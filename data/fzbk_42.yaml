- en: Error Handling
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 错误处理
- en: 原文：[http://www.fuzzingbook.org/html/ExpectError.html](http://www.fuzzingbook.org/html/ExpectError.html)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 原文：[http://www.fuzzingbook.org/html/ExpectError.html](http://www.fuzzingbook.org/html/ExpectError.html)
- en: The code in this notebook helps with handling errors. Normally, an error in
    notebook code causes the execution of the code to stop; while an infinite loop
    in notebook code causes the notebook to run without end. This notebook provides
    two classes to help address these concerns.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 这个笔记本中的代码有助于处理错误。通常，笔记本中的错误会导致代码执行停止；而笔记本中的无限循环会导致笔记本无限运行。这个笔记本提供了两个类来帮助解决这些问题。
- en: '**Prerequisites**'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: '**先决条件**'
- en: This notebook needs some understanding on advanced concepts in Python, notably
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 这个笔记本需要对 Python 的高级概念有所了解，特别是
- en: classes
  id: totrans-5
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 类
- en: the Python `with` statement
  id: totrans-6
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: Python 的 `with` 语句
- en: tracing
  id: totrans-7
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 跟踪
- en: measuring time
  id: totrans-8
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 测量时间
- en: exceptions
  id: totrans-9
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 异常
- en: Synopsis
  id: totrans-10
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 概述
- en: To [use the code provided in this chapter](Importing.html), write
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用本章提供的代码（Importing.html），请编写
- en: '[PRE0]'
  id: totrans-12
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: and then make use of the following features.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 然后利用以下功能。
- en: 'The `ExpectError` class allows you to catch and report exceptions, yet resume
    execution. This is useful in notebooks, as they would normally interrupt execution
    as soon as an exception is raised. Its typical usage is in conjunction with a
    `with` clause:'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: '`ExpectError` 类允许你捕获并报告异常，同时继续执行。这在笔记本中很有用，因为它们通常会一遇到异常就中断执行。它的典型用法是与 `with`
    语句结合：'
- en: '[PRE1]'
  id: totrans-15
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: The `ExpectTimeout` class allows you to interrupt execution after the specified
    time. This is useful for interrupting code that might otherwise run forever.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: '`ExpectTimeout` 类允许你在指定的时间后中断执行。这对于中断可能无限运行的代码很有用。'
- en: '[PRE2]'
  id: totrans-17
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'The exception and the associated traceback are printed as error messages. If
    you do not want that, use these keyword options:'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 异常及其相关的堆栈跟踪会作为错误消息打印。如果你不希望这样，可以使用以下关键字选项：
- en: '`print_traceback` (default True) can be set to `False` to avoid the traceback
    being printed'
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`print_traceback`（默认为 True）可以设置为 `False` 以避免打印堆栈跟踪'
- en: '`mute` (default False) can be set to `True` to completely avoid any output.'
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`mute`（默认为 False）可以设置为 `True` 以完全避免任何输出。'
- en: Catching Errors
  id: totrans-21
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 捕获错误
- en: 'The class `ExpectError` allows to express that some code produces an exception.
    A typical usage looks as follows:'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: '`ExpectError` 类允许表达某些代码会产生异常。典型的用法如下：'
- en: '[PRE3]'
  id: totrans-23
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: If an exception occurs, it is printed on standard error; yet, execution continues.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 如果发生异常，它会在标准错误上打印；然而，执行继续。
- en: '[PRE4]'
  id: totrans-25
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: '[PRE5]'
  id: totrans-26
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: '[PRE6]'
  id: totrans-27
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: '[PRE7]'
  id: totrans-28
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'Here''s an example:'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 这里有一个例子：
- en: '[PRE8]'
  id: totrans-30
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: '[PRE9]'
  id: totrans-31
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: '[PRE10]'
  id: totrans-32
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: '[PRE11]'
  id: totrans-33
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: '[PRE12]'
  id: totrans-34
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: We can specify the type of the expected exception. This way, if something else
    happens, we will get notified.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以指定期望的异常类型。这样，如果发生其他情况，我们会收到通知。
- en: '[PRE13]'
  id: totrans-36
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: '[PRE14]'
  id: totrans-37
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: '[PRE15]'
  id: totrans-38
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: '[PRE16]'
  id: totrans-39
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: Catching Timeouts
  id: totrans-40
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 捕获超时
- en: 'The class `ExpectTimeout(seconds)` allows expressing that some code may run
    for a long or infinite time; execution is thus interrupted after `seconds` seconds.
    A typical usage looks as follows:'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: '`ExpectTimeout(seconds)` 类允许表达某些代码可能运行很长时间或无限时间；因此，在 `seconds` 秒后中断执行。典型的用法如下：'
- en: '[PRE17]'
  id: totrans-42
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: If an exception occurs, it is printed on standard error (as with `ExpectError`);
    yet, execution continues.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 如果发生异常，它会在标准错误上打印（与 `ExpectError` 类似）；然而，执行继续。
- en: Should there be a need to cancel the timeout within the `with` block, `t.cancel()`
    will do the trick.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 如果需要在 `with` 块内取消超时，`t.cancel()` 将会起作用。
- en: The implementation uses `sys.settrace()`, as this seems to be the most portable
    way to implement timeouts. It is not very efficient, though. Also, it only works
    on individual lines of Python code and will not interrupt a long-running system
    function.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 实现使用 `sys.settrace()`，因为这似乎是实现超时最可移植的方法。然而，它并不高效。此外，它只适用于单个 Python 代码行，并且不会中断长时间运行的系统函数。
- en: '[PRE18]'
  id: totrans-46
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: '[PRE19]'
  id: totrans-47
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: '[PRE20]'
  id: totrans-48
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'Here''s an example:'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 这里有一个例子：
- en: '[PRE21]'
  id: totrans-50
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: '[PRE22]'
  id: totrans-51
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: '[PRE23]'
  id: totrans-52
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: '[PRE24]'
  id: totrans-53
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: Note that it is possible to nest multiple timeouts.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，可以嵌套多个超时。
- en: '[PRE25]'
  id: totrans-55
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: '[PRE26]'
  id: totrans-56
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: '[PRE27]'
  id: totrans-57
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: '[PRE28]'
  id: totrans-58
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: '[PRE29]'
  id: totrans-59
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: That's it, folks – enjoy!
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 就这样，朋友们——享受吧！
- en: Lessons Learned
  id: totrans-61
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 经验教训
- en: With the `ExpectError` class, it is very easy to handle errors without interrupting
    notebook execution.
  id: totrans-62
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 `ExpectError` 类，可以非常容易地处理错误，而不会中断笔记本执行。
- en: '![Creative Commons License](../Images/2f3faa36146c6fb38bbab67add09aa5f.png)
    The content of this project is licensed under the [Creative Commons Attribution-NonCommercial-ShareAlike
    4.0 International License](https://creativecommons.org/licenses/by-nc-sa/4.0/).
    The source code that is part of the content, as well as the source code used to
    format and display that content is licensed under the [MIT License](https://github.com/uds-se/fuzzingbook/blob/master/LICENSE.md#mit-license).
    [Last change: 2023-11-11 18:25:46+01:00](https://github.com/uds-se/fuzzingbook/commits/master/notebooks/ExpectError.ipynb)
    • [Cite](#citation) • [Imprint](https://cispa.de/en/impressum)'
  id: totrans-63
  prefs: []
  type: TYPE_IMG
  zh: '![Creative Commons License](../Images/2f3faa36146c6fb38bbab67add09aa5f.png)
    本项目的内 容受[Creative Commons Attribution-NonCommercial-ShareAlike 4.0 国际许可协议](https://creativecommons.org/licenses/by-nc-sa/4.0/)的许可。作为内容一部分的源代码，以及用于格式化和显示该内容的源代码，受[MIT
    许可协议](https://github.com/uds-se/fuzzingbook/blob/master/LICENSE.md#mit-license)的许可。
    [最后修改：2023-11-11 18:25:46+01:00](https://github.com/uds-se/fuzzingbook/commits/master/notebooks/ExpectError.ipynb)
    • [引用](#citation) • [版权信息](https://cispa.de/en/impressum)'
- en: How to Cite this Work
  id: totrans-64
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何引用这篇作品
- en: 'Andreas Zeller, Rahul Gopinath, Marcel Böhme, Gordon Fraser, and Christian
    Holler: "[Error Handling](https://www.fuzzingbook.org/html/ExpectError.html)".
    In Andreas Zeller, Rahul Gopinath, Marcel Böhme, Gordon Fraser, and Christian
    Holler, "[The Fuzzing Book](https://www.fuzzingbook.org/)", [https://www.fuzzingbook.org/html/ExpectError.html](https://www.fuzzingbook.org/html/ExpectError.html).
    Retrieved 2023-11-11 18:25:46+01:00.'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 'Andreas Zeller, Rahul Gopinath, Marcel Böhme, Gordon Fraser, 和 Christian Holler:
    "[错误处理](https://www.fuzzingbook.org/html/ExpectError.html)". In Andreas Zeller,
    Rahul Gopinath, Marcel Böhme, Gordon Fraser, 和 Christian Holler, "[模糊测试书](https://www.fuzzingbook.org/)",
    [https://www.fuzzingbook.org/html/ExpectError.html](https://www.fuzzingbook.org/html/ExpectError.html).
    Retrieved 2023-11-11 18:25:46+01:00.'
- en: '[PRE30]'
  id: totrans-66
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
