<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Railroad Diagrams</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Railroad Diagrams</h1>
<blockquote>原文：<a href="http://www.fuzzingbook.org/html/RailroadDiagrams.html">http://www.fuzzingbook.org/html/RailroadDiagrams.html</a></blockquote>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The code in this notebook helps with drawing syntax-diagrams.  It is a (slightly customized) copy of the <a href="https://github.com/tabatkins/railroad-diagrams">excellent library from Tab Atkins jr.</a>, which unfortunately is not available as a Python package.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p><strong>Prerequisites</strong></p>
<p>This notebook needs some understanding on advanced concepts in Python and Graphics, notably</p>

<pre><code>* classes
* the Python `with` statement
* Scalable Vector Graphics</code></pre>
</div>
</div>
</div>
</div>

<details id="Excursion:-Railroad-diagrams-implementation">
<summary>Railroad diagrams implementation</summary>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="kn">import</span> <span class="nn"><a href="https://github.com/uds-se/fuzzingbook//tree/master/notebooks/shared/bookutils" class="import" target="_blank">bookutils.setup</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/re.html" class="import" target="_blank">re</a></span>
<span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/io.html" class="import" target="_blank">io</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">C</span><span class="p">:</span>
    <span class="c1"># Display constants</span>
    <span class="n">DEBUG</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># if true, writes some debug information into attributes</span>
    <span class="n">VS</span> <span class="o">=</span> <span class="mi">8</span>  <span class="c1"># minimum vertical separation between things. For a 3px stroke, must be at least 4</span>
    <span class="n">AR</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># radius of arcs</span>
    <span class="n">DIAGRAM_CLASS</span> <span class="o">=</span> <span class="s1">'railroad-diagram'</span>  <span class="c1"># class to put on the root &lt;svg&gt;</span>
    <span class="c1"># is the stroke width an odd (1px, 3px, etc) pixel length?</span>
    <span class="n">STROKE_ODD_PIXEL_LENGTH</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="c1"># how to align items when they have extra space. left/right/center</span>
    <span class="n">INTERNAL_ALIGNMENT</span> <span class="o">=</span> <span class="s1">'center'</span>
    <span class="c1"># width of each monospace character. play until you find the right value</span>
    <span class="c1"># for your font</span>
    <span class="n">CHAR_WIDTH</span> <span class="o">=</span> <span class="mf">8.5</span>
    <span class="n">COMMENT_CHAR_WIDTH</span> <span class="o">=</span> <span class="mi">7</span>  <span class="c1"># comments are in smaller text by default</span>

    <span class="n">DEFAULT_STYLE</span> <span class="o">=</span> <span class="s1">'''</span><span class="se">\</span>
<span class="s1">    svg.railroad-diagram {</span>
<span class="s1">    }</span>
<span class="s1">    svg.railroad-diagram path {</span>
<span class="s1">        stroke-width:3;</span>
<span class="s1">        stroke:black;</span>
<span class="s1">        fill:white;</span>
<span class="s1">    }</span>
<span class="s1">    svg.railroad-diagram text {</span>
<span class="s1">        font:14px "Fira Mono", monospace;</span>
<span class="s1">        text-anchor:middle;</span>
<span class="s1">    }</span>
<span class="s1">    svg.railroad-diagram text.label{</span>
<span class="s1">        text-anchor:start;</span>
<span class="s1">    }</span>
<span class="s1">    svg.railroad-diagram text.comment{</span>
<span class="s1">        font:italic 12px "Fira Mono", monospace;</span>
<span class="s1">    }</span>
<span class="s1">    svg.railroad-diagram rect{</span>
<span class="s1">        stroke-width:2;</span>
<span class="s1">        stroke:black;</span>
<span class="s1">        fill:mistyrose;</span>
<span class="s1">    }</span>
<span class="s1">'''</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">e</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">"&amp;"</span><span class="p">,</span> <span class="s1">'&amp;amp;'</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">"&lt;"</span><span class="p">,</span> <span class="s1">'&amp;lt;'</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">"&gt;"</span><span class="p">,</span> <span class="s1">'&amp;gt;'</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">determineGaps</span><span class="p">(</span><span class="n">outer</span><span class="p">,</span> <span class="n">inner</span><span class="p">):</span>
    <span class="n">diff</span> <span class="o">=</span> <span class="n">outer</span> <span class="o">-</span> <span class="n">inner</span>
    <span class="k">if</span> <span class="n">C</span><span class="o">.</span><span class="n">INTERNAL_ALIGNMENT</span> <span class="o">==</span> <span class="s1">'left'</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="n">diff</span>
    <span class="k">elif</span> <span class="n">C</span><span class="o">.</span><span class="n">INTERNAL_ALIGNMENT</span> <span class="o">==</span> <span class="s1">'right'</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">diff</span><span class="p">,</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">diff</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">diff</span> <span class="o">/</span> <span class="mi">2</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">doubleenumerate</span><span class="p">(</span><span class="n">seq</span><span class="p">):</span>
    <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">seq</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">seq</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="n">length</span><span class="p">,</span> <span class="n">item</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">addDebug</span><span class="p">(</span><span class="n">el</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">C</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">el</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">'data-x'</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"</span><span class="si">{0}</span><span class="s2"> w:</span><span class="si">{1}</span><span class="s2"> h:</span><span class="si">{2}</span><span class="s2">/</span><span class="si">{3}</span><span class="s2">/</span><span class="si">{4}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="nb">type</span><span class="p">(</span><span class="n">el</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">el</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">el</span><span class="o">.</span><span class="n">up</span><span class="p">,</span> <span class="n">el</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="n">el</span><span class="o">.</span><span class="n">down</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">DiagramItem</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="c1"># up = distance it projects above the entry line</span>
        <span class="c1"># height = distance between the entry/exit lines</span>
        <span class="c1"># down = distance it projects below the exit line</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="n">attrs</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">[</span><span class="n">text</span><span class="p">]</span> <span class="k">if</span> <span class="n">text</span> <span class="k">else</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">needsSpace</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">width</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>  <span class="c1"># Virtual</span>

    <span class="k">def</span> <span class="nf">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">writeSvg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">write</span><span class="p">):</span>
        <span class="n">write</span><span class="p">(</span><span class="sa">u</span><span class="s1">'&lt;</span><span class="si">{0}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">write</span><span class="p">(</span><span class="sa">u</span><span class="s1">' </span><span class="si">{0}</span><span class="s1">="</span><span class="si">{1}</span><span class="s1">"'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">e</span><span class="p">(</span><span class="n">value</span><span class="p">)))</span>
        <span class="n">write</span><span class="p">(</span><span class="sa">u</span><span class="s1">'&gt;'</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">"g"</span><span class="p">,</span> <span class="s2">"svg"</span><span class="p">]:</span>
            <span class="n">write</span><span class="p">(</span><span class="sa">u</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">DiagramItem</span><span class="p">):</span>
                <span class="n">child</span><span class="o">.</span><span class="n">writeSvg</span><span class="p">(</span><span class="n">write</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">write</span><span class="p">(</span><span class="n">e</span><span class="p">(</span><span class="n">child</span><span class="p">))</span>
        <span class="n">write</span><span class="p">(</span><span class="sa">u</span><span class="s1">'&lt;/</span><span class="si">{0}</span><span class="s1">&gt;'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span>
            <span class="n">other</span><span class="p">))</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="vm">__dict__</span>

    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span> <span class="o">==</span> <span class="n">other</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">Path</span><span class="p">(</span><span class="n">DiagramItem</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>
        <span class="n">DiagramItem</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">'path'</span><span class="p">,</span> <span class="p">{</span><span class="s1">'d'</span><span class="p">:</span> <span class="s1">'M</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">'</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)})</span>

    <span class="k">def</span> <span class="nf">m</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">'d'</span><span class="p">]</span> <span class="o">+=</span> <span class="s1">'m</span><span class="si">{0}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">ll</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>   <span class="c1"># was l(), which violates PEP8 -- AZ</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">'d'</span><span class="p">]</span> <span class="o">+=</span> <span class="s1">'l</span><span class="si">{0}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">h</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">'d'</span><span class="p">]</span> <span class="o">+=</span> <span class="s1">'h</span><span class="si">{0}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">right</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">val</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">left</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="o">-</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">val</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">v</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">'d'</span><span class="p">]</span> <span class="o">+=</span> <span class="s1">'v</span><span class="si">{0}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">down</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">val</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">up</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">(</span><span class="o">-</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">val</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">arc_8</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="nb">dir</span><span class="p">):</span>
        <span class="c1"># 1/8 of a circle</span>
        <span class="n">arc</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span>
        <span class="n">s2</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">arc</span>
        <span class="n">s2inv</span> <span class="o">=</span> <span class="p">(</span><span class="n">arc</span> <span class="o">-</span> <span class="n">s2</span><span class="p">)</span>
        <span class="n">path</span> <span class="o">=</span> <span class="s2">"a </span><span class="si">{0}</span><span class="s2"> </span><span class="si">{0}</span><span class="s2"> 0 0 </span><span class="si">{1}</span><span class="s2"> "</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">arc</span><span class="p">,</span> <span class="s2">"1"</span> <span class="k">if</span> <span class="nb">dir</span> <span class="o">==</span> <span class="s1">'cw'</span> <span class="k">else</span> <span class="s2">"0"</span><span class="p">)</span>
        <span class="n">sd</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="nb">dir</span>
        <span class="k">if</span> <span class="n">sd</span> <span class="o">==</span> <span class="s1">'ncw'</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="p">[</span><span class="n">s2</span><span class="p">,</span> <span class="n">s2inv</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">sd</span> <span class="o">==</span> <span class="s1">'necw'</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="p">[</span><span class="n">s2inv</span><span class="p">,</span> <span class="n">s2</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">sd</span> <span class="o">==</span> <span class="s1">'ecw'</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">s2inv</span><span class="p">,</span> <span class="n">s2</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">sd</span> <span class="o">==</span> <span class="s1">'secw'</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">s2</span><span class="p">,</span> <span class="n">s2inv</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">sd</span> <span class="o">==</span> <span class="s1">'scw'</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">s2</span><span class="p">,</span> <span class="o">-</span><span class="n">s2inv</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">sd</span> <span class="o">==</span> <span class="s1">'swcw'</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">s2inv</span><span class="p">,</span> <span class="o">-</span><span class="n">s2</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">sd</span> <span class="o">==</span> <span class="s1">'wcw'</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="p">[</span><span class="n">s2inv</span><span class="p">,</span> <span class="o">-</span><span class="n">s2</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">sd</span> <span class="o">==</span> <span class="s1">'nwcw'</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="p">[</span><span class="n">s2</span><span class="p">,</span> <span class="o">-</span><span class="n">s2inv</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">sd</span> <span class="o">==</span> <span class="s1">'nccw'</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">s2</span><span class="p">,</span> <span class="n">s2inv</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">sd</span> <span class="o">==</span> <span class="s1">'nwccw'</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">s2inv</span><span class="p">,</span> <span class="n">s2</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">sd</span> <span class="o">==</span> <span class="s1">'wccw'</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="p">[</span><span class="n">s2inv</span><span class="p">,</span> <span class="n">s2</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">sd</span> <span class="o">==</span> <span class="s1">'swccw'</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="p">[</span><span class="n">s2</span><span class="p">,</span> <span class="n">s2inv</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">sd</span> <span class="o">==</span> <span class="s1">'sccw'</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="p">[</span><span class="n">s2</span><span class="p">,</span> <span class="o">-</span><span class="n">s2inv</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">sd</span> <span class="o">==</span> <span class="s1">'seccw'</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="p">[</span><span class="n">s2inv</span><span class="p">,</span> <span class="o">-</span><span class="n">s2</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">sd</span> <span class="o">==</span> <span class="s1">'eccw'</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">s2inv</span><span class="p">,</span> <span class="o">-</span><span class="n">s2</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">sd</span> <span class="o">==</span> <span class="s1">'neccw'</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">s2</span><span class="p">,</span> <span class="o">-</span><span class="n">s2inv</span><span class="p">]</span>

        <span class="n">path</span> <span class="o">+=</span> <span class="s2">" "</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">offset</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">'d'</span><span class="p">]</span> <span class="o">+=</span> <span class="n">path</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">arc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sweep</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span>
        <span class="k">if</span> <span class="n">sweep</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'e'</span> <span class="ow">or</span> <span class="n">sweep</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'w'</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">sweep</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'s'</span> <span class="ow">or</span> <span class="n">sweep</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'n'</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">cw</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">sweep</span> <span class="o">==</span> <span class="s1">'ne'</span> <span class="ow">or</span> <span class="n">sweep</span> <span class="o">==</span> <span class="s1">'es'</span> <span class="ow">or</span> <span class="n">sweep</span> <span class="o">==</span> <span class="s1">'sw'</span> <span class="ow">or</span> <span class="n">sweep</span> <span class="o">==</span> <span class="s1">'wn'</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">'d'</span><span class="p">]</span> <span class="o">+=</span> <span class="s1">'a</span><span class="si">{0}</span><span class="s1"> </span><span class="si">{0}</span><span class="s1"> 0 0 </span><span class="si">{1}</span><span class="s1"> </span><span class="si">{2}</span><span class="s1"> </span><span class="si">{3}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">AR</span><span class="p">,</span> <span class="n">cw</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">'d'</span><span class="p">]</span> <span class="o">+=</span> <span class="s1">'h.5'</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">'Path(</span><span class="si">%r</span><span class="s1">, </span><span class="si">%r</span><span class="s1">)'</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">wrapString</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">value</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">DiagramItem</span><span class="p">)</span> <span class="k">else</span> <span class="n">Terminal</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">Style</span><span class="p">(</span><span class="n">DiagramItem</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">css</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">'style'</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">css</span> <span class="o">=</span> <span class="n">css</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">needsSpace</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">'Style(</span><span class="si">%r</span><span class="s1">)'</span> <span class="o">%</span> <span class="n">css</span>

    <span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">width</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">writeSvg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">write</span><span class="p">):</span>
        <span class="c1"># Write included stylesheet as CDATA. See</span>
        <span class="c1"># https:#developer.mozilla.org/en-US/docs/Web/SVG/Element/style</span>
        <span class="n">cdata</span> <span class="o">=</span> <span class="sa">u</span><span class="s1">'/* &lt;![CDATA[ */</span><span class="se">\n</span><span class="si">{css}</span><span class="se">\n</span><span class="s1">/* ]]&gt; */</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">css</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">css</span><span class="p">)</span>
        <span class="n">write</span><span class="p">(</span><span class="sa">u</span><span class="s1">'&lt;style&gt;</span><span class="si">{cdata}</span><span class="s1">&lt;/style&gt;'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cdata</span><span class="o">=</span><span class="n">cdata</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">Diagram</span><span class="p">(</span><span class="n">DiagramItem</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">items</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># Accepts a type=[simple|complex] kwarg</span>
        <span class="n">DiagramItem</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="s1">'svg'</span><span class="p">,</span> <span class="p">{</span><span class="s1">'class'</span><span class="p">:</span> <span class="n">C</span><span class="o">.</span><span class="n">DIAGRAM_CLASS</span><span class="p">,</span> <span class="s1">'xmlns'</span><span class="p">:</span> <span class="s2">"http://www.w3.org/2000/svg"</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"type"</span><span class="p">,</span> <span class="s2">"simple"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">wrapString</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">items</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Start</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Start</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">items</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">End</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">End</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">css</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"css"</span><span class="p">,</span> <span class="n">C</span><span class="o">.</span><span class="n">DEFAULT_STYLE</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">css</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Style</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">css</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">up</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">down</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">Style</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">+=</span> <span class="n">item</span><span class="o">.</span><span class="n">width</span> <span class="o">+</span> <span class="p">(</span><span class="mi">20</span> <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">needsSpace</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">up</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">up</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">up</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">+=</span> <span class="n">item</span><span class="o">.</span><span class="n">height</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">down</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">down</span> <span class="o">-</span> <span class="n">item</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">down</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">needsSpace</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">-=</span> <span class="mi">10</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">needsSpace</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">-=</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">formatted</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">css</span><span class="p">:</span>
            <span class="n">items</span> <span class="o">=</span> <span class="s1">', '</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">repr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">items</span> <span class="o">=</span> <span class="s1">', '</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">repr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">pieces</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">items</span> <span class="k">else</span> <span class="p">[</span><span class="n">items</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">css</span> <span class="o">!=</span> <span class="n">C</span><span class="o">.</span><span class="n">DEFAULT_STYLE</span><span class="p">:</span>
            <span class="n">pieces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">'css=</span><span class="si">%r</span><span class="s1">'</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">css</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="s1">'simple'</span><span class="p">:</span>
            <span class="n">pieces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">'type=</span><span class="si">%r</span><span class="s1">'</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">'Diagram(</span><span class="si">%s</span><span class="s1">)'</span> <span class="o">%</span> <span class="s1">', '</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pieces</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">paddingTop</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">paddingRight</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">paddingBottom</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">paddingLeft</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">paddingRight</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">paddingRight</span> <span class="o">=</span> <span class="n">paddingTop</span>
        <span class="k">if</span> <span class="n">paddingBottom</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">paddingBottom</span> <span class="o">=</span> <span class="n">paddingTop</span>
        <span class="k">if</span> <span class="n">paddingLeft</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">paddingLeft</span> <span class="o">=</span> <span class="n">paddingRight</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">paddingLeft</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">paddingTop</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">up</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">DiagramItem</span><span class="p">(</span><span class="s1">'g'</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">C</span><span class="o">.</span><span class="n">STROKE_ODD_PIXEL_LENGTH</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">'transform'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'translate(.5 .5)'</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">needsSpace</span><span class="p">:</span>
                <span class="n">Path</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">+=</span> <span class="mi">10</span>
            <span class="n">item</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">width</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">+=</span> <span class="n">item</span><span class="o">.</span><span class="n">width</span>
            <span class="n">y</span> <span class="o">+=</span> <span class="n">item</span><span class="o">.</span><span class="n">height</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">needsSpace</span><span class="p">:</span>
                <span class="n">Path</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">+=</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">'width'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">+</span> <span class="n">paddingLeft</span> <span class="o">+</span> <span class="n">paddingRight</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">'height'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">up</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">+</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">down</span> <span class="o">+</span> <span class="n">paddingTop</span> <span class="o">+</span> <span class="n">paddingBottom</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">'viewBox'</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"0 0 </span><span class="si">{width}</span><span class="s2"> </span><span class="si">{height}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">formatted</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">writeSvg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">write</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatted</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">DiagramItem</span><span class="o">.</span><span class="n">writeSvg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">write</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">parseCSSGrammar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="n">token_patterns</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">'keyword'</span><span class="p">:</span> <span class="sa">r</span><span class="s2">"[\w-]+\(?"</span><span class="p">,</span>
            <span class="s1">'type'</span><span class="p">:</span> <span class="sa">r</span><span class="s2">"&lt;[\w-]+(\(\))?&gt;"</span><span class="p">,</span>
            <span class="s1">'char'</span><span class="p">:</span> <span class="sa">r</span><span class="s2">"[/,()]"</span><span class="p">,</span>
            <span class="s1">'literal'</span><span class="p">:</span> <span class="sa">r</span><span class="s2">"'(.)'"</span><span class="p">,</span>
            <span class="s1">'openbracket'</span><span class="p">:</span> <span class="sa">r</span><span class="s2">"\["</span><span class="p">,</span>
            <span class="s1">'closebracket'</span><span class="p">:</span> <span class="sa">r</span><span class="s2">"\]"</span><span class="p">,</span>
            <span class="s1">'closebracketbang'</span><span class="p">:</span> <span class="sa">r</span><span class="s2">"\]!"</span><span class="p">,</span>
            <span class="s1">'bar'</span><span class="p">:</span> <span class="sa">r</span><span class="s2">"\|"</span><span class="p">,</span>
            <span class="s1">'doublebar'</span><span class="p">:</span> <span class="sa">r</span><span class="s2">"\|\|"</span><span class="p">,</span>
            <span class="s1">'doubleand'</span><span class="p">:</span> <span class="sa">r</span><span class="s2">"&amp;&amp;"</span><span class="p">,</span>
            <span class="s1">'multstar'</span><span class="p">:</span> <span class="sa">r</span><span class="s2">"\*"</span><span class="p">,</span>
            <span class="s1">'multplus'</span><span class="p">:</span> <span class="sa">r</span><span class="s2">"\+"</span><span class="p">,</span>
            <span class="s1">'multhash'</span><span class="p">:</span> <span class="sa">r</span><span class="s2">"#"</span><span class="p">,</span>
            <span class="s1">'multnum1'</span><span class="p">:</span> <span class="sa">r</span><span class="s2">"{\s*(\d+)\s*}"</span><span class="p">,</span>
            <span class="s1">'multnum2'</span><span class="p">:</span> <span class="sa">r</span><span class="s2">"{\s*(\d+)\s*,\s*(\d*)\s*}"</span><span class="p">,</span>
            <span class="s1">'multhashnum1'</span><span class="p">:</span> <span class="sa">r</span><span class="s2">"#{\s*(\d+)\s*}"</span><span class="p">,</span>
            <span class="s1">'multhashnum2'</span><span class="p">:</span> <span class="sa">r</span><span class="s2">"{\s*(\d+)\s*,\s*(\d*)\s*}"</span>
        <span class="p">}</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">Sequence</span><span class="p">(</span><span class="n">DiagramItem</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">items</span><span class="p">):</span>
        <span class="n">DiagramItem</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">'g'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">wrapString</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">needsSpace</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">up</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">down</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">+=</span> <span class="n">item</span><span class="o">.</span><span class="n">width</span> <span class="o">+</span> <span class="p">(</span><span class="mi">20</span> <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">needsSpace</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">up</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">up</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">up</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">+=</span> <span class="n">item</span><span class="o">.</span><span class="n">height</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">down</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">down</span> <span class="o">-</span> <span class="n">item</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">down</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">needsSpace</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">-=</span> <span class="mi">10</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">needsSpace</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">-=</span> <span class="mi">10</span>
        <span class="n">addDebug</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">items</span> <span class="o">=</span> <span class="s1">', '</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">repr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">))</span>
        <span class="k">return</span> <span class="s1">'Sequence(</span><span class="si">%s</span><span class="s1">)'</span> <span class="o">%</span> <span class="n">items</span>

    <span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">width</span><span class="p">):</span>
        <span class="n">leftGap</span><span class="p">,</span> <span class="n">rightGap</span> <span class="o">=</span> <span class="n">determineGaps</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>
        <span class="n">Path</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="n">leftGap</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">Path</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">leftGap</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">)</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="n">rightGap</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">+=</span> <span class="n">leftGap</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">needsSpace</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">Path</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">+=</span> <span class="mi">10</span>
            <span class="n">item</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">width</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">+=</span> <span class="n">item</span><span class="o">.</span><span class="n">width</span>
            <span class="n">y</span> <span class="o">+=</span> <span class="n">item</span><span class="o">.</span><span class="n">height</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">needsSpace</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">Path</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">+=</span> <span class="mi">10</span>
        <span class="k">return</span> <span class="bp">self</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">Stack</span><span class="p">(</span><span class="n">DiagramItem</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">items</span><span class="p">):</span>
        <span class="n">DiagramItem</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">'g'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">wrapString</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">needsSpace</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">width</span> <span class="o">+</span> <span class="p">(</span><span class="mi">20</span> <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">needsSpace</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
                         <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">)</span>
        <span class="c1"># pretty sure that space calc is totes wrong</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">+=</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">up</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">up</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">down</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">down</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">last</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">+=</span> <span class="n">item</span><span class="o">.</span><span class="n">height</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">+=</span> <span class="nb">max</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">up</span> <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">VS</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">last</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">+=</span> <span class="nb">max</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">down</span> <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">VS</span><span class="p">)</span>
        <span class="n">addDebug</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">items</span> <span class="o">=</span> <span class="s1">', '</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">'Stack(</span><span class="si">%s</span><span class="s1">)'</span> <span class="o">%</span> <span class="n">items</span>

    <span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">width</span><span class="p">):</span>
        <span class="n">leftGap</span><span class="p">,</span> <span class="n">rightGap</span> <span class="o">=</span> <span class="n">determineGaps</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>
        <span class="n">Path</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="n">leftGap</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">+=</span> <span class="n">leftGap</span>
        <span class="n">xInitial</span> <span class="o">=</span> <span class="n">x</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">Path</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">AR</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">+=</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span>
            <span class="n">innerWidth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">innerWidth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">):</span>
            <span class="n">item</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">innerWidth</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">+=</span> <span class="n">innerWidth</span>
            <span class="n">y</span> <span class="o">+=</span> <span class="n">item</span><span class="o">.</span><span class="n">height</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">arc</span><span class="p">(</span><span class="s1">'ne'</span><span class="p">)</span><span class="o">.</span><span class="n">down</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">down</span> <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">VS</span> <span class="o">-</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span>
                    <span class="o">.</span><span class="n">arc</span><span class="p">(</span><span class="s1">'es'</span><span class="p">)</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="n">innerWidth</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">arc</span><span class="p">(</span><span class="s1">'nw'</span><span class="p">)</span><span class="o">.</span><span class="n">down</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">up</span> <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">VS</span> <span class="o">-</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span>
                    <span class="o">.</span><span class="n">arc</span><span class="p">(</span><span class="s1">'ws'</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
                <span class="n">y</span> <span class="o">+=</span> <span class="nb">max</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">down</span> <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">VS</span><span class="p">,</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> \
                    <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">up</span> <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">VS</span><span class="p">,</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">xInitial</span> <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">Path</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">AR</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">+=</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span>
        <span class="n">Path</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="n">rightGap</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">OptionalSequence</span><span class="p">(</span><span class="n">DiagramItem</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">items</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Sequence</span><span class="p">(</span><span class="o">*</span><span class="n">items</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">OptionalSequence</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">items</span><span class="p">):</span>
        <span class="n">DiagramItem</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">'g'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">wrapString</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">needsSpace</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">up</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">height</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">down</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">down</span>
        <span class="n">heightSoFar</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">up</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">up</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">up</span> <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">VS</span><span class="p">)</span> <span class="o">-</span> <span class="n">heightSoFar</span><span class="p">)</span>
            <span class="n">heightSoFar</span> <span class="o">+=</span> <span class="n">item</span><span class="o">.</span><span class="n">height</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">down</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">down</span><span class="p">,</span> <span class="n">heightSoFar</span>
                                <span class="o">+</span> <span class="nb">max</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">down</span> <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">VS</span><span class="p">))</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span>
            <span class="n">itemWidth</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">width</span> <span class="o">+</span> <span class="p">(</span><span class="mi">20</span> <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">needsSpace</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">+=</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">+</span> <span class="nb">max</span><span class="p">(</span><span class="n">itemWidth</span><span class="p">,</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">+=</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="nb">max</span><span class="p">(</span><span class="n">itemWidth</span><span class="p">,</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span><span class="p">)</span> <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span>
        <span class="n">addDebug</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">items</span> <span class="o">=</span> <span class="s1">', '</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">'OptionalSequence(</span><span class="si">%s</span><span class="s1">)'</span> <span class="o">%</span> <span class="n">items</span>

    <span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">width</span><span class="p">):</span>
        <span class="n">leftGap</span><span class="p">,</span> <span class="n">rightGap</span> <span class="o">=</span> <span class="n">determineGaps</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>
        <span class="n">Path</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="n">leftGap</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">Path</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">leftGap</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">y</span>
             <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">)</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="n">rightGap</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">+=</span> <span class="n">leftGap</span>
        <span class="n">upperLineY</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">up</span>
        <span class="n">last</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">):</span>
            <span class="n">itemSpace</span> <span class="o">=</span> <span class="mi">10</span> <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">needsSpace</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="n">itemWidth</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">width</span> <span class="o">+</span> <span class="n">itemSpace</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># Upper skip</span>
                <span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">arc</span><span class="p">(</span><span class="s1">'se'</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">up</span><span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">upperLineY</span> <span class="o">-</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">arc</span><span class="p">(</span><span class="s1">'wn'</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="n">itemWidth</span> <span class="o">-</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">arc</span><span class="p">(</span><span class="s1">'ne'</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">down</span><span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="n">item</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="n">upperLineY</span> <span class="o">-</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">arc</span><span class="p">(</span><span class="s1">'ws'</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
                <span class="c1"># Straight line</span>
                <span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="n">itemSpace</span> <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
                <span class="n">item</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">itemSpace</span> <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">width</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">+=</span> <span class="n">itemWidth</span> <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span>
                <span class="n">y</span> <span class="o">+=</span> <span class="n">item</span><span class="o">.</span><span class="n">height</span>
            <span class="k">elif</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">last</span><span class="p">:</span>
                <span class="c1"># Upper skip</span>
                <span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">upperLineY</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="nb">max</span><span class="p">(</span><span class="n">itemWidth</span><span class="p">,</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span><span class="p">)</span> <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">arc</span><span class="p">(</span><span class="s1">'ne'</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">down</span><span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">upperLineY</span> <span class="o">+</span> <span class="n">item</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">arc</span><span class="p">(</span><span class="s1">'ws'</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
                <span class="c1"># Straight line</span>
                <span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
                <span class="n">item</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">width</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">item</span><span class="o">.</span><span class="n">width</span> <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">item</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="n">itemSpace</span> <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
                <span class="c1"># Lower skip</span>
                <span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">arc</span><span class="p">(</span><span class="s1">'ne'</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">down</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">height</span> <span class="o">+</span> <span class="nb">max</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">down</span> <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">VS</span><span class="p">,</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">arc</span><span class="p">(</span><span class="s1">'ws'</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="n">itemWidth</span> <span class="o">-</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">arc</span><span class="p">(</span><span class="s1">'se'</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">up</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">down</span> <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">VS</span> <span class="o">-</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">arc</span><span class="p">(</span><span class="s1">'wn'</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
                <span class="n">x</span> <span class="o">+=</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="nb">max</span><span class="p">(</span><span class="n">itemWidth</span><span class="p">,</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span><span class="p">)</span> <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span>
                <span class="n">y</span> <span class="o">+=</span> <span class="n">item</span><span class="o">.</span><span class="n">height</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Straight line</span>
                <span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
                <span class="n">item</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">width</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">item</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">item</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="n">itemSpace</span> <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
                <span class="c1"># Lower skip</span>
                <span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">arc</span><span class="p">(</span><span class="s1">'ne'</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">down</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">height</span> <span class="o">+</span> <span class="nb">max</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">down</span> <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">VS</span><span class="p">,</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">arc</span><span class="p">(</span><span class="s1">'ws'</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="n">itemWidth</span> <span class="o">-</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">arc</span><span class="p">(</span><span class="s1">'se'</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">up</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">down</span> <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">VS</span> <span class="o">-</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">arc</span><span class="p">(</span><span class="s1">'wn'</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">AlternatingSequence</span><span class="p">(</span><span class="n">DiagramItem</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">items</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">AlternatingSequence</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">"AlternatingSequence takes exactly two arguments got "</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">items</span><span class="p">):</span>
        <span class="n">DiagramItem</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">'g'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">wrapString</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">needsSpace</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">arc</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span>
        <span class="n">vert</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">VS</span>
        <span class="n">first</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">second</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">arcX</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">arc</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="n">arcY</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="n">arc</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="n">crossY</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">arc</span><span class="p">,</span> <span class="n">vert</span><span class="p">)</span>
        <span class="n">crossX</span> <span class="o">=</span> <span class="p">(</span><span class="n">crossY</span> <span class="o">-</span> <span class="n">arcY</span><span class="p">)</span> <span class="o">+</span> <span class="n">arcX</span>

        <span class="n">firstOut</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">arc</span> <span class="o">+</span> <span class="n">arc</span><span class="p">,</span> <span class="n">crossY</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">arc</span> <span class="o">+</span> <span class="n">arc</span><span class="p">,</span>
                       <span class="n">crossY</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">vert</span> <span class="o">+</span> <span class="n">first</span><span class="o">.</span><span class="n">down</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">up</span> <span class="o">=</span> <span class="n">firstOut</span> <span class="o">+</span> <span class="n">first</span><span class="o">.</span><span class="n">height</span> <span class="o">+</span> <span class="n">first</span><span class="o">.</span><span class="n">up</span>

        <span class="n">secondIn</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">arc</span> <span class="o">+</span> <span class="n">arc</span><span class="p">,</span> <span class="n">crossY</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">arc</span> <span class="o">+</span> <span class="n">arc</span><span class="p">,</span>
                       <span class="n">crossY</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">vert</span> <span class="o">+</span> <span class="n">second</span><span class="o">.</span><span class="n">up</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">down</span> <span class="o">=</span> <span class="n">secondIn</span> <span class="o">+</span> <span class="n">second</span><span class="o">.</span><span class="n">height</span> <span class="o">+</span> <span class="n">second</span><span class="o">.</span><span class="n">down</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">firstWidth</span> <span class="o">=</span> <span class="p">(</span><span class="mi">20</span> <span class="k">if</span> <span class="n">first</span><span class="o">.</span><span class="n">needsSpace</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">first</span><span class="o">.</span><span class="n">width</span>
        <span class="n">secondWidth</span> <span class="o">=</span> <span class="p">(</span><span class="mi">20</span> <span class="k">if</span> <span class="n">second</span><span class="o">.</span><span class="n">needsSpace</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">second</span><span class="o">.</span><span class="n">width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">arc</span> <span class="o">+</span> <span class="nb">max</span><span class="p">(</span><span class="n">firstWidth</span><span class="p">,</span> <span class="n">crossX</span><span class="p">,</span> <span class="n">secondWidth</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">arc</span>
        <span class="n">addDebug</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">items</span> <span class="o">=</span> <span class="s1">', '</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">'AlternatingSequence(</span><span class="si">%s</span><span class="s1">)'</span> <span class="o">%</span> <span class="n">items</span>

    <span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">width</span><span class="p">):</span>
        <span class="n">arc</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span>
        <span class="n">gaps</span> <span class="o">=</span> <span class="n">determineGaps</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>
        <span class="n">Path</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="n">gaps</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">+=</span> <span class="n">gaps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">Path</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="n">gaps</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="c1"># bounding box</span>
        <span class="c1"># Path(x+gaps[0], y).up(self.up).right(self.width).down(self.up+self.down).left(self.width).up(self.down).addTo(self)</span>
        <span class="n">first</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">second</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># top</span>
        <span class="n">firstIn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">up</span> <span class="o">-</span> <span class="n">first</span><span class="o">.</span><span class="n">up</span>
        <span class="n">firstOut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">up</span> <span class="o">-</span> <span class="n">first</span><span class="o">.</span><span class="n">up</span> <span class="o">-</span> <span class="n">first</span><span class="o">.</span><span class="n">height</span>
        <span class="n">Path</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">arc</span><span class="p">(</span><span class="s1">'se'</span><span class="p">)</span><span class="o">.</span><span class="n">up</span><span class="p">(</span><span class="n">firstIn</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">arc</span><span class="p">)</span><span class="o">.</span><span class="n">arc</span><span class="p">(</span><span class="s1">'wn'</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">first</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">x</span>
            <span class="o">+</span> <span class="mi">2</span>
            <span class="o">*</span> <span class="n">arc</span><span class="p">,</span>
            <span class="n">y</span>
            <span class="o">-</span> <span class="n">firstIn</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">width</span>
            <span class="o">-</span> <span class="mi">4</span>
            <span class="o">*</span> <span class="n">arc</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">Path</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">arc</span><span class="p">,</span> <span class="n">y</span>
             <span class="o">-</span> <span class="n">firstOut</span><span class="p">)</span><span class="o">.</span><span class="n">arc</span><span class="p">(</span><span class="s1">'ne'</span><span class="p">)</span><span class="o">.</span><span class="n">down</span><span class="p">(</span><span class="n">firstOut</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">arc</span><span class="p">)</span><span class="o">.</span><span class="n">arc</span><span class="p">(</span><span class="s1">'ws'</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># bottom</span>
        <span class="n">secondIn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">down</span> <span class="o">-</span> <span class="n">second</span><span class="o">.</span><span class="n">down</span> <span class="o">-</span> <span class="n">second</span><span class="o">.</span><span class="n">height</span>
        <span class="n">secondOut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">down</span> <span class="o">-</span> <span class="n">second</span><span class="o">.</span><span class="n">down</span>
        <span class="n">Path</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">arc</span><span class="p">(</span><span class="s1">'ne'</span><span class="p">)</span><span class="o">.</span><span class="n">down</span><span class="p">(</span><span class="n">secondIn</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">arc</span><span class="p">)</span><span class="o">.</span><span class="n">arc</span><span class="p">(</span><span class="s1">'ws'</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">second</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">x</span>
            <span class="o">+</span> <span class="mi">2</span>
            <span class="o">*</span> <span class="n">arc</span><span class="p">,</span>
            <span class="n">y</span>
            <span class="o">+</span> <span class="n">secondIn</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">width</span>
            <span class="o">-</span> <span class="mi">4</span>
            <span class="o">*</span> <span class="n">arc</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">Path</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">arc</span><span class="p">,</span> <span class="n">y</span>
             <span class="o">+</span> <span class="n">secondOut</span><span class="p">)</span><span class="o">.</span><span class="n">arc</span><span class="p">(</span><span class="s1">'se'</span><span class="p">)</span><span class="o">.</span><span class="n">up</span><span class="p">(</span><span class="n">secondOut</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">arc</span><span class="p">)</span><span class="o">.</span><span class="n">arc</span><span class="p">(</span><span class="s1">'wn'</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># crossover</span>
        <span class="n">arcX</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">Math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">arc</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="n">arcY</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">Math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="n">arc</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="n">crossY</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">arc</span><span class="p">,</span> <span class="n">C</span><span class="o">.</span><span class="n">VS</span><span class="p">)</span>
        <span class="n">crossX</span> <span class="o">=</span> <span class="p">(</span><span class="n">crossY</span> <span class="o">-</span> <span class="n">arcY</span><span class="p">)</span> <span class="o">+</span> <span class="n">arcX</span>
        <span class="n">crossBar</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">arc</span> <span class="o">-</span> <span class="n">crossX</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">arc</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="n">crossY</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">arc</span><span class="p">)</span><span class="o">.</span><span class="n">arc</span><span class="p">(</span><span class="s1">'ws'</span><span class="p">)</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="n">crossBar</span><span class="p">)</span>
            <span class="o">.</span><span class="n">arc_8</span><span class="p">(</span><span class="s1">'n'</span><span class="p">,</span> <span class="s1">'cw'</span><span class="p">)</span><span class="o">.</span><span class="n">ll</span><span class="p">(</span><span class="n">crossX</span> <span class="o">-</span> <span class="n">arcX</span><span class="p">,</span> <span class="n">crossY</span> <span class="o">-</span> <span class="n">arcY</span><span class="p">)</span><span class="o">.</span><span class="n">arc_8</span><span class="p">(</span><span class="s1">'sw'</span><span class="p">,</span> <span class="s1">'ccw'</span><span class="p">)</span>
            <span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="n">crossBar</span><span class="p">)</span><span class="o">.</span><span class="n">arc</span><span class="p">(</span><span class="s1">'ne'</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">arc</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">crossY</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">arc</span><span class="p">)</span><span class="o">.</span><span class="n">arc</span><span class="p">(</span><span class="s1">'wn'</span><span class="p">)</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="n">crossBar</span><span class="p">)</span>
            <span class="o">.</span><span class="n">arc_8</span><span class="p">(</span><span class="s1">'s'</span><span class="p">,</span> <span class="s1">'ccw'</span><span class="p">)</span><span class="o">.</span><span class="n">ll</span><span class="p">(</span><span class="n">crossX</span> <span class="o">-</span> <span class="n">arcX</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">crossY</span> <span class="o">-</span> <span class="n">arcY</span><span class="p">))</span><span class="o">.</span><span class="n">arc_8</span><span class="p">(</span><span class="s1">'nw'</span><span class="p">,</span> <span class="s1">'cw'</span><span class="p">)</span>
            <span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="n">crossBar</span><span class="p">)</span><span class="o">.</span><span class="n">arc</span><span class="p">(</span><span class="s1">'se'</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

        <span class="k">return</span> <span class="bp">self</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">Choice</span><span class="p">(</span><span class="n">DiagramItem</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">default</span><span class="p">,</span> <span class="o">*</span><span class="n">items</span><span class="p">):</span>
        <span class="n">DiagramItem</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">'g'</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">default</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default</span> <span class="o">=</span> <span class="n">default</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">wrapString</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="nb">max</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">width</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">up</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">up</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">down</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">down</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="n">default</span><span class="p">]</span><span class="o">.</span><span class="n">height</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">default</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">default</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]:</span>
                <span class="n">arcs</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">arcs</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">default</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">up</span> <span class="o">+=</span> <span class="nb">max</span><span class="p">(</span><span class="n">arcs</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">height</span> <span class="o">+</span> <span class="n">item</span><span class="o">.</span><span class="n">down</span>
                               <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">VS</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">up</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="n">default</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">down</span> <span class="o">+=</span> <span class="nb">max</span><span class="p">(</span><span class="n">arcs</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">up</span> <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">VS</span>
                                 <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">down</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
        <span class="c1"># already counted in self.height</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">down</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="n">default</span><span class="p">]</span><span class="o">.</span><span class="n">height</span>
        <span class="n">addDebug</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">items</span> <span class="o">=</span> <span class="s1">', '</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">'Choice(</span><span class="si">%r</span><span class="s1">, </span><span class="si">%s</span><span class="s1">)'</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default</span><span class="p">,</span> <span class="n">items</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">width</span><span class="p">):</span>
        <span class="n">leftGap</span><span class="p">,</span> <span class="n">rightGap</span> <span class="o">=</span> <span class="n">determineGaps</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>

        <span class="c1"># Hook up the two sides if self is narrower than its stated width.</span>
        <span class="n">Path</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="n">leftGap</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">Path</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">leftGap</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">)</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="n">rightGap</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">+=</span> <span class="n">leftGap</span>

        <span class="n">innerWidth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">4</span>
        <span class="n">default</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">default</span><span class="p">]</span>

        <span class="c1"># Do the elements that curve above</span>
        <span class="n">above</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">default</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">above</span><span class="p">:</span>
            <span class="n">distanceFromY</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
                <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
                <span class="n">default</span><span class="o">.</span><span class="n">up</span>
                <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">VS</span>
                <span class="o">+</span> <span class="n">above</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">down</span>
                <span class="o">+</span> <span class="n">above</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ni</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">doubleenumerate</span><span class="p">(</span><span class="n">above</span><span class="p">):</span>
            <span class="n">Path</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">arc</span><span class="p">(</span><span class="s1">'se'</span><span class="p">)</span><span class="o">.</span><span class="n">up</span><span class="p">(</span><span class="n">distanceFromY</span>
                                    <span class="o">-</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">arc</span><span class="p">(</span><span class="s1">'wn'</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">item</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="n">distanceFromY</span><span class="p">,</span>
                        <span class="n">innerWidth</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">Path</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">innerWidth</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="n">distanceFromY</span> <span class="o">+</span> <span class="n">item</span><span class="o">.</span><span class="n">height</span><span class="p">)</span><span class="o">.</span><span class="n">arc</span><span class="p">(</span><span class="s1">'ne'</span><span class="p">)</span> \
                <span class="o">.</span><span class="n">down</span><span class="p">(</span><span class="n">distanceFromY</span> <span class="o">-</span> <span class="n">item</span><span class="o">.</span><span class="n">height</span> <span class="o">+</span> <span class="n">default</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">arc</span><span class="p">(</span><span class="s1">'ws'</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ni</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">distanceFromY</span> <span class="o">+=</span> <span class="nb">max</span><span class="p">(</span>
                    <span class="n">C</span><span class="o">.</span><span class="n">AR</span><span class="p">,</span>
                    <span class="n">item</span><span class="o">.</span><span class="n">up</span>
                    <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">VS</span>
                    <span class="o">+</span> <span class="n">above</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">down</span>
                    <span class="o">+</span> <span class="n">above</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>

        <span class="c1"># Do the straight-line path.</span>
        <span class="n">Path</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">default</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">x</span> <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">innerWidth</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">Path</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">innerWidth</span><span class="p">,</span> <span class="n">y</span>
             <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">)</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># Do the elements that curve below</span>
        <span class="n">below</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">default</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span>
        <span class="k">if</span> <span class="n">below</span><span class="p">:</span>
            <span class="n">distanceFromY</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
                <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
                <span class="n">default</span><span class="o">.</span><span class="n">height</span>
                <span class="o">+</span> <span class="n">default</span><span class="o">.</span><span class="n">down</span>
                <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">VS</span>
                <span class="o">+</span> <span class="n">below</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">up</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">below</span><span class="p">):</span>
            <span class="n">Path</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">arc</span><span class="p">(</span><span class="s1">'ne'</span><span class="p">)</span><span class="o">.</span><span class="n">down</span><span class="p">(</span>
                <span class="n">distanceFromY</span> <span class="o">-</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">arc</span><span class="p">(</span><span class="s1">'ws'</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">item</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">distanceFromY</span><span class="p">,</span>
                        <span class="n">innerWidth</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">Path</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">innerWidth</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">distanceFromY</span> <span class="o">+</span> <span class="n">item</span><span class="o">.</span><span class="n">height</span><span class="p">)</span><span class="o">.</span><span class="n">arc</span><span class="p">(</span><span class="s1">'se'</span><span class="p">)</span> \
                <span class="o">.</span><span class="n">up</span><span class="p">(</span><span class="n">distanceFromY</span> <span class="o">-</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">item</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="n">default</span><span class="o">.</span><span class="n">height</span><span class="p">)</span><span class="o">.</span><span class="n">arc</span><span class="p">(</span><span class="s1">'wn'</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">distanceFromY</span> <span class="o">+=</span> <span class="nb">max</span><span class="p">(</span>
                <span class="n">C</span><span class="o">.</span><span class="n">AR</span><span class="p">,</span>
                <span class="n">item</span><span class="o">.</span><span class="n">height</span>
                <span class="o">+</span> <span class="n">item</span><span class="o">.</span><span class="n">down</span>
                <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">VS</span>
                <span class="o">+</span> <span class="p">(</span><span class="n">below</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">up</span> <span class="k">if</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">below</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">MultipleChoice</span><span class="p">(</span><span class="n">DiagramItem</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">default</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="o">*</span><span class="n">items</span><span class="p">):</span>
        <span class="n">DiagramItem</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">'g'</span><span class="p">)</span>
        <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">default</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">"any"</span><span class="p">,</span> <span class="s2">"all"</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default</span> <span class="o">=</span> <span class="n">default</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">needsSpace</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">wrapString</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">innerWidth</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">width</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mi">30</span> <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">innerWidth</span> <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">+</span> <span class="mi">20</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">up</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">up</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">down</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">down</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="n">default</span><span class="p">]</span><span class="o">.</span><span class="n">height</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">default</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">default</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]:</span>
                <span class="n">minimum</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">minimum</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">default</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">up</span> <span class="o">+=</span> <span class="nb">max</span><span class="p">(</span><span class="n">minimum</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">height</span>
                               <span class="o">+</span> <span class="n">item</span><span class="o">.</span><span class="n">down</span> <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">VS</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">up</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="n">default</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">down</span> <span class="o">+=</span> <span class="nb">max</span><span class="p">(</span><span class="n">minimum</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">up</span> <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">VS</span>
                                 <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">down</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
        <span class="c1"># already counted in self.height</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">down</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="n">default</span><span class="p">]</span><span class="o">.</span><span class="n">height</span>
        <span class="n">addDebug</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">items</span> <span class="o">=</span> <span class="s1">', '</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">repr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">))</span>
        <span class="k">return</span> <span class="s1">'MultipleChoice(</span><span class="si">%r</span><span class="s1">, </span><span class="si">%r</span><span class="s1">, </span><span class="si">%s</span><span class="s1">)'</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">items</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">width</span><span class="p">):</span>
        <span class="n">leftGap</span><span class="p">,</span> <span class="n">rightGap</span> <span class="o">=</span> <span class="n">determineGaps</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>

        <span class="c1"># Hook up the two sides if self is narrower than its stated width.</span>
        <span class="n">Path</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="n">leftGap</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">Path</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">leftGap</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">)</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="n">rightGap</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">+=</span> <span class="n">leftGap</span>

        <span class="n">default</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">default</span><span class="p">]</span>

        <span class="c1"># Do the elements that curve above</span>
        <span class="n">above</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">default</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">above</span><span class="p">:</span>
            <span class="n">distanceFromY</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
                <span class="mi">10</span> <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span><span class="p">,</span>
                <span class="n">default</span><span class="o">.</span><span class="n">up</span>
                <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">VS</span>
                <span class="o">+</span> <span class="n">above</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">down</span>
                <span class="o">+</span> <span class="n">above</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ni</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">doubleenumerate</span><span class="p">(</span><span class="n">above</span><span class="p">):</span>
            <span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">30</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
                <span class="o">.</span><span class="n">up</span><span class="p">(</span><span class="n">distanceFromY</span> <span class="o">-</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span><span class="p">)</span>
                <span class="o">.</span><span class="n">arc</span><span class="p">(</span><span class="s1">'wn'</span><span class="p">)</span>
                <span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
            <span class="n">item</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">30</span> <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="n">distanceFromY</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">innerWidth</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">30</span> <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">innerWidth</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="n">distanceFromY</span> <span class="o">+</span> <span class="n">item</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
                <span class="o">.</span><span class="n">arc</span><span class="p">(</span><span class="s1">'ne'</span><span class="p">)</span>
                <span class="o">.</span><span class="n">down</span><span class="p">(</span><span class="n">distanceFromY</span> <span class="o">-</span> <span class="n">item</span><span class="o">.</span><span class="n">height</span> <span class="o">+</span> <span class="n">default</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">-</span> <span class="mi">10</span><span class="p">)</span>
                <span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">ni</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">distanceFromY</span> <span class="o">+=</span> <span class="nb">max</span><span class="p">(</span>
                    <span class="n">C</span><span class="o">.</span><span class="n">AR</span><span class="p">,</span>
                    <span class="n">item</span><span class="o">.</span><span class="n">up</span>
                    <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">VS</span>
                    <span class="o">+</span> <span class="n">above</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">down</span>
                    <span class="o">+</span> <span class="n">above</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>

        <span class="c1"># Do the straight-line path.</span>
        <span class="n">Path</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">30</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">AR</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">default</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">x</span> <span class="o">+</span> <span class="mi">30</span> <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">innerWidth</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">Path</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">30</span> <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">innerWidth</span><span class="p">,</span> <span class="n">y</span>
             <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">)</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">AR</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># Do the elements that curve below</span>
        <span class="n">below</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">default</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span>
        <span class="k">if</span> <span class="n">below</span><span class="p">:</span>
            <span class="n">distanceFromY</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
                <span class="mi">10</span> <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span><span class="p">,</span>
                <span class="n">default</span><span class="o">.</span><span class="n">height</span>
                <span class="o">+</span> <span class="n">default</span><span class="o">.</span><span class="n">down</span>
                <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">VS</span>
                <span class="o">+</span> <span class="n">below</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">up</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">below</span><span class="p">):</span>
            <span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">30</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
                <span class="o">.</span><span class="n">down</span><span class="p">(</span><span class="n">distanceFromY</span> <span class="o">-</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span><span class="p">)</span>
                <span class="o">.</span><span class="n">arc</span><span class="p">(</span><span class="s1">'ws'</span><span class="p">)</span>
                <span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
            <span class="n">item</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">30</span> <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">distanceFromY</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">innerWidth</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">30</span> <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">innerWidth</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">distanceFromY</span> <span class="o">+</span> <span class="n">item</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
                <span class="o">.</span><span class="n">arc</span><span class="p">(</span><span class="s1">'se'</span><span class="p">)</span>
                <span class="o">.</span><span class="n">up</span><span class="p">(</span><span class="n">distanceFromY</span> <span class="o">-</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">+</span> <span class="n">item</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="n">default</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="mi">10</span><span class="p">)</span>
                <span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
            <span class="n">distanceFromY</span> <span class="o">+=</span> <span class="nb">max</span><span class="p">(</span>
                <span class="n">C</span><span class="o">.</span><span class="n">AR</span><span class="p">,</span>
                <span class="n">item</span><span class="o">.</span><span class="n">height</span>
                <span class="o">+</span> <span class="n">item</span><span class="o">.</span><span class="n">down</span>
                <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">VS</span>
                <span class="o">+</span> <span class="p">(</span><span class="n">below</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">up</span> <span class="k">if</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">below</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span><span class="p">))</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">DiagramItem</span><span class="p">(</span><span class="s1">'g'</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s2">"class"</span><span class="p">:</span> <span class="s2">"diagram-text"</span><span class="p">})</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">DiagramItem</span><span class="p">(</span><span class="s1">'title'</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">"take one or more branches, once each, in any order"</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span>
                    <span class="o">==</span> <span class="s2">"any"</span> <span class="k">else</span> <span class="s2">"take all branches, once each, in any order"</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="n">DiagramItem</span><span class="p">(</span><span class="s1">'path'</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">"d"</span><span class="p">:</span> <span class="s2">"M </span><span class="si">{x}</span><span class="s2"> </span><span class="si">{y}</span><span class="s2"> h -26 a 4 4 0 0 0 -4 4 v 12 a 4 4 0 0 0 4 4 h 26 z"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span> <span class="o">+</span> <span class="mi">30</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span> <span class="o">-</span> <span class="mi">10</span><span class="p">),</span>
            <span class="s2">"class"</span><span class="p">:</span> <span class="s2">"diagram-text"</span>
        <span class="p">})</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="n">DiagramItem</span><span class="p">(</span><span class="s1">'text'</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">"1+"</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">"any"</span> <span class="k">else</span> <span class="s2">"all"</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">"x"</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">15</span><span class="p">,</span>
            <span class="s2">"y"</span><span class="p">:</span> <span class="n">y</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span>
            <span class="s2">"class"</span><span class="p">:</span> <span class="s2">"diagram-text"</span>
        <span class="p">})</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="n">DiagramItem</span><span class="p">(</span><span class="s1">'path'</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">"d"</span><span class="p">:</span> <span class="s2">"M </span><span class="si">{x}</span><span class="s2"> </span><span class="si">{y}</span><span class="s2"> h 16 a 4 4 0 0 1 4 4 v 12 a 4 4 0 0 1 -4 4 h -16 z"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="mi">20</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span> <span class="o">-</span> <span class="mi">10</span><span class="p">),</span>
            <span class="s2">"class"</span><span class="p">:</span> <span class="s2">"diagram-text"</span>
        <span class="p">})</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="n">DiagramItem</span><span class="p">(</span><span class="s1">'text'</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="sa">u</span><span class="s2">"↺"</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">"x"</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="mi">10</span><span class="p">,</span>
            <span class="s2">"y"</span><span class="p">:</span> <span class="n">y</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span>
            <span class="s2">"class"</span><span class="p">:</span> <span class="s2">"diagram-arrow"</span>
        <span class="p">})</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">HorizontalChoice</span><span class="p">(</span><span class="n">DiagramItem</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">items</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Sequence</span><span class="p">(</span><span class="o">*</span><span class="n">items</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">HorizontalChoice</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">items</span><span class="p">):</span>
        <span class="n">DiagramItem</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">'g'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">wrapString</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">]</span>
        <span class="n">allButLast</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">middles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">first</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">last</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">needsSpace</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">AR</span>  <span class="c1"># starting track</span>
                      <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># inbetween tracks</span>
                      <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">width</span> <span class="o">+</span> <span class="p">(</span><span class="mi">20</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">needsSpace</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">)</span>  <span class="c1"># items</span>
                      <span class="c1"># needs space to curve up</span>
                      <span class="o">+</span> <span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="k">if</span> <span class="n">last</span><span class="o">.</span><span class="n">height</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
                      <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span><span class="p">)</span>  <span class="c1"># ending track</span>

        <span class="c1"># Always exits at entrance height</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># All but the last have a track running above them</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_upperTrack</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
            <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
            <span class="n">C</span><span class="o">.</span><span class="n">VS</span><span class="p">,</span>
            <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">up</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">allButLast</span><span class="p">)</span> <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">VS</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">up</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_upperTrack</span><span class="p">,</span> <span class="n">last</span><span class="o">.</span><span class="n">up</span><span class="p">)</span>

        <span class="c1"># All but the first have a track running below them</span>
        <span class="c1"># Last either straight-lines or curves up, so has different calculation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lowerTrack</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
            <span class="n">C</span><span class="o">.</span><span class="n">VS</span><span class="p">,</span>
            <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">height</span> <span class="o">+</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">down</span> <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">VS</span><span class="p">,</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">middles</span><span class="p">)</span> <span class="k">if</span> <span class="n">middles</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">last</span><span class="o">.</span><span class="n">height</span> <span class="o">+</span> <span class="n">last</span><span class="o">.</span><span class="n">down</span> <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">VS</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">first</span><span class="o">.</span><span class="n">height</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lowerTrack</span><span class="p">:</span>
            <span class="c1"># Make sure there's at least 2*C.AR room between first exit and</span>
            <span class="c1"># lower track</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_lowerTrack</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_lowerTrack</span><span class="p">,</span> <span class="n">first</span><span class="o">.</span><span class="n">height</span> <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">down</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_lowerTrack</span><span class="p">,</span> <span class="n">first</span><span class="o">.</span><span class="n">height</span> <span class="o">+</span> <span class="n">first</span><span class="o">.</span><span class="n">down</span><span class="p">)</span>

        <span class="n">addDebug</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">width</span><span class="p">):</span>
        <span class="c1"># Hook up the two sides if self is narrower than its stated width.</span>
        <span class="n">leftGap</span><span class="p">,</span> <span class="n">rightGap</span> <span class="o">=</span> <span class="n">determineGaps</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>
        <span class="n">Path</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="n">leftGap</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">Path</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">leftGap</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">)</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="n">rightGap</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">+=</span> <span class="n">leftGap</span>

        <span class="n">first</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">last</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># upper track</span>
        <span class="n">upperSpan</span> <span class="o">=</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">width</span> <span class="o">+</span> <span class="p">(</span><span class="mi">20</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">needsSpace</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                     <span class="o">+</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span>
                     <span class="o">-</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span><span class="p">)</span>
        <span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="o">.</span><span class="n">arc</span><span class="p">(</span><span class="s1">'se'</span><span class="p">)</span>
            <span class="o">.</span><span class="n">up</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_upperTrack</span> <span class="o">-</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
            <span class="o">.</span><span class="n">arc</span><span class="p">(</span><span class="s1">'wn'</span><span class="p">)</span>
            <span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="n">upperSpan</span><span class="p">)</span>
            <span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

        <span class="c1"># lower track</span>
        <span class="n">lowerSpan</span> <span class="o">=</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">width</span> <span class="o">+</span> <span class="p">(</span><span class="mi">20</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">needsSpace</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
                     <span class="o">+</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span>
                     <span class="o">+</span> <span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="k">if</span> <span class="n">last</span><span class="o">.</span><span class="n">height</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
                     <span class="o">-</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span><span class="p">)</span>
        <span class="n">lowerStart</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">+</span> <span class="n">first</span><span class="o">.</span><span class="n">width</span> <span class="o">+</span> \
            <span class="p">(</span><span class="mi">20</span> <span class="k">if</span> <span class="n">first</span><span class="o">.</span><span class="n">needsSpace</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">lowerStart</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lowerTrack</span><span class="p">)</span>
            <span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="n">lowerSpan</span><span class="p">)</span>
            <span class="o">.</span><span class="n">arc</span><span class="p">(</span><span class="s1">'se'</span><span class="p">)</span>
            <span class="o">.</span><span class="n">up</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_lowerTrack</span> <span class="o">-</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
            <span class="o">.</span><span class="n">arc</span><span class="p">(</span><span class="s1">'wn'</span><span class="p">)</span>
            <span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

        <span class="c1"># Items</span>
        <span class="k">for</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">item</span><span class="p">]</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">):</span>
            <span class="c1"># input track</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">AR</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
                <span class="n">x</span> <span class="o">+=</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_upperTrack</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">arc</span><span class="p">(</span><span class="s1">'ne'</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">v</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_upperTrack</span> <span class="o">-</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">arc</span><span class="p">(</span><span class="s1">'ws'</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
                <span class="n">x</span> <span class="o">+=</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span>

            <span class="c1"># item</span>
            <span class="n">itemWidth</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">width</span> <span class="o">+</span> <span class="p">(</span><span class="mi">20</span> <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">needsSpace</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">item</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">itemWidth</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">+=</span> <span class="n">itemWidth</span>

            <span class="c1"># output track</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">height</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
                        <span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">AR</span><span class="p">)</span>
                        <span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">item</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
                        <span class="o">.</span><span class="n">arc</span><span class="p">(</span><span class="s1">'se'</span><span class="p">)</span>
                        <span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">item</span><span class="o">.</span><span class="n">height</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lowerTrack</span><span class="p">:</span>
                <span class="c1"># Needs to arc up to meet the lower track, not down.</span>
                <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lowerTrack</span> <span class="o">&gt;=</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">item</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
                        <span class="o">.</span><span class="n">arc</span><span class="p">(</span><span class="s1">'se'</span><span class="p">)</span>
                        <span class="o">.</span><span class="n">v</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_lowerTrack</span> <span class="o">-</span> <span class="n">item</span><span class="o">.</span><span class="n">height</span> <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
                        <span class="o">.</span><span class="n">arc</span><span class="p">(</span><span class="s1">'wn'</span><span class="p">)</span>
                        <span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Not enough space to fit two arcs</span>
                    <span class="c1"># so just bail and draw a straight line for now.</span>
                    <span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">item</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
                        <span class="o">.</span><span class="n">ll</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lowerTrack</span> <span class="o">-</span> <span class="n">item</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
                        <span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">item</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">arc</span><span class="p">(</span><span class="s1">'ne'</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">v</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_lowerTrack</span> <span class="o">-</span> <span class="n">item</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">arc</span><span class="p">(</span><span class="s1">'ws'</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">Optional</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">skip</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Choice</span><span class="p">(</span><span class="mi">0</span> <span class="k">if</span> <span class="n">skip</span> <span class="k">else</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Skip</span><span class="p">(),</span> <span class="n">item</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">OneOrMore</span><span class="p">(</span><span class="n">DiagramItem</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">repeat</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">DiagramItem</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">'g'</span><span class="p">)</span>
        <span class="n">repeat</span> <span class="o">=</span> <span class="n">repeat</span> <span class="ow">or</span> <span class="n">Skip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item</span> <span class="o">=</span> <span class="n">wrapString</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rep</span> <span class="o">=</span> <span class="n">wrapString</span><span class="p">(</span><span class="n">repeat</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">item</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rep</span><span class="o">.</span><span class="n">width</span><span class="p">)</span> <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">item</span><span class="o">.</span><span class="n">height</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">up</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">item</span><span class="o">.</span><span class="n">up</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">down</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
            <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">item</span><span class="o">.</span><span class="n">down</span> <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">VS</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">rep</span><span class="o">.</span><span class="n">up</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">rep</span><span class="o">.</span><span class="n">height</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">rep</span><span class="o">.</span><span class="n">down</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">needsSpace</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">addDebug</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">width</span><span class="p">):</span>
        <span class="n">leftGap</span><span class="p">,</span> <span class="n">rightGap</span> <span class="o">=</span> <span class="n">determineGaps</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>

        <span class="c1"># Hook up the two sides if self is narrower than its stated width.</span>
        <span class="n">Path</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="n">leftGap</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">Path</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">leftGap</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">)</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="n">rightGap</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">+=</span> <span class="n">leftGap</span>

        <span class="c1"># Draw item</span>
        <span class="n">Path</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">AR</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">Path</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">)</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">AR</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># Draw repeat arc</span>
        <span class="n">distanceFromY</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">item</span><span class="o">.</span><span class="n">height</span>
                            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">item</span><span class="o">.</span><span class="n">down</span> <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">VS</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">rep</span><span class="o">.</span><span class="n">up</span><span class="p">)</span>
        <span class="n">Path</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">arc</span><span class="p">(</span><span class="s1">'nw'</span><span class="p">)</span><span class="o">.</span><span class="n">down</span><span class="p">(</span><span class="n">distanceFromY</span> <span class="o">-</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> \
            <span class="o">.</span><span class="n">arc</span><span class="p">(</span><span class="s1">'ws'</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rep</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">distanceFromY</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">Path</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">distanceFromY</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">rep</span><span class="o">.</span><span class="n">height</span><span class="p">)</span><span class="o">.</span><span class="n">arc</span><span class="p">(</span><span class="s1">'se'</span><span class="p">)</span> \
            <span class="o">.</span><span class="n">up</span><span class="p">(</span><span class="n">distanceFromY</span> <span class="o">-</span> <span class="n">C</span><span class="o">.</span><span class="n">AR</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">rep</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">item</span><span class="o">.</span><span class="n">height</span><span class="p">)</span><span class="o">.</span><span class="n">arc</span><span class="p">(</span><span class="s1">'en'</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">'OneOrMore(</span><span class="si">%r</span><span class="s1">, repeat=</span><span class="si">%r</span><span class="s1">)'</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">item</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rep</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">ZeroOrMore</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">repeat</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">skip</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">Optional</span><span class="p">(</span><span class="n">OneOrMore</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">repeat</span><span class="p">),</span> <span class="n">skip</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">Start</span><span class="p">(</span><span class="n">DiagramItem</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"simple"</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">DiagramItem</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">'g'</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">label</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">label</span><span class="p">)</span> <span class="o">*</span> <span class="n">C</span><span class="o">.</span><span class="n">CHAR_WIDTH</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mi">20</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">up</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">down</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">label</span>
        <span class="n">addDebug</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">_width</span><span class="p">):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="mi">10</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">"complex"</span><span class="p">:</span>
            <span class="n">path</span><span class="o">.</span><span class="n">down</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">m</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">path</span><span class="o">.</span><span class="n">down</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">m</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">down</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">m</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span>
                                                <span class="o">-</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">:</span>
            <span class="n">DiagramItem</span><span class="p">(</span><span class="s1">'text'</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span>
                        <span class="s2">"x"</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="s2">"y"</span><span class="p">:</span> <span class="n">y</span> <span class="o">-</span> <span class="mi">15</span><span class="p">,</span> <span class="s2">"style"</span><span class="p">:</span> <span class="s2">"text-anchor:start"</span><span class="p">},</span> <span class="n">text</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">'Start(type=</span><span class="si">%r</span><span class="s1">, label=</span><span class="si">%r</span><span class="s1">)'</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">End</span><span class="p">(</span><span class="n">DiagramItem</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"simple"</span><span class="p">):</span>
        <span class="n">DiagramItem</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">'path'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mi">20</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">up</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">down</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">type</span>
        <span class="n">addDebug</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">_width</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">"simple"</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">'d'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'M </span><span class="si">{0}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1"> h 20 m -10 -10 v 20 m 10 -20 v 20'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">"complex"</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">'d'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'M </span><span class="si">{0}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1"> h 20 m 0 -10 v 20'</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">'End(type=</span><span class="si">%r</span><span class="s1">)'</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">Terminal</span><span class="p">(</span><span class="n">DiagramItem</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">href</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">DiagramItem</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">'g'</span><span class="p">,</span> <span class="p">{</span><span class="s1">'class'</span><span class="p">:</span> <span class="s1">'terminal'</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">href</span> <span class="o">=</span> <span class="n">href</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">*</span> <span class="n">C</span><span class="o">.</span><span class="n">CHAR_WIDTH</span> <span class="o">+</span> <span class="mi">20</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">up</span> <span class="o">=</span> <span class="mi">11</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">down</span> <span class="o">=</span> <span class="mi">11</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">needsSpace</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">addDebug</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">'Terminal(</span><span class="si">%r</span><span class="s1">, href=</span><span class="si">%r</span><span class="s1">, title=</span><span class="si">%r</span><span class="s1">)'</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">href</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">width</span><span class="p">):</span>
        <span class="n">leftGap</span><span class="p">,</span> <span class="n">rightGap</span> <span class="o">=</span> <span class="n">determineGaps</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>

        <span class="c1"># Hook up the two sides if self is narrower than its stated width.</span>
        <span class="n">Path</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="n">leftGap</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">Path</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">leftGap</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="n">rightGap</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="n">DiagramItem</span><span class="p">(</span><span class="s1">'rect'</span><span class="p">,</span> <span class="p">{</span><span class="s1">'x'</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">leftGap</span><span class="p">,</span> <span class="s1">'y'</span><span class="p">:</span> <span class="n">y</span> <span class="o">-</span> <span class="mi">11</span><span class="p">,</span> <span class="s1">'width'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
                             <span class="s1">'height'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">up</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">down</span><span class="p">,</span> <span class="s1">'rx'</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">'ry'</span><span class="p">:</span> <span class="mi">10</span><span class="p">})</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">DiagramItem</span><span class="p">(</span><span class="s1">'text'</span><span class="p">,</span> <span class="p">{</span><span class="s1">'x'</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">'y'</span><span class="p">:</span> <span class="n">y</span> <span class="o">+</span> <span class="mi">4</span><span class="p">},</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">href</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">DiagramItem</span><span class="p">(</span><span class="s1">'a'</span><span class="p">,</span> <span class="p">{</span><span class="s1">'xlink:href'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">href</span><span class="p">},</span> <span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">text</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">text</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">DiagramItem</span><span class="p">(</span><span class="s1">'title'</span><span class="p">,</span> <span class="p">{},</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">NonTerminal</span><span class="p">(</span><span class="n">DiagramItem</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">href</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">DiagramItem</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">'g'</span><span class="p">,</span> <span class="p">{</span><span class="s1">'class'</span><span class="p">:</span> <span class="s1">'non-terminal'</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">href</span> <span class="o">=</span> <span class="n">href</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">*</span> <span class="n">C</span><span class="o">.</span><span class="n">CHAR_WIDTH</span> <span class="o">+</span> <span class="mi">20</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">up</span> <span class="o">=</span> <span class="mi">11</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">down</span> <span class="o">=</span> <span class="mi">11</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">needsSpace</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">addDebug</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">'NonTerminal(</span><span class="si">%r</span><span class="s1">, href=</span><span class="si">%r</span><span class="s1">, title=</span><span class="si">%r</span><span class="s1">)'</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">href</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">width</span><span class="p">):</span>
        <span class="n">leftGap</span><span class="p">,</span> <span class="n">rightGap</span> <span class="o">=</span> <span class="n">determineGaps</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>

        <span class="c1"># Hook up the two sides if self is narrower than its stated width.</span>
        <span class="n">Path</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="n">leftGap</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">Path</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">leftGap</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="n">rightGap</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="n">DiagramItem</span><span class="p">(</span><span class="s1">'rect'</span><span class="p">,</span> <span class="p">{</span><span class="s1">'x'</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">leftGap</span><span class="p">,</span> <span class="s1">'y'</span><span class="p">:</span> <span class="n">y</span> <span class="o">-</span> <span class="mi">11</span><span class="p">,</span> <span class="s1">'width'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
                             <span class="s1">'height'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">up</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">down</span><span class="p">})</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">DiagramItem</span><span class="p">(</span><span class="s1">'text'</span><span class="p">,</span> <span class="p">{</span><span class="s1">'x'</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">'y'</span><span class="p">:</span> <span class="n">y</span> <span class="o">+</span> <span class="mi">4</span><span class="p">},</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">href</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">DiagramItem</span><span class="p">(</span><span class="s1">'a'</span><span class="p">,</span> <span class="p">{</span><span class="s1">'xlink:href'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">href</span><span class="p">},</span> <span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">text</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">text</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">DiagramItem</span><span class="p">(</span><span class="s1">'title'</span><span class="p">,</span> <span class="p">{},</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">Comment</span><span class="p">(</span><span class="n">DiagramItem</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">href</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">DiagramItem</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">'g'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">href</span> <span class="o">=</span> <span class="n">href</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">*</span> <span class="n">C</span><span class="o">.</span><span class="n">COMMENT_CHAR_WIDTH</span> <span class="o">+</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">up</span> <span class="o">=</span> <span class="mi">11</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">down</span> <span class="o">=</span> <span class="mi">11</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">needsSpace</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">addDebug</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">'Comment(</span><span class="si">%r</span><span class="s1">, href=</span><span class="si">%r</span><span class="s1">, title=</span><span class="si">%r</span><span class="s1">)'</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">href</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">width</span><span class="p">):</span>
        <span class="n">leftGap</span><span class="p">,</span> <span class="n">rightGap</span> <span class="o">=</span> <span class="n">determineGaps</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>

        <span class="c1"># Hook up the two sides if self is narrower than its stated width.</span>
        <span class="n">Path</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="n">leftGap</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">Path</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">leftGap</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="n">rightGap</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="n">text</span> <span class="o">=</span> <span class="n">DiagramItem</span><span class="p">(</span>
            <span class="s1">'text'</span><span class="p">,</span> <span class="p">{</span><span class="s1">'x'</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">'y'</span><span class="p">:</span> <span class="n">y</span> <span class="o">+</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">'class'</span><span class="p">:</span> <span class="s1">'comment'</span><span class="p">},</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">href</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">DiagramItem</span><span class="p">(</span><span class="s1">'a'</span><span class="p">,</span> <span class="p">{</span><span class="s1">'xlink:href'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">href</span><span class="p">},</span> <span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">text</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">text</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">DiagramItem</span><span class="p">(</span><span class="s1">'title'</span><span class="p">,</span> <span class="p">{},</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">Skip</span><span class="p">(</span><span class="n">DiagramItem</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">DiagramItem</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">'g'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">up</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">down</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">addDebug</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">width</span><span class="p">):</span>
        <span class="n">Path</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="n">width</span><span class="p">)</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">'Skip()'</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">show_diagram</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">Diagram</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="n">d</span><span class="o">.</span><span class="n">writeSvg</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">)</span>
        <span class="n">mysvg</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">mysvg</span>
</pre></div>

</div>
</div></div>
</div>
</div>

</details>

        
<p class="imprint">
<img style="float:right" src="../Images/2f3faa36146c6fb38bbab67add09aa5f.png" alt="Creative Commons License" data-original-src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png"/>
The content of this project is licensed under the
<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.
The source code that is part of the content, as well as the source code used to format and display that content is licensed under the <a href="https://github.com/uds-se/fuzzingbook/blob/master/LICENSE.md#mit-license">MIT License</a>.
<a href="https://github.com/uds-se/fuzzingbook/commits/master/notebooks/RailroadDiagrams.ipynb" target="_blank)">Last change: 2023-11-11 18:18:06+01:00</a> • 
<a href="#citation" id="cite" onclick="revealCitation()">Cite</a> •
<a href="https://cispa.de/en/impressum" target="_blank">Imprint</a>
</p>



<div id="citation" class="citation" style="display: none;">
<a name="citation"/>
<h2>How to Cite this Work</h2>
<p>
Andreas Zeller, Rahul Gopinath, Marcel Böhme, Gordon Fraser, and Christian Holler: "<a href="https://www.fuzzingbook.org/html/RailroadDiagrams.html">Railroad Diagrams</a>".  In Andreas Zeller, Rahul Gopinath, Marcel Böhme, Gordon Fraser, and Christian Holler, "<a href="https://www.fuzzingbook.org/">The Fuzzing Book</a>", <a href="https://www.fuzzingbook.org/html/RailroadDiagrams.html">https://www.fuzzingbook.org/html/RailroadDiagrams.html</a>.  Retrieved 2023-11-11 18:18:06+01:00.
</p>
<pre>
@incollection{fuzzingbook2023:RailroadDiagrams,
    author = {Andreas Zeller and Rahul Gopinath and Marcel B{\"o}hme and Gordon Fraser and Christian Holler},
    booktitle = {The Fuzzing Book},
    title = {Railroad Diagrams},
    year = {2023},
    publisher = {CISPA Helmholtz Center for Information Security},
    howpublished = {\url{https://www.fuzzingbook.org/html/RailroadDiagrams.html}},
    note = {Retrieved 2023-11-11 18:18:06+01:00},
    url = {https://www.fuzzingbook.org/html/RailroadDiagrams.html},
    urldate = {2023-11-11 18:18:06+01:00}
}
</pre>
</div>

          
</body>
</html>