<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Symbolic Fuzzing</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Symbolic Fuzzing</h1>
<blockquote>原文：<a href="http://www.fuzzingbook.org/html/SymbolicFuzzer.html">http://www.fuzzingbook.org/html/SymbolicFuzzer.html</a></blockquote>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>One of the problems with traditional methods of fuzzing is that they fail to exercise all the possible behaviors that a system can have, especially when the input space is large. Quite often the execution of a specific branch of execution may happen only with very specific inputs, which could represent a minimal fraction of the input space. The traditional fuzzing methods relies on chance to produce inputs they need. However, relying on randomness to generate values that we want is a bad idea when the space to be explored is huge. For example, a function that accepts a string, even if one only considers the first $10$ characters, already has $2^{80}$ possible inputs. If one is looking for a specific string, random generation of values will take a few thousand years even in one of the super computers.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>In the <a href="ConcolicFuzzer.html">chapter on concolic testing</a>, we have seen how <em>concolic tracing</em> can offer a way out. We saw how concolic tracing can be implemented using direct information flows using the Python interpreter. However, there are two problems with this approach.</p>
<ul>
<li>The first is that concolic tracing relies on the existence of sample inputs. What if one has no sample inputs?</li>
<li>Second, direct information flows could be unreliable if the program has indirect information flows such as those based on control flow.</li>
</ul>
<p>In both cases, <em>static code analysis</em> can bridge the gap. However, that raises the question: Can we determine the complete behavior of the program by examining it statically, and check if it behaves unexpectedly under some (unknown) input or result in an unexpected output?</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p><em>Symbolic execution</em> is one of the ways that we can reason about the behavior of a program without executing it. A program is a computation that can be treated as a system of equations that obtains the output values from the given inputs. Executing the program symbolically -- that is, solving these mathematically -- along with any specified objective such as covering a particular branch or obtaining a particular output will get us inputs that can accomplish this task.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>In this chapter, we investigate how symbolic execution can be implemented, and how it can be used to obtain interesting values for fuzzing.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="kn">from</span> <span class="nn"><a href="https://github.com/uds-se/fuzzingbook//tree/master/notebooks/shared/bookutils" class="import" target="_blank">bookutils</a></span> <span class="kn">import</span> <span class="n">YouTubeVideo</span>
<span class="n">YouTubeVideo</span><span class="p">(</span><span class="s1">'AJfRBF8NEWU'</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_html rendered_html output_subarea output_execute_result">

        

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p><strong>Prerequisites</strong></p>
<ul>
<li>You should understand how to use <a href="https://docs.python.org/3/library/typing.html">type annotations</a> in Python.</li>
<li>A working knowledge of <a href="https://en.wikipedia.org/wiki/Satisfiability_modulo_theories">SMT solvers</a>, especially <a href="https://github.com/Z3Prover/z3">Z3</a> is useful.</li>
<li>You should have read the <a href="Coverage.html">chapter on coverage</a>.</li>
<li>A familiarity with <a href="ConcolicFuzzer.html">chapter on concolic fuzzing</a> would be helpful.</li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><div class="synopsis"><h2 id="Synopsis">Synopsis</h2><!-- Automatically generated. Do not edit. -->

<p>To <a href="Importing.html">use the code provided in this chapter</a>, write</p>
<div class="highlight"><pre><span/><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn"><a href="SymbolicFuzzer.html" class="import" target="_blank">fuzzingbook.SymbolicFuzzer</a></span> <span class="kn">import</span> <span class="o">&lt;</span><span class="n">identifier</span><span class="o">&gt;</span>
</pre></div>
<p>and then make use of the following features.</p>
<p>This chapter provides an implementation of a symbolic fuzzing engine <code>SymbolicFuzzer</code>. The fuzzer uses symbolic execution to exhaustively explore paths in the program to a limited depth, and generate inputs that will reach these paths.</p>
<p>As an example, consider the function <code>gcd()</code>, computing the greatest common divisor of <code>a</code> and <code>b</code>:</p>
<div class="highlight"><pre><span/><span class="k">def</span> <span class="nf">gcd</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">:</span>
        <span class="n">c</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">a</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">b</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">c</span>

    <span class="k">while</span> <span class="n">b</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">c</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">a</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">b</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">c</span> <span class="o">%</span> <span class="n">b</span>

    <span class="k">return</span> <span class="n">a</span>
</pre></div>
<p>To explore <code>gcd()</code>, the fuzzer can be used as follows, producing values for arguments that cover different paths in <code>gcd()</code> (including multiple times of loop iterations):</p>
<div class="highlight"><pre><span/><span class="o">&gt;&gt;&gt;</span> <span class="n">gcd_fuzzer</span> <span class="o">=</span> <span class="n">SymbolicFuzzer</span><span class="p">(</span><span class="n">gcd</span><span class="p">,</span> <span class="n">max_tries</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="n">args</span> <span class="o">=</span> <span class="n">gcd_fuzzer</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="nb">print</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
<span class="p">{</span><span class="s1">'a'</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s1">'b'</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>
<span class="p">{</span><span class="s1">'a'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">'b'</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
<span class="p">{</span><span class="s1">'a'</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">'b'</span><span class="p">:</span> <span class="mi">5</span><span class="p">}</span>
<span class="p">{</span><span class="s1">'a'</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s1">'b'</span><span class="p">:</span> <span class="mi">6</span><span class="p">}</span>
<span class="p">{</span><span class="s1">'a'</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span> <span class="s1">'b'</span><span class="p">:</span> <span class="mi">10</span><span class="p">}</span>
<span class="p">{</span><span class="s1">'a'</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">'b'</span><span class="p">:</span> <span class="mi">4</span><span class="p">}</span>
<span class="p">{</span><span class="s1">'a'</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">'b'</span><span class="p">:</span> <span class="mi">9</span><span class="p">}</span>
<span class="p">{</span><span class="s1">'a'</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">'b'</span><span class="p">:</span> <span class="mi">10</span><span class="p">}</span>
<span class="p">{</span><span class="s1">'a'</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span> <span class="s1">'b'</span><span class="p">:</span> <span class="mi">7</span><span class="p">}</span>
<span class="p">{</span><span class="s1">'a'</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">'b'</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
</pre></div>
<p>Note that the variable values returned by <code>fuzz()</code> are Z3 <em>symbolic</em> values; to convert them to Python numbers, use their method <code>as_long()</code>:</p>
<div class="highlight"><pre><span/><span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="n">args</span> <span class="o">=</span> <span class="n">gcd_fuzzer</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="n">a</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s1">'a'</span><span class="p">]</span><span class="o">.</span><span class="n">as_long</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="n">b</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s1">'b'</span><span class="p">]</span><span class="o">.</span><span class="n">as_long</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="n">d</span> <span class="o">=</span> <span class="n">gcd</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"gcd(</span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2">) = </span><span class="si">{</span><span class="n">d</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="n">gcd</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">gcd</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">gcd</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">gcd</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">gcd</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">gcd</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">gcd</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">gcd</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">=</span> <span class="mi">15</span>
<span class="n">gcd</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">gcd</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</pre></div>
<p>The symbolic fuzzer is subject to a number of constraints. First, it requires that the function to be fuzzed has correct type annotations, including all local variables. Second, it solves loops by unrolling them, but only for a fixed amount.</p>
<p>For programs without loops and variable reassignments, the <code>SimpleSymbolicFuzzer</code> is a faster, but more limited alternative.</p>
<p>

<!-- Generated by graphviz version 12.2.1 (20241206.2353)
 -->
<!-- Pages: 1 -->
<svg width="300pt" height="402pt" viewbox="0.00 0.00 300.00 401.75" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 397.75)">
<g id="a_graph0"><a xlink:title="SymbolicFuzzer class hierarchy">
<polygon fill="white" stroke="none" points="-4,4 -4,-397.75 296,-397.75 296,4 -4,4"/>
</a>
</g>
<!-- SymbolicFuzzer -->
<g id="node1" class="node">
<title>SymbolicFuzzer</title>
<g id="a_node1"><a xlink:href="#" xlink:title="class SymbolicFuzzer:&#10;Symbolic fuzzing with reassignments and loop unrolling">
<polygon fill="none" stroke="black" points="0.38,-0.5 0.38,-98.25 154.38,-98.25 154.38,-0.5 0.38,-0.5"/>
<text text-anchor="start" x="28.62" y="-81.95" font-family="Patua One, Helvetica, sans-serif" font-weight="bold" font-size="14.00" fill="#b03a2e">SymbolicFuzzer</text>
<polyline fill="none" stroke="black" points="0.38,-72.25 154.38,-72.25"/>
<g id="a_node1_0"><a xlink:href="#" xlink:title="SymbolicFuzzer">
<g id="a_node1_1"><a xlink:href="#" xlink:title="extract_constraints(self, path)">
<text text-anchor="start" x="8.38" y="-59.75" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00">extract_constraints()</text>
</a>
</g>
<g id="a_node1_2"><a xlink:href="#" xlink:title="get_all_paths(self, fenter)">
<text text-anchor="start" x="8.38" y="-47" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00">get_all_paths()</text>
</a>
</g>
<g id="a_node1_3"><a xlink:href="#" xlink:title="get_next_path(self)">
<text text-anchor="start" x="8.38" y="-34.25" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00">get_next_path()</text>
</a>
</g>
<g id="a_node1_4"><a xlink:href="#" xlink:title="options(self, kwargs)">
<text text-anchor="start" x="8.38" y="-21.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00">options()</text>
</a>
</g>
<g id="a_node1_5"><a xlink:href="#" xlink:title="solve_path_constraint(self, path)">
<text text-anchor="start" x="8.38" y="-8.75" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00">solve_path_constraint()</text>
</a>
</g>
</a>
</g>
</a>
</g>
</g>
<!-- SimpleSymbolicFuzzer -->
<g id="node2" class="node">
<title>SimpleSymbolicFuzzer</title>
<g id="a_node2"><a xlink:href="#" xlink:title="class SimpleSymbolicFuzzer:&#10;Simple symbolic fuzzer">
<polygon fill="none" stroke="black" points="0,-135.25 0,-271.25 154.75,-271.25 154.75,-135.25 0,-135.25"/>
<text text-anchor="start" x="8" y="-254.95" font-family="Patua One, Helvetica, sans-serif" font-weight="bold" font-size="14.00" fill="#b03a2e">SimpleSymbolicFuzzer</text>
<polyline fill="none" stroke="black" points="0,-245.25 154.75,-245.25"/>
<g id="a_node2_6"><a xlink:href="#" xlink:title="SimpleSymbolicFuzzer">
<g id="a_node2_7"><a xlink:href="#" xlink:title="__init__(self, fn, **kwargs):&#10;Constructor.&#10;`fn` is the function to be fuzzed.&#10;Possible keyword parameters:&#10;* `max_depth` - the depth to which one should attempt&#10;to trace the execution (default 100)&#10;* `max_tries` - the maximum number of attempts&#10;we will try to produce a value before giving up (default 100)&#10;* `max_iter` - the number of iterations we will attempt (default 100).">
<text text-anchor="start" x="8.38" y="-232.75" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-style="italic" font-size="10.00">__init__()</text>
</a>
</g>
<g id="a_node2_8"><a xlink:href="#" xlink:title="fuzz(self):&#10;Produce one solution for each path.&#10;Returns a mapping of variable names to (symbolic) Z3 values.">
<text text-anchor="start" x="8.38" y="-220" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-style="italic" font-size="10.00">fuzz()</text>
</a>
</g>
<g id="a_node2_9"><a xlink:href="#" xlink:title="extract_constraints(self, path)">
<text text-anchor="start" x="8.38" y="-207.25" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00">extract_constraints()</text>
</a>
</g>
<g id="a_node2_10"><a xlink:href="#" xlink:title="get_all_paths(self, fenter, depth=0)">
<text text-anchor="start" x="8.38" y="-194.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00">get_all_paths()</text>
</a>
</g>
<g id="a_node2_11"><a xlink:href="#" xlink:title="get_next_path(self)">
<text text-anchor="start" x="8.38" y="-181.75" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00">get_next_path()</text>
</a>
</g>
<g id="a_node2_12"><a xlink:href="#" xlink:title="options(self, kwargs)">
<text text-anchor="start" x="8.38" y="-169" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00">options()</text>
</a>
</g>
<g id="a_node2_13"><a xlink:href="#" xlink:title="process(self)">
<text text-anchor="start" x="8.38" y="-155.25" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00">process()</text>
</a>
</g>
<g id="a_node2_14"><a xlink:href="#" xlink:title="solve_path_constraint(self, path)">
<text text-anchor="start" x="8.38" y="-143.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00">solve_path_constraint()</text>
</a>
</g>
</a>
</g>
</a>
</g>
</g>
<!-- SymbolicFuzzer&#45;&gt;SimpleSymbolicFuzzer -->
<g id="edge1" class="edge">
<title>SymbolicFuzzer-&gt;SimpleSymbolicFuzzer</title>
<path fill="none" stroke="black" d="M77.38,-98.43C77.38,-106.47 77.38,-114.99 77.38,-123.55"/>
<polygon fill="none" stroke="black" points="73.88,-123.29 77.38,-133.29 80.88,-123.29 73.88,-123.29"/>
</g>
<!-- Fuzzer -->
<g id="node3" class="node">
<title>Fuzzer</title>
<g id="a_node3"><a xlink:href="Fuzzer.html" xlink:title="class Fuzzer:&#10;Base class for fuzzers.">
<polygon fill="none" stroke="black" points="39.38,-308.25 39.38,-393.25 115.38,-393.25 115.38,-308.25 39.38,-308.25"/>
<text text-anchor="start" x="56.75" y="-376.95" font-family="Patua One, Helvetica, sans-serif" font-weight="bold" font-size="14.00" fill="#b03a2e">Fuzzer</text>
<polyline fill="none" stroke="black" points="39.38,-367.25 115.38,-367.25"/>
<g id="a_node3_15"><a xlink:href="#" xlink:title="Fuzzer">
<g id="a_node3_16"><a xlink:href="Fuzzer.html" xlink:title="__init__(self) -&gt; None:&#10;Constructor">
<text text-anchor="start" x="47.38" y="-354.75" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-style="italic" font-size="10.00">__init__()</text>
</a>
</g>
<g id="a_node3_17"><a xlink:href="Fuzzer.html" xlink:title="fuzz(self) -&gt; str:&#10;Return fuzz input">
<text text-anchor="start" x="47.38" y="-342" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-style="italic" font-size="10.00">fuzz()</text>
</a>
</g>
<g id="a_node3_18"><a xlink:href="Fuzzer.html" xlink:title="run(self, runner: Fuzzer.Runner = &lt;Fuzzer.Runner object&gt;) -&gt; Tuple[subprocess.CompletedProcess, str]:&#10;Run `runner` with fuzz input">
<text text-anchor="start" x="47.38" y="-329.25" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00">run()</text>
</a>
</g>
<g id="a_node3_19"><a xlink:href="Fuzzer.html" xlink:title="runs(self, runner: Fuzzer.Runner = &lt;Fuzzer.PrintRunner object&gt;, trials: int = 10) -&gt; List[Tuple[subprocess.CompletedProcess, str]]:&#10;Run `runner` with fuzz input, `trials` times">
<text text-anchor="start" x="47.38" y="-316.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00">runs()</text>
</a>
</g>
</a>
</g>
</a>
</g>
</g>
<!-- SimpleSymbolicFuzzer&#45;&gt;Fuzzer -->
<g id="edge2" class="edge">
<title>SimpleSymbolicFuzzer-&gt;Fuzzer</title>
<path fill="none" stroke="black" d="M77.38,-271.46C77.38,-279.97 77.38,-288.57 77.38,-296.81"/>
<polygon fill="none" stroke="black" points="73.88,-296.65 77.38,-306.65 80.88,-296.65 73.88,-296.65"/>
</g>
<!-- Legend -->
<g id="node4" class="node">
<title>Legend</title>
<text text-anchor="start" x="172.75" y="-65.38" font-family="Patua One, Helvetica, sans-serif" font-weight="bold" font-size="10.00" fill="#b03a2e">Legend</text>
<text text-anchor="start" x="172.75" y="-55.38" font-family="Patua One, Helvetica, sans-serif" font-size="10.00">• </text>
<text text-anchor="start" x="178.75" y="-55.38" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="8.00">public_method()</text>
<text text-anchor="start" x="172.75" y="-45.38" font-family="Patua One, Helvetica, sans-serif" font-size="10.00">• </text>
<text text-anchor="start" x="178.75" y="-45.38" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="8.00">private_method()</text>
<text text-anchor="start" x="172.75" y="-35.38" font-family="Patua One, Helvetica, sans-serif" font-size="10.00">• </text>
<text text-anchor="start" x="178.75" y="-35.38" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="8.00">overloaded_method()</text>
<text text-anchor="start" x="172.75" y="-26.32" font-family="Helvetica,sans-Serif" font-size="9.00">Hover over names to see doc</text>
</g>
</g>
</svg>
</p>
</div>
</div>
</div>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Obtaining-Path-Conditions-for-Coverage">Obtaining Path Conditions for Coverage</h2></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>In the chapter on <a href="SearchBasedFuzzer.html">parsing and recombining inputs</a>, we saw how difficult it was to generate inputs for <code>process_vehicle()</code> -- a simple function that accepts a string. The solution given there was to rely on preexisting sample inputs. However, this solution is inadequate as it assumes the existence of sample inputs. What if there are no sample inputs at hand?</p>
<p>For a simpler example, let us consider the following triangle function (which we already have seen in the <a href="ConcolicFuzzer.html">chapter on concolic fuzzing</a>). Can we generate inputs to cover all the paths?</p>
<p><em>Note.</em> We use type annotations to denote the argument types of programs. The <a href="DynamicInvariants.html">chapter on discovering dynamic invariants</a> will discuss how these types can be inferred automatically.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">check_triangle</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="n">b</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="n">c</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="n">c</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">"Equilateral"</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">"Isosceles"</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">"Isosceles"</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">b</span> <span class="o">!=</span> <span class="n">c</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="n">c</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">"Isosceles"</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">"Scalene"</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">"Isosceles"</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="The-Control-Flow-Graph">The Control Flow Graph</h3></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The control flow graph of this function can be represented as follows:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="kn">import</span> <span class="nn"><a href="https://github.com/uds-se/fuzzingbook//tree/master/notebooks/shared/bookutils" class="import" target="_blank">bookutils.setup</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/inspect.html" class="import" target="_blank">inspect</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="kn">from</span> <span class="nn"><a href="ControlFlow.html" class="import" target="_blank">ControlFlow</a></span> <span class="kn">import</span> <span class="n">PyCFG</span><span class="p">,</span> <span class="n">to_graph</span><span class="p">,</span> <span class="n">gen_cfg</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">show_cfg</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">to_graph</span><span class="p">(</span><span class="n">gen_cfg</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">getsource</span><span class="p">(</span><span class="n">fn</span><span class="p">)),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">show_cfg</span><span class="p">(</span><span class="n">check_triangle</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_svg output_subarea output_execute_result">


<!-- Generated by graphviz version 12.2.1 (20241206.2353)
 -->
<!-- Pages: 1 -->
<svg width="676pt" height="487pt" viewbox="0.00 0.00 675.50 486.50" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 482.5)">
<polygon fill="white" stroke="none" points="-4,4 -4,-482.5 671.5,-482.5 671.5,4 -4,4"/>
<!-- 1 -->
<g id="node1" class="node">
<title>1</title>
<ellipse fill="none" stroke="black" cx="259.75" cy="-456.5" rx="118.94" ry="18"/>
<ellipse fill="none" stroke="black" cx="259.75" cy="-456.5" rx="122.94" ry="22"/>
<text text-anchor="middle" x="259.75" y="-450.32" font-family="Times,serif" font-size="14.00">1: enter: check_triangle(a, b, c)</text>
</g>
<!-- 3 -->
<g id="node9" class="node">
<title>3</title>
<polygon fill="none" stroke="black" points="259.75,-397.5 185.32,-379.5 259.75,-361.5 334.18,-379.5 259.75,-397.5"/>
<text text-anchor="middle" x="259.75" y="-373.32" font-family="Times,serif" font-size="14.00">2: if: a == b</text>
</g>
<!-- 1&#45;&gt;3 -->
<g id="edge7" class="edge">
<title>1-&gt;3</title>
<path fill="none" stroke="black" d="M259.75,-434.21C259.75,-426.32 259.75,-417.25 259.75,-408.83"/>
<polygon fill="black" stroke="black" points="263.25,-409.07 259.75,-399.07 256.25,-409.07 263.25,-409.07"/>
</g>
<!-- 2 -->
<g id="node2" class="node">
<title>2</title>
<ellipse fill="none" stroke="black" cx="353.75" cy="-22" rx="114.64" ry="18"/>
<ellipse fill="none" stroke="black" cx="353.75" cy="-22" rx="118.64" ry="22"/>
<text text-anchor="middle" x="353.75" y="-15.82" font-family="Times,serif" font-size="14.00">1: exit: check_triangle(a, b, c)</text>
</g>
<!-- 6 -->
<g id="node3" class="node">
<title>6</title>
<polygon fill="none" stroke="black" points="209.75,-117 79.75,-117 79.75,-81 209.75,-81 209.75,-117"/>
<text text-anchor="middle" x="144.75" y="-92.83" font-family="Times,serif" font-size="14.00">5: return 'Equilateral'</text>
</g>
<!-- 6&#45;&gt;2 -->
<g id="edge1" class="edge">
<title>6-&gt;2</title>
<path fill="none" stroke="black" d="M193.49,-80.51C222.19,-70.21 258.83,-57.06 289.82,-45.94"/>
<polygon fill="black" stroke="black" points="290.88,-49.28 299.11,-42.61 288.51,-42.69 290.88,-49.28"/>
</g>
<!-- 7 -->
<g id="node4" class="node">
<title>7</title>
<polygon fill="none" stroke="black" points="347.5,-117 228,-117 228,-81 347.5,-81 347.5,-117"/>
<text text-anchor="middle" x="287.75" y="-92.83" font-family="Times,serif" font-size="14.00">7: return 'Isosceles'</text>
</g>
<!-- 7&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>7-&gt;2</title>
<path fill="none" stroke="black" d="M303.06,-80.6C310.4,-72.26 319.41,-62.02 327.79,-52.5"/>
<polygon fill="black" stroke="black" points="330.25,-55 334.23,-45.18 325,-50.37 330.25,-55"/>
</g>
<!-- 8 -->
<g id="node5" class="node">
<title>8</title>
<polygon fill="none" stroke="black" points="119.5,-171 0,-171 0,-135 119.5,-135 119.5,-171"/>
<text text-anchor="middle" x="59.75" y="-146.82" font-family="Times,serif" font-size="14.00">9: return 'Isosceles'</text>
</g>
<!-- 8&#45;&gt;2 -->
<g id="edge3" class="edge">
<title>8-&gt;2</title>
<path fill="none" stroke="black" d="M57.35,-134.72C56.17,-118.67 57.24,-95.18 70.75,-81 93.77,-56.84 169.35,-42.12 236.61,-33.56"/>
<polygon fill="black" stroke="black" points="236.75,-37.07 246.25,-32.37 235.9,-30.12 236.75,-37.07"/>
</g>
<!-- 11 -->
<g id="node6" class="node">
<title>11</title>
<polygon fill="none" stroke="black" points="529.88,-117 403.62,-117 403.62,-81 529.88,-81 529.88,-117"/>
<text text-anchor="middle" x="466.75" y="-92.83" font-family="Times,serif" font-size="14.00">13: return 'Isosceles'</text>
</g>
<!-- 11&#45;&gt;2 -->
<g id="edge4" class="edge">
<title>11-&gt;2</title>
<path fill="none" stroke="black" d="M440.54,-80.6C426.72,-71.43 409.46,-59.98 393.99,-49.71"/>
<polygon fill="black" stroke="black" points="396.16,-46.94 385.89,-44.33 392.29,-52.78 396.16,-46.94"/>
</g>
<!-- 12 -->
<g id="node7" class="node">
<title>12</title>
<polygon fill="none" stroke="black" points="667.5,-117 548,-117 548,-81 667.5,-81 667.5,-117"/>
<text text-anchor="middle" x="607.75" y="-92.83" font-family="Times,serif" font-size="14.00">15: return 'Scalene'</text>
</g>
<!-- 12&#45;&gt;2 -->
<g id="edge5" class="edge">
<title>12-&gt;2</title>
<path fill="none" stroke="black" d="M548.52,-80.51C511.94,-69.71 464.75,-55.78 425.98,-44.33"/>
<polygon fill="black" stroke="black" points="427.32,-41.07 416.74,-41.6 425.34,-47.79 427.32,-41.07"/>
</g>
<!-- 13 -->
<g id="node8" class="node">
<title>13</title>
<polygon fill="none" stroke="black" points="432.88,-171 306.62,-171 306.62,-135 432.88,-135 432.88,-171"/>
<text text-anchor="middle" x="369.75" y="-146.82" font-family="Times,serif" font-size="14.00">17: return 'Isosceles'</text>
</g>
<!-- 13&#45;&gt;2 -->
<g id="edge6" class="edge">
<title>13-&gt;2</title>
<path fill="none" stroke="black" d="M367.59,-134.6C365.09,-114.42 360.91,-80.7 357.79,-55.6"/>
<polygon fill="black" stroke="black" points="361.3,-55.4 356.59,-45.91 354.35,-56.26 361.3,-55.4"/>
</g>
<!-- 4 -->
<g id="node10" class="node">
<title>4</title>
<polygon fill="none" stroke="black" points="175.75,-311.25 101.99,-293.25 175.75,-275.25 249.51,-293.25 175.75,-311.25"/>
<text text-anchor="middle" x="175.75" y="-287.07" font-family="Times,serif" font-size="14.00">3: if: a == c</text>
</g>
<!-- 3&#45;&gt;4 -->
<g id="edge8" class="edge">
<title>3-&gt;4</title>
<path fill="none" stroke="blue" d="M245.88,-364.59C232.75,-351.42 212.83,-331.44 197.57,-316.13"/>
<polygon fill="blue" stroke="blue" points="200.25,-313.87 190.71,-309.25 195.29,-318.81 200.25,-313.87"/>
<text text-anchor="middle" x="226.9" y="-330.2" font-family="Times,serif" font-size="14.00">T</text>
</g>
<!-- 9 -->
<g id="node12" class="node">
<title>9</title>
<polygon fill="none" stroke="black" points="368.75,-311.25 291.62,-293.25 368.75,-275.25 445.88,-293.25 368.75,-311.25"/>
<text text-anchor="middle" x="368.75" y="-287.07" font-family="Times,serif" font-size="14.00">11: if: b != c</text>
</g>
<!-- 3&#45;&gt;9 -->
<g id="edge13" class="edge">
<title>3-&gt;9</title>
<path fill="none" stroke="red" d="M276.78,-365.34C294.36,-351.75 322,-330.38 342.4,-314.62"/>
<polygon fill="red" stroke="red" points="344.51,-317.41 350.28,-308.53 340.23,-311.87 344.51,-317.41"/>
<text text-anchor="middle" x="324.53" y="-330.2" font-family="Times,serif" font-size="14.00">F</text>
</g>
<!-- 4&#45;&gt;8 -->
<g id="edge12" class="edge">
<title>4-&gt;8</title>
<path fill="none" stroke="red" d="M155.8,-279.92C137.47,-267.79 110.54,-247.81 92.75,-225 82.66,-212.06 74.74,-195.54 69.2,-181.68"/>
<polygon fill="red" stroke="red" points="72.61,-180.8 65.8,-172.68 66.06,-183.28 72.61,-180.8"/>
<text text-anchor="middle" x="127.31" y="-243.95" font-family="Times,serif" font-size="14.00">F</text>
</g>
<!-- 5 -->
<g id="node11" class="node">
<title>5</title>
<polygon fill="none" stroke="black" points="175.75,-225 101.32,-207 175.75,-189 250.18,-207 175.75,-225"/>
<text text-anchor="middle" x="175.75" y="-200.82" font-family="Times,serif" font-size="14.00">4: if: b == c</text>
</g>
<!-- 4&#45;&gt;5 -->
<g id="edge9" class="edge">
<title>4-&gt;5</title>
<path fill="none" stroke="blue" d="M175.75,-274.79C175.75,-263.84 175.75,-249.44 175.75,-236.82"/>
<polygon fill="blue" stroke="blue" points="179.25,-236.95 175.75,-226.95 172.25,-236.95 179.25,-236.95"/>
<text text-anchor="middle" x="179.88" y="-243.95" font-family="Times,serif" font-size="14.00">T</text>
</g>
<!-- 5&#45;&gt;6 -->
<g id="edge10" class="edge">
<title>5-&gt;6</title>
<path fill="none" stroke="blue" d="M171.04,-189.9C166.26,-173.54 158.75,-147.86 152.97,-128.12"/>
<polygon fill="blue" stroke="blue" points="156.4,-127.38 150.24,-118.76 149.68,-129.34 156.4,-127.38"/>
<text text-anchor="middle" x="168.96" y="-146.82" font-family="Times,serif" font-size="14.00">T</text>
</g>
<!-- 5&#45;&gt;7 -->
<g id="edge11" class="edge">
<title>5-&gt;7</title>
<path fill="none" stroke="red" d="M190.39,-192.14C208.29,-175.2 238.94,-146.2 261.07,-125.25"/>
<polygon fill="red" stroke="red" points="263.43,-127.84 268.29,-118.42 258.62,-122.75 263.43,-127.84"/>
<text text-anchor="middle" x="252.08" y="-146.82" font-family="Times,serif" font-size="14.00">F</text>
</g>
<!-- 9&#45;&gt;13 -->
<g id="edge17" class="edge">
<title>9-&gt;13</title>
<path fill="none" stroke="red" d="M368.87,-275.02C369.04,-251.94 369.34,-210.68 369.54,-182.83"/>
<polygon fill="red" stroke="red" points="373.04,-182.99 369.61,-172.96 366.04,-182.93 373.04,-182.99"/>
<text text-anchor="middle" x="372.85" y="-243.95" font-family="Times,serif" font-size="14.00">F</text>
</g>
<!-- 10 -->
<g id="node13" class="node">
<title>10</title>
<polygon fill="none" stroke="black" points="476.75,-225 396.92,-207 476.75,-189 556.58,-207 476.75,-225"/>
<text text-anchor="middle" x="476.75" y="-200.82" font-family="Times,serif" font-size="14.00">12: if: a == c</text>
</g>
<!-- 9&#45;&gt;10 -->
<g id="edge14" class="edge">
<title>9-&gt;10</title>
<path fill="none" stroke="blue" d="M385.62,-279.09C403.04,-265.5 430.43,-244.13 450.64,-228.37"/>
<polygon fill="blue" stroke="blue" points="452.71,-231.19 458.44,-222.28 448.41,-225.67 452.71,-231.19"/>
<text text-anchor="middle" x="433.34" y="-243.95" font-family="Times,serif" font-size="14.00">T</text>
</g>
<!-- 10&#45;&gt;11 -->
<g id="edge15" class="edge">
<title>10-&gt;11</title>
<path fill="none" stroke="blue" d="M475.14,-188.97C473.61,-172.76 471.28,-148.06 469.47,-128.79"/>
<polygon fill="blue" stroke="blue" points="472.95,-128.47 468.53,-118.85 465.98,-129.13 472.95,-128.47"/>
<text text-anchor="middle" x="477.36" y="-146.82" font-family="Times,serif" font-size="14.00">T</text>
</g>
<!-- 10&#45;&gt;12 -->
<g id="edge16" class="edge">
<title>10-&gt;12</title>
<path fill="none" stroke="red" d="M493.61,-192.36C514.75,-175.25 551.38,-145.61 577.44,-124.53"/>
<polygon fill="red" stroke="red" points="579.42,-127.42 585,-118.41 575.02,-121.98 579.42,-127.42"/>
<text text-anchor="middle" x="565.39" y="-146.82" font-family="Times,serif" font-size="14.00">F</text>
</g>
</g>
</svg>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The possible execution paths traced by the program can be represented as follows, with the numbers indicating the specific line numbers executed.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">paths</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'&lt;path 1&gt;'</span><span class="p">:</span> <span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="s1">'Equilateral'</span><span class="p">),</span>
    <span class="s1">'&lt;path 2&gt;'</span><span class="p">:</span> <span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span> <span class="s1">'Isosceles'</span><span class="p">),</span>
    <span class="s1">'&lt;path 3&gt;'</span><span class="p">:</span> <span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">9</span><span class="p">],</span> <span class="s1">'Isosceles'</span><span class="p">),</span>
    <span class="s1">'&lt;path 4&gt;'</span><span class="p">:</span> <span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">],</span> <span class="s1">'Isosceles'</span><span class="p">),</span>
    <span class="s1">'&lt;path 5&gt;'</span><span class="p">:</span> <span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">15</span><span class="p">],</span> <span class="s1">'Scalene'</span><span class="p">),</span>
    <span class="s1">'&lt;path 6&gt;'</span><span class="p">:</span> <span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">17</span><span class="p">],</span> <span class="s1">'Isosceles'</span><span class="p">),</span>
<span class="p">}</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Consider the <code>&lt;path 1&gt;</code>. To trace this path, we need to execute the following statements in order.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><div class="highlight"><pre><span/><span class="mi">1</span><span class="p">:</span> <span class="n">check_triangle</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
<span class="mi">2</span><span class="p">:</span> <span class="k">if</span> <span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="n">b</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">True</span>
<span class="mi">3</span><span class="p">:</span> <span class="k">if</span> <span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="n">c</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">True</span>
<span class="mi">4</span><span class="p">:</span> <span class="k">if</span> <span class="p">(</span><span class="n">b</span> <span class="o">==</span> <span class="n">c</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">True</span>
<span class="mi">5</span><span class="p">:</span> <span class="k">return</span> <span class="s1">'Equilateral'</span>
</pre></div>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>That is, any execution that traces this path has to start with values for <code>a</code>, <code>b</code>, and <code>c</code> that obeys the constraints in line numbers <code>2: (a == b)</code> evaluates to <code>True</code>, <code>3: (a == c)</code> evaluates to <code>True</code>, and <code>4: (b == c)</code> evaluates to <code>True</code>. Can we generate inputs such that these constraints are satisfied?</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We have seen from the <a href="ConcolicFuzzer.html">chapter on concolic fuzzing</a> how one can use an SMT solver such as Z3 to obtain a solution.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="kn">import</span> <span class="nn"><a href="https://github.com/Z3Prover/z3#readme" class="import" target="_blank">z3</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">z3_ver</span> <span class="o">=</span> <span class="n">z3</span><span class="o">.</span><span class="n">get_version</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">z3_ver</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(4, 11, 2, 0)
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">assert</span> <span class="n">z3_ver</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="s2">"Please check z3 version"</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>What kind of symbolic variables do we need? We can obtain that information from the type annotations of the function.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">get_annotations</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
    <span class="n">sig</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">([(</span><span class="n">i</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">annotation</span><span class="p">)</span>
             <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sig</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">values</span><span class="p">()],</span> <span class="n">sig</span><span class="o">.</span><span class="n">return_annotation</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">params</span><span class="p">,</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">get_annotations</span><span class="p">(</span><span class="n">check_triangle</span><span class="p">)</span>
<span class="n">params</span><span class="p">,</span> <span class="n">ret</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>([('a', int), ('b', int), ('c', int)], str)
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We create symbolic variables to represent each of the parameters</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">SYM_VARS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nb">int</span><span class="p">:</span> <span class="p">(</span>
        <span class="n">z3</span><span class="o">.</span><span class="n">Int</span><span class="p">,</span> <span class="n">z3</span><span class="o">.</span><span class="n">IntVal</span><span class="p">),</span> <span class="nb">float</span><span class="p">:</span> <span class="p">(</span>
            <span class="n">z3</span><span class="o">.</span><span class="n">Real</span><span class="p">,</span> <span class="n">z3</span><span class="o">.</span><span class="n">RealVal</span><span class="p">),</span> <span class="nb">str</span><span class="p">:</span> <span class="p">(</span>
                <span class="n">z3</span><span class="o">.</span><span class="n">String</span><span class="p">,</span> <span class="n">z3</span><span class="o">.</span><span class="n">StringVal</span><span class="p">)}</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">get_symbolicparams</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
    <span class="n">params</span><span class="p">,</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">get_annotations</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">SYM_VARS</span><span class="p">[</span><span class="n">typ</span><span class="p">][</span><span class="mi">0</span><span class="p">](</span><span class="n">name</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">typ</span> <span class="ow">in</span> <span class="n">params</span><span class="p">],</span> <span class="n">SYM_VARS</span><span class="p">[</span><span class="n">ret</span><span class="p">][</span><span class="mi">0</span><span class="p">](</span><span class="s1">'__return__'</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">),</span> <span class="n">r</span> <span class="o">=</span> <span class="n">get_symbolicparams</span><span class="p">(</span><span class="n">check_triangle</span><span class="p">)</span>
<span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">r</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>(a, b, c, __return__)
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We can now ask <em>z3</em> to solve the set of equations for us as follows.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">z3</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">==</span> <span class="n">c</span><span class="p">,</span> <span class="n">b</span> <span class="o">==</span> <span class="n">c</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[a = 0, b = 0, c = 0]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Here we find the first problem in our program. Our program seems to not check whether the sides are greater than zero. (Real-world triangles all have sides with a positive length.) Assume for now that we do not have that restriction. Does our program correctly follow the path described?</p>
<p>We can use the <code>ArcCoverage</code> from the <a href="ConcolicFuzzer.html">chapter on concolic fuzzing</a> as a tracer to visualize that information as below.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="kn">from</span> <span class="nn"><a href="ConcolicFuzzer.html" class="import" target="_blank">ConcolicFuzzer</a></span> <span class="kn">import</span> <span class="n">ArcCoverage</span>  <span class="c1"># minor dependency</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>First, we recover the trace.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">with</span> <span class="n">ArcCoverage</span><span class="p">()</span> <span class="k">as</span> <span class="n">cov</span><span class="p">:</span>
    <span class="k">assert</span> <span class="n">check_triangle</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="s1">'Equilateral'</span>
<span class="n">cov</span><span class="o">.</span><span class="n">_trace</span><span class="p">,</span> <span class="n">cov</span><span class="o">.</span><span class="n">arcs</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>([('check_triangle', 1),
  ('check_triangle', 2),
  ('check_triangle', 3),
  ('check_triangle', 4),
  ('check_triangle', 5),
  ('__exit__', 102),
  ('__exit__', 105)],
 [(1, 2), (2, 3), (3, 4), (4, 5), (5, 102), (102, 105)])
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We can now determine the path taken.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="The-CFG-with-Path-Taken">The CFG with Path Taken</h3></div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">show_cfg</span><span class="p">(</span><span class="n">check_triangle</span><span class="p">,</span> <span class="n">arcs</span><span class="o">=</span><span class="n">cov</span><span class="o">.</span><span class="n">arcs</span><span class="p">())</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_svg output_subarea output_execute_result">


<!-- Generated by graphviz version 12.2.1 (20241206.2353)
 -->
<!-- Pages: 1 -->
<svg width="683pt" height="420pt" viewbox="0.00 0.00 682.50 420.00" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 416)">
<polygon fill="white" stroke="none" points="-4,4 -4,-416 678.5,-416 678.5,4 -4,4"/>
<!-- 1 -->
<g id="node1" class="node">
<title>1</title>
<ellipse fill="none" stroke="black" cx="295.75" cy="-390" rx="118.94" ry="18"/>
<ellipse fill="none" stroke="black" cx="295.75" cy="-390" rx="122.94" ry="22"/>
<text text-anchor="middle" x="295.75" y="-383.82" font-family="Times,serif" font-size="14.00">1: enter: check_triangle(a, b, c)</text>
</g>
<!-- 3 -->
<g id="node9" class="node">
<title>3</title>
<polygon fill="none" stroke="black" points="295.75,-332 221.32,-314 295.75,-296 370.18,-314 295.75,-332"/>
<text text-anchor="middle" x="295.75" y="-307.82" font-family="Times,serif" font-size="14.00">2: if: a == b</text>
</g>
<!-- 1&#45;&gt;3 -->
<g id="edge7" class="edge">
<title>1-&gt;3</title>
<path fill="none" stroke="green" d="M295.75,-367.6C295.75,-360.11 295.75,-351.59 295.75,-343.61"/>
<polygon fill="green" stroke="green" points="299.25,-343.65 295.75,-333.65 292.25,-343.65 299.25,-343.65"/>
</g>
<!-- 2 -->
<g id="node2" class="node">
<title>2</title>
<ellipse fill="none" stroke="black" cx="338.75" cy="-22" rx="114.64" ry="18"/>
<ellipse fill="none" stroke="black" cx="338.75" cy="-22" rx="118.64" ry="22"/>
<text text-anchor="middle" x="338.75" y="-15.82" font-family="Times,serif" font-size="14.00">1: exit: check_triangle(a, b, c)</text>
</g>
<!-- 6 -->
<g id="node3" class="node">
<title>6</title>
<polygon fill="none" stroke="black" points="216.75,-116 86.75,-116 86.75,-80 216.75,-80 216.75,-116"/>
<text text-anchor="middle" x="151.75" y="-91.83" font-family="Times,serif" font-size="14.00">5: return 'Equilateral'</text>
</g>
<!-- 6&#45;&gt;2 -->
<g id="edge1" class="edge">
<title>6-&gt;2</title>
<path fill="none" stroke="green" d="M195.59,-79.65C220.47,-69.81 251.95,-57.35 279.05,-46.63"/>
<polygon fill="green" stroke="green" points="280.16,-49.95 288.18,-43.01 277.59,-43.44 280.16,-49.95"/>
</g>
<!-- 7 -->
<g id="node4" class="node">
<title>7</title>
<polygon fill="none" stroke="black" points="354.5,-116 235,-116 235,-80 354.5,-80 354.5,-116"/>
<text text-anchor="middle" x="294.75" y="-91.83" font-family="Times,serif" font-size="14.00">7: return 'Isosceles'</text>
</g>
<!-- 7&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>7-&gt;2</title>
<path fill="none" stroke="red" d="M304.96,-79.84C309.53,-72.14 315.07,-62.83 320.33,-53.98"/>
<polygon fill="red" stroke="red" points="323.21,-55.99 325.31,-45.61 317.19,-52.41 323.21,-55.99"/>
</g>
<!-- 8 -->
<g id="node5" class="node">
<title>8</title>
<polygon fill="none" stroke="black" points="119.5,-188 0,-188 0,-152 119.5,-152 119.5,-188"/>
<text text-anchor="middle" x="59.75" y="-163.82" font-family="Times,serif" font-size="14.00">9: return 'Isosceles'</text>
</g>
<!-- 8&#45;&gt;2 -->
<g id="edge3" class="edge">
<title>8-&gt;2</title>
<path fill="none" stroke="red" d="M58.1,-151.73C57.2,-131.69 59.06,-98.98 77.75,-80 98.81,-58.61 165.3,-44.28 225.9,-35.34"/>
<polygon fill="red" stroke="red" points="226.23,-38.82 235.63,-33.94 225.24,-31.89 226.23,-38.82"/>
</g>
<!-- 11 -->
<g id="node6" class="node">
<title>11</title>
<polygon fill="none" stroke="black" points="536.88,-116 410.62,-116 410.62,-80 536.88,-80 536.88,-116"/>
<text text-anchor="middle" x="473.75" y="-91.83" font-family="Times,serif" font-size="14.00">13: return 'Isosceles'</text>
</g>
<!-- 11&#45;&gt;2 -->
<g id="edge4" class="edge">
<title>11-&gt;2</title>
<path fill="none" stroke="red" d="M442.1,-79.65C425.19,-70.38 404.05,-58.79 385.3,-48.52"/>
<polygon fill="red" stroke="red" points="387.24,-45.59 376.79,-43.85 383.87,-51.73 387.24,-45.59"/>
</g>
<!-- 12 -->
<g id="node7" class="node">
<title>12</title>
<polygon fill="none" stroke="black" points="674.5,-116 555,-116 555,-80 674.5,-80 674.5,-116"/>
<text text-anchor="middle" x="614.75" y="-91.83" font-family="Times,serif" font-size="14.00">15: return 'Scalene'</text>
</g>
<!-- 12&#45;&gt;2 -->
<g id="edge5" class="edge">
<title>12-&gt;2</title>
<path fill="none" stroke="red" d="M554.52,-80.85C513.73,-69.91 459.47,-55.37 415.57,-43.6"/>
<polygon fill="red" stroke="red" points="416.67,-40.27 406.1,-41.06 414.86,-47.03 416.67,-40.27"/>
</g>
<!-- 13 -->
<g id="node8" class="node">
<title>13</title>
<polygon fill="none" stroke="black" points="444.88,-188 318.62,-188 318.62,-152 444.88,-152 444.88,-188"/>
<text text-anchor="middle" x="381.75" y="-163.82" font-family="Times,serif" font-size="14.00">17: return 'Isosceles'</text>
</g>
<!-- 13&#45;&gt;2 -->
<g id="edge6" class="edge">
<title>13-&gt;2</title>
<path fill="none" stroke="red" d="M379.37,-151.66C376.62,-133.52 371.45,-104.35 363.75,-80 361.08,-71.55 357.55,-62.66 353.99,-54.48"/>
<polygon fill="red" stroke="red" points="357.29,-53.29 349.98,-45.61 350.91,-56.17 357.29,-53.29"/>
</g>
<!-- 4 -->
<g id="node10" class="node">
<title>4</title>
<polygon fill="none" stroke="black" points="211.75,-260 137.99,-242 211.75,-224 285.51,-242 211.75,-260"/>
<text text-anchor="middle" x="211.75" y="-235.82" font-family="Times,serif" font-size="14.00">3: if: a == c</text>
</g>
<!-- 3&#45;&gt;4 -->
<g id="edge8" class="edge">
<title>3-&gt;4</title>
<path fill="none" stroke="green" d="M279.55,-299.5C267.35,-289.34 250.41,-275.21 236.51,-263.63"/>
<polygon fill="green" stroke="green" points="238.98,-261.14 229.06,-257.42 234.5,-266.51 238.98,-261.14"/>
</g>
<!-- 9 -->
<g id="node12" class="node">
<title>9</title>
<polygon fill="none" stroke="black" points="381.75,-260 304.62,-242 381.75,-224 458.88,-242 381.75,-260"/>
<text text-anchor="middle" x="381.75" y="-235.82" font-family="Times,serif" font-size="14.00">11: if: b != c</text>
</g>
<!-- 3&#45;&gt;9 -->
<g id="edge13" class="edge">
<title>3-&gt;9</title>
<path fill="none" stroke="red" d="M312.33,-299.5C324.82,-289.34 342.17,-275.21 356.4,-263.63"/>
<polygon fill="red" stroke="red" points="358.5,-266.44 364.05,-257.41 354.08,-261.01 358.5,-266.44"/>
</g>
<!-- 4&#45;&gt;8 -->
<g id="edge12" class="edge">
<title>4-&gt;8</title>
<path fill="none" stroke="red" d="M186.99,-229.6C165.6,-219.75 134.08,-205.23 107.76,-193.11"/>
<polygon fill="red" stroke="red" points="109.51,-190.06 98.97,-189.06 106.59,-196.42 109.51,-190.06"/>
</g>
<!-- 5 -->
<g id="node11" class="node">
<title>5</title>
<polygon fill="none" stroke="black" points="211.75,-188 137.32,-170 211.75,-152 286.18,-170 211.75,-188"/>
<text text-anchor="middle" x="211.75" y="-163.82" font-family="Times,serif" font-size="14.00">4: if: b == c</text>
</g>
<!-- 4&#45;&gt;5 -->
<g id="edge9" class="edge">
<title>4-&gt;5</title>
<path fill="none" stroke="green" d="M211.75,-223.7C211.75,-216.41 211.75,-207.73 211.75,-199.54"/>
<polygon fill="green" stroke="green" points="215.25,-199.62 211.75,-189.62 208.25,-199.62 215.25,-199.62"/>
</g>
<!-- 5&#45;&gt;6 -->
<g id="edge10" class="edge">
<title>5-&gt;6</title>
<path fill="none" stroke="green" d="M199.32,-154.5C192.06,-146.03 182.7,-135.1 174.19,-125.18"/>
<polygon fill="green" stroke="green" points="176.86,-122.92 167.7,-117.61 171.55,-127.48 176.86,-122.92"/>
</g>
<!-- 5&#45;&gt;7 -->
<g id="edge11" class="edge">
<title>5-&gt;7</title>
<path fill="none" stroke="red" d="M227.75,-155.5C238.47,-146.46 252.89,-134.3 265.61,-123.58"/>
<polygon fill="red" stroke="red" points="267.53,-126.54 272.92,-117.41 263.02,-121.19 267.53,-126.54"/>
</g>
<!-- 9&#45;&gt;13 -->
<g id="edge17" class="edge">
<title>9-&gt;13</title>
<path fill="none" stroke="red" d="M381.75,-223.7C381.75,-216.41 381.75,-207.73 381.75,-199.54"/>
<polygon fill="red" stroke="red" points="385.25,-199.62 381.75,-189.62 378.25,-199.62 385.25,-199.62"/>
</g>
<!-- 10 -->
<g id="node13" class="node">
<title>10</title>
<polygon fill="none" stroke="black" points="542.75,-188 462.92,-170 542.75,-152 622.58,-170 542.75,-188"/>
<text text-anchor="middle" x="542.75" y="-163.82" font-family="Times,serif" font-size="14.00">12: if: a == c</text>
</g>
<!-- 9&#45;&gt;10 -->
<g id="edge14" class="edge">
<title>9-&gt;10</title>
<path fill="none" stroke="red" d="M407.62,-229.75C434.22,-218.19 475.89,-200.07 505.92,-187.01"/>
<polygon fill="red" stroke="red" points="507.25,-190.25 515.02,-183.05 504.46,-183.83 507.25,-190.25"/>
</g>
<!-- 10&#45;&gt;11 -->
<g id="edge15" class="edge">
<title>10-&gt;11</title>
<path fill="none" stroke="red" d="M528.79,-154.83C520.15,-146.07 508.81,-134.57 498.67,-124.28"/>
<polygon fill="red" stroke="red" points="501.45,-122.11 491.93,-117.45 496.46,-127.02 501.45,-122.11"/>
</g>
<!-- 10&#45;&gt;12 -->
<g id="edge16" class="edge">
<title>10-&gt;12</title>
<path fill="none" stroke="red" d="M557.32,-154.83C566.33,-146.07 578.17,-134.57 588.75,-124.28"/>
<polygon fill="red" stroke="red" points="591.07,-126.9 595.8,-117.42 586.19,-121.88 591.07,-126.9"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>As you can see, the path taken is <code>&lt;path 1&gt;</code>.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Similarly, for solving <code>&lt;path 2&gt;</code> we need to simply invert the condition at &lt;line 2&gt;:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">z3</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">==</span> <span class="n">c</span><span class="p">,</span> <span class="n">z3</span><span class="o">.</span><span class="n">Not</span><span class="p">(</span><span class="n">b</span> <span class="o">==</span> <span class="n">c</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>no solution
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The symbolic execution suggests that there is no solution. A moment's reflection will convince us that it is indeed true. Let us proceed with the other paths. The <code>&lt;path 3&gt;</code> can be obtained by inverting the condition at <code>&lt;line 4&gt;</code>.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">z3</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="n">b</span><span class="p">,</span> <span class="n">z3</span><span class="o">.</span><span class="n">Not</span><span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="n">c</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[b = 1, c = 0, a = 1]
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">with</span> <span class="n">ArcCoverage</span><span class="p">()</span> <span class="k">as</span> <span class="n">cov</span><span class="p">:</span>
    <span class="k">assert</span> <span class="n">check_triangle</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="s1">'Isosceles'</span>
<span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">fn</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cov</span><span class="o">.</span><span class="n">_trace</span> <span class="k">if</span> <span class="n">fn</span> <span class="o">==</span> <span class="s1">'check_triangle'</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[1, 2, 3, 9]
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">paths</span><span class="p">[</span><span class="s1">'&lt;path 3&gt;'</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>([1, 2, 3, 9], 'Isosceles')
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>How about path &lt;4&gt;?</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">z3</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">z3</span><span class="o">.</span><span class="n">Not</span><span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="n">b</span><span class="p">),</span> <span class="n">b</span> <span class="o">!=</span> <span class="n">c</span><span class="p">,</span> <span class="n">a</span> <span class="o">==</span> <span class="n">c</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[b = 0, c = 1, a = 1]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>As we mentioned earlier, our program does not account for sides with zero or negative length. We can modify our program to check for zero and negative input. However, do we always have to make sure that every function has to account for all possible inputs? It is possible that the <code>check_triangle</code> is not directly exposed to the user, and it is called from another function that already guarantees that the inputs would be positive. In the <a href="DynamicInvariants.html">chapter on dynamic invariants</a>, we will show how to discover such preconditions and post conditions.</p>
<p>We can easily add such a precondition here.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">pre_condition</span> <span class="o">=</span> <span class="n">z3</span><span class="o">.</span><span class="n">And</span><span class="p">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">b</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">c</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">z3</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">pre_condition</span><span class="p">,</span> <span class="n">z3</span><span class="o">.</span><span class="n">Not</span><span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="n">b</span><span class="p">),</span> <span class="n">b</span> <span class="o">!=</span> <span class="n">c</span><span class="p">,</span> <span class="n">a</span> <span class="o">==</span> <span class="n">c</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[c = 2, b = 1, a = 2]
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">with</span> <span class="n">ArcCoverage</span><span class="p">()</span> <span class="k">as</span> <span class="n">cov</span><span class="p">:</span>
    <span class="k">assert</span> <span class="n">check_triangle</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s1">'Isosceles'</span>
<span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">fn</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cov</span><span class="o">.</span><span class="n">_trace</span> <span class="k">if</span> <span class="n">fn</span> <span class="o">==</span> <span class="s1">'check_triangle'</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[1, 2, 11, 12, 13]
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">paths</span><span class="p">[</span><span class="s1">'&lt;path 4&gt;'</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>([1, 2, 11, 12, 13], 'Isosceles')
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Continuing to path &lt;5&gt;:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">z3</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">pre_condition</span><span class="p">,</span> <span class="n">z3</span><span class="o">.</span><span class="n">Not</span><span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="n">b</span><span class="p">),</span> <span class="n">b</span> <span class="o">!=</span> <span class="n">c</span><span class="p">,</span> <span class="n">z3</span><span class="o">.</span><span class="n">Not</span><span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="n">c</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[a = 1, c = 3, b = 2]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>And indeed it is a <em>Scalene</em> triangle.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">with</span> <span class="n">ArcCoverage</span><span class="p">()</span> <span class="k">as</span> <span class="n">cov</span><span class="p">:</span>
    <span class="k">assert</span> <span class="n">check_triangle</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="s1">'Scalene'</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">paths</span><span class="p">[</span><span class="s1">'&lt;path 5&gt;'</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>([1, 2, 11, 12, 15], 'Scalene')
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Finally, for <code>&lt;path 6&gt;</code> the procedure is similar.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">z3</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">pre_condition</span><span class="p">,</span> <span class="n">z3</span><span class="o">.</span><span class="n">Not</span><span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="n">b</span><span class="p">),</span> <span class="n">z3</span><span class="o">.</span><span class="n">Not</span><span class="p">(</span><span class="n">b</span> <span class="o">!=</span> <span class="n">c</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[c = 2, a = 1, b = 2]
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">with</span> <span class="n">ArcCoverage</span><span class="p">()</span> <span class="k">as</span> <span class="n">cov</span><span class="p">:</span>
    <span class="k">assert</span> <span class="n">check_triangle</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s1">'Isosceles'</span>
<span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">fn</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cov</span><span class="o">.</span><span class="n">_trace</span> <span class="k">if</span> <span class="n">fn</span> <span class="o">==</span> <span class="s1">'check_triangle'</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[1, 2, 11, 17]
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">paths</span><span class="p">[</span><span class="s1">'&lt;path 6&gt;'</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>([1, 2, 11, 17], 'Isosceles')
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>What if we wanted another solution? We can simply ask the solver to solve again, and not give us the same values.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">seen</span> <span class="o">=</span> <span class="p">[</span><span class="n">z3</span><span class="o">.</span><span class="n">And</span><span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="n">b</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">z3</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">pre_condition</span><span class="p">,</span> <span class="n">z3</span><span class="o">.</span><span class="n">Not</span><span class="p">(</span><span class="n">z3</span><span class="o">.</span><span class="n">Or</span><span class="p">(</span><span class="n">seen</span><span class="p">)),</span> <span class="n">z3</span><span class="o">.</span><span class="n">Not</span><span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="n">b</span><span class="p">),</span> <span class="n">z3</span><span class="o">.</span><span class="n">Not</span><span class="p">(</span><span class="n">b</span> <span class="o">!=</span> <span class="n">c</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[c = 2, a = 1, b = 2]
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">seen</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z3</span><span class="o">.</span><span class="n">And</span><span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">b</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">z3</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">pre_condition</span><span class="p">,</span> <span class="n">z3</span><span class="o">.</span><span class="n">Not</span><span class="p">(</span><span class="n">z3</span><span class="o">.</span><span class="n">Or</span><span class="p">(</span><span class="n">seen</span><span class="p">)),</span> <span class="n">z3</span><span class="o">.</span><span class="n">Not</span><span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="n">b</span><span class="p">),</span> <span class="n">z3</span><span class="o">.</span><span class="n">Not</span><span class="p">(</span><span class="n">b</span> <span class="o">!=</span> <span class="n">c</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[c = 1, a = 3, b = 1]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>That is, using simple symbolic computation, we were able to easily see that (1) some paths are not reachable, and (2) some conditions were insufficient -- we needed preconditions. What about the total coverage obtained?</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Visualizing-the-Coverage">Visualizing the Coverage</h3></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Visualizing the statement coverage can be accomplished as below.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">VisualizedArcCoverage</span><span class="p">(</span><span class="n">ArcCoverage</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">show_coverage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">):</span>
        <span class="n">src</span> <span class="o">=</span> <span class="n">fn</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getsource</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
        <span class="n">covered</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">lineno</span> <span class="k">for</span> <span class="n">method</span><span class="p">,</span> <span class="n">lineno</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trace</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="si">%s</span><span class="s1"> </span><span class="si">%2d</span><span class="s1">: </span><span class="si">%s</span><span class="s1">'</span> <span class="o">%</span> <span class="p">(</span><span class="s1">'#'</span> <span class="k">if</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="ow">in</span> <span class="n">covered</span> <span class="k">else</span> <span class="s1">' '</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">s</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We run all the inputs obtained under the coverage tracer.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">with</span> <span class="n">VisualizedArcCoverage</span><span class="p">()</span> <span class="k">as</span> <span class="n">cov</span><span class="p">:</span>
    <span class="k">assert</span> <span class="n">check_triangle</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="s1">'Equilateral'</span>
    <span class="k">assert</span> <span class="n">check_triangle</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="s1">'Isosceles'</span>
    <span class="k">assert</span> <span class="n">check_triangle</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s1">'Isosceles'</span>
    <span class="k">assert</span> <span class="n">check_triangle</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="s1">'Scalene'</span>
    <span class="k">assert</span> <span class="n">check_triangle</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s1">'Isosceles'</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">cov</span><span class="o">.</span><span class="n">show_coverage</span><span class="p">(</span><span class="n">check_triangle</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>#  1: def check_triangle(a: int, b: int, c: int) -&gt; str:
#  2:     if a == b:
#  3:         if a == c:
#  4:             if b == c:
#  5:                 return "Equilateral"
   6:             else:
   7:                 return "Isosceles"
   8:         else:
#  9:             return "Isosceles"
  10:     else:
# 11:         if b != c:
# 12:             if a == c:
# 13:                 return "Isosceles"
  14:             else:
# 15:                 return "Scalene"
  16:         else:
# 17:             return "Isosceles"
  18: 
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The coverage is as expected. The generated values do seem to cover all code that can be covered.</p>
<p>We have seen how to reason about each path through the program. Can we combine them together to produce a single expression that represents the program behavior? This is what we will discuss next.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Function-Summaries">Function Summaries</h3></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Consider this equation for determining absolute value.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">abs_value</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">v</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="n">x</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">v</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">x</span>
    <span class="k">return</span> <span class="n">v</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">show_cfg</span><span class="p">(</span><span class="n">abs_value</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_svg output_subarea output_execute_result">


<!-- Generated by graphviz version 12.2.1 (20241206.2353)
 -->
<!-- Pages: 1 -->
<svg width="264pt" height="365pt" viewbox="0.00 0.00 263.62 365.25" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 361.25)">
<polygon fill="white" stroke="none" points="-4,4 -4,-361.25 259.62,-361.25 259.62,4 -4,4"/>
<!-- 1 -->
<g id="node1" class="node">
<title>1</title>
<ellipse fill="none" stroke="black" cx="128.74" cy="-335.25" rx="85.55" ry="18"/>
<ellipse fill="none" stroke="black" cx="128.74" cy="-335.25" rx="89.55" ry="22"/>
<text text-anchor="middle" x="128.74" y="-329.07" font-family="Times,serif" font-size="14.00">1: enter: abs_value(x)</text>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<polygon fill="none" stroke="black" points="128.74,-276.25 61.05,-258.25 128.74,-240.25 196.43,-258.25 128.74,-276.25"/>
<text text-anchor="middle" x="128.74" y="-252.07" font-family="Times,serif" font-size="14.00">2: if: x &lt; 0</text>
</g>
<!-- 1&#45;&gt;3 -->
<g id="edge2" class="edge">
<title>1-&gt;3</title>
<path fill="none" stroke="black" d="M128.74,-312.96C128.74,-305.07 128.74,-296 128.74,-287.58"/>
<polygon fill="black" stroke="black" points="132.24,-287.82 128.74,-277.82 125.24,-287.82 132.24,-287.82"/>
</g>
<!-- 2 -->
<g id="node2" class="node">
<title>2</title>
<ellipse fill="none" stroke="black" cx="128.74" cy="-22" rx="81.25" ry="18"/>
<ellipse fill="none" stroke="black" cx="128.74" cy="-22" rx="85.25" ry="22"/>
<text text-anchor="middle" x="128.74" y="-15.82" font-family="Times,serif" font-size="14.00">1: exit: abs_value(x)</text>
</g>
<!-- 6 -->
<g id="node3" class="node">
<title>6</title>
<polygon fill="none" stroke="black" points="165.24,-117 92.24,-117 92.24,-81 165.24,-81 165.24,-117"/>
<text text-anchor="middle" x="128.74" y="-92.83" font-family="Times,serif" font-size="14.00">6: return v</text>
</g>
<!-- 6&#45;&gt;2 -->
<g id="edge1" class="edge">
<title>6-&gt;2</title>
<path fill="none" stroke="black" d="M128.74,-80.6C128.74,-73.17 128.74,-64.23 128.74,-55.64"/>
<polygon fill="black" stroke="black" points="132.24,-55.83 128.74,-45.83 125.24,-55.83 132.24,-55.83"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<ellipse fill="none" stroke="black" cx="60.74" cy="-172" rx="60.74" ry="18"/>
<text text-anchor="middle" x="60.74" y="-165.82" font-family="Times,serif" font-size="14.00">3: v: float = -x</text>
</g>
<!-- 3&#45;&gt;4 -->
<g id="edge3" class="edge">
<title>3-&gt;4</title>
<path fill="none" stroke="blue" d="M117.2,-242.96C107.41,-230.83 93.13,-213.13 81.37,-198.56"/>
<polygon fill="blue" stroke="blue" points="84.4,-196.74 75.4,-191.16 78.95,-201.14 84.4,-196.74"/>
<text text-anchor="middle" x="102.94" y="-208.95" font-family="Times,serif" font-size="14.00">T</text>
</g>
<!-- 5 -->
<g id="node6" class="node">
<title>5</title>
<ellipse fill="none" stroke="black" cx="197.74" cy="-172" rx="57.88" ry="18"/>
<text text-anchor="middle" x="197.74" y="-165.82" font-family="Times,serif" font-size="14.00">5: v: float = x</text>
</g>
<!-- 3&#45;&gt;5 -->
<g id="edge4" class="edge">
<title>3-&gt;5</title>
<path fill="none" stroke="red" d="M140.45,-242.96C150.44,-230.75 165.06,-212.9 177.03,-198.28"/>
<polygon fill="red" stroke="red" points="179.49,-200.81 183.12,-190.85 174.08,-196.37 179.49,-200.81"/>
<text text-anchor="middle" x="171.12" y="-208.95" font-family="Times,serif" font-size="14.00">F</text>
</g>
<!-- 4&#45;&gt;6 -->
<g id="edge5" class="edge">
<title>4-&gt;6</title>
<path fill="none" stroke="black" d="M76.86,-154.17C85.06,-145.61 95.2,-135.02 104.34,-125.48"/>
<polygon fill="black" stroke="black" points="106.59,-128.18 110.98,-118.54 101.54,-123.34 106.59,-128.18"/>
</g>
<!-- 5&#45;&gt;6 -->
<g id="edge6" class="edge">
<title>5-&gt;6</title>
<path fill="none" stroke="black" d="M181.74,-154.53C173.36,-145.91 162.92,-135.17 153.53,-125.51"/>
<polygon fill="black" stroke="black" points="156.15,-123.19 146.67,-118.45 151.13,-128.06 156.15,-123.19"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>What can we say about the value of <code>v</code> at <code>line: 5</code>? Let us trace and see. First, we have variable <code>x</code> at <code>line: 1</code>.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="p">(</span><span class="n">x</span><span class="p">,),</span> <span class="n">r</span> <span class="o">=</span> <span class="n">get_symbolicparams</span><span class="p">(</span><span class="n">abs_value</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>At <code>line: 2</code>, we face a bifurcation in the possible paths. Hence, we produce two paths with corresponding constraints.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">l2_T</span> <span class="o">=</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span>
<span class="n">l2_F</span> <span class="o">=</span> <span class="n">z3</span><span class="o">.</span><span class="n">Not</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>For <code>line: 3</code>, we only need to consider the <code>If</code> path. However, we have an assignment. So we use a new variable here. The type <em>float</em> is indicated in the source, and its equivalent <em>z3</em> type is <em>Real</em>.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">v_0</span> <span class="o">=</span> <span class="n">z3</span><span class="o">.</span><span class="n">Real</span><span class="p">(</span><span class="s1">'v_0'</span><span class="p">)</span>
<span class="n">l3</span> <span class="o">=</span> <span class="n">z3</span><span class="o">.</span><span class="n">And</span><span class="p">(</span><span class="n">l2_T</span><span class="p">,</span> <span class="n">v_0</span> <span class="o">==</span> <span class="o">-</span><span class="n">x</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Similarly, for <code>line: 5</code>, we have an assignment. (Can we reuse the variable <code>v_0</code> from before?)</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">v_1</span> <span class="o">=</span> <span class="n">z3</span><span class="o">.</span><span class="n">Real</span><span class="p">(</span><span class="s1">'v_1'</span><span class="p">)</span>
<span class="n">l5</span> <span class="o">=</span> <span class="n">z3</span><span class="o">.</span><span class="n">And</span><span class="p">(</span><span class="n">l2_F</span><span class="p">,</span> <span class="n">v_1</span> <span class="o">==</span> <span class="n">x</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>When we come to <code>line: 6</code>, we see that we have <em>two</em> input streams. We have a choice. We can either keep each path separate as we did previously.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">v</span> <span class="o">=</span> <span class="n">z3</span><span class="o">.</span><span class="n">Real</span><span class="p">(</span><span class="s1">'v'</span><span class="p">)</span>
<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">[</span><span class="n">z3</span><span class="o">.</span><span class="n">And</span><span class="p">(</span><span class="n">l3</span><span class="p">,</span> <span class="n">v</span> <span class="o">==</span> <span class="n">v_0</span><span class="p">),</span> <span class="n">z3</span><span class="o">.</span><span class="n">And</span><span class="p">(</span><span class="n">l5</span><span class="p">,</span> <span class="n">v</span> <span class="o">==</span> <span class="n">v_1</span><span class="p">)]:</span>
    <span class="n">z3</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">x</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[x = -1/2, v_0 = 1/2, v = 1/2]
[v_1 = 1, x = 1, v = 1]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Or, we can combine them together and produce a single predicate at <code>line: 6</code>.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">v</span> <span class="o">=</span> <span class="n">z3</span><span class="o">.</span><span class="n">Real</span><span class="p">(</span><span class="s1">'v'</span><span class="p">)</span>
<span class="n">l6</span> <span class="o">=</span> <span class="n">z3</span><span class="o">.</span><span class="n">Or</span><span class="p">(</span><span class="n">z3</span><span class="o">.</span><span class="n">And</span><span class="p">(</span><span class="n">l3</span><span class="p">,</span> <span class="n">v</span> <span class="o">==</span> <span class="n">v_0</span><span class="p">),</span> <span class="n">z3</span><span class="o">.</span><span class="n">And</span><span class="p">(</span><span class="n">l5</span><span class="p">,</span> <span class="n">v</span> <span class="o">==</span> <span class="n">v_1</span><span class="p">))</span>
<span class="n">z3</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">l6</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[v_1 = 1/2, x = -1/4, v_0 = 1/4, v = 1/4]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p><strong>Note.</strong> Merging two incoming streams of execution can be non-trivial, especially when the execution paths are traversed multiple times (E.g. loops and recursion). For those interested, lookup <a href="https://www.st.cs.uni-saarland.de/publications/details/galeotti-hvc-2014/">inferring loop invariants</a>.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We can get this to produce any number of solutions for <code>abs()</code> as below.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">s</span> <span class="o">=</span> <span class="n">z3</span><span class="o">.</span><span class="n">Solver</span><span class="p">()</span>
<span class="n">s</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">l6</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">check</span><span class="p">()</span> <span class="o">==</span> <span class="n">z3</span><span class="o">.</span><span class="n">sat</span><span class="p">:</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">model</span><span class="p">()</span>
        <span class="n">x_val</span> <span class="o">=</span> <span class="n">m</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">'no solution'</span><span class="p">)</span>
        <span class="k">break</span>
    <span class="n">s</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">z3</span><span class="o">.</span><span class="n">Not</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="n">x_val</span><span class="p">))</span>
<span class="n">s</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[v_1 = 1/2, x = 1/2, v_0 = 0, v = 1/2]
[v_1 = 0, x = 0, v = 0]
[v_1 = 1/4, x = 1/4, v = 1/4]
[v_1 = 1/8, x = 1/8, v = 1/8]
[v_1 = 1/16, x = 1/16, v = 1/16]
</pre>
</div>

</div>

<div class="output_area">

<div class="output_html rendered_html output_subarea output_execute_result">

[x &lt; 0 ∧ v_0 = -x ∧ v = v_0 ∨ ¬(x &lt; 0) ∧ v_1 = x ∧ v = v_1,
 ¬(1/2 = x),
 ¬(0 = x),
 ¬(1/4 = x),
 ¬(1/8 = x),
 ¬(1/16 = x)]

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The solver is not particularly random. So we need to help it a bit to produce values on the negative range.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">s</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">check</span><span class="p">()</span> <span class="o">==</span> <span class="n">z3</span><span class="o">.</span><span class="n">sat</span><span class="p">:</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">model</span><span class="p">()</span>
        <span class="n">x_val</span> <span class="o">=</span> <span class="n">m</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">'no solution'</span><span class="p">)</span>
        <span class="k">break</span>
    <span class="n">s</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">z3</span><span class="o">.</span><span class="n">Not</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="n">x_val</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[x = -1/32, v_0 = 1/32, v = 1/32]
[x = -33/32, v_0 = 33/32, v = 33/32]
[x = -65/32, v_0 = 65/32, v = 65/32]
[x = -97/32, v_0 = 97/32, v = 97/32]
[x = -129/32, v_0 = 129/32, v = 129/32]
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">s</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_html rendered_html output_subarea output_execute_result">

[x &lt; 0 ∧ v_0 = -x ∧ v = v_0 ∨ ¬(x &lt; 0) ∧ v_1 = x ∧ v = v_1,
 ¬(1/2 = x),
 ¬(0 = x),
 ¬(1/4 = x),
 ¬(1/8 = x),
 ¬(1/16 = x),
 x &lt; 0,
 ¬(-1/32 = x),
 ¬(-33/32 = x),
 ¬(-65/32 = x),
 ¬(-97/32 = x),
 ¬(-129/32 = x)]

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Note that the single expression produced at <code>line: 6</code> is essentially a summary for <code>abs_value()</code>.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">abs_value_summary</span> <span class="o">=</span> <span class="n">l6</span>
<span class="n">abs_value_summary</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_html rendered_html output_subarea output_execute_result">

x &lt; 0 ∧ v_0 = -x ∧ v = v_0 ∨ ¬(x &lt; 0) ∧ v_1 = x ∧ v = v_1

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The <em>z3</em> solver can be used to simplify the predicates where possible.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">z3</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">l6</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_html rendered_html output_subarea output_execute_result">

¬(0 ≤ x) ∧ v_0 = -1·x ∧ v = v_0 ∨ 0 ≤ x ∧ v_1 = x ∧ v = v_1

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>One can use this summary rather than trace into <code>abs_value()</code> when <code>abs_value()</code> is used elsewhere. However, that presents us with a problem. It is possible that the same function may be called multiple times. In this case, using the same variables will lead to collision. One way to avoid that is to <em>prefix</em> some call specific value to the variables.</p>
<p><strong>Note:</strong> The SMT 2.0 standard allows one to define functions (<em>macros</em> in SMT parlance) directly. For example, the <code>abs-value</code> will be defined as follows:</p>
<div class="highlight"><pre><span/><span class="p">(</span><span class="nv">define-fun</span><span class="w"> </span><span class="nv">abs-value</span><span class="w"> </span><span class="p">((</span><span class="nv">x</span><span class="w"> </span><span class="nv">Int</span><span class="p">))</span><span class="w"> </span><span class="nv">Int</span>
<span class="w">       </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">&gt;</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">           </span><span class="nv">x</span>
<span class="w">           </span><span class="p">(</span><span class="nb">*</span><span class="w"> </span><span class="mi">-1</span><span class="w"> </span><span class="nv">x</span><span class="p">)))</span>
</pre></div>
<p>Or equivalently, (especially if <code>abs-value</code> is recursively defined)</p>
<div class="highlight"><pre><span/><span class="p">(</span><span class="nv">declare-fun</span><span class="w"> </span><span class="nv">abs-value</span><span class="w"> </span><span class="p">(</span><span class="nv">Int</span><span class="p">)</span><span class="w"> </span><span class="nv">Int</span><span class="p">)</span>
<span class="p">(</span><span class="nb">assert</span><span class="w"> </span><span class="p">(</span><span class="nv">forall</span><span class="w"> </span><span class="p">((</span><span class="nv">x</span><span class="w"> </span><span class="nv">Int</span><span class="p">))</span>
<span class="w">                </span><span class="p">(</span><span class="nb">=</span><span class="w"> </span><span class="p">(</span><span class="nv">abs-value</span><span class="w"> </span><span class="nv">x</span><span class="p">)</span>
<span class="w">                   </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">&gt;</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">                       </span><span class="nv">x</span>
<span class="w">                       </span><span class="p">(</span><span class="nb">*</span><span class="w"> </span><span class="mi">-1</span><span class="w"> </span><span class="nv">x</span><span class="p">)))))</span>
</pre></div>
<p>One can then say</p>

<pre><code>(&gt; (abs-value x) (abs-value y))</code></pre>
<p>Unfortunately, the z3py project does not expose this facility in Python. Hence, we have to use the <code>prefix_vars()</code> hack.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/ast.html" class="import" target="_blank">ast</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The method <code>prefix_vars()</code> modifies the variables in an expression such that the variables are prefixed with a given value.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">prefix_vars</span><span class="p">(</span><span class="n">astnode</span><span class="p">,</span> <span class="n">prefix</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">astnode</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">BoolOp</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">ast</span><span class="o">.</span><span class="n">BoolOp</span><span class="p">(</span><span class="n">astnode</span><span class="o">.</span><span class="n">op</span><span class="p">,</span>
                          <span class="p">[</span><span class="n">prefix_vars</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">prefix</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">astnode</span><span class="o">.</span><span class="n">values</span><span class="p">],</span> <span class="p">[])</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">astnode</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">BinOp</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">ast</span><span class="o">.</span><span class="n">BinOp</span><span class="p">(</span>
            <span class="n">prefix_vars</span><span class="p">(</span><span class="n">astnode</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="n">prefix</span><span class="p">),</span> <span class="n">astnode</span><span class="o">.</span><span class="n">op</span><span class="p">,</span>
            <span class="n">prefix_vars</span><span class="p">(</span><span class="n">astnode</span><span class="o">.</span><span class="n">right</span><span class="p">,</span> <span class="n">prefix</span><span class="p">))</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">astnode</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">UnaryOp</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">ast</span><span class="o">.</span><span class="n">UnaryOp</span><span class="p">(</span><span class="n">astnode</span><span class="o">.</span><span class="n">op</span><span class="p">,</span> <span class="n">prefix_vars</span><span class="p">(</span><span class="n">astnode</span><span class="o">.</span><span class="n">operand</span><span class="p">,</span> <span class="n">prefix</span><span class="p">))</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">astnode</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Call</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">ast</span><span class="o">.</span><span class="n">Call</span><span class="p">(</span><span class="n">prefix_vars</span><span class="p">(</span><span class="n">astnode</span><span class="o">.</span><span class="n">func</span><span class="p">,</span> <span class="n">prefix</span><span class="p">),</span>
                        <span class="p">[</span><span class="n">prefix_vars</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">prefix</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">astnode</span><span class="o">.</span><span class="n">args</span><span class="p">],</span>
                        <span class="n">astnode</span><span class="o">.</span><span class="n">keywords</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">astnode</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Compare</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">ast</span><span class="o">.</span><span class="n">Compare</span><span class="p">(</span>
            <span class="n">prefix_vars</span><span class="p">(</span><span class="n">astnode</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="n">prefix</span><span class="p">),</span> <span class="n">astnode</span><span class="o">.</span><span class="n">ops</span><span class="p">,</span>
            <span class="p">[</span><span class="n">prefix_vars</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">prefix</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">astnode</span><span class="o">.</span><span class="n">comparators</span><span class="p">])</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">astnode</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">astnode</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="p">{</span><span class="s1">'And'</span><span class="p">,</span> <span class="s1">'Or'</span><span class="p">,</span> <span class="s1">'Not'</span><span class="p">}:</span>
            <span class="k">return</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="s1">'z3.</span><span class="si">%s</span><span class="s1">'</span> <span class="o">%</span> <span class="p">(</span><span class="n">astnode</span><span class="o">.</span><span class="n">id</span><span class="p">),</span> <span class="n">astnode</span><span class="o">.</span><span class="n">ctx</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="s1">'</span><span class="si">%s%s</span><span class="s1">'</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">astnode</span><span class="o">.</span><span class="n">id</span><span class="p">),</span> <span class="n">astnode</span><span class="o">.</span><span class="n">ctx</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">astnode</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Return</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">ast</span><span class="o">.</span><span class="n">Return</span><span class="p">(</span><span class="n">prefix_vars</span><span class="p">(</span><span class="n">astnode</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">env</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">astnode</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>For applying <code>prefix_vars()</code> one needs the <em>abstract syntax tree</em> (AST) of the Python expression involved. We obtain this by invoking <code>ast.parse()</code>:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">xy_ast</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s1">'x+y'</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We can visualize the resulting tree as follows:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="kn">from</span> <span class="nn"><a href="https://github.com/uds-se/fuzzingbook//tree/master/notebooks/shared/bookutils" class="import" target="_blank">bookutils</a></span> <span class="kn">import</span> <span class="n">rich_output</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">if</span> <span class="n">rich_output</span><span class="p">():</span>
    <span class="c1"># Normally, this will do</span>
    <span class="kn">from</span> <span class="nn"><a href="https://pypi.org/project/showast/" class="import" target="_blank">showast</a></span> <span class="kn">import</span> <span class="n">show_ast</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">show_ast</span><span class="p">(</span><span class="n">tree</span><span class="p">):</span>
        <span class="n">ast</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">show_ast</span><span class="p">(</span><span class="n">xy_ast</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="296pt" height="260pt" viewbox="0.00 0.00 296.00 260.00">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 256)">
<polygon fill="white" stroke="none" points="-4,4 -4,-256 292,-256 292,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="start" x="118.5" y="-229.95" font-family="Courier,monospace" font-weight="bold" font-size="14.00" fill="#004080">Expr</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="start" x="114.38" y="-157.95" font-family="Courier,monospace" font-weight="bold" font-size="14.00" fill="#004080">BinOp</text>
</g>
<!-- 0&#45;&#45;1 -->
<g id="edge1" class="edge">
<title>0--1</title>
<path fill="none" stroke="black" d="M135,-216.05C135,-205.05 135,-190.76 135,-179.79"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="start" x="46.5" y="-85.95" font-family="Courier,monospace" font-weight="bold" font-size="14.00" fill="#004080">Name</text>
</g>
<!-- 1&#45;&#45;2 -->
<g id="edge2" class="edge">
<title>1--2</title>
<path fill="none" stroke="black" d="M135,-143C135,-143 107.23,-122.94 86.18,-107.74"/>
</g>
<!-- 5 -->
<g id="node6" class="node">
<title>5</title>
<text text-anchor="middle" x="135" y="-84.95" font-family="Courier,monospace" font-size="14.00" fill="#008040">Add</text>
</g>
<!-- 1&#45;&#45;5 -->
<g id="edge5" class="edge">
<title>1--5</title>
<path fill="none" stroke="black" d="M135,-143C135,-143 135,-122.94 135,-107.74"/>
</g>
<!-- 6 -->
<g id="node7" class="node">
<title>6</title>
<text text-anchor="start" x="190.5" y="-85.95" font-family="Courier,monospace" font-weight="bold" font-size="14.00" fill="#004080">Name</text>
</g>
<!-- 1&#45;&#45;6 -->
<g id="edge6" class="edge">
<title>1--6</title>
<path fill="none" stroke="black" d="M135,-143C135,-143 162.77,-122.94 183.82,-107.74"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="27" y="-12.95" font-family="Courier,monospace" font-size="14.00" fill="#008040">"x"</text>
</g>
<!-- 2&#45;&#45;3 -->
<g id="edge3" class="edge">
<title>2--3</title>
<path fill="none" stroke="black" d="M63,-71C63,-71 49.11,-50.94 38.59,-35.74"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="99" y="-12.95" font-family="Courier,monospace" font-size="14.00" fill="#008040">Load</text>
</g>
<!-- 2&#45;&#45;4 -->
<g id="edge4" class="edge">
<title>2--4</title>
<path fill="none" stroke="black" d="M63,-71C63,-71 76.89,-50.94 87.41,-35.74"/>
</g>
<!-- 7 -->
<g id="node8" class="node">
<title>7</title>
<text text-anchor="middle" x="189" y="-12.95" font-family="Courier,monospace" font-size="14.00" fill="#008040">"y"</text>
</g>
<!-- 6&#45;&#45;7 -->
<g id="edge7" class="edge">
<title>6--7</title>
<path fill="none" stroke="black" d="M211,-71C211,-71 202.51,-50.94 196.08,-35.74"/>
</g>
<!-- 8 -->
<g id="node9" class="node">
<title>8</title>
<text text-anchor="middle" x="261" y="-12.95" font-family="Courier,monospace" font-size="14.00" fill="#008040">Load</text>
</g>
<!-- 6&#45;&#45;8 -->
<g id="edge8" class="edge">
<title>6--8</title>
<path fill="none" stroke="black" d="M211,-71C211,-71 230.29,-50.94 244.9,-35.74"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>What the visualization does <em>not</em> show, though, is that when parsing Python source code, the resulting AST comes wrapped in a <code>Module</code> by default:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">xy_ast</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>&lt;ast.Module at 0x116dfa6e0&gt;
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>And to access the expression (<code>Expr</code>), we need to access the first child of that "module":</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">xy_ast</span><span class="o">.</span><span class="n">body</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>&lt;ast.Expr at 0x116dfa4a0&gt;
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The actual expression is within that <code>Expr</code> object:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">xy_ast</span><span class="o">.</span><span class="n">body</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>&lt;ast.BinOp at 0x116dfa2c0&gt;
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Hence, for easier manipulation of an expression AST, we define a function <code>get_expression()</code> which unwraps it and returns the AST representation of the expression inside.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">get_expression</span><span class="p">(</span><span class="n">src</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">ast</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">src</span><span class="p">)</span><span class="o">.</span><span class="n">body</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>It is used as follows:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">e</span> <span class="o">=</span> <span class="n">get_expression</span><span class="p">(</span><span class="s1">'x+y'</span><span class="p">)</span>
<span class="n">e</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>&lt;ast.BinOp at 0x116df8a00&gt;
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The function <code>to_src()</code> allows us to <em>unparse</em> an expression.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">to_src</span><span class="p">(</span><span class="n">astnode</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">ast</span><span class="o">.</span><span class="n">unparse</span><span class="p">(</span><span class="n">astnode</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>It is used as follows:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">to_src</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>'x + y'
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We can combine both pieces to produce a prefixed expression. Let us prefix all variables with <code>x1_</code>:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">abs_value_summary_ast</span> <span class="o">=</span> <span class="n">get_expression</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">abs_value_summary</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">to_src</span><span class="p">(</span><span class="n">prefix_vars</span><span class="p">(</span><span class="n">abs_value_summary_ast</span><span class="p">,</span> <span class="s1">'x1_'</span><span class="p">)))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>z3.Or(z3.And(z3.And(x1_x &lt; 0, x1_v_0 == -x1_x), x1_v == x1_v_0), z3.And(z3.And(z3.Not(x1_x &lt; 0), x1_v_1 == x1_x), x1_v == x1_v_1))
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="Get-Names-and-Types-of-Variables-Used">Get Names and Types of Variables Used</h4></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>What about the declarations used? Given that we have all equations in <em>Z3</em>, we can retrieve this information directly. We define <code>z3_names_and_types()</code> that takes in a <em>Z3</em> expression, and extracts the variable definitions required.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">z3_names_and_types</span><span class="p">(</span><span class="n">z3_ast</span><span class="p">):</span>
    <span class="n">hm</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">children</span> <span class="o">=</span> <span class="n">z3_ast</span><span class="o">.</span><span class="n">children</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">children</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">children</span><span class="p">:</span>
            <span class="n">hm</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">z3_names_and_types</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># HACK.. How else to distinguish literals and vars?</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">z3_ast</span><span class="o">.</span><span class="n">decl</span><span class="p">())</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">(</span><span class="n">z3_ast</span><span class="o">.</span><span class="n">sort</span><span class="p">())):</span>
            <span class="n">hm</span><span class="p">[</span><span class="s2">"</span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">z3_ast</span><span class="o">.</span><span class="n">decl</span><span class="p">())]</span> <span class="o">=</span> <span class="s1">'z3.</span><span class="si">%s</span><span class="s1">'</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">z3_ast</span><span class="o">.</span><span class="n">sort</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>
    <span class="k">return</span> <span class="n">hm</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">abs_value_declarations</span> <span class="o">=</span> <span class="n">z3_names_and_types</span><span class="p">(</span><span class="n">abs_value_summary</span><span class="p">)</span>
<span class="n">abs_value_declarations</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>{'x': 'z3.Real', 'v_0': 'z3.Real', 'v': 'z3.Real', 'v_1': 'z3.Real'}
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>However, <code>z3_names_and_types()</code> is limited in that it requires the <em>Z3</em> AST to operate. Hence, we also define <code>used_identifiers()</code> that can extract identifiers directly from the string representation of any Python expression, (including <em>Z3</em> constraints). One trade-off here is that we lose track of the type information. But we will see how to recover that later.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">used_identifiers</span><span class="p">(</span><span class="n">src</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">names</span><span class="p">(</span><span class="n">astnode</span><span class="p">):</span>
        <span class="n">lst</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">astnode</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">BoolOp</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">astnode</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
                <span class="n">lst</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">names</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">astnode</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">BinOp</span><span class="p">):</span>
            <span class="n">lst</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">names</span><span class="p">(</span><span class="n">astnode</span><span class="o">.</span><span class="n">left</span><span class="p">))</span>
            <span class="n">lst</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">names</span><span class="p">(</span><span class="n">astnode</span><span class="o">.</span><span class="n">right</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">astnode</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">UnaryOp</span><span class="p">):</span>
            <span class="n">lst</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">names</span><span class="p">(</span><span class="n">astnode</span><span class="o">.</span><span class="n">operand</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">astnode</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Call</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">astnode</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
                <span class="n">lst</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">names</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">astnode</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Compare</span><span class="p">):</span>
            <span class="n">lst</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">names</span><span class="p">(</span><span class="n">astnode</span><span class="o">.</span><span class="n">left</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">astnode</span><span class="o">.</span><span class="n">comparators</span><span class="p">:</span>
                <span class="n">lst</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">names</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">astnode</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">):</span>
            <span class="n">lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">astnode</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">astnode</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Expr</span><span class="p">):</span>
            <span class="n">lst</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">names</span><span class="p">(</span><span class="n">astnode</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">astnode</span><span class="p">,</span> <span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">Num</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Str</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Tuple</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">NameConstant</span><span class="p">)):</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">astnode</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Assign</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">astnode</span><span class="o">.</span><span class="n">targets</span><span class="p">:</span>
                <span class="n">lst</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">names</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
            <span class="n">lst</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">names</span><span class="p">(</span><span class="n">astnode</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">astnode</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">astnode</span><span class="o">.</span><span class="n">body</span><span class="p">:</span>
                <span class="n">lst</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">names</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">astnode</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">lst</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">names</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">src</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">used_identifiers</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">abs_value_summary</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>['v_0', 'x', 'v', 'v_1']
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We can now register the function summary <code>abs_value</code> for later use.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">function_summaries</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">function_summaries</span><span class="p">[</span><span class="s1">'abs_value'</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'predicate'</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">abs_value_summary</span><span class="p">),</span>
    <span class="s1">'vars'</span><span class="p">:</span> <span class="n">abs_value_declarations</span><span class="p">}</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>As we mentioned previously, we do not want to rely on <em>Z3</em> to extract the type information. A better alternative is to let the user specify the type information as annotations, and extract this information from the program. We will see next how this can be achieved.</p>
<p>First, we convert the <em>Python type to Z3 type</em> map to its string equivalent.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">SYM_VARS_STR</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">k</span><span class="o">.</span><span class="vm">__name__</span><span class="p">:</span> <span class="p">(</span><span class="s2">"z3.</span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="n">v1</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="s2">"z3.</span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="n">v2</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span> <span class="ow">in</span> <span class="n">SYM_VARS</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<span class="p">}</span>
<span class="n">SYM_VARS_STR</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>{'int': ('z3.Int', 'z3.IntVal'),
 'float': ('z3.Real', 'z3.RealVal'),
 'str': ('z3.String', 'z3.StringVal')}
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We also define a convenience method <code>translate_to_z3_name()</code> for accessing the <em>Z3</em> type for symbolic variables.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">translate_to_z3_name</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">SYM_VARS_STR</span><span class="p">[</span><span class="n">v</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We now define the method <code>declarations()</code> that extracts variables used in Python <em>statements</em>. The idea is to look for augmented assignments that contain annotated type information. These are collected and returned.</p>
<p>If there are <code>call</code> nodes, they represent function calls. The used variables in these function calls are recovered from the corresponding function summaries.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">declarations</span><span class="p">(</span><span class="n">astnode</span><span class="p">,</span> <span class="n">hm</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">hm</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">hm</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">astnode</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">astnode</span><span class="o">.</span><span class="n">body</span><span class="p">:</span>
            <span class="n">declarations</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">hm</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">astnode</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">FunctionDef</span><span class="p">):</span>
        <span class="c1"># hm[astnode.name + '__return__'] = \</span>
        <span class="c1"># translate_to_z3_name(astnode.returns.id)</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">astnode</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
            <span class="n">hm</span><span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">arg</span><span class="p">]</span> <span class="o">=</span> <span class="n">translate_to_z3_name</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">annotation</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">astnode</span><span class="o">.</span><span class="n">body</span><span class="p">:</span>
            <span class="n">declarations</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">hm</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">astnode</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Call</span><span class="p">):</span>
        <span class="c1"># get declarations from the function summary.</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">astnode</span><span class="o">.</span><span class="n">function</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">)</span>  <span class="c1"># for now.</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">id</span>
        <span class="n">hm</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">function_summaries</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s1">'vars'</span><span class="p">]))</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">astnode</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">AnnAssign</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">astnode</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">)</span>
        <span class="n">hm</span><span class="p">[</span><span class="n">astnode</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">translate_to_z3_name</span><span class="p">(</span><span class="n">astnode</span><span class="o">.</span><span class="n">annotation</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">astnode</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Assign</span><span class="p">):</span>
        <span class="c1"># verify it is already defined</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">astnode</span><span class="o">.</span><span class="n">targets</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">t</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="n">hm</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">astnode</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">AugAssign</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">astnode</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">astnode</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="n">hm</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">astnode</span><span class="p">,</span> <span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">If</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">For</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">While</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">astnode</span><span class="o">.</span><span class="n">body</span><span class="p">:</span>
            <span class="n">declarations</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">hm</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">astnode</span><span class="o">.</span><span class="n">orelse</span><span class="p">:</span>
            <span class="n">declarations</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">hm</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">astnode</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Return</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">astnode</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">hm</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>With this, we can now extract the variables used in an expression.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">declarations</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s1">'s: int = 3</span><span class="se">\n</span><span class="s1">p: float = 4.0</span><span class="se">\n</span><span class="s1">s += 1'</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>{'s': 'z3.Int', 'p': 'z3.Real'}
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We wrap <code>declarations()</code> in the method <code>used_vars()</code> that operates directly on function objects.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">used_vars</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">declarations</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">getsource</span><span class="p">(</span><span class="n">fn</span><span class="p">)))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Here is how it can be used:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">used_vars</span><span class="p">(</span><span class="n">check_triangle</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>{'a': 'z3.Int', 'b': 'z3.Int', 'c': 'z3.Int'}
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">used_vars</span><span class="p">(</span><span class="n">abs_value</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>{'x': 'z3.Real', 'v': 'z3.Real'}
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Given the extracted variables and their <em>Z3</em> types, we need a way to re-instantiate them when needed. We define <code>define_symbolic_vars()</code> that translates these descriptions to a form that can be directly <code>exec()</code>ed.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">define_symbolic_vars</span><span class="p">(</span><span class="n">fn_vars</span><span class="p">,</span> <span class="n">prefix</span><span class="p">):</span>
    <span class="n">sym_var_dec</span> <span class="o">=</span> <span class="s1">', '</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">prefix</span> <span class="o">+</span> <span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">fn_vars</span><span class="p">])</span>
    <span class="n">sym_var_def</span> <span class="o">=</span> <span class="s1">', '</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">"</span><span class="si">%s</span><span class="s2">('</span><span class="si">%s%s</span><span class="s2">')"</span> <span class="o">%</span> <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
                             <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">fn_vars</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
    <span class="k">return</span> <span class="s2">"</span><span class="si">%s</span><span class="s2"> = </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="n">sym_var_dec</span><span class="p">,</span> <span class="n">sym_var_def</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Here is how it can be used:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">define_symbolic_vars</span><span class="p">(</span><span class="n">abs_value_declarations</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>"x, v_0, v, v_1 = z3.Real('x'), z3.Real('v_0'), z3.Real('v'), z3.Real('v_1')"
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We next define <code>gen_fn_summary()</code> that returns a function summary in instantiable form using <em>Z3</em>.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">gen_fn_summary</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">fn</span><span class="p">):</span>
    <span class="n">summary</span> <span class="o">=</span> <span class="n">function_summaries</span><span class="p">[</span><span class="n">fn</span><span class="o">.</span><span class="vm">__name__</span><span class="p">][</span><span class="s1">'predicate'</span><span class="p">]</span>
    <span class="n">fn_vars</span> <span class="o">=</span> <span class="n">function_summaries</span><span class="p">[</span><span class="n">fn</span><span class="o">.</span><span class="vm">__name__</span><span class="p">][</span><span class="s1">'vars'</span><span class="p">]</span>
    <span class="n">decl</span> <span class="o">=</span> <span class="n">define_symbolic_vars</span><span class="p">(</span><span class="n">fn_vars</span><span class="p">,</span> <span class="n">prefix</span><span class="p">)</span>
    <span class="n">summary_ast</span> <span class="o">=</span> <span class="n">get_expression</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">decl</span><span class="p">,</span> <span class="n">to_src</span><span class="p">(</span><span class="n">prefix_vars</span><span class="p">(</span><span class="n">summary_ast</span><span class="p">,</span> <span class="n">prefix</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Here is how it can be used:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">gen_fn_summary</span><span class="p">(</span><span class="s1">'a_'</span><span class="p">,</span> <span class="n">abs_value</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>("a_x, a_v_0, a_v, a_v_1 = z3.Real('a_x'), z3.Real('a_v_0'), z3.Real('a_v'), z3.Real('a_v_1')",
 'z3.Or(z3.And(z3.And(a_x &lt; 0, a_v_0 == -a_x), a_v == a_v_0), z3.And(z3.And(z3.Not(a_x &lt; 0), a_v_1 == a_x), a_v == a_v_1))')
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">gen_fn_summary</span><span class="p">(</span><span class="s1">'b_'</span><span class="p">,</span> <span class="n">abs_value</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>("b_x, b_v_0, b_v, b_v_1 = z3.Real('b_x'), z3.Real('b_v_0'), z3.Real('b_v'), z3.Real('b_v_1')",
 'z3.Or(z3.And(z3.And(b_x &lt; 0, b_v_0 == -b_x), b_v == b_v_0), z3.And(z3.And(z3.Not(b_x &lt; 0), b_v_1 == b_x), b_v == b_v_1))')
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>How do we use our function summaries? Here is a function <code>abs_max()</code> that uses <code>abs_value()</code>.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">abs_max</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
    <span class="n">a1</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">abs_value</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">b1</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">abs_value</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">a1</span> <span class="o">&gt;</span> <span class="n">b1</span><span class="p">:</span>
        <span class="n">c</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">a1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">c</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">b1</span>
    <span class="k">return</span> <span class="n">c</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>To trace this function symbolically, we first define the two variables <code>a</code> and <code>b</code>.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">a</span> <span class="o">=</span> <span class="n">z3</span><span class="o">.</span><span class="n">Real</span><span class="p">(</span><span class="s1">'a'</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">z3</span><span class="o">.</span><span class="n">Real</span><span class="p">(</span><span class="s1">'b'</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The <code>line: 2</code> contains definition for <code>a1</code>, which we define as a symbolic variable.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">a1</span> <span class="o">=</span> <span class="n">z3</span><span class="o">.</span><span class="n">Real</span><span class="p">(</span><span class="s1">'a1'</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We also need to call <code>abs_value()</code>, which is accomplished as follows. Since this is the first call to <code>abs_value()</code>, we use <code>abs1</code> as the prefix.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">d</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">gen_fn_summary</span><span class="p">(</span><span class="s1">'abs1_'</span><span class="p">,</span> <span class="n">abs_value</span><span class="p">)</span>
<span class="n">d</span><span class="p">,</span> <span class="n">v</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>("abs1_x, abs1_v_0, abs1_v, abs1_v_1 = z3.Real('abs1_x'), z3.Real('abs1_v_0'), z3.Real('abs1_v'), z3.Real('abs1_v_1')",
 'z3.Or(z3.And(z3.And(abs1_x &lt; 0, abs1_v_0 == -abs1_x), abs1_v == abs1_v_0), z3.And(z3.And(z3.Not(abs1_x &lt; 0), abs1_v_1 == abs1_x), abs1_v == abs1_v_1))')
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We also need to equate the resulting value (<code>&lt;prefix&gt;_v</code>) to the symbolic variable <code>a1</code> we defined earlier.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">l2_src</span> <span class="o">=</span> <span class="s2">"l2 = z3.And(a == abs1_x, a1 == abs1_v, </span><span class="si">%s</span><span class="s2">)"</span> <span class="o">%</span> <span class="n">v</span>
<span class="n">l2_src</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>'l2 = z3.And(a == abs1_x, a1 == abs1_v, z3.Or(z3.And(z3.And(abs1_x &lt; 0, abs1_v_0 == -abs1_x), abs1_v == abs1_v_0), z3.And(z3.And(z3.Not(abs1_x &lt; 0), abs1_v_1 == abs1_x), abs1_v == abs1_v_1)))'
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Applying both declaration and the assignment.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">exec</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="n">exec</span><span class="p">(</span><span class="n">l2_src</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">l2</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_html rendered_html output_subarea output_execute_result">

a = abs1_x ∧
a1 = abs1_v ∧
(abs1_x &lt; 0 ∧ abs1_v_0 = -abs1_x ∧ abs1_v = abs1_v_0 ∨
 ¬(abs1_x &lt; 0) ∧ abs1_v_1 = abs1_x ∧ abs1_v = abs1_v_1)

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We need to do the same for <code>line: 3</code>, but with <code>abs2</code> as the prefix.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">b1</span> <span class="o">=</span> <span class="n">z3</span><span class="o">.</span><span class="n">Real</span><span class="p">(</span><span class="s1">'b1'</span><span class="p">)</span>
<span class="n">d</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">gen_fn_summary</span><span class="p">(</span><span class="s1">'abs2_'</span><span class="p">,</span> <span class="n">abs_value</span><span class="p">)</span>
<span class="n">l3_src</span> <span class="o">=</span> <span class="s2">"l3_ = z3.And(b == abs2_x, b1 == abs2_v, </span><span class="si">%s</span><span class="s2">)"</span> <span class="o">%</span> <span class="n">v</span>
<span class="n">exec</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="n">exec</span><span class="p">(</span><span class="n">l3_src</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">l3_</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_html rendered_html output_subarea output_execute_result">

b = abs2_x ∧
b1 = abs2_v ∧
(abs2_x &lt; 0 ∧ abs2_v_0 = -abs2_x ∧ abs2_v = abs2_v_0 ∨
 ¬(abs2_x &lt; 0) ∧ abs2_v_1 = abs2_x ∧ abs2_v = abs2_v_1)

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>To get the true set of predicates at <code>line: 3</code>, we need to add the predicates from <code>line: 2</code>.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">l3</span> <span class="o">=</span> <span class="n">z3</span><span class="o">.</span><span class="n">And</span><span class="p">(</span><span class="n">l2</span><span class="p">,</span> <span class="n">l3_</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">l3</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_html rendered_html output_subarea output_execute_result">

a = abs1_x ∧
a1 = abs1_v ∧
(abs1_x &lt; 0 ∧ abs1_v_0 = -abs1_x ∧ abs1_v = abs1_v_0 ∨
 ¬(abs1_x &lt; 0) ∧ abs1_v_1 = abs1_x ∧ abs1_v = abs1_v_1) ∧
b = abs2_x ∧
b1 = abs2_v ∧
(abs2_x &lt; 0 ∧ abs2_v_0 = -abs2_x ∧ abs2_v = abs2_v_0 ∨
 ¬(abs2_x &lt; 0) ∧ abs2_v_1 = abs2_x ∧ abs2_v = abs2_v_1)

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>This equation can be simplified a bit using z3.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">z3</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">l3</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_html rendered_html output_subarea output_execute_result">

a = abs1_x ∧
a1 = abs1_v ∧
(¬(0 ≤ abs1_x) ∧ abs1_v_0 = -1·abs1_x ∧ abs1_v = abs1_v_0 ∨
 0 ≤ abs1_x ∧ abs1_v_1 = abs1_x ∧ abs1_v = abs1_v_1) ∧
b = abs2_x ∧
b1 = abs2_v ∧
(¬(0 ≤ abs2_x) ∧ abs2_v_0 = -1·abs2_x ∧ abs2_v = abs2_v_0 ∨
 0 ≤ abs2_x ∧ abs2_v_1 = abs2_x ∧ abs2_v = abs2_v_1)

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Coming to <code>line: 4</code>, we have a condition.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">l4_cond</span> <span class="o">=</span> <span class="n">a1</span> <span class="o">&gt;</span> <span class="n">b1</span>
<span class="n">l4</span> <span class="o">=</span> <span class="n">z3</span><span class="o">.</span><span class="n">And</span><span class="p">(</span><span class="n">l3</span><span class="p">,</span> <span class="n">l4_cond</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>For <code>line: 5</code>, we define the symbolic variable <code>c_0</code> assuming we took the <em>IF</em> branch.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">c_0</span> <span class="o">=</span> <span class="n">z3</span><span class="o">.</span><span class="n">Real</span><span class="p">(</span><span class="s1">'c_0'</span><span class="p">)</span>
<span class="n">l5</span> <span class="o">=</span> <span class="n">z3</span><span class="o">.</span><span class="n">And</span><span class="p">(</span><span class="n">l4</span><span class="p">,</span> <span class="n">c_0</span> <span class="o">==</span> <span class="n">a1</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>For <code>line: 6</code>, the <em>ELSE</em> branch was taken. So we invert that condition.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">l6</span> <span class="o">=</span> <span class="n">z3</span><span class="o">.</span><span class="n">And</span><span class="p">(</span><span class="n">l3</span><span class="p">,</span> <span class="n">z3</span><span class="o">.</span><span class="n">Not</span><span class="p">(</span><span class="n">l4_cond</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>For <code>line: 7</code>, we define <code>c_1</code>.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">c_1</span> <span class="o">=</span> <span class="n">z3</span><span class="o">.</span><span class="n">Real</span><span class="p">(</span><span class="s1">'c_1'</span><span class="p">)</span>
<span class="n">l7</span> <span class="o">=</span> <span class="n">z3</span><span class="o">.</span><span class="n">And</span><span class="p">(</span><span class="n">l6</span><span class="p">,</span> <span class="n">c_1</span> <span class="o">==</span> <span class="n">b1</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">s1</span> <span class="o">=</span> <span class="n">z3</span><span class="o">.</span><span class="n">Solver</span><span class="p">()</span>
<span class="n">s1</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">l5</span><span class="p">)</span>
<span class="n">s1</span><span class="o">.</span><span class="n">check</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_html rendered_html output_subarea output_execute_result">

<b>sat</b>

</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">m1</span> <span class="o">=</span> <span class="n">s1</span><span class="o">.</span><span class="n">model</span><span class="p">()</span>
<span class="nb">sorted</span><span class="p">([(</span><span class="n">d</span><span class="p">,</span> <span class="n">m1</span><span class="p">[</span><span class="n">d</span><span class="p">])</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">m1</span><span class="o">.</span><span class="n">decls</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">d</span><span class="o">.</span><span class="n">name</span><span class="p">(</span>
<span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">'abs'</span><span class="p">)],</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">())</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[(a, 1/2), (a1, 1/2), (b, -1/4), (b1, 1/4), (c_0, 1/2)]
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">s2</span> <span class="o">=</span> <span class="n">z3</span><span class="o">.</span><span class="n">Solver</span><span class="p">()</span>
<span class="n">s2</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">l7</span><span class="p">)</span>
<span class="n">s2</span><span class="o">.</span><span class="n">check</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_html rendered_html output_subarea output_execute_result">

<b>sat</b>

</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">m2</span> <span class="o">=</span> <span class="n">s2</span><span class="o">.</span><span class="n">model</span><span class="p">()</span>
<span class="nb">sorted</span><span class="p">([(</span><span class="n">d</span><span class="p">,</span> <span class="n">m2</span><span class="p">[</span><span class="n">d</span><span class="p">])</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">m2</span><span class="o">.</span><span class="n">decls</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">d</span><span class="o">.</span><span class="n">name</span><span class="p">(</span>
<span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">'abs'</span><span class="p">)],</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">())</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[(a, -1/2), (a1, 1/2), (b, 1/2), (b1, 1/2), (c_1, 1/2)]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>What we really want to do is to automate this process, because doing this by hand is tedious and error-prone. Essentially, we want the ability to extract <em>all paths</em> in the program, and symbolically execute each path, which will generate the inputs required to cover all reachable portions of the program.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Simple-Symbolic-Fuzzing">Simple Symbolic Fuzzing</h2></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We define a simple <em>symbolic fuzzer</em> that can generate input values <em>symbolically</em> with the following assumptions:</p>
<ul>
<li>There are no loops in the program</li>
<li>The function is self-contained.</li>
<li>No recursion.</li>
<li>No reassignments for variables.</li>
</ul>
<p>The key idea is as follows: We traverse through the control flow graph from the entry point, and generate all possible paths to a given depth. Then we collect constraints that we encountered along the path, and generate inputs that will traverse the program up to that point.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We build our fuzzer based on the class <code>Fuzzer</code>.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="kn">from</span> <span class="nn"><a href="Fuzzer.html" class="import" target="_blank">Fuzzer</a></span> <span class="kn">import</span> <span class="n">Fuzzer</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We start by extracting the control flow graph of the function passed. We also provide a hook for child classes to do their processing.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">SimpleSymbolicFuzzer</span><span class="p">(</span><span class="n">Fuzzer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Simple symbolic fuzzer"""</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Constructor.</span>
<span class="sd">        `fn` is the function to be fuzzed.</span>
<span class="sd">        Possible keyword parameters:</span>
<span class="sd">        * `max_depth` - the depth to which one should attempt</span>
<span class="sd">          to trace the execution (default 100) </span>
<span class="sd">        * `max_tries` - the maximum number of attempts</span>
<span class="sd">          we will try to produce a value before giving up (default 100)</span>
<span class="sd">        * `max_iter` - the number of iterations we will attempt (default 100).</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fn_name</span> <span class="o">=</span> <span class="n">fn</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="n">py_cfg</span> <span class="o">=</span> <span class="n">PyCFG</span><span class="p">()</span>
        <span class="n">py_cfg</span><span class="o">.</span><span class="n">gen_cfg</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">getsource</span><span class="p">(</span><span class="n">fn</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fnenter</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fnexit</span> <span class="o">=</span> <span class="n">py_cfg</span><span class="o">.</span><span class="n">functions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fn_name</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">used_variables</span> <span class="o">=</span> <span class="n">used_vars</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fn_args</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z3</span> <span class="o">=</span> <span class="n">z3</span><span class="o">.</span><span class="n">Solver</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">paths</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_path</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="o">...</span>  <span class="c1"># to be defined later</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We need a few variables to control how much we are willing to traverse.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p><code>MAX_DEPTH</code> is the depth to which one should attempt to trace the execution.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">MAX_DEPTH</span> <span class="o">=</span> <span class="mi">100</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p><code>MAX_TRIES</code> is the maximum number of attempts we will try to produce a value before giving up.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">MAX_TRIES</span> <span class="o">=</span> <span class="mi">100</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p><code>MAX_ITER</code> is the number of iterations we will attempt.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">MAX_ITER</span> <span class="o">=</span> <span class="mi">100</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The <code>options()</code> method sets these parameters in the fuzzing class.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">SimpleSymbolicFuzzer</span><span class="p">(</span><span class="n">SimpleSymbolicFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_depth</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'max_depth'</span><span class="p">,</span> <span class="n">MAX_DEPTH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_tries</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'max_tries'</span><span class="p">,</span> <span class="n">MAX_TRIES</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_iter</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'max_iter'</span><span class="p">,</span> <span class="n">MAX_ITER</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_options</span> <span class="o">=</span> <span class="n">kwargs</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The initialization generates a control flow graph and hooks it to <code>fnenter</code> and <code>fnexit</code>.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">symfz_ct</span> <span class="o">=</span> <span class="n">SimpleSymbolicFuzzer</span><span class="p">(</span><span class="n">check_triangle</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">symfz_ct</span><span class="o">.</span><span class="n">fnenter</span><span class="p">,</span> <span class="n">symfz_ct</span><span class="o">.</span><span class="n">fnexit</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>(id:9 line[1] parents: [] : enter: check_triangle(a, b, c),
 id:10 line[1] parents: [14, 15, 16, 19, 20, 21] : exit: check_triangle(a, b, c))
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Generating-All-Possible-Paths">Generating All Possible Paths</h3><p>We can use the procedure <code>get_all_paths()</code> starting from <code>fnenter</code> to recursively retrieve all paths in the function.</p>
<p>The idea is as follows: Start with the function entry point <code>fnenter</code>, and recursively follow the children using the CFG. At any node there is a branching, there would be multiple children. On other nodes there would be only one child. Let us say a node had $n$ children. Such a node would result in $n$ paths. We attach the current node to the head of each path, and return all paths thus generated.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">SimpleSymbolicFuzzer</span><span class="p">(</span><span class="n">SimpleSymbolicFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get_all_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fenter</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_depth</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">'Maximum depth exceeded'</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">fenter</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[[(</span><span class="mi">0</span><span class="p">,</span> <span class="n">fenter</span><span class="p">)]]</span>

        <span class="n">fnpaths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">child</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fenter</span><span class="o">.</span><span class="n">children</span><span class="p">):</span>
            <span class="n">child_paths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_paths</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">child_paths</span><span class="p">:</span>
                <span class="c1"># In a conditional branch, idx is 0 for IF, and 1 for Else</span>
                <span class="n">fnpaths</span><span class="o">.</span><span class="n">append</span><span class="p">([(</span><span class="n">idx</span><span class="p">,</span> <span class="n">fenter</span><span class="p">)]</span> <span class="o">+</span> <span class="n">path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fnpaths</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>This can be used as follows.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">symfz_ct</span> <span class="o">=</span> <span class="n">SimpleSymbolicFuzzer</span><span class="p">(</span><span class="n">check_triangle</span><span class="p">)</span>
<span class="n">all_paths</span> <span class="o">=</span> <span class="n">symfz_ct</span><span class="o">.</span><span class="n">get_all_paths</span><span class="p">(</span><span class="n">symfz_ct</span><span class="o">.</span><span class="n">fnenter</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="nb">len</span><span class="p">(</span><span class="n">all_paths</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>6
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">all_paths</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[(0, id:24 line[1] parents: [] : enter: check_triangle(a, b, c)),
 (0, id:26 line[2] parents: [24] : _if: a == b),
 (0, id:27 line[3] parents: [26] : _if: a == c),
 (1, id:28 line[4] parents: [27] : _if: b == c),
 (0, id:30 line[7] parents: [28] : return 'Isosceles'),
 (0,
  id:25 line[1] parents: [29, 30, 31, 34, 35, 36] : exit: check_triangle(a, b, c))]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We hook <code>get_all_paths()</code> to initialization as below.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">SimpleSymbolicFuzzer</span><span class="p">(</span><span class="n">SimpleSymbolicFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">paths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_paths</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fnenter</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_path</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Extracting-All-Constraints">Extracting All Constraints</h3><p>For any given path, we define a function <code>extract_constraints()</code> to extract the constraints such that they are executable directly with <em>Z3</em>. The <code>idx</code> represents the particular branch that was taken. Hence, if the <code>False</code> branch was taken in a conditional, we attach a negation of the conditional.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">SimpleSymbolicFuzzer</span><span class="p">(</span><span class="n">SimpleSymbolicFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">extract_constraints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="n">predicates</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">elt</span><span class="p">)</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">elt</span><span class="o">.</span><span class="n">ast_node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">AnnAssign</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">elt</span><span class="o">.</span><span class="n">ast_node</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="p">{</span><span class="s1">'_if'</span><span class="p">,</span> <span class="s1">'_while'</span><span class="p">}:</span>
                    <span class="n">s</span> <span class="o">=</span> <span class="n">to_src</span><span class="p">(</span><span class="n">elt</span><span class="o">.</span><span class="n">ast_node</span><span class="o">.</span><span class="n">annotation</span><span class="p">)</span>
                    <span class="n">predicates</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">"</span><span class="si">%s</span><span class="s2">"</span> <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">"z3.Not(</span><span class="si">%s</span><span class="s2">)"</span><span class="p">)</span> <span class="o">%</span> <span class="n">s</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">elt</span><span class="o">.</span><span class="n">ast_node</span><span class="o">.</span><span class="n">annotation</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Call</span><span class="p">):</span>
                    <span class="k">assert</span> <span class="n">elt</span><span class="o">.</span><span class="n">ast_node</span><span class="o">.</span><span class="n">annotation</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">fn_name</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">node</span> <span class="o">=</span> <span class="n">elt</span><span class="o">.</span><span class="n">ast_node</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Compare</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">Eq</span><span class="p">()],</span> <span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="p">])</span>
                    <span class="n">predicates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">to_src</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">elt</span><span class="o">.</span><span class="n">ast_node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Assign</span><span class="p">):</span>
                <span class="n">node</span> <span class="o">=</span> <span class="n">elt</span><span class="o">.</span><span class="n">ast_node</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Compare</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">Eq</span><span class="p">()],</span> <span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="p">])</span>
                <span class="n">predicates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">to_src</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">return</span> <span class="n">predicates</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">symfz_ct</span> <span class="o">=</span> <span class="n">SimpleSymbolicFuzzer</span><span class="p">(</span><span class="n">check_triangle</span><span class="p">)</span>
<span class="n">all_paths</span> <span class="o">=</span> <span class="n">symfz_ct</span><span class="o">.</span><span class="n">get_all_paths</span><span class="p">(</span><span class="n">symfz_ct</span><span class="o">.</span><span class="n">fnenter</span><span class="p">)</span>
<span class="n">symfz_ct</span><span class="o">.</span><span class="n">extract_constraints</span><span class="p">(</span><span class="n">all_paths</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>['a == b', 'a == c', 'b == c']
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">constraints</span> <span class="o">=</span> <span class="n">symfz_ct</span><span class="o">.</span><span class="n">extract_constraints</span><span class="p">(</span><span class="n">all_paths</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">constraints</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>['a == b', 'a == c', 'z3.Not(b == c)']
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Fuzzing-with-Simple-Symbolic-Fuzzer">Fuzzing with Simple Symbolic Fuzzer</h3><p>To actually generate solutions, we define <code>fuzz()</code>. For that, we need to first extract all paths. Then choose a particular path, and extract the constraints in that path, which is then solved using <em>z3</em>.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="kn">from</span> <span class="nn"><a href="https://docs.python.org/3/library/contextlib.html" class="import" target="_blank">contextlib</a></span> <span class="kn">import</span> <span class="n">contextmanager</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>First we create a checkpoint for our current solver so that we can check a predicate, and rollback if necessary.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">checkpoint</span><span class="p">(</span><span class="n">z3solver</span><span class="p">):</span>
    <span class="n">z3solver</span><span class="o">.</span><span class="n">push</span><span class="p">()</span>
    <span class="k">yield</span> <span class="n">z3solver</span>
    <span class="n">z3solver</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The <code>use_path()</code> function extracts constraints for a single function, applies it to our current solver (under a checkpoint), and returns the results if some solutions can be found.
If solutions were found, we also make sure that we never reuse those solutions.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">SimpleSymbolicFuzzer</span><span class="p">(</span><span class="n">SimpleSymbolicFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">solve_path_constraint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="c1"># re-initializing does not seem problematic.</span>
        <span class="c1"># a = z3.Int('a').get_id() remains the same.</span>
        <span class="n">constraints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_constraints</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">decl</span> <span class="o">=</span> <span class="n">define_symbolic_vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">used_variables</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>
        <span class="n">exec</span><span class="p">(</span><span class="n">decl</span><span class="p">)</span>

        <span class="n">solutions</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">with</span> <span class="n">checkpoint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z3</span><span class="p">):</span>
            <span class="n">st</span> <span class="o">=</span> <span class="s1">'self.z3.add(</span><span class="si">%s</span><span class="s1">)'</span> <span class="o">%</span> <span class="s1">', '</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">constraints</span><span class="p">)</span>
            <span class="nb">eval</span><span class="p">(</span><span class="n">st</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">z3</span><span class="o">.</span><span class="n">check</span><span class="p">()</span> <span class="o">!=</span> <span class="n">z3</span><span class="o">.</span><span class="n">sat</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">{}</span>
            <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z3</span><span class="o">.</span><span class="n">model</span><span class="p">()</span>
            <span class="n">solutions</span> <span class="o">=</span> <span class="p">{</span><span class="n">d</span><span class="o">.</span><span class="n">name</span><span class="p">():</span> <span class="n">m</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">decls</span><span class="p">()}</span>
            <span class="n">my_args</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">solutions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fn_args</span><span class="p">}</span>
        <span class="n">predicate</span> <span class="o">=</span> <span class="s1">'z3.And(</span><span class="si">%s</span><span class="s1">)'</span> <span class="o">%</span> <span class="s1">','</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">"</span><span class="si">%s</span><span class="s2"> == </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">my_args</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
        <span class="nb">eval</span><span class="p">(</span><span class="s1">'self.z3.add(z3.Not(</span><span class="si">%s</span><span class="s1">))'</span> <span class="o">%</span> <span class="n">predicate</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">my_args</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We define <code>get_path()</code> that retrieves the current path and updates the path used.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">SimpleSymbolicFuzzer</span><span class="p">(</span><span class="n">SimpleSymbolicFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get_next_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_path</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_path</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_path</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">last_path</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The <code>fuzz()</code> method simply solves each path in order.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">SimpleSymbolicFuzzer</span><span class="p">(</span><span class="n">SimpleSymbolicFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">fuzz</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Produce one solution for each path.</span>
<span class="sd">        Returns a mapping of variable names to (symbolic) Z3 values."""</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_tries</span><span class="p">):</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">solve_path_constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_next_path</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">res</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">res</span>

        <span class="k">return</span> <span class="p">{}</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The fuzzer can be used as follows. Note that we need to convert the symbolic variables returned to Python numbers, using <code>as_long()</code>:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
<span class="n">symfz_ct</span> <span class="o">=</span> <span class="n">SimpleSymbolicFuzzer</span><span class="p">(</span><span class="n">check_triangle</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">symfz_ct</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">check_triangle</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">'a'</span><span class="p">]</span><span class="o">.</span><span class="n">as_long</span><span class="p">(),</span>
                         <span class="n">args</span><span class="p">[</span><span class="s1">'b'</span><span class="p">]</span><span class="o">.</span><span class="n">as_long</span><span class="p">(),</span>
                         <span class="n">args</span><span class="p">[</span><span class="s1">'c'</span><span class="p">]</span><span class="o">.</span><span class="n">as_long</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s2">"result:"</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>{'a': 2, 'b': 3, 'c': 3} result: Isosceles
{'a': 6, 'b': 4, 'c': 5} result: Scalene
{'a': 8, 'b': 7, 'c': 8} result: Isosceles
{'a': 9, 'b': 9, 'c': 10} result: Isosceles
{'a': 11, 'b': 11, 'c': 11} result: Equilateral
{'a': 13, 'b': 12, 'c': 12} result: Isosceles
{'a': 16, 'b': 14, 'c': 15} result: Scalene
{'a': 18, 'b': 17, 'c': 18} result: Isosceles
{'a': 19, 'b': 19, 'c': 20} result: Isosceles
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>For symbolic fractions, we access their numerators and denominators:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">symfz_av</span> <span class="o">=</span> <span class="n">SimpleSymbolicFuzzer</span><span class="p">(</span><span class="n">abs_value</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">symfz_av</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span>
    <span class="n">abs_res</span> <span class="o">=</span> <span class="n">abs_value</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">'x'</span><span class="p">]</span><span class="o">.</span><span class="n">numerator_as_long</span><span class="p">()</span> <span class="o">/</span>
                        <span class="n">args</span><span class="p">[</span><span class="s1">'x'</span><span class="p">]</span><span class="o">.</span><span class="n">denominator_as_long</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s2">"result:"</span><span class="p">,</span> <span class="n">abs_res</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>{'x': 0} result: 0.0
{'x': -1/2} result: 0.5
{'x': 1/2} result: 0.5
{'x': -1/4} result: 0.25
{'x': 1/4} result: 0.25
{'x': -3/8} result: 0.375
{'x': 1/8} result: 0.125
{'x': -3/2} result: 1.5
{'x': 1/16} result: 0.0625
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The <em>SimpleSymbolicFuzzer</em> seems to work well for the <em>simple</em> programs we checked above.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Problems-with-the-Simple-Fuzzer">Problems with the Simple Fuzzer</h3><p>As we mentioned earlier, the <code>SimpleSymbolicFuzzer</code> cannot yet deal with variable reassignments. Further, it also fails to account for any loops. For example, consider the following program.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">gcd</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">:</span>
        <span class="n">c</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">a</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">b</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">c</span>

    <span class="k">while</span> <span class="n">b</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">c</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">a</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">b</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">c</span> <span class="o">%</span> <span class="n">b</span>

    <span class="k">return</span> <span class="n">a</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">show_cfg</span><span class="p">(</span><span class="n">gcd</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_svg output_subarea output_execute_result">


<!-- Generated by graphviz version 12.2.1 (20241206.2353)
 -->
<!-- Pages: 1 -->
<svg width="282pt" height="671pt" viewbox="0.00 0.00 281.77 670.50" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 666.5)">
<polygon fill="white" stroke="none" points="-4,4 -4,-666.5 277.77,-666.5 277.77,4 -4,4"/>
<!-- 1 -->
<g id="node1" class="node">
<title>1</title>
<ellipse fill="none" stroke="black" cx="169.9" cy="-640.5" rx="72.19" ry="18"/>
<ellipse fill="none" stroke="black" cx="169.9" cy="-640.5" rx="76.19" ry="22"/>
<text text-anchor="middle" x="169.9" y="-634.33" font-family="Times,serif" font-size="14.00">1: enter: gcd(a, b)</text>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<polygon fill="none" stroke="black" points="169.9,-581.5 102.88,-563.5 169.9,-545.5 236.91,-563.5 169.9,-581.5"/>
<text text-anchor="middle" x="169.9" y="-557.33" font-family="Times,serif" font-size="14.00">2: if: a &lt; b</text>
</g>
<!-- 1&#45;&gt;3 -->
<g id="edge2" class="edge">
<title>1-&gt;3</title>
<path fill="none" stroke="black" d="M169.9,-618.21C169.9,-610.32 169.9,-601.25 169.9,-592.83"/>
<polygon fill="black" stroke="black" points="173.4,-593.07 169.9,-583.07 166.4,-593.07 173.4,-593.07"/>
</g>
<!-- 2 -->
<g id="node2" class="node">
<title>2</title>
<ellipse fill="none" stroke="black" cx="71.9" cy="-95" rx="67.9" ry="18"/>
<ellipse fill="none" stroke="black" cx="71.9" cy="-95" rx="71.9" ry="22"/>
<text text-anchor="middle" x="71.9" y="-88.83" font-family="Times,serif" font-size="14.00">1: exit: gcd(a, b)</text>
</g>
<!-- 11 -->
<g id="node3" class="node">
<title>11</title>
<polygon fill="none" stroke="black" points="111.4,-190 32.4,-190 32.4,-154 111.4,-154 111.4,-190"/>
<text text-anchor="middle" x="71.9" y="-165.82" font-family="Times,serif" font-size="14.00">12: return a</text>
</g>
<!-- 11&#45;&gt;2 -->
<g id="edge1" class="edge">
<title>11-&gt;2</title>
<path fill="none" stroke="black" d="M71.9,-153.6C71.9,-146.17 71.9,-137.23 71.9,-128.64"/>
<polygon fill="black" stroke="black" points="75.4,-128.83 71.9,-118.83 68.4,-128.83 75.4,-128.83"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<ellipse fill="none" stroke="black" cx="130.9" cy="-477.25" rx="50.72" ry="18"/>
<text text-anchor="middle" x="130.9" y="-471.07" font-family="Times,serif" font-size="14.00">3: c: int = a</text>
</g>
<!-- 3&#45;&gt;4 -->
<g id="edge3" class="edge">
<title>3-&gt;4</title>
<path fill="none" stroke="blue" d="M162.74,-547.05C157.4,-535.5 149.95,-519.42 143.6,-505.7"/>
<polygon fill="blue" stroke="blue" points="146.82,-504.32 139.44,-496.72 140.47,-507.26 146.82,-504.32"/>
<text text-anchor="middle" x="156.86" y="-514.2" font-family="Times,serif" font-size="14.00">T</text>
</g>
<!-- 7 -->
<g id="node8" class="node">
<title>7</title>
<polygon fill="none" stroke="black" points="179.9,-276.25 88.6,-258.25 179.9,-240.25 271.19,-258.25 179.9,-276.25"/>
<text text-anchor="middle" x="179.9" y="-252.07" font-family="Times,serif" font-size="14.00">7: while: b != 0</text>
</g>
<!-- 3&#45;&gt;7 -->
<g id="edge7" class="edge">
<title>3-&gt;7</title>
<path fill="none" stroke="red" d="M181.47,-548.26C193.28,-532.24 209.9,-504.97 209.9,-478.25 209.9,-478.25 209.9,-478.25 209.9,-330.25 209.9,-314.09 203.22,-297.39 196.17,-284.24"/>
<polygon fill="red" stroke="red" points="199.35,-282.75 191.32,-275.85 193.3,-286.26 199.35,-282.75"/>
<text text-anchor="middle" x="213.65" y="-398.07" font-family="Times,serif" font-size="14.00">F</text>
</g>
<!-- 5 -->
<g id="node6" class="node">
<title>5</title>
<polygon fill="none" stroke="black" points="171.27,-422.25 112.52,-422.25 112.52,-386.25 171.27,-386.25 171.27,-422.25"/>
<text text-anchor="middle" x="141.9" y="-398.07" font-family="Times,serif" font-size="14.00">4: a = b</text>
</g>
<!-- 4&#45;&gt;5 -->
<g id="edge4" class="edge">
<title>4-&gt;5</title>
<path fill="none" stroke="black" d="M133.56,-459.06C134.75,-451.39 136.18,-442.14 137.52,-433.49"/>
<polygon fill="black" stroke="black" points="140.95,-434.19 139.03,-423.77 134.04,-433.12 140.95,-434.19"/>
</g>
<!-- 6 -->
<g id="node7" class="node">
<title>6</title>
<polygon fill="none" stroke="black" points="179.27,-349.25 120.52,-349.25 120.52,-313.25 179.27,-313.25 179.27,-349.25"/>
<text text-anchor="middle" x="149.9" y="-325.07" font-family="Times,serif" font-size="14.00">5: b = c</text>
</g>
<!-- 5&#45;&gt;6 -->
<g id="edge5" class="edge">
<title>5-&gt;6</title>
<path fill="none" stroke="black" d="M143.83,-386.06C144.7,-378.39 145.74,-369.14 146.71,-360.49"/>
<polygon fill="black" stroke="black" points="150.17,-361.11 147.81,-350.78 143.21,-360.33 150.17,-361.11"/>
</g>
<!-- 6&#45;&gt;7 -->
<g id="edge6" class="edge">
<title>6-&gt;7</title>
<path fill="none" stroke="black" d="M157.16,-313.06C160.61,-304.89 164.81,-294.94 168.66,-285.83"/>
<polygon fill="black" stroke="black" points="171.85,-287.27 172.52,-276.7 165.41,-284.55 171.85,-287.27"/>
</g>
<!-- 7&#45;&gt;11 -->
<g id="edge12" class="edge">
<title>7-&gt;11</title>
<path fill="none" stroke="red" d="M162.06,-243.34C146.1,-230.89 122.34,-212.35 103.21,-197.43"/>
<polygon fill="red" stroke="red" points="105.48,-194.76 95.45,-191.37 101.18,-200.28 105.48,-194.76"/>
<text text-anchor="middle" x="136.11" y="-208.95" font-family="Times,serif" font-size="14.00">F</text>
</g>
<!-- 8 -->
<g id="node10" class="node">
<title>8</title>
<ellipse fill="none" stroke="black" cx="179.9" cy="-172" rx="50.72" ry="18"/>
<text text-anchor="middle" x="179.9" y="-165.82" font-family="Times,serif" font-size="14.00">8: c: int = a</text>
</g>
<!-- 7&#45;&gt;8 -->
<g id="edge9" class="edge">
<title>7-&gt;8</title>
<path fill="none" stroke="blue" d="M179.9,-239.79C179.9,-228.84 179.9,-214.44 179.9,-201.82"/>
<polygon fill="blue" stroke="blue" points="183.4,-201.95 179.9,-191.95 176.4,-201.95 183.4,-201.95"/>
<text text-anchor="middle" x="184.02" y="-208.95" font-family="Times,serif" font-size="14.00">T</text>
</g>
<!-- 10 -->
<g id="node9" class="node">
<title>10</title>
<polygon fill="none" stroke="black" points="273.77,-36 182.02,-36 182.02,0 273.77,0 273.77,-36"/>
<text text-anchor="middle" x="227.9" y="-11.82" font-family="Times,serif" font-size="14.00">10: b = c % b</text>
</g>
<!-- 10&#45;&gt;7 -->
<g id="edge8" class="edge">
<title>10-&gt;7</title>
<path fill="none" stroke="black" d="M233.82,-36.45C243.59,-68.2 260.09,-137.03 239.9,-190 233.1,-207.82 219.18,-223.91 206.45,-235.89"/>
<polygon fill="black" stroke="black" points="204.2,-233.21 199.07,-242.48 208.86,-238.43 204.2,-233.21"/>
</g>
<!-- 9 -->
<g id="node11" class="node">
<title>9</title>
<polygon fill="none" stroke="black" points="226.27,-113 167.52,-113 167.52,-77 226.27,-77 226.27,-113"/>
<text text-anchor="middle" x="196.9" y="-88.83" font-family="Times,serif" font-size="14.00">9: a = b</text>
</g>
<!-- 8&#45;&gt;9 -->
<g id="edge10" class="edge">
<title>8-&gt;9</title>
<path fill="none" stroke="black" d="M183.84,-153.6C185.81,-144.9 188.25,-134.13 190.49,-124.28"/>
<polygon fill="black" stroke="black" points="193.84,-125.3 192.64,-114.78 187.02,-123.76 193.84,-125.3"/>
</g>
<!-- 9&#45;&gt;10 -->
<g id="edge11" class="edge">
<title>9-&gt;10</title>
<path fill="none" stroke="black" d="M204.09,-76.6C207.76,-67.71 212.33,-56.66 216.47,-46.64"/>
<polygon fill="black" stroke="black" points="219.58,-48.28 220.17,-37.7 213.11,-45.6 219.58,-48.28"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="kn">from</span> <span class="nn"><a href="ExpectError.html" class="import" target="_blank">ExpectError</a></span> <span class="kn">import</span> <span class="n">ExpectError</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">with</span> <span class="n">ExpectError</span><span class="p">():</span>
    <span class="n">symfz_gcd</span> <span class="o">=</span> <span class="n">SimpleSymbolicFuzzer</span><span class="p">(</span><span class="n">gcd</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">symfz_gcd</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">gcd</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">'a'</span><span class="p">]</span><span class="o">.</span><span class="n">as_long</span><span class="p">(),</span> <span class="n">r</span><span class="p">[</span><span class="s1">'b'</span><span class="p">]</span><span class="o">.</span><span class="n">as_long</span><span class="p">())</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>Traceback (most recent call last):
  File "/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_16239/3731434224.py", line 2, in &lt;module&gt;
    symfz_gcd = SimpleSymbolicFuzzer(gcd, max_depth=1000, max_iter=10)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_16239/2089833100.py", line 26, in __init__
    self.process()
  File "/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_16239/4234366425.py", line 3, in process
    self.paths = self.get_all_paths(self.fnenter)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_16239/228300930.py", line 10, in get_all_paths
    child_paths = self.get_all_paths(child, depth + 1)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_16239/228300930.py", line 10, in get_all_paths
    child_paths = self.get_all_paths(child, depth + 1)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_16239/228300930.py", line 10, in get_all_paths
    child_paths = self.get_all_paths(child, depth + 1)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 998 more times]
  File "/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_16239/228300930.py", line 4, in get_all_paths
    raise Exception('Maximum depth exceeded')
Exception: Maximum depth exceeded (expected)
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The problem here is that our <em>SimpleSymbolicFuzzer</em> has no concept of loops and variable reassignments. We will see how to fix this shortcoming next.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Advanced-Symbolic-Fuzzing">Advanced Symbolic Fuzzing</h2></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We next define <code>SymbolicFuzzer</code> that can deal with reassignments and <em>unrolling of loops</em>.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">SymbolicFuzzer</span><span class="p">(</span><span class="n">SimpleSymbolicFuzzer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Symbolic fuzzing with reassignments and loop unrolling"""</span>

    <span class="k">def</span> <span class="nf">options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Once we allow reassignments and loop unrolling, we have to deal with what to call the new variables generated. This is what we will tackle next.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Dealing-with-Reassignments">Dealing with Reassignments</h3><p>We want to rename all variables present in an expression such that the variables are annotated with their usage count. This makes it possible to determine variable reassignments.  To do that, we define the <code>rename_variables()</code> function that, when given an <code>env</code> that contains the current usage index of different variables, renames the variables in the passed AST node with the annotations, and returns a copy with the modifications. Note that we can't use <a href="https://docs.python.org/3/library/ast.html#ast.NodeTransformer">NodeTransformer</a> here as it would modify the AST.</p>
<p>That is, if the expression is <code>env[v] == 1</code>, <code>v</code> is renamed to <code>_v_1</code></p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">rename_variables</span><span class="p">(</span><span class="n">astnode</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">astnode</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">BoolOp</span><span class="p">):</span>
        <span class="n">fn</span> <span class="o">=</span> <span class="s1">'z3.And'</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">astnode</span><span class="o">.</span><span class="n">op</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">And</span><span class="p">)</span> <span class="k">else</span> <span class="s1">'z3.Or'</span>
        <span class="k">return</span> <span class="n">ast</span><span class="o">.</span><span class="n">Call</span><span class="p">(</span>
            <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="p">[</span><span class="n">rename_variables</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">astnode</span><span class="o">.</span><span class="n">values</span><span class="p">],</span> <span class="p">[])</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">astnode</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">BinOp</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">ast</span><span class="o">.</span><span class="n">BinOp</span><span class="p">(</span>
            <span class="n">rename_variables</span><span class="p">(</span><span class="n">astnode</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="n">env</span><span class="p">),</span> <span class="n">astnode</span><span class="o">.</span><span class="n">op</span><span class="p">,</span>
            <span class="n">rename_variables</span><span class="p">(</span><span class="n">astnode</span><span class="o">.</span><span class="n">right</span><span class="p">,</span> <span class="n">env</span><span class="p">))</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">astnode</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">UnaryOp</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">astnode</span><span class="o">.</span><span class="n">op</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Not</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">ast</span><span class="o">.</span><span class="n">Call</span><span class="p">(</span>
                <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="s1">'z3.Not'</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                <span class="p">[</span><span class="n">rename_variables</span><span class="p">(</span><span class="n">astnode</span><span class="o">.</span><span class="n">operand</span><span class="p">,</span> <span class="n">env</span><span class="p">)],</span> <span class="p">[])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ast</span><span class="o">.</span><span class="n">UnaryOp</span><span class="p">(</span><span class="n">astnode</span><span class="o">.</span><span class="n">op</span><span class="p">,</span>
                               <span class="n">rename_variables</span><span class="p">(</span><span class="n">astnode</span><span class="o">.</span><span class="n">operand</span><span class="p">,</span> <span class="n">env</span><span class="p">))</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">astnode</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Call</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">ast</span><span class="o">.</span><span class="n">Call</span><span class="p">(</span><span class="n">astnode</span><span class="o">.</span><span class="n">func</span><span class="p">,</span>
                        <span class="p">[</span><span class="n">rename_variables</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">astnode</span><span class="o">.</span><span class="n">args</span><span class="p">],</span>
                        <span class="n">astnode</span><span class="o">.</span><span class="n">keywords</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">astnode</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Compare</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">ast</span><span class="o">.</span><span class="n">Compare</span><span class="p">(</span>
            <span class="n">rename_variables</span><span class="p">(</span><span class="n">astnode</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="n">env</span><span class="p">),</span> <span class="n">astnode</span><span class="o">.</span><span class="n">ops</span><span class="p">,</span>
            <span class="p">[</span><span class="n">rename_variables</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">astnode</span><span class="o">.</span><span class="n">comparators</span><span class="p">])</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">astnode</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">astnode</span><span class="o">.</span><span class="n">id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">env</span><span class="p">:</span>
            <span class="n">env</span><span class="p">[</span><span class="n">astnode</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">num</span> <span class="o">=</span> <span class="n">env</span><span class="p">[</span><span class="n">astnode</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="s1">'_</span><span class="si">%s</span><span class="s1">_</span><span class="si">%d</span><span class="s1">'</span> <span class="o">%</span> <span class="p">(</span><span class="n">astnode</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">num</span><span class="p">),</span> <span class="n">astnode</span><span class="o">.</span><span class="n">ctx</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">astnode</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Return</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">ast</span><span class="o">.</span><span class="n">Return</span><span class="p">(</span><span class="n">rename_variables</span><span class="p">(</span><span class="n">astnode</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">env</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">astnode</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>To verify that it works as intended, we start with an environment.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">env</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'x'</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">ba</span> <span class="o">=</span> <span class="n">get_expression</span><span class="p">(</span><span class="s1">'x == 1 and y == 2'</span><span class="p">)</span>
<span class="nb">type</span><span class="p">(</span><span class="n">ba</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>ast.BoolOp
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">assert</span> <span class="n">to_src</span><span class="p">(</span><span class="n">rename_variables</span><span class="p">(</span><span class="n">ba</span><span class="p">,</span> <span class="n">env</span><span class="p">))</span> <span class="o">==</span> <span class="s1">'z3.And(_x_1 == 1, _y_0 == 2)'</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">bo</span> <span class="o">=</span> <span class="n">get_expression</span><span class="p">(</span><span class="s1">'x == 1 or y == 2'</span><span class="p">)</span>
<span class="nb">type</span><span class="p">(</span><span class="n">bo</span><span class="o">.</span><span class="n">op</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>ast.Or
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">assert</span> <span class="n">to_src</span><span class="p">(</span><span class="n">rename_variables</span><span class="p">(</span><span class="n">bo</span><span class="p">,</span> <span class="n">env</span><span class="p">))</span> <span class="o">==</span> <span class="s1">'z3.Or(_x_1 == 1, _y_0 == 2)'</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">b</span> <span class="o">=</span> <span class="n">get_expression</span><span class="p">(</span><span class="s1">'x + y'</span><span class="p">)</span>
<span class="nb">type</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>ast.BinOp
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">assert</span> <span class="n">to_src</span><span class="p">(</span><span class="n">rename_variables</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">env</span><span class="p">))</span> <span class="o">==</span> <span class="s1">'_x_1 + _y_0'</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">u</span> <span class="o">=</span> <span class="n">get_expression</span><span class="p">(</span><span class="s1">'-y'</span><span class="p">)</span>
<span class="nb">type</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>ast.UnaryOp
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">assert</span> <span class="n">to_src</span><span class="p">(</span><span class="n">rename_variables</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">env</span><span class="p">))</span> <span class="o">==</span> <span class="s1">'-_y_0'</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">un</span> <span class="o">=</span> <span class="n">get_expression</span><span class="p">(</span><span class="s1">'not y'</span><span class="p">)</span>
<span class="nb">type</span><span class="p">(</span><span class="n">un</span><span class="o">.</span><span class="n">op</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>ast.Not
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">assert</span> <span class="n">to_src</span><span class="p">(</span><span class="n">rename_variables</span><span class="p">(</span><span class="n">un</span><span class="p">,</span> <span class="n">env</span><span class="p">))</span> <span class="o">==</span> <span class="s1">'z3.Not(_y_0)'</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">c</span> <span class="o">=</span> <span class="n">get_expression</span><span class="p">(</span><span class="s1">'x == y'</span><span class="p">)</span>
<span class="nb">type</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>ast.Compare
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">assert</span> <span class="n">to_src</span><span class="p">(</span><span class="n">rename_variables</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">env</span><span class="p">))</span> <span class="o">==</span> <span class="s1">'_x_1 == _y_0'</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">f</span> <span class="o">=</span> <span class="n">get_expression</span><span class="p">(</span><span class="s1">'fn(x,y)'</span><span class="p">)</span>
<span class="nb">type</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>ast.Call
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">assert</span> <span class="n">to_src</span><span class="p">(</span><span class="n">rename_variables</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">env</span><span class="p">))</span> <span class="o">==</span> <span class="s1">'fn(_x_1, _y_0)'</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">env</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>{'x': 1, 'y': 0}
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Next, we want to process the CFG, and correctly transform the paths.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Tracking-Assignments">Tracking Assignments</h3><p>For keeping track of assignments in the CFG, We define a data structure <code>PNode</code> that stores the current CFG node.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">PNode</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">cfgnode</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">seen</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seen</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">seen</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">seen</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_iter</span> <span class="o">=</span> <span class="n">MAX_ITER</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfgnode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">=</span> <span class="n">idx</span><span class="p">,</span> <span class="n">cfgnode</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">order</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">"PNode:</span><span class="si">%d</span><span class="s2">[</span><span class="si">%s</span><span class="s2"> order:</span><span class="si">%d</span><span class="s2">]"</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idx</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfgnode</span><span class="p">),</span>
                                          <span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Defining a new <code>PNode</code> is done as follows.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">cfg</span> <span class="o">=</span> <span class="n">PyCFG</span><span class="p">()</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">gen_cfg</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">getsource</span><span class="p">(</span><span class="n">gcd</span><span class="p">))</span>
<span class="n">gcd_fnenter</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">functions</span><span class="p">[</span><span class="s1">'gcd'</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">PNode</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">gcd_fnenter</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>PNode:0[id:27 line[1] parents: [] : enter: gcd(a, b) order:0]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The <code>copy()</code> method generates a copy for the child's keep, indicating which path was taken (with <code>order</code> of the child).</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">PNode</span><span class="p">(</span><span class="n">PNode</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">PNode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfgnode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">seen</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">p</span><span class="o">.</span><span class="n">order</span> <span class="o">==</span> <span class="n">order</span>
        <span class="k">return</span> <span class="n">p</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Using the copy operation.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">PNode</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">gcd_fnenter</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>PNode:0[id:27 line[1] parents: [] : enter: gcd(a, b) order:1]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="Stepwise-Exploration-of-Paths">Stepwise Exploration of Paths</h4><p>A problem we had with our <code>SimpleSymbolicFuzzer</code> is that it explored a path to completion before attempting another. However, this is non-optimal. One may want to explore the graph in a more step-wise manner, expanding every possible execution one step at a time.</p>
<p>Hence, we define <code>explore()</code> which explores the children of a node if any, one step at a time. If done exhaustively, this will generate all paths from a starting node until no more children are left. We made <code>PNode</code> to a container class so that this iteration can be driven from outside, and stopped if say a maximum iteration is complete, or certain paths need to be prioritized.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">PNode</span><span class="p">(</span><span class="n">PNode</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">explore</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfgnode</span><span class="o">.</span><span class="n">children</span><span class="p">):</span>
            <span class="n">key</span> <span class="o">=</span> <span class="s2">"[</span><span class="si">%d</span><span class="s2">]</span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
            <span class="n">ccount</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seen</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ccount</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_iter</span><span class="p">:</span>
                <span class="k">continue</span>  <span class="c1"># drop this child</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">seen</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">ccount</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">pn</span> <span class="o">=</span> <span class="n">PNode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">seen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seen</span><span class="p">)</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pn</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We can use <code>explore()</code> as follows.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">PNode</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">gcd_fnenter</span><span class="p">)</span><span class="o">.</span><span class="n">explore</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[PNode:1[id:29 line[2] parents: [27] : _if: a &lt; b order:0]]
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">PNode</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">gcd_fnenter</span><span class="p">)</span><span class="o">.</span><span class="n">explore</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">explore</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[PNode:2[id:30 line[3] parents: [29] : c: int = a order:0],
 PNode:2[id:33 line[7] parents: [32, 29, 36] : _while: b != 0 order:0]]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The method <code>get_path_to_root()</code> recursively goes up through child-&gt;parent chain retrieving the complete chain to the topmost parent.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">PNode</span><span class="p">(</span><span class="n">PNode</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get_path_to_root</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">while</span> <span class="n">n</span><span class="p">:</span>
            <span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">parent</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">p</span> <span class="o">=</span> <span class="n">PNode</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">gcd_fnenter</span><span class="p">)</span>
<span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">get_path_to_root</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">explore</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">explore</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">explore</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">explore</span><span class="p">()]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[[PNode:0[id:27 line[1] parents: [] : enter: gcd(a, b) order:0],
  PNode:1[id:29 line[2] parents: [27] : _if: a &lt; b order:0],
  PNode:2[id:30 line[3] parents: [29] : c: int = a order:0],
  PNode:3[id:31 line[4] parents: [30] : a = b order:0],
  PNode:4[id:32 line[5] parents: [31] : b = c order:0]]]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The string representation of the node is in <code>z3</code> solvable form.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">PNode</span><span class="p">(</span><span class="n">PNode</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_path_to_root</span><span class="p">()</span>
        <span class="n">ssa_path</span> <span class="o">=</span> <span class="n">to_single_assignment_predicates</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">', '</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">to_src</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ssa_path</span><span class="p">])</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>However, before using it, we need to take care of variable renaming so that reassignments can work.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="Renaming-Used-Variables">Renaming Used Variables</h4><p>We need to rename used variables. Any variable <code>v = xxx</code> should be renamed to <code>_v_0</code> and any later assignment such as <code>v = v + 1</code> should be transformed to <code>_v_1 = _v_0 + 1</code> and later conditionals such as <code>v == x</code> should be transformed to <code>(_v_1 == _x_0)</code>. The method <code>to_single_assignment_predicates()</code> does this for a given path.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">to_single_assignment_predicates</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="n">env</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">new_path</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="n">ast_node</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">cfgnode</span><span class="o">.</span><span class="n">ast_node</span>
        <span class="n">new_node</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ast_node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">AnnAssign</span><span class="p">)</span> <span class="ow">and</span> <span class="n">ast_node</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="p">{</span>
                <span class="s1">'exit'</span><span class="p">}:</span>
            <span class="n">new_node</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ast_node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">AnnAssign</span><span class="p">)</span> <span class="ow">and</span> <span class="n">ast_node</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="p">{</span><span class="s1">'enter'</span><span class="p">}:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">ast</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span>
                    <span class="s2">"</span><span class="si">%s</span><span class="s2"> == _</span><span class="si">%s</span><span class="s2">_0"</span> <span class="o">%</span>
                    <span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">))</span><span class="o">.</span><span class="n">body</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">ast_node</span><span class="o">.</span><span class="n">annotation</span><span class="o">.</span><span class="n">args</span><span class="p">]</span>
            <span class="n">new_node</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Call</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="s1">'z3.And'</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="n">args</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ast_node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">AnnAssign</span><span class="p">)</span> <span class="ow">and</span> <span class="n">ast_node</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="p">{</span><span class="s1">'_if'</span><span class="p">,</span> <span class="s1">'_while'</span><span class="p">}:</span>
            <span class="n">new_node</span> <span class="o">=</span> <span class="n">rename_variables</span><span class="p">(</span><span class="n">ast_node</span><span class="o">.</span><span class="n">annotation</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">order</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">node</span><span class="o">.</span><span class="n">order</span> <span class="o">==</span> <span class="mi">1</span>
                <span class="n">new_node</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Call</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="s1">'z3.Not'</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="p">[</span><span class="n">new_node</span><span class="p">],</span> <span class="p">[])</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ast_node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">AnnAssign</span><span class="p">):</span>
            <span class="n">assigned</span> <span class="o">=</span> <span class="n">ast_node</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">id</span>
            <span class="n">val</span> <span class="o">=</span> <span class="p">[</span><span class="n">rename_variables</span><span class="p">(</span><span class="n">ast_node</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">env</span><span class="p">)]</span>
            <span class="n">env</span><span class="p">[</span><span class="n">assigned</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">assigned</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">env</span> <span class="k">else</span> <span class="n">env</span><span class="p">[</span><span class="n">assigned</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">target</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="s1">'_</span><span class="si">%s</span><span class="s1">_</span><span class="si">%d</span><span class="s1">'</span> <span class="o">%</span>
                              <span class="p">(</span><span class="n">ast_node</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">env</span><span class="p">[</span><span class="n">assigned</span><span class="p">]),</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">new_node</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Expr</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">Compare</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">Eq</span><span class="p">()],</span> <span class="n">val</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ast_node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Assign</span><span class="p">):</span>
            <span class="n">assigned</span> <span class="o">=</span> <span class="n">ast_node</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span>
            <span class="n">val</span> <span class="o">=</span> <span class="p">[</span><span class="n">rename_variables</span><span class="p">(</span><span class="n">ast_node</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">env</span><span class="p">)]</span>
            <span class="n">env</span><span class="p">[</span><span class="n">assigned</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">assigned</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">env</span> <span class="k">else</span> <span class="n">env</span><span class="p">[</span><span class="n">assigned</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">target</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="s1">'_</span><span class="si">%s</span><span class="s1">_</span><span class="si">%d</span><span class="s1">'</span> <span class="o">%</span>
                              <span class="p">(</span><span class="n">ast_node</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">env</span><span class="p">[</span><span class="n">assigned</span><span class="p">]),</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">new_node</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Expr</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">Compare</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">Eq</span><span class="p">()],</span> <span class="n">val</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ast_node</span><span class="p">,</span> <span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">Return</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Pass</span><span class="p">)):</span>
            <span class="n">new_node</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="s2">"NI </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">ast_node</span><span class="p">),</span> <span class="n">ast_node</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">new_path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_node</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">new_path</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Here is how it can be used:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">p</span> <span class="o">=</span> <span class="n">PNode</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">gcd_fnenter</span><span class="p">)</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">explore</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">explore</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">explore</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_path_to_root</span><span class="p">()</span>
<span class="n">spath</span> <span class="o">=</span> <span class="n">to_single_assignment_predicates</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="p">[</span><span class="n">to_src</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">spath</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>['z3.And(a == _a_0, b == _b_0)', '_a_0 &lt; _b_0', '_c_0 == _a_0', '_a_1 == _b_0']
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="Check-Before-You-Loop">Check Before You Loop</h4><p>One of the ways in which the <em>concolic</em> execution simplifies <em>symbolic</em> execution is in the treatment of loops. Rather than trying to determine an invariant for a loop, we simply <em>unroll</em> the loops a number of times until we hit the <code>MAX_DEPTH</code> limit.
However, not all loops will need to be unrolled until <code>MAX_DEPTH</code> is reached. Some of them may exit before. Hence, it is necessary to check whether the given set of constraints can be satisfied before continuing to explore further.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">identifiers_with_types</span><span class="p">(</span><span class="n">identifiers</span><span class="p">,</span> <span class="n">defined</span><span class="p">):</span>
    <span class="n">with_types</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">defined</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">identifiers</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'_'</span><span class="p">:</span>
            <span class="n">nxt</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">'_'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">nxt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="k">assert</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">defined</span>
            <span class="n">typ</span> <span class="o">=</span> <span class="n">defined</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="n">with_types</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">typ</span>
    <span class="k">return</span> <span class="n">with_types</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The <code>extract_constraints()</code> generates the <code>z3</code> constraints from a path. The main work is done by <code>to_single_assignment_predicates()</code>. The <code>extract_constraints()</code> then converts the AST to source.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">SymbolicFuzzer</span><span class="p">(</span><span class="n">SymbolicFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">extract_constraints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">to_src</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">to_single_assignment_predicates</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">if</span> <span class="n">p</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Solving-Path-Constraints">Solving Path Constraints</h3><p>We now update our <code>solve_path_constraint()</code> method to take into account the new identifiers created during reassignments.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">SymbolicFuzzer</span><span class="p">(</span><span class="n">SymbolicFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">solve_path_constraint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="c1"># re-initializing does not seem problematic.</span>
        <span class="c1"># a = z3.Int('a').get_id() remains the same.</span>
        <span class="n">constraints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_constraints</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">identifiers</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">c</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">constraints</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">used_identifiers</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span>  <span class="c1"># &lt;- changes</span>
        <span class="n">with_types</span> <span class="o">=</span> <span class="n">identifiers_with_types</span><span class="p">(</span>
            <span class="n">identifiers</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">used_variables</span><span class="p">)</span>  <span class="c1"># &lt;- changes</span>
        <span class="n">decl</span> <span class="o">=</span> <span class="n">define_symbolic_vars</span><span class="p">(</span><span class="n">with_types</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>
        <span class="n">exec</span><span class="p">(</span><span class="n">decl</span><span class="p">)</span>

        <span class="n">solutions</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">with</span> <span class="n">checkpoint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z3</span><span class="p">):</span>
            <span class="n">st</span> <span class="o">=</span> <span class="s1">'self.z3.add(</span><span class="si">%s</span><span class="s1">)'</span> <span class="o">%</span> <span class="s1">', '</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">constraints</span><span class="p">)</span>
            <span class="nb">eval</span><span class="p">(</span><span class="n">st</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">z3</span><span class="o">.</span><span class="n">check</span><span class="p">()</span> <span class="o">!=</span> <span class="n">z3</span><span class="o">.</span><span class="n">sat</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">{}</span>
            <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z3</span><span class="o">.</span><span class="n">model</span><span class="p">()</span>
            <span class="n">solutions</span> <span class="o">=</span> <span class="p">{</span><span class="n">d</span><span class="o">.</span><span class="n">name</span><span class="p">():</span> <span class="n">m</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">decls</span><span class="p">()}</span>
            <span class="n">my_args</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">solutions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fn_args</span><span class="p">}</span>

        <span class="n">predicate</span> <span class="o">=</span> <span class="s1">'z3.And(</span><span class="si">%s</span><span class="s1">)'</span> <span class="o">%</span> <span class="s1">','</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">"</span><span class="si">%s</span><span class="s2"> == </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">my_args</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
        <span class="nb">eval</span><span class="p">(</span><span class="s1">'self.z3.add(z3.Not(</span><span class="si">%s</span><span class="s1">))'</span> <span class="o">%</span> <span class="n">predicate</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">my_args</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Generating-All-Paths">Generating All Paths</h3></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The <code>get_all_paths()</code> is now similarly updated so that we unroll loops only to a specified height. It is also converted to an iterative exploration style so that we explore the CFG in a breadth first manner.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">SymbolicFuzzer</span><span class="p">(</span><span class="n">SymbolicFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get_all_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fenter</span><span class="p">):</span>
        <span class="n">path_lst</span> <span class="o">=</span> <span class="p">[</span><span class="n">PNode</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">fenter</span><span class="p">)]</span>
        <span class="n">completed</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_iter</span><span class="p">):</span>
            <span class="n">new_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">PNode</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">fenter</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">path_lst</span><span class="p">:</span>
                <span class="c1"># explore each path once</span>
                <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">cfgnode</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                    <span class="n">np</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">explore</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">np</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">idx</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_depth</span><span class="p">:</span>
                            <span class="k">break</span>
                        <span class="n">new_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">completed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="n">path_lst</span> <span class="o">=</span> <span class="n">new_paths</span>
        <span class="k">return</span> <span class="n">completed</span> <span class="o">+</span> <span class="n">path_lst</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We can now obtain all paths using our advanced symbolic fuzzer as follows.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">asymfz_gcd</span> <span class="o">=</span> <span class="n">SymbolicFuzzer</span><span class="p">(</span>
    <span class="n">gcd</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_tries</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">all_paths</span> <span class="o">=</span> <span class="n">asymfz_gcd</span><span class="o">.</span><span class="n">get_all_paths</span><span class="p">(</span><span class="n">asymfz_gcd</span><span class="o">.</span><span class="n">fnenter</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="nb">len</span><span class="p">(</span><span class="n">all_paths</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>38
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">all_paths</span><span class="p">[</span><span class="mi">37</span><span class="p">]</span><span class="o">.</span><span class="n">get_path_to_root</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[PNode:0[id:40 line[1] parents: [] : enter: gcd(a, b) order:0],
 PNode:1[id:42 line[2] parents: [40] : _if: a &lt; b order:1],
 PNode:2[id:46 line[7] parents: [45, 42, 49] : _while: b != 0 order:0],
 PNode:3[id:47 line[8] parents: [46] : c: int = a order:0],
 PNode:4[id:48 line[9] parents: [47] : a = b order:0],
 PNode:5[id:49 line[10] parents: [48] : b = c % b order:0],
 PNode:6[id:46 line[7] parents: [45, 42, 49] : _while: b != 0 order:0],
 PNode:7[id:47 line[8] parents: [46] : c: int = a order:0],
 PNode:8[id:48 line[9] parents: [47] : a = b order:0],
 PNode:9[id:49 line[10] parents: [48] : b = c % b order:0],
 PNode:10[id:46 line[7] parents: [45, 42, 49] : _while: b != 0 order:0]]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We can also list the predicates in each path.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">to_single_assignment_predicates</span><span class="p">(</span><span class="n">all_paths</span><span class="p">[</span><span class="mi">37</span><span class="p">]</span><span class="o">.</span><span class="n">get_path_to_root</span><span class="p">()):</span>
    <span class="k">if</span> <span class="n">s</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">to_src</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>z3.And(a == _a_0, b == _b_0)
z3.Not(_a_0 &lt; _b_0)
_b_0 != 0
_c_0 == _a_0
_a_1 == _b_0
_b_1 == _c_0 % _b_0
_b_1 != 0
_c_1 == _a_1
_a_2 == _b_1
_b_2 == _c_1 % _b_1
_b_2 != 0
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">constraints</span> <span class="o">=</span> <span class="n">asymfz_gcd</span><span class="o">.</span><span class="n">extract_constraints</span><span class="p">(</span><span class="n">all_paths</span><span class="p">[</span><span class="mi">37</span><span class="p">]</span><span class="o">.</span><span class="n">get_path_to_root</span><span class="p">())</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">constraints</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>['z3.And(a == _a_0, b == _b_0)',
 'z3.Not(_a_0 &lt; _b_0)',
 '_b_0 != 0',
 '_c_0 == _a_0',
 '_a_1 == _b_0',
 '_b_1 == _c_0 % _b_0',
 '_b_1 != 0',
 '_c_1 == _a_1',
 '_a_2 == _b_1',
 '_b_2 == _c_1 % _b_1',
 '_b_2 != 0']
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The constraints printed out demonstrates that our approach for renaming variables was successful. We need only one more piece to complete the puzzle. Our path is still a <code>PNode</code>. We need to modify <code>get_next_path()</code> so that we return the corresponding predicate chain.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">SymbolicFuzzer</span><span class="p">(</span><span class="n">SymbolicFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get_next_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_path</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_path</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_path</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">last_path</span><span class="p">]</span><span class="o">.</span><span class="n">get_path_to_root</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We will see next how to use our fuzzer for fuzzing.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Fuzzing-with-Advanced-Symbolic-Fuzzer">Fuzzing with Advanced Symbolic Fuzzer</h3><p>We use our advanced symbolic fuzzer on <em>gcd</em> to generate plausible inputs.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">asymfz_gcd</span> <span class="o">=</span> <span class="n">SymbolicFuzzer</span><span class="p">(</span>
    <span class="n">gcd</span><span class="p">,</span> <span class="n">max_tries</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">asymfz_gcd</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span>
    <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">r</span><span class="p">[</span><span class="s1">'a'</span><span class="p">]</span><span class="o">.</span><span class="n">as_long</span><span class="p">(),</span> <span class="n">r</span><span class="p">[</span><span class="s1">'b'</span><span class="p">]</span><span class="o">.</span><span class="n">as_long</span><span class="p">()))</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">gcd</span><span class="p">(</span><span class="o">*</span><span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="s2">"result:"</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>{'a': 8, 'b': 3} result: 1
{'a': 1, 'b': 2} result: 1
{'a': 2, 'b': 5} result: 1
{'a': 5, 'b': 2} result: 1
{'a': 3, 'b': 4} result: 1
{'a': 9, 'b': 9} result: 9
{'a': 7, 'b': 6} result: 1
{'a': 5, 'b': 10} result: 5
{'a': 3, 'b': 1} result: 1
{'a': 10, 'b': 7} result: 1
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The outputs look reasonable. However, what is the coverage obtained?</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">with</span> <span class="n">VisualizedArcCoverage</span><span class="p">()</span> <span class="k">as</span> <span class="n">cov</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">gcd</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">cov</span><span class="o">.</span><span class="n">show_coverage</span><span class="p">(</span><span class="n">gcd</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>#  1: def gcd(a: int, b: int) -&gt; int:
#  2:     if a &lt; b:
#  3:         c: int = a  # type: ignore
#  4:         a = b
#  5:         b = c
   6: 
#  7:     while b != 0:
#  8:         c: int = a  # type: ignore
#  9:         a = b
# 10:         b = c % b
  11: 
# 12:     return a
  13: 
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">show_cfg</span><span class="p">(</span><span class="n">gcd</span><span class="p">,</span> <span class="n">arcs</span><span class="o">=</span><span class="n">cov</span><span class="o">.</span><span class="n">arcs</span><span class="p">())</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_svg output_subarea output_execute_result">


<!-- Generated by graphviz version 12.2.1 (20241206.2353)
 -->
<!-- Pages: 1 -->
<svg width="282pt" height="636pt" viewbox="0.00 0.00 281.77 636.00" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 632)">
<polygon fill="white" stroke="none" points="-4,4 -4,-632 277.77,-632 277.77,4 -4,4"/>
<!-- 1 -->
<g id="node1" class="node">
<title>1</title>
<ellipse fill="none" stroke="black" cx="173.9" cy="-606" rx="72.19" ry="18"/>
<ellipse fill="none" stroke="black" cx="173.9" cy="-606" rx="76.19" ry="22"/>
<text text-anchor="middle" x="173.9" y="-599.83" font-family="Times,serif" font-size="14.00">1: enter: gcd(a, b)</text>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<polygon fill="none" stroke="black" points="173.9,-548 106.88,-530 173.9,-512 240.91,-530 173.9,-548"/>
<text text-anchor="middle" x="173.9" y="-523.83" font-family="Times,serif" font-size="14.00">2: if: a &lt; b</text>
</g>
<!-- 1&#45;&gt;3 -->
<g id="edge2" class="edge">
<title>1-&gt;3</title>
<path fill="none" stroke="green" d="M173.9,-583.6C173.9,-576.11 173.9,-567.59 173.9,-559.61"/>
<polygon fill="green" stroke="green" points="177.4,-559.65 173.9,-549.65 170.4,-559.65 177.4,-559.65"/>
</g>
<!-- 2 -->
<g id="node2" class="node">
<title>2</title>
<ellipse fill="none" stroke="black" cx="71.9" cy="-94" rx="67.9" ry="18"/>
<ellipse fill="none" stroke="black" cx="71.9" cy="-94" rx="71.9" ry="22"/>
<text text-anchor="middle" x="71.9" y="-87.83" font-family="Times,serif" font-size="14.00">1: exit: gcd(a, b)</text>
</g>
<!-- 11 -->
<g id="node3" class="node">
<title>11</title>
<polygon fill="none" stroke="black" points="111.4,-188 32.4,-188 32.4,-152 111.4,-152 111.4,-188"/>
<text text-anchor="middle" x="71.9" y="-163.82" font-family="Times,serif" font-size="14.00">12: return a</text>
</g>
<!-- 11&#45;&gt;2 -->
<g id="edge1" class="edge">
<title>11-&gt;2</title>
<path fill="none" stroke="green" d="M71.9,-151.84C71.9,-144.64 71.9,-136.02 71.9,-127.7"/>
<polygon fill="green" stroke="green" points="75.4,-127.82 71.9,-117.82 68.4,-127.82 75.4,-127.82"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<ellipse fill="none" stroke="black" cx="134.9" cy="-458" rx="50.72" ry="18"/>
<text text-anchor="middle" x="134.9" y="-451.82" font-family="Times,serif" font-size="14.00">3: c: int = a</text>
</g>
<!-- 3&#45;&gt;4 -->
<g id="edge3" class="edge">
<title>3-&gt;4</title>
<path fill="none" stroke="green" d="M165.43,-513.81C160.89,-505.66 155.16,-495.37 149.89,-485.92"/>
<polygon fill="green" stroke="green" points="153.1,-484.48 145.17,-477.45 146.98,-487.89 153.1,-484.48"/>
</g>
<!-- 7 -->
<g id="node8" class="node">
<title>7</title>
<polygon fill="none" stroke="black" points="179.9,-260 88.6,-242 179.9,-224 271.19,-242 179.9,-260"/>
<text text-anchor="middle" x="179.9" y="-235.82" font-family="Times,serif" font-size="14.00">7: while: b != 0</text>
</g>
<!-- 3&#45;&gt;7 -->
<g id="edge7" class="edge">
<title>3-&gt;7</title>
<path fill="none" stroke="green" d="M181.75,-513.7C186.6,-503.35 192.37,-489.22 194.9,-476 208.86,-402.85 195.05,-314.68 186.15,-270.74"/>
<polygon fill="green" stroke="green" points="189.59,-270.11 184.1,-261.04 182.74,-271.55 189.59,-270.11"/>
</g>
<!-- 5 -->
<g id="node6" class="node">
<title>5</title>
<polygon fill="none" stroke="black" points="175.27,-404 116.52,-404 116.52,-368 175.27,-368 175.27,-404"/>
<text text-anchor="middle" x="145.9" y="-379.82" font-family="Times,serif" font-size="14.00">4: a = b</text>
</g>
<!-- 4&#45;&gt;5 -->
<g id="edge4" class="edge">
<title>4-&gt;5</title>
<path fill="none" stroke="green" d="M137.61,-439.7C138.77,-432.32 140.16,-423.52 141.46,-415.25"/>
<polygon fill="green" stroke="green" points="144.88,-416.02 142.97,-405.6 137.96,-414.93 144.88,-416.02"/>
</g>
<!-- 6 -->
<g id="node7" class="node">
<title>6</title>
<polygon fill="none" stroke="black" points="181.27,-332 122.52,-332 122.52,-296 181.27,-296 181.27,-332"/>
<text text-anchor="middle" x="151.9" y="-307.82" font-family="Times,serif" font-size="14.00">5: b = c</text>
</g>
<!-- 5&#45;&gt;6 -->
<g id="edge5" class="edge">
<title>5-&gt;6</title>
<path fill="none" stroke="green" d="M147.38,-367.7C148,-360.41 148.75,-351.73 149.45,-343.54"/>
<polygon fill="green" stroke="green" points="152.93,-343.87 150.3,-333.61 145.96,-343.28 152.93,-343.87"/>
</g>
<!-- 6&#45;&gt;7 -->
<g id="edge6" class="edge">
<title>6-&gt;7</title>
<path fill="none" stroke="green" d="M158.82,-295.7C161.96,-287.84 165.75,-278.37 169.24,-269.63"/>
<polygon fill="green" stroke="green" points="172.41,-271.13 172.88,-260.55 165.91,-268.53 172.41,-271.13"/>
</g>
<!-- 7&#45;&gt;11 -->
<g id="edge12" class="edge">
<title>7-&gt;11</title>
<path fill="none" stroke="green" d="M159.33,-227.67C144.77,-218.23 124.86,-205.33 107.71,-194.22"/>
<polygon fill="green" stroke="green" points="110.09,-191.59 99.8,-189.08 106.28,-197.46 110.09,-191.59"/>
</g>
<!-- 8 -->
<g id="node10" class="node">
<title>8</title>
<ellipse fill="none" stroke="black" cx="179.9" cy="-170" rx="50.72" ry="18"/>
<text text-anchor="middle" x="179.9" y="-163.82" font-family="Times,serif" font-size="14.00">8: c: int = a</text>
</g>
<!-- 7&#45;&gt;8 -->
<g id="edge9" class="edge">
<title>7-&gt;8</title>
<path fill="none" stroke="green" d="M179.9,-223.7C179.9,-216.41 179.9,-207.73 179.9,-199.54"/>
<polygon fill="green" stroke="green" points="183.4,-199.62 179.9,-189.62 176.4,-199.62 183.4,-199.62"/>
</g>
<!-- 10 -->
<g id="node9" class="node">
<title>10</title>
<polygon fill="none" stroke="black" points="273.77,-36 182.02,-36 182.02,0 273.77,0 273.77,-36"/>
<text text-anchor="middle" x="227.9" y="-11.82" font-family="Times,serif" font-size="14.00">10: b = c % b</text>
</g>
<!-- 10&#45;&gt;7 -->
<g id="edge8" class="edge">
<title>10-&gt;7</title>
<path fill="none" stroke="green" d="M234.37,-36.5C245.04,-68.28 262.93,-136.92 239.9,-188 233.87,-201.36 222.62,-212.71 211.48,-221.44"/>
<polygon fill="green" stroke="green" points="209.52,-218.53 203.49,-227.25 213.64,-224.2 209.52,-218.53"/>
</g>
<!-- 9 -->
<g id="node11" class="node">
<title>9</title>
<polygon fill="none" stroke="black" points="226.27,-112 167.52,-112 167.52,-76 226.27,-76 226.27,-112"/>
<text text-anchor="middle" x="196.9" y="-87.83" font-family="Times,serif" font-size="14.00">9: a = b</text>
</g>
<!-- 8&#45;&gt;9 -->
<g id="edge10" class="edge">
<title>8-&gt;9</title>
<path fill="none" stroke="green" d="M183.84,-151.84C185.78,-143.4 188.16,-133.01 190.37,-123.42"/>
<polygon fill="green" stroke="green" points="193.75,-124.33 192.58,-113.8 186.93,-122.76 193.75,-124.33"/>
</g>
<!-- 9&#45;&gt;10 -->
<g id="edge11" class="edge">
<title>9-&gt;10</title>
<path fill="none" stroke="green" d="M204.09,-75.84C207.7,-67.21 212.17,-56.55 216.25,-46.79"/>
<polygon fill="green" stroke="green" points="219.42,-48.3 220.05,-37.72 212.96,-45.59 219.42,-48.3"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Indeed, both branch and statement coverage visualization seems to indicate that we achieved complete coverage.
How do we make use of our fuzzer in practice? We explore a small case study of a program to solve the roots of a quadratic equation.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="Example:-Roots-of-a-Quadratic-Equation">Example: Roots of a Quadratic Equation</h4><p>Here is the famous equation for finding the roots of a quadratic equation.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="kn">from</span> <span class="nn"><a href="https://docs.python.org/3/library/typing.html" class="import" target="_blank">typing</a></span> <span class="kn">import</span> <span class="n">Tuple</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">roots</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
    <span class="n">d</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">b</span> <span class="o">*</span> <span class="n">b</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">c</span>
    <span class="n">ax</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">d</span>
    <span class="n">bx</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">ax</span> <span class="o">-</span> <span class="n">bx</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.1</span><span class="p">:</span>
        <span class="n">bx</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">ax</span> <span class="o">+</span> <span class="n">d</span> <span class="o">/</span> <span class="n">ax</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">bx</span>

    <span class="n">s</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">bx</span>
    <span class="n">a2</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">a</span>
    <span class="n">ba2</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">b</span> <span class="o">/</span> <span class="n">a2</span>

    <span class="k">return</span> <span class="o">-</span><span class="n">ba2</span> <span class="o">+</span> <span class="n">s</span> <span class="o">/</span> <span class="n">a2</span><span class="p">,</span> <span class="o">-</span><span class="n">ba2</span> <span class="o">-</span> <span class="n">s</span> <span class="o">/</span> <span class="n">a2</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Does the program look correct? Let us investigate if the program is reasonable. But before that, we need a helper
function <code>sym_to_float()</code> to convert symbolic values to floating point.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">sym_to_float</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">inf</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">z3</span><span class="o">.</span><span class="n">IntNumRef</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">v</span><span class="o">.</span><span class="n">as_long</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">v</span><span class="o">.</span><span class="n">numerator_as_long</span><span class="p">()</span> <span class="o">/</span> <span class="n">v</span><span class="o">.</span><span class="n">denominator_as_long</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Now we are ready to fuzz.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">asymfz_roots</span> <span class="o">=</span> <span class="n">SymbolicFuzzer</span><span class="p">(</span>
    <span class="n">roots</span><span class="p">,</span>
    <span class="n">max_tries</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">max_iter</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">with</span> <span class="n">ExpectError</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">asymfz_roots</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">[</span><span class="n">sym_to_float</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'a'</span><span class="p">,</span> <span class="s1">'b'</span><span class="p">,</span> <span class="s1">'c'</span><span class="p">]]</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">roots</span><span class="p">(</span><span class="o">*</span><span class="n">d</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>{'a': 11/10, 'b': 0, 'c': -1/2}
[1.1, 0.0, -0.5] (0.7045454545454545, -0.7045454545454545)
{'a': 0, 'b': 58617/131072, 'c': -1/2}
</pre>
</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>Traceback (most recent call last):
  File "/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_16239/94617992.py", line 6, in &lt;module&gt;
    v = roots(*d)
        ^^^^^^^^^
  File "/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_16239/2299859991.py", line 11, in roots
    ba2: float = b / a2
                 ~~^~~~
ZeroDivisionError: float division by zero (expected)
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We have a <code>ZeroDivisionError</code>. Can we eliminate it?</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h5 id="Roots---Check-Before-Divide">Roots - Check Before Divide</h5></div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">roots2</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
    <span class="n">d</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">b</span> <span class="o">*</span> <span class="n">b</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">c</span>

    <span class="n">xa</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">d</span>
    <span class="n">xb</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">xa</span> <span class="o">-</span> <span class="n">xb</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.1</span><span class="p">:</span>
        <span class="n">xb</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">xa</span> <span class="o">+</span> <span class="n">d</span> <span class="o">/</span> <span class="n">xa</span><span class="p">)</span>
        <span class="n">xa</span> <span class="o">=</span> <span class="n">xb</span>

    <span class="n">s</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">xb</span>

    <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">c</span> <span class="o">/</span> <span class="n">b</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span> <span class="o">/</span> <span class="n">b</span>  <span class="c1"># only one solution</span>

    <span class="n">a2</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">a</span>
    <span class="n">ba2</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">b</span> <span class="o">/</span> <span class="n">a2</span>
    <span class="k">return</span> <span class="o">-</span><span class="n">ba2</span> <span class="o">+</span> <span class="n">s</span> <span class="o">/</span> <span class="n">a2</span><span class="p">,</span> <span class="o">-</span><span class="n">ba2</span> <span class="o">-</span> <span class="n">s</span> <span class="o">/</span> <span class="n">a2</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">asymfz_roots</span> <span class="o">=</span> <span class="n">SymbolicFuzzer</span><span class="p">(</span>
    <span class="n">roots2</span><span class="p">,</span>
    <span class="n">max_tries</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">max_iter</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">with</span> <span class="n">ExpectError</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">asymfz_roots</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">[</span><span class="n">sym_to_float</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'a'</span><span class="p">,</span> <span class="s1">'b'</span><span class="p">,</span> <span class="s1">'c'</span><span class="p">]]</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">roots2</span><span class="p">(</span><span class="o">*</span><span class="n">d</span><span class="p">)</span>
        <span class="c1">#print(d, v)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>Traceback (most recent call last):
  File "/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_16239/567876003.py", line 5, in &lt;module&gt;
    v = roots2(*d)
        ^^^^^^^^^^
  File "/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_16239/714795544.py", line 13, in roots2
    return -c / b, -c / b  # only one solution
           ~~~^~~
ZeroDivisionError: float division by zero (expected)
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Apparently, our fix was incomplete. Let us try again.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h5 id="Roots---Eliminating-the-Zero-Division-Error">Roots - Eliminating the Zero Division Error</h5></div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/math.html" class="import" target="_blank">math</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">roots3</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
    <span class="n">d</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">b</span> <span class="o">*</span> <span class="n">b</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">c</span>

    <span class="n">xa</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">d</span>
    <span class="n">xb</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">xa</span> <span class="o">-</span> <span class="n">xb</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.1</span><span class="p">:</span>
        <span class="n">xb</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">xa</span> <span class="o">+</span> <span class="n">d</span> <span class="o">/</span> <span class="n">xa</span><span class="p">)</span>
        <span class="n">xa</span> <span class="o">=</span> <span class="n">xb</span>
    <span class="n">s</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">xb</span>

    <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">inf</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">c</span> <span class="o">/</span> <span class="n">b</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span> <span class="o">/</span> <span class="n">b</span>  <span class="c1"># only one solution</span>

    <span class="n">a2</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">a</span>
    <span class="n">ba2</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">b</span> <span class="o">/</span> <span class="n">a2</span>
    <span class="k">return</span> <span class="o">-</span><span class="n">ba2</span> <span class="o">+</span> <span class="n">s</span> <span class="o">/</span> <span class="n">a2</span><span class="p">,</span> <span class="o">-</span><span class="n">ba2</span> <span class="o">-</span> <span class="n">s</span> <span class="o">/</span> <span class="n">a2</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">asymfz_roots</span> <span class="o">=</span> <span class="n">SymbolicFuzzer</span><span class="p">(</span>
    <span class="n">roots3</span><span class="p">,</span>
    <span class="n">max_tries</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">max_iter</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">asymfz_roots</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="p">[</span><span class="n">sym_to_float</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'a'</span><span class="p">,</span> <span class="s1">'b'</span><span class="p">,</span> <span class="s1">'c'</span><span class="p">]]</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">roots3</span><span class="p">(</span><span class="o">*</span><span class="n">d</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>{'a': -1, 'b': 0, 'c': 0}
[-1.0, 0.0, 0.0] (0.0, 0.0)
{'a': -11/20, 'b': 0, 'c': 1}
[-0.55, 0.0, 1.0] (-1.409090909090909, 1.409090909090909)
{'a': -1/40, 'b': 0, 'c': 2}
[-0.025, 0.0, 2.0] (0.0, 0.0)
{'a': 0, 'b': -1/4, 'c': 3}
[0.0, -0.25, 3.0] (12.0, 12.0)
{'a': 0, 'b': 0, 'c': 4}
[0.0, 0.0, 4.0] (inf, inf)
{'a': 0, 'b': -777645/524288, 'c': 5}
[0.0, -1.4832401275634766, 5.0] (3.370998334715712, 3.370998334715712)
{'a': -2/91, 'b': 0, 'c': 91/40}
[-0.02197802197802198, 0.0, 2.275] (0.0, 0.0)
{'a': 0, 'b': 4/9, 'c': 6}
[0.0, 0.4444444444444444, 6.0] (-13.5, -13.5)
{'a': 0, 'b': 0, 'c': 7}
[0.0, 0.0, 7.0] (inf, inf)
{'a': -7/6, 'b': -1, 'c': 3/2}
[-1.1666666666666667, -1.0, 1.5] (-1.7142857142857142, 0.857142857142857)
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>With this, we have demonstrated that we can use our <em>SymbolicFuzzer</em> to fuzz programs, and it can aid in identifying problems in code.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Limitations">Limitations</h2><p>There is an evident error in the <code>roots3()</code> function. We are not checking for negative roots. However, the symbolic execution does not seem to have detected it. Why are we not able to detect the problem of negative roots? Because we stop execution at a predetermined depth without throwing an error. That is, our symbolic execution is wide but shallow. One of the ways this limitation can be overcome is by relying on <a href="ConcolicFuzzer.html">concolic execution</a>, that allows one to go deeper than pure symbolic execution.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>A second problem is that symbolic execution is necessarily computation intensive. This means that specification based fuzzers are often able to generate a much larger set of inputs, and consecutively more coverage on programs that do not check for magic bytes, such that they provide a reasonable gradient of exploration.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Lessons-Learned">Lessons Learned</h2><ul>
<li>One can use symbolic execution to augment the inputs that explore all characteristics of a program.</li>
<li>Symbolic execution can be broad but shallow.</li>
<li>Symbolic execution is well suited for programs that rely on specific values to be present in the input, however, its utility decreases when such values are not present, and the input space represents a gradient in terms of coverage.</li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Next-Steps">Next Steps</h2><ul>
<li><a href="SearchBasedFuzzer.html">Search based fuzzing</a> can often be an acceptable middle ground when random fuzzing does not provide sufficient results, but symbolic fuzzing is too heavyweight.</li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Background">Background</h2><p>Symbolic execution of programs was originally described by King [<a href="https://doi.org/10.1145/360248.360252">King <em>et al</em>, 1976</a>] in 1976. It is used extensively in vulnerability analysis of software, especially binary programs. Some well known symbolic execution tools include <em>KLEE</em> [Cadar <em>et al</em>, 2008], <em>angr</em> [Wang <em>et al</em>, 2017], <em>Driller</em> [Stephens <em>et al</em>, 2016], and <em>SAGE</em> [Godefroid <em>et al</em>, 2012]. The best known symbolic execution environment for Python is CHEF [<a href="https://doi.org/10.1145/2541940.2541977">Bucur <em>et al</em>, 2014</a>] which does symbolic execution by modifying the interpreter.</p>
<p>The Z3 solver we use in this chapter was developed at Microsoft Research under the lead of Leonardo de Moura and Nikolaj Bjørner [<a href="https://link.springer.com/chapter/10.1007/978-3-540-78800-3_24">De Moura <em>et al</em>, 2008</a>]. It is one of the most popular solvers.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Exercises">Exercises</h2></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Exercise-1:-Extending-Symbolic-Fuzzer-to-use-function-summaries">Exercise 1: Extending Symbolic Fuzzer to use function summaries</h3><p>We showed in the first section how function summaries may be produced. Can you extend the <code>SymbolicFuzzer</code> to use function summaries when needed?</p>

    
<p/><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/HEAD?labpath=docs%2Fnotebooks/SymbolicFuzzer.ipynb#Exercises" target="_blank">Use the notebook</a> to work on the exercises and see solutions.</div>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Exercise-2:-Statically-checking-if-a-loop-should-be-unrolled-further">Exercise 2: Statically checking if a loop should be unrolled further</h3><p>We examined how loops would be unrolled during exploration to a fixed depth. However, not all loops need to be unrolled completely. Some loops may contain only a constant number of iterations. For example, consider the loop below.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>This loop needs to be unrolled exactly $10$ times. For such cases, can you implement a method <code>can_be_satisfied()</code> which is invoked as below, to only unroll further if the path condition can be satisfied.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">SymbolicFuzzer</span><span class="p">(</span><span class="n">SymbolicFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get_all_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fenter</span><span class="p">):</span>
        <span class="n">path_lst</span> <span class="o">=</span> <span class="p">[</span><span class="n">PNode</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">fenter</span><span class="p">)]</span>
        <span class="n">completed</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_iter</span><span class="p">):</span>
            <span class="n">new_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">PNode</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">fenter</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">path_lst</span><span class="p">:</span>
                <span class="c1"># explore each path once</span>
                <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">cfgnode</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                    <span class="n">np</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">explore</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">np</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">idx</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_depth</span><span class="p">:</span>
                            <span class="k">break</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">can_be_satisfied</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
                            <span class="n">new_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">completed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="n">path_lst</span> <span class="o">=</span> <span class="n">new_paths</span>
        <span class="k">return</span> <span class="n">completed</span> <span class="o">+</span> <span class="n">path_lst</span>
</pre></div>

</div>
</div>
    
<p/><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/HEAD?labpath=docs%2Fnotebooks/SymbolicFuzzer.ipynb#Exercises" target="_blank">Use the notebook</a> to work on the exercises and see solutions.</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p><strong>Solution.</strong> Here is a solution.</p>

    
<p/><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/HEAD?labpath=docs%2Fnotebooks/SymbolicFuzzer.ipynb#Exercises" target="_blank">Use the notebook</a> to work on the exercises and see solutions.</div>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Exercise-3:-Implementing-a-Concolic-Fuzzer">Exercise 3: Implementing a Concolic Fuzzer</h3></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We have seen in the chapter on <a href="ConcolicFuzzer.html">concolic fuzzing</a> how to trace a function concolically using information flow. However, this is somewhat suboptimal as the constraints can get dropped when the information flow is indirect (as in control flow based information flow). Can you implement concolic tracing using the infrastructure we built for symbolic execution?</p>

    
<p/><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/HEAD?labpath=docs%2Fnotebooks/SymbolicFuzzer.ipynb#Exercises" target="_blank">Use the notebook</a> to work on the exercises and see solutions.</div>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p><strong>Solution.</strong> Here is a possible solution.</p>

    
<p/><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/HEAD?labpath=docs%2Fnotebooks/SymbolicFuzzer.ipynb#Exercises" target="_blank">Use the notebook</a> to work on the exercises and see solutions.</div>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Indeed, the path traced is now different. One can continue this procedure to the necessary number of times to explore all nearby paths to the execution.</p>
<p>Can you incorporate this exploration into the concolic fuzzer?</p>

    
<p/><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/HEAD?labpath=docs%2Fnotebooks/SymbolicFuzzer.ipynb#Exercises" target="_blank">Use the notebook</a> to work on the exercises and see solutions.</div>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Compatibility">Compatibility</h2></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Earlier versions of this chapter used the name <code>AdvancedSymbolicFuzzer</code> for <code>SymbolicFuzzer</code>.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">AdvancedSymbolicFuzzer</span> <span class="o">=</span> <span class="n">SymbolicFuzzer</span>
</pre></div>

</div>
</div></div>
</div>
</div>

        
<p class="imprint">
<img style="float:right" src="../Images/2f3faa36146c6fb38bbab67add09aa5f.png" alt="Creative Commons License" data-original-src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png"/>
The content of this project is licensed under the
<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.
The source code that is part of the content, as well as the source code used to format and display that content is licensed under the <a href="https://github.com/uds-se/fuzzingbook/blob/master/LICENSE.md#mit-license">MIT License</a>.
<a href="https://github.com/uds-se/fuzzingbook/commits/master/notebooks/SymbolicFuzzer.ipynb" target="_blank)">Last change: 2025-01-22 09:37:42+01:00</a> • 
<a href="#citation" id="cite" onclick="revealCitation()">Cite</a> •
<a href="https://cispa.de/en/impressum" target="_blank">Imprint</a>
</p>



<div id="citation" class="citation" style="display: none;">
<a name="citation"/>
<h2>How to Cite this Work</h2>
<p>
Andreas Zeller, Rahul Gopinath, Marcel Böhme, Gordon Fraser, and Christian Holler: "<a href="https://www.fuzzingbook.org/html/SymbolicFuzzer.html">Symbolic Fuzzing</a>".  In Andreas Zeller, Rahul Gopinath, Marcel Böhme, Gordon Fraser, and Christian Holler, "<a href="https://www.fuzzingbook.org/">The Fuzzing Book</a>", <a href="https://www.fuzzingbook.org/html/SymbolicFuzzer.html">https://www.fuzzingbook.org/html/SymbolicFuzzer.html</a>.  Retrieved 2025-01-22 09:37:42+01:00.
</p>
<pre>
@incollection{fuzzingbook2025:SymbolicFuzzer,
    author = {Andreas Zeller and Rahul Gopinath and Marcel B{\"o}hme and Gordon Fraser and Christian Holler},
    booktitle = {The Fuzzing Book},
    title = {Symbolic Fuzzing},
    year = {2025},
    publisher = {CISPA Helmholtz Center for Information Security},
    howpublished = {\url{https://www.fuzzingbook.org/html/SymbolicFuzzer.html}},
    note = {Retrieved 2025-01-22 09:37:42+01:00},
    url = {https://www.fuzzingbook.org/html/SymbolicFuzzer.html},
    urldate = {2025-01-22 09:37:42+01:00}
}
</pre>
</div>

          
</body>
</html>