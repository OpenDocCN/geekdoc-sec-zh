<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Fuzzing with Grammars</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Fuzzing with Grammars</h1>
<blockquote>原文：<a href="http://www.fuzzingbook.org/html/Grammars.html">http://www.fuzzingbook.org/html/Grammars.html</a></blockquote>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>In the chapter on <a href="MutationFuzzer.html">"Mutation-Based Fuzzing"</a>, we have seen how to use extra hints – such as sample input files – to speed up test generation.  In this chapter, we take this idea one step further, by providing a <em>specification</em> of the legal inputs to a program.  Specifying inputs via a <em>grammar</em> allows for very systematic and efficient test generation, in particular for complex input formats.  Grammars also serve as the base for configuration fuzzing, API fuzzing, GUI fuzzing, and many more.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="kn">from</span> <span class="nn"><a href="https://github.com/uds-se/fuzzingbook//tree/master/notebooks/shared/bookutils" class="import" target="_blank">bookutils</a></span> <span class="kn">import</span> <span class="n">YouTubeVideo</span>
<span class="n">YouTubeVideo</span><span class="p">(</span><span class="s1">'Jc8Whz0W41o'</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_html rendered_html output_subarea output_execute_result">

        

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p><strong>Prerequisites</strong></p>
<ul>
<li>You should know how basic fuzzing works, e.g. from the <a href="Fuzzer.html">Chapter introducing fuzzing</a>.</li>
<li>Knowledge on <a href="MutationFuzzer.html">mutation-based fuzzing</a> and <a href="Coverage.html">coverage</a> is <em>not</em> required yet, but still recommended.</li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="kn">import</span> <span class="nn"><a href="https://github.com/uds-se/fuzzingbook//tree/master/notebooks/shared/bookutils" class="import" target="_blank">bookutils.setup</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="kn">from</span> <span class="nn"><a href="https://docs.python.org/3/library/typing.html" class="import" target="_blank">typing</a></span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Optional</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="kn">import</span> <span class="nn"><a href="Fuzzer.html" class="import" target="_blank">Fuzzer</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><div class="synopsis"><h2 id="Synopsis">Synopsis</h2><!-- Automatically generated. Do not edit. -->

<p>To <a href="Importing.html">use the code provided in this chapter</a>, write</p>
<div class="highlight"><pre><span/><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn"><a href="Grammars.html" class="import" target="_blank">fuzzingbook.Grammars</a></span> <span class="kn">import</span> <span class="o">&lt;</span><span class="n">identifier</span><span class="o">&gt;</span>
</pre></div>
<p>and then make use of the following features.</p>
<p>This chapter introduces <em>grammars</em> as a simple means to specify input languages, and to use them for testing programs with syntactically valid inputs.  A grammar is defined as a mapping of nonterminal symbols to lists of alternative expansions, as in the following example:</p>
<div class="highlight"><pre><span/><span class="o">&gt;&gt;&gt;</span> <span class="n">US_PHONE_GRAMMAR</span><span class="p">:</span> <span class="n">Grammar</span> <span class="o">=</span> <span class="p">{</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="s2">"&lt;start&gt;"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"&lt;phone-number&gt;"</span><span class="p">],</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="s2">"&lt;phone-number&gt;"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"(&lt;area&gt;)&lt;exchange&gt;-&lt;line&gt;"</span><span class="p">],</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="s2">"&lt;area&gt;"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"&lt;lead-digit&gt;&lt;digit&gt;&lt;digit&gt;"</span><span class="p">],</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="s2">"&lt;exchange&gt;"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"&lt;lead-digit&gt;&lt;digit&gt;&lt;digit&gt;"</span><span class="p">],</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="s2">"&lt;line&gt;"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"&lt;digit&gt;&lt;digit&gt;&lt;digit&gt;&lt;digit&gt;"</span><span class="p">],</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="s2">"&lt;lead-digit&gt;"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"2"</span><span class="p">,</span> <span class="s2">"3"</span><span class="p">,</span> <span class="s2">"4"</span><span class="p">,</span> <span class="s2">"5"</span><span class="p">,</span> <span class="s2">"6"</span><span class="p">,</span> <span class="s2">"7"</span><span class="p">,</span> <span class="s2">"8"</span><span class="p">,</span> <span class="s2">"9"</span><span class="p">],</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="s2">"&lt;digit&gt;"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"0"</span><span class="p">,</span> <span class="s2">"1"</span><span class="p">,</span> <span class="s2">"2"</span><span class="p">,</span> <span class="s2">"3"</span><span class="p">,</span> <span class="s2">"4"</span><span class="p">,</span> <span class="s2">"5"</span><span class="p">,</span> <span class="s2">"6"</span><span class="p">,</span> <span class="s2">"7"</span><span class="p">,</span> <span class="s2">"8"</span><span class="p">,</span> <span class="s2">"9"</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="p">}</span>
<span class="o">&gt;&gt;&gt;</span> 
<span class="o">&gt;&gt;&gt;</span> <span class="k">assert</span> <span class="n">is_valid_grammar</span><span class="p">(</span><span class="n">US_PHONE_GRAMMAR</span><span class="p">)</span>
</pre></div>
<p>Nonterminal symbols are enclosed in angle brackets (say, <code>&lt;digit&gt;</code>).  To generate an input string from a grammar, a <em>producer</em> starts with the start symbol (<code>&lt;start&gt;</code>) and randomly chooses a random expansion for this symbol.  It continues the process until all nonterminal symbols are expanded.  The function <code>simple_grammar_fuzzer()</code> does just that:</p>
<div class="highlight"><pre><span/><span class="o">&gt;&gt;&gt;</span> <span class="p">[</span><span class="n">simple_grammar_fuzzer</span><span class="p">(</span><span class="n">US_PHONE_GRAMMAR</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)]</span>
<span class="p">[</span><span class="s1">'(692)449-5179'</span><span class="p">,</span>
 <span class="s1">'(519)230-7422'</span><span class="p">,</span>
 <span class="s1">'(613)761-0853'</span><span class="p">,</span>
 <span class="s1">'(979)881-3858'</span><span class="p">,</span>
 <span class="s1">'(810)914-5475'</span><span class="p">]</span>
</pre></div>
<p>In practice, though, instead of <code>simple_grammar_fuzzer()</code>, you should use <a href="GrammarFuzzer.html">the <code>GrammarFuzzer</code> class</a> or one of its <a href="GrammarCoverageFuzzer.html">coverage-based</a>, <a href="ProbabilisticGrammarFuzzer.html">probabilistic-based</a>, or <a href="GeneratorGrammarFuzzer.html">generator-based</a> derivatives; these are more efficient, protect against infinite growth, and provide several additional features.</p>
<p>This chapter also introduces a <a href="#A-Grammar-Toolbox">grammar toolbox</a> with several helper functions that ease the writing of grammars, such as using shortcut notations for character classes and repetitions, or extending grammars</p>
</div>
</div>
</div>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Input-Languages">Input Languages</h2><p>All possible behaviors of a program can be triggered by its input.  "Input" here can be a wide range of possible sources: We are talking about data that is read from files, from the environment, or over the network, data input by the user, or data acquired from interaction with other resources.  The set of all these inputs determines how the program will behave – including its failures.  When testing, it is thus very helpful to think about possible input sources, how to get them under control, and <em>how to systematically test them</em>.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>For the sake of simplicity, we will assume for now that the program has only one source of inputs; this is the same assumption we have been using in the previous chapters, too.  The set of valid inputs to a program is called a <em>language</em>.  Languages range from the simple to the complex: the CSV language denotes the set of valid comma-separated inputs, whereas the Python language denotes the set of valid Python programs.  We commonly separate data languages and programming languages, although any program can also be treated as input data (say, to a compiler).  The <a href="https://en.wikipedia.org/wiki/List_of_file_formats">Wikipedia page on file formats</a> lists more than 1,000 different file formats, each of which is its own language.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>To formally describe languages, the field of <em>formal languages</em> has devised a number of <em>language specifications</em> that describe a language.  <em>Regular expressions</em> represent the simplest class of these languages to denote sets of strings: The regular expression <code>[a-z]*</code>, for instance, denotes a (possibly empty) sequence of lowercase letters.  <em>Automata theory</em> connects these languages to automata that accept these inputs; <em>finite state machines</em>, for instance, can be used to specify the language of regular expressions.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Regular expressions are great for not-too-complex input formats, and the associated finite state machines have many properties that make them great for reasoning.  To specify more complex inputs, though, they quickly encounter limitations.  At the other end of the language spectrum, we have <em>universal grammars</em> that denote the language accepted by <em>Turing machines</em>.  A Turing machine can compute anything that can be computed; and with Python being Turing-complete, this means that we can also use a Python program $p$ to specify or even enumerate legal inputs.  But then, computer science theory also tells us that each such testing program has to be written specifically for the program to be tested, which is not the level of automation we want.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Grammars">Grammars</h2><p>The middle ground between regular expressions and Turing machines is covered by <em>grammars</em>.  Grammars are among the most popular (and best understood) formalisms to formally specify input languages.  Using a grammar, one can express a wide range of the properties of an input language.  Grammars are particularly great for expressing the <em>syntactical structure</em> of an input, and are the formalism of choice to express nested or recursive inputs.  The grammars we use are so-called <em>context-free grammars</em>, one of the easiest and most popular grammar formalisms.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Rules-and-Expansions">Rules and Expansions</h3><p>A grammar consists of a <em>start symbol</em> and a set of <em>expansion rules</em> (or simply <em>rules</em>) which indicate how the start symbol (and other symbols) can be expanded.  As an example, consider the following grammar, denoting a sequence of two digits:</p>

<pre><code>&lt;start&gt; ::= &lt;digit&gt;&lt;digit&gt;
&lt;digit&gt; ::= 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9</code></pre>
<p>To read such a grammar, start with the start symbol (<code>&lt;start&gt;</code>).  An expansion rule <code>&lt;A&gt; ::= &lt;B&gt;</code> means that the symbol on the left side (<code>&lt;A&gt;</code>) can be replaced by the string on the right side (<code>&lt;B&gt;</code>).  In the above grammar, <code>&lt;start&gt;</code> would be replaced by <code>&lt;digit&gt;&lt;digit&gt;</code>.</p>
<p>In this string again, <code>&lt;digit&gt;</code> would be replaced by the string on the right side of the <code>&lt;digit&gt;</code> rule.  The special operator <code>|</code> denotes <em>expansion alternatives</em> (or simply <em>alternatives</em>), meaning that any of the digits can be chosen for an expansion.  Each <code>&lt;digit&gt;</code> thus would be expanded into one of the given digits, eventually yielding a string between <code>00</code> and <code>99</code>.  There are no further expansions for <code>0</code> to <code>9</code>, so we are all set.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The interesting thing about grammars is that they can be <em>recursive</em>. That is, expansions can make use of symbols expanded earlier – which would then be expanded again.  As an example, consider a grammar that describes integers:</p>

<pre><code>&lt;start&gt;  ::= &lt;integer&gt;
&lt;integer&gt; ::= &lt;digit&gt; | &lt;digit&gt;&lt;integer&gt;
&lt;digit&gt;   ::= 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9</code></pre>
<p>Here, a <code>&lt;integer&gt;</code> is either a single digit, or a digit followed by another integer.  The number <code>1234</code> thus would be represented as a single digit <code>1</code>, followed by the integer <code>234</code>, which in turn is a digit <code>2</code>, followed by the integer <code>34</code>.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>If we wanted to express that an integer can be preceded by a sign (<code>+</code> or <code>-</code>), we would write the grammar as</p>

<pre><code>&lt;start&gt;   ::= &lt;number&gt;
&lt;number&gt;  ::= &lt;integer&gt; | +&lt;integer&gt; | -&lt;integer&gt;
&lt;integer&gt; ::= &lt;digit&gt; | &lt;digit&gt;&lt;integer&gt;
&lt;digit&gt;   ::= 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9</code></pre>
<p>These rules formally define the language: Anything that can be derived from the start symbol is part of the language; anything that cannot is not.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="kn">from</span> <span class="nn"><a href="https://github.com/uds-se/fuzzingbook//tree/master/notebooks/shared/bookutils" class="import" target="_blank">bookutils</a></span> <span class="kn">import</span> <span class="n">quiz</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_html rendered_html output_subarea output_execute_result">

    

    <div class="quiz">
    <h3 class="quiz_title">Quiz</h3>
    <p>
    </p><div class="quiz_question">Which of these strings cannot be produced from the above <code>&lt;start&gt;</code> symbol?</div>
    
    <p>
    </p><div class="quiz_options" title="Check all that apply.">

        <input type="checkbox" name="e1424af2-d3ed-11ef-9634-6298cf1a5790" id="e1424af2-d3ed-11ef-9634-6298cf1a5790-1" onclick="clear_selection('e1424af2-d3ed-11ef-9634-6298cf1a5790')"/>
        <label id="e1424af2-d3ed-11ef-9634-6298cf1a5790-1-label" for="e1424af2-d3ed-11ef-9634-6298cf1a5790-1"><code>007</code></label><br/>

        <input type="checkbox" name="e1424af2-d3ed-11ef-9634-6298cf1a5790" id="e1424af2-d3ed-11ef-9634-6298cf1a5790-2" onclick="clear_selection('e1424af2-d3ed-11ef-9634-6298cf1a5790')"/>
        <label id="e1424af2-d3ed-11ef-9634-6298cf1a5790-2-label" for="e1424af2-d3ed-11ef-9634-6298cf1a5790-2"><code>-42</code></label><br/>

        <input type="checkbox" name="e1424af2-d3ed-11ef-9634-6298cf1a5790" id="e1424af2-d3ed-11ef-9634-6298cf1a5790-3" onclick="clear_selection('e1424af2-d3ed-11ef-9634-6298cf1a5790')"/>
        <label id="e1424af2-d3ed-11ef-9634-6298cf1a5790-3-label" for="e1424af2-d3ed-11ef-9634-6298cf1a5790-3"><code>++1</code></label><br/>

        <input type="checkbox" name="e1424af2-d3ed-11ef-9634-6298cf1a5790" id="e1424af2-d3ed-11ef-9634-6298cf1a5790-4" onclick="clear_selection('e1424af2-d3ed-11ef-9634-6298cf1a5790')"/>
        <label id="e1424af2-d3ed-11ef-9634-6298cf1a5790-4-label" for="e1424af2-d3ed-11ef-9634-6298cf1a5790-4"><code>3.14</code></label><br/>

    </div>
    
    <input id="e1424af2-d3ed-11ef-9634-6298cf1a5790-submit" type="submit" value="Submit" onclick="check_selection('e1424af2-d3ed-11ef-9634-6298cf1a5790', 24, 1, '[27 ** (1/3), 256 ** (1/4)]')"/>
    <span class="quiz_hint" id="e1424af2-d3ed-11ef-9634-6298cf1a5790-hint"/>
    </div>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Arithmetic-Expressions">Arithmetic Expressions</h3><p>Let us expand our grammar to cover full <em>arithmetic expressions</em> – a poster child example for a grammar.  We see that an expression (<code>&lt;expr&gt;</code>) is either a sum, or a difference, or a term; a term is either a product or a division, or a factor; and a factor is either a number or a parenthesized expression.  Almost all rules can have recursion, and thus allow arbitrary complex expressions such as <code>(1 + 2) * (3.4 / 5.6 - 789)</code>.</p>

<pre><code>&lt;start&gt;   ::= &lt;expr&gt;
&lt;expr&gt;    ::= &lt;term&gt; + &lt;expr&gt; | &lt;term&gt; - &lt;expr&gt; | &lt;term&gt;
&lt;term&gt;    ::= &lt;term&gt; * &lt;factor&gt; | &lt;term&gt; / &lt;factor&gt; | &lt;factor&gt;
&lt;factor&gt;  ::= +&lt;factor&gt; | -&lt;factor&gt; | (&lt;expr&gt;) | &lt;integer&gt; | &lt;integer&gt;.&lt;integer&gt;
&lt;integer&gt; ::= &lt;digit&gt;&lt;integer&gt; | &lt;digit&gt;
&lt;digit&gt;   ::= 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9</code></pre>
<p>In such a grammar, if we start with <code>&lt;start&gt;</code> and then expand one symbol after another, randomly choosing alternatives, we can quickly produce one valid arithmetic expression after another.  Such <em>grammar fuzzing</em> is highly effective as it comes to produce complex inputs, and this is what we will implement in this chapter.</p>
</div>
</div>
</div>
</div>

<div class="output_area">

<div class="output_html rendered_html output_subarea output_execute_result">

    

    <div class="quiz">
    <h3 class="quiz_title">Quiz</h3>
    <p>
    </p><div class="quiz_question">Which of these strings cannot be produced from the above <code>&lt;start&gt;</code> symbol?</div>
    
    <p>
    </p><div class="quiz_options" title="Pick a choice.">

        <input type="radio" name="e1433cfa-d3ed-11ef-9634-6298cf1a5790" id="e1433cfa-d3ed-11ef-9634-6298cf1a5790-1" onclick="clear_selection('e1433cfa-d3ed-11ef-9634-6298cf1a5790')"/>
        <label id="e1433cfa-d3ed-11ef-9634-6298cf1a5790-1-label" for="e1433cfa-d3ed-11ef-9634-6298cf1a5790-1"><code>1 + 1</code></label><br/>

        <input type="radio" name="e1433cfa-d3ed-11ef-9634-6298cf1a5790" id="e1433cfa-d3ed-11ef-9634-6298cf1a5790-2" onclick="clear_selection('e1433cfa-d3ed-11ef-9634-6298cf1a5790')"/>
        <label id="e1433cfa-d3ed-11ef-9634-6298cf1a5790-2-label" for="e1433cfa-d3ed-11ef-9634-6298cf1a5790-2"><code>1+1</code></label><br/>

        <input type="radio" name="e1433cfa-d3ed-11ef-9634-6298cf1a5790" id="e1433cfa-d3ed-11ef-9634-6298cf1a5790-3" onclick="clear_selection('e1433cfa-d3ed-11ef-9634-6298cf1a5790')"/>
        <label id="e1433cfa-d3ed-11ef-9634-6298cf1a5790-3-label" for="e1433cfa-d3ed-11ef-9634-6298cf1a5790-3"><code>+1</code></label><br/>

        <input type="radio" name="e1433cfa-d3ed-11ef-9634-6298cf1a5790" id="e1433cfa-d3ed-11ef-9634-6298cf1a5790-4" onclick="clear_selection('e1433cfa-d3ed-11ef-9634-6298cf1a5790')"/>
        <label id="e1433cfa-d3ed-11ef-9634-6298cf1a5790-4-label" for="e1433cfa-d3ed-11ef-9634-6298cf1a5790-4"><code>+(1)</code></label><br/>

    </div>
    
    <input id="e1433cfa-d3ed-11ef-9634-6298cf1a5790-submit" type="submit" value="Submit" onclick="check_selection('e1433cfa-d3ed-11ef-9634-6298cf1a5790', 4, 0, '4 ** 0.5')"/>
    <span class="quiz_hint" id="e1433cfa-d3ed-11ef-9634-6298cf1a5790-hint"/>
    </div>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Representing-Grammars-in-Python">Representing Grammars in Python</h2><p>Our first step in building a grammar fuzzer is to find an appropriate format for grammars.  To make the writing of grammars as simple as possible, we use a format that is based on strings and lists.  Our grammars in Python take the format of a <em>mapping</em> between symbol names and expansions, where expansions are <em>lists</em> of alternatives.  A one-rule grammar for digits thus takes the form</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">DIGIT_GRAMMAR</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"&lt;start&gt;"</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">"0"</span><span class="p">,</span> <span class="s2">"1"</span><span class="p">,</span> <span class="s2">"2"</span><span class="p">,</span> <span class="s2">"3"</span><span class="p">,</span> <span class="s2">"4"</span><span class="p">,</span> <span class="s2">"5"</span><span class="p">,</span> <span class="s2">"6"</span><span class="p">,</span> <span class="s2">"7"</span><span class="p">,</span> <span class="s2">"8"</span><span class="p">,</span> <span class="s2">"9"</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<details id="Excursion:-A-Grammar-Type">
<summary>A <code>Grammar</code> Type</summary>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let us define a type for grammars, such that we can check grammar types statically.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>A first attempt at a grammar type would be that each symbol (a string) is mapped to a list of expansions (strings):</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">SimpleGrammar</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>However, our <code>opts()</code> feature for adding optional attributes, which we will introduce later in this chapter, also allows expansions to be <em>pairs</em> that consist of strings and options, where options are mappings of strings to values:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">Option</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Hence, an expansion is either a string – or a pair of a string and an option.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">Expansion</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Option</span><span class="p">]]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>With this, we can now define a <code>Grammar</code> as a mapping of strings to <code>Expansion</code> lists.</p>
</div>
</div>
</div>
</div>

</details>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We can capture the grammar structure in a <em><code>Grammar</code></em> type, in which each symbol (a string) is mapped to a list of expansions (strings):</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">Grammar</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Expansion</span><span class="p">]]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>With this <code>Grammar</code> type, the full grammar for arithmetic expressions looks like this:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">EXPR_GRAMMAR</span><span class="p">:</span> <span class="n">Grammar</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"&lt;start&gt;"</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">"&lt;expr&gt;"</span><span class="p">],</span>

    <span class="s2">"&lt;expr&gt;"</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">"&lt;term&gt; + &lt;expr&gt;"</span><span class="p">,</span> <span class="s2">"&lt;term&gt; - &lt;expr&gt;"</span><span class="p">,</span> <span class="s2">"&lt;term&gt;"</span><span class="p">],</span>

    <span class="s2">"&lt;term&gt;"</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">"&lt;factor&gt; * &lt;term&gt;"</span><span class="p">,</span> <span class="s2">"&lt;factor&gt; / &lt;term&gt;"</span><span class="p">,</span> <span class="s2">"&lt;factor&gt;"</span><span class="p">],</span>

    <span class="s2">"&lt;factor&gt;"</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">"+&lt;factor&gt;"</span><span class="p">,</span>
         <span class="s2">"-&lt;factor&gt;"</span><span class="p">,</span>
         <span class="s2">"(&lt;expr&gt;)"</span><span class="p">,</span>
         <span class="s2">"&lt;integer&gt;.&lt;integer&gt;"</span><span class="p">,</span>
         <span class="s2">"&lt;integer&gt;"</span><span class="p">],</span>

    <span class="s2">"&lt;integer&gt;"</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">"&lt;digit&gt;&lt;integer&gt;"</span><span class="p">,</span> <span class="s2">"&lt;digit&gt;"</span><span class="p">],</span>

    <span class="s2">"&lt;digit&gt;"</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">"0"</span><span class="p">,</span> <span class="s2">"1"</span><span class="p">,</span> <span class="s2">"2"</span><span class="p">,</span> <span class="s2">"3"</span><span class="p">,</span> <span class="s2">"4"</span><span class="p">,</span> <span class="s2">"5"</span><span class="p">,</span> <span class="s2">"6"</span><span class="p">,</span> <span class="s2">"7"</span><span class="p">,</span> <span class="s2">"8"</span><span class="p">,</span> <span class="s2">"9"</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>In the grammar, every symbol can be defined exactly once.  We can access any rule by its symbol...</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">EXPR_GRAMMAR</span><span class="p">[</span><span class="s2">"&lt;digit&gt;"</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>['0', '1', '2', '3', '4', '5', '6', '7', '8', '9']
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>....and we can check whether a symbol is in the grammar:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="s2">"&lt;identifier&gt;"</span> <span class="ow">in</span> <span class="n">EXPR_GRAMMAR</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>False
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Note that we assume that on the left-hand side of a rule (i.e., the key in the mapping) is always a single symbol.  This is the property that gives our grammars the characterization of <em>context-free</em>.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Some-Definitions">Some Definitions</h2></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We assume that the canonical start symbol is <code>&lt;start&gt;</code>:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">START_SYMBOL</span> <span class="o">=</span> <span class="s2">"&lt;start&gt;"</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The handy <code>nonterminals()</code> function extracts the list of nonterminal symbols (i.e., anything between <code>&lt;</code> and <code>&gt;</code>, except spaces) from an expansion.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/re.html" class="import" target="_blank">re</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">RE_NONTERMINAL</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">'(&lt;[^&lt;&gt; ]*&gt;)'</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">nonterminals</span><span class="p">(</span><span class="n">expansion</span><span class="p">):</span>
    <span class="c1"># In later chapters, we allow expansions to be tuples,</span>
    <span class="c1"># with the expansion being the first element</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expansion</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="n">expansion</span> <span class="o">=</span> <span class="n">expansion</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">RE_NONTERMINAL</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">expansion</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">assert</span> <span class="n">nonterminals</span><span class="p">(</span><span class="s2">"&lt;term&gt; * &lt;factor&gt;"</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="s2">"&lt;term&gt;"</span><span class="p">,</span> <span class="s2">"&lt;factor&gt;"</span><span class="p">]</span>
<span class="k">assert</span> <span class="n">nonterminals</span><span class="p">(</span><span class="s2">"&lt;digit&gt;&lt;integer&gt;"</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="s2">"&lt;digit&gt;"</span><span class="p">,</span> <span class="s2">"&lt;integer&gt;"</span><span class="p">]</span>
<span class="k">assert</span> <span class="n">nonterminals</span><span class="p">(</span><span class="s2">"1 &lt; 3 &gt; 2"</span><span class="p">)</span> <span class="o">==</span> <span class="p">[]</span>
<span class="k">assert</span> <span class="n">nonterminals</span><span class="p">(</span><span class="s2">"1 &lt;3&gt; 2"</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="s2">"&lt;3&gt;"</span><span class="p">]</span>
<span class="k">assert</span> <span class="n">nonterminals</span><span class="p">(</span><span class="s2">"1 + 2"</span><span class="p">)</span> <span class="o">==</span> <span class="p">[]</span>
<span class="k">assert</span> <span class="n">nonterminals</span><span class="p">((</span><span class="s2">"&lt;1&gt;"</span><span class="p">,</span> <span class="p">{</span><span class="s1">'option'</span><span class="p">:</span> <span class="s1">'value'</span><span class="p">}))</span> <span class="o">==</span> <span class="p">[</span><span class="s2">"&lt;1&gt;"</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Likewise, <code>is_nonterminal()</code> checks whether some symbol is a nonterminal:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">is_nonterminal</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">RE_NONTERMINAL</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">assert</span> <span class="n">is_nonterminal</span><span class="p">(</span><span class="s2">"&lt;abc&gt;"</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">is_nonterminal</span><span class="p">(</span><span class="s2">"&lt;symbol-1&gt;"</span><span class="p">)</span>
<span class="k">assert</span> <span class="ow">not</span> <span class="n">is_nonterminal</span><span class="p">(</span><span class="s2">"+"</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="A-Simple-Grammar-Fuzzer">A Simple Grammar Fuzzer</h2><p>Let us now put the above grammars to use.  We will build a very simple grammar fuzzer that starts with a start symbol (<code>&lt;start&gt;</code>) and then keeps on expanding it.  To avoid expansion to infinite inputs, we place a limit (<code>max_nonterminals</code>) on the number of nonterminals.  Furthermore, to avoid being stuck in a situation where we cannot reduce the number of symbols any further, we also limit the total number of expansion steps.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/random.html" class="import" target="_blank">random</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">ExpansionError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">simple_grammar_fuzzer</span><span class="p">(</span><span class="n">grammar</span><span class="p">:</span> <span class="n">Grammar</span><span class="p">,</span> 
                          <span class="n">start_symbol</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">START_SYMBOL</span><span class="p">,</span>
                          <span class="n">max_nonterminals</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
                          <span class="n">max_expansion_trials</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
                          <span class="n">log</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Produce a string from `grammar`.</span>
<span class="sd">       `start_symbol`: use a start symbol other than `&lt;start&gt;` (default).</span>
<span class="sd">       `max_nonterminals`: the maximum number of nonterminals </span>
<span class="sd">         still left for expansion</span>
<span class="sd">       `max_expansion_trials`: maximum # of attempts to produce a string</span>
<span class="sd">       `log`: print expansion progress if True"""</span>

    <span class="n">term</span> <span class="o">=</span> <span class="n">start_symbol</span>
    <span class="n">expansion_trials</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">nonterminals</span><span class="p">(</span><span class="n">term</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">symbol_to_expand</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">nonterminals</span><span class="p">(</span><span class="n">term</span><span class="p">))</span>
        <span class="n">expansions</span> <span class="o">=</span> <span class="n">grammar</span><span class="p">[</span><span class="n">symbol_to_expand</span><span class="p">]</span>
        <span class="n">expansion</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">expansions</span><span class="p">)</span>
        <span class="c1"># In later chapters, we allow expansions to be tuples,</span>
        <span class="c1"># with the expansion being the first element</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expansion</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">expansion</span> <span class="o">=</span> <span class="n">expansion</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">new_term</span> <span class="o">=</span> <span class="n">term</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">symbol_to_expand</span><span class="p">,</span> <span class="n">expansion</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nonterminals</span><span class="p">(</span><span class="n">new_term</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">max_nonterminals</span><span class="p">:</span>
            <span class="n">term</span> <span class="o">=</span> <span class="n">new_term</span>
            <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="si">%-40s</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="n">symbol_to_expand</span> <span class="o">+</span> <span class="s2">" -&gt; "</span> <span class="o">+</span> <span class="n">expansion</span><span class="p">),</span> <span class="n">term</span><span class="p">)</span>
            <span class="n">expansion_trials</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">expansion_trials</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">expansion_trials</span> <span class="o">&gt;=</span> <span class="n">max_expansion_trials</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ExpansionError</span><span class="p">(</span><span class="s2">"Cannot expand "</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">term</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">term</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let us see how this simple grammar fuzzer obtains an arithmetic expression from the start symbol:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">simple_grammar_fuzzer</span><span class="p">(</span><span class="n">grammar</span><span class="o">=</span><span class="n">EXPR_GRAMMAR</span><span class="p">,</span> <span class="n">max_nonterminals</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;start&gt; -&gt; &lt;expr&gt;                        &lt;expr&gt;
&lt;expr&gt; -&gt; &lt;term&gt; + &lt;expr&gt;                &lt;term&gt; + &lt;expr&gt;
&lt;term&gt; -&gt; &lt;factor&gt;                       &lt;factor&gt; + &lt;expr&gt;
&lt;factor&gt; -&gt; &lt;integer&gt;                    &lt;integer&gt; + &lt;expr&gt;
&lt;integer&gt; -&gt; &lt;digit&gt;                     &lt;digit&gt; + &lt;expr&gt;
&lt;digit&gt; -&gt; 6                             6 + &lt;expr&gt;
&lt;expr&gt; -&gt; &lt;term&gt; - &lt;expr&gt;                6 + &lt;term&gt; - &lt;expr&gt;
&lt;expr&gt; -&gt; &lt;term&gt;                         6 + &lt;term&gt; - &lt;term&gt;
&lt;term&gt; -&gt; &lt;factor&gt;                       6 + &lt;factor&gt; - &lt;term&gt;
&lt;factor&gt; -&gt; -&lt;factor&gt;                    6 + -&lt;factor&gt; - &lt;term&gt;
&lt;term&gt; -&gt; &lt;factor&gt;                       6 + -&lt;factor&gt; - &lt;factor&gt;
&lt;factor&gt; -&gt; (&lt;expr&gt;)                     6 + -(&lt;expr&gt;) - &lt;factor&gt;
&lt;factor&gt; -&gt; (&lt;expr&gt;)                     6 + -(&lt;expr&gt;) - (&lt;expr&gt;)
&lt;expr&gt; -&gt; &lt;term&gt;                         6 + -(&lt;term&gt;) - (&lt;expr&gt;)
&lt;expr&gt; -&gt; &lt;term&gt;                         6 + -(&lt;term&gt;) - (&lt;term&gt;)
&lt;term&gt; -&gt; &lt;factor&gt;                       6 + -(&lt;factor&gt;) - (&lt;term&gt;)
&lt;factor&gt; -&gt; +&lt;factor&gt;                    6 + -(+&lt;factor&gt;) - (&lt;term&gt;)
&lt;factor&gt; -&gt; +&lt;factor&gt;                    6 + -(++&lt;factor&gt;) - (&lt;term&gt;)
&lt;term&gt; -&gt; &lt;factor&gt;                       6 + -(++&lt;factor&gt;) - (&lt;factor&gt;)
&lt;factor&gt; -&gt; (&lt;expr&gt;)                     6 + -(++(&lt;expr&gt;)) - (&lt;factor&gt;)
&lt;factor&gt; -&gt; &lt;integer&gt;                    6 + -(++(&lt;expr&gt;)) - (&lt;integer&gt;)
&lt;expr&gt; -&gt; &lt;term&gt;                         6 + -(++(&lt;term&gt;)) - (&lt;integer&gt;)
&lt;integer&gt; -&gt; &lt;digit&gt;                     6 + -(++(&lt;term&gt;)) - (&lt;digit&gt;)
&lt;digit&gt; -&gt; 9                             6 + -(++(&lt;term&gt;)) - (9)
&lt;term&gt; -&gt; &lt;factor&gt; * &lt;term&gt;              6 + -(++(&lt;factor&gt; * &lt;term&gt;)) - (9)
&lt;term&gt; -&gt; &lt;factor&gt;                       6 + -(++(&lt;factor&gt; * &lt;factor&gt;)) - (9)
&lt;factor&gt; -&gt; &lt;integer&gt;                    6 + -(++(&lt;integer&gt; * &lt;factor&gt;)) - (9)
&lt;integer&gt; -&gt; &lt;digit&gt;                     6 + -(++(&lt;digit&gt; * &lt;factor&gt;)) - (9)
&lt;digit&gt; -&gt; 2                             6 + -(++(2 * &lt;factor&gt;)) - (9)
&lt;factor&gt; -&gt; +&lt;factor&gt;                    6 + -(++(2 * +&lt;factor&gt;)) - (9)
&lt;factor&gt; -&gt; -&lt;factor&gt;                    6 + -(++(2 * +-&lt;factor&gt;)) - (9)
&lt;factor&gt; -&gt; -&lt;factor&gt;                    6 + -(++(2 * +--&lt;factor&gt;)) - (9)
&lt;factor&gt; -&gt; -&lt;factor&gt;                    6 + -(++(2 * +---&lt;factor&gt;)) - (9)
&lt;factor&gt; -&gt; -&lt;factor&gt;                    6 + -(++(2 * +----&lt;factor&gt;)) - (9)
&lt;factor&gt; -&gt; &lt;integer&gt;.&lt;integer&gt;          6 + -(++(2 * +----&lt;integer&gt;.&lt;integer&gt;)) - (9)
&lt;integer&gt; -&gt; &lt;digit&gt;                     6 + -(++(2 * +----&lt;digit&gt;.&lt;integer&gt;)) - (9)
&lt;integer&gt; -&gt; &lt;digit&gt;                     6 + -(++(2 * +----&lt;digit&gt;.&lt;digit&gt;)) - (9)
&lt;digit&gt; -&gt; 1                             6 + -(++(2 * +----1.&lt;digit&gt;)) - (9)
&lt;digit&gt; -&gt; 7                             6 + -(++(2 * +----1.7)) - (9)
</pre>
</div>

</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>'6 + -(++(2 * +----1.7)) - (9)'
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>By increasing the limit of nonterminals, we can quickly get much longer productions:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">simple_grammar_fuzzer</span><span class="p">(</span><span class="n">grammar</span><span class="o">=</span><span class="n">EXPR_GRAMMAR</span><span class="p">,</span> <span class="n">max_nonterminals</span><span class="o">=</span><span class="mi">5</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>7 / +48.5
-5.9 / 9 - 4 * +-(-+++((1 + (+7 - (-1 * (++-+7.7 - -+-4.0))))) * +--4 - -(6) + 64)
8.2 - 27 - -9 / +((+9 * --2 + --+-+-((-1 * +(8 - 5 - 6)) * (-((-+(((+(4))))) - ++4) / +(-+---((5.6 - --(3 * -1.8 * +(6 * +-(((-(-6) * ---+6)) / +--(+-+-7 * (-0 * (+(((((2)) + 8 - 3 - ++9.0 + ---(--+7 / (1 / +++6.37) + (1) / 482) / +++-+0)))) * -+5 + 7.513)))) - (+1 / ++((-84)))))))) * ++5 / +-(--2 - -++-9.0)))) / 5 * --++090
1 - -3 * 7 - 28 / 9
(+9) * +-5 * ++-926.2 - (+9.03 / -+(-(-6) / 2 * +(-+--(8) / -(+1.0) - 5 + 4)) * 3.5)
8 + -(9.6 - 3 - -+-4 * +77)
-(((((++((((+((++++-((+-37))))))))))))) / ++(-(+++(+6)) * -++-(+(++(---6 * (((7)) * (1) / (-7.6 * 535338) + +256) * 0) * 0))) - 4 + +1
5.43
(9 / -405 / -23 - +-((+-(2 * (13))))) + +6 - +8 - 934
-++2 - (--+715769550) / 8 / (1)
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Note that while our fuzzer does the job in most cases, it has a number of drawbacks.</p>
</div>
</div>
</div>
</div>

<div class="output_area">

<div class="output_html rendered_html output_subarea output_execute_result">

    

    <div class="quiz">
    <h3 class="quiz_title">Quiz</h3>
    <p>
    </p><div class="quiz_question">What drawbacks does <code>simple_grammar_fuzzer()</code> have?</div>
    
    <p>
    </p><div class="quiz_options" title="Pick a choice.">

        <input type="radio" name="e1505106-d3ed-11ef-9634-6298cf1a5790" id="e1505106-d3ed-11ef-9634-6298cf1a5790-1" onclick="clear_selection('e1505106-d3ed-11ef-9634-6298cf1a5790')"/>
        <label id="e1505106-d3ed-11ef-9634-6298cf1a5790-1-label" for="e1505106-d3ed-11ef-9634-6298cf1a5790-1">It has a large number of string search and replace operations</label><br/>

        <input type="radio" name="e1505106-d3ed-11ef-9634-6298cf1a5790" id="e1505106-d3ed-11ef-9634-6298cf1a5790-2" onclick="clear_selection('e1505106-d3ed-11ef-9634-6298cf1a5790')"/>
        <label id="e1505106-d3ed-11ef-9634-6298cf1a5790-2-label" for="e1505106-d3ed-11ef-9634-6298cf1a5790-2">It may fail to produce a string (<code>ExpansionError</code>)</label><br/>

        <input type="radio" name="e1505106-d3ed-11ef-9634-6298cf1a5790" id="e1505106-d3ed-11ef-9634-6298cf1a5790-3" onclick="clear_selection('e1505106-d3ed-11ef-9634-6298cf1a5790')"/>
        <label id="e1505106-d3ed-11ef-9634-6298cf1a5790-3-label" for="e1505106-d3ed-11ef-9634-6298cf1a5790-3">It often picks some symbol to expand that does not even occur in the string</label><br/>

        <input type="radio" name="e1505106-d3ed-11ef-9634-6298cf1a5790" id="e1505106-d3ed-11ef-9634-6298cf1a5790-4" onclick="clear_selection('e1505106-d3ed-11ef-9634-6298cf1a5790')"/>
        <label id="e1505106-d3ed-11ef-9634-6298cf1a5790-4-label" for="e1505106-d3ed-11ef-9634-6298cf1a5790-4">All of the above</label><br/>

    </div>
    
    <input id="e1505106-d3ed-11ef-9634-6298cf1a5790-submit" type="submit" value="Submit" onclick="check_selection('e1505106-d3ed-11ef-9634-6298cf1a5790', 16, 0, '1 &lt;&lt; 2')"/>
    <span class="quiz_hint" id="e1505106-d3ed-11ef-9634-6298cf1a5790-hint"/>
    </div>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Indeed, <code>simple_grammar_fuzzer()</code> is rather inefficient due to the large number of search and replace operations, and it may even fail to produce a string. On the other hand, the implementation is straightforward and does the job in most cases. For this chapter, we'll stick to it; in the <a href="GrammarFuzzer.html">next chapter</a>, we'll show how to build a more efficient one.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Visualizing-Grammars-as-Railroad-Diagrams">Visualizing Grammars as Railroad Diagrams</h2></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>With grammars, we can easily specify the format for several of the examples we discussed earlier.  The above arithmetic expressions, for instance, can be directly sent into <code>bc</code> (or any other program that takes arithmetic expressions).  Before we introduce a few additional grammars, let us give a means to <em>visualize</em> them, giving an alternate view to aid their understanding.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p><em>Railroad diagrams</em>, also called <em>syntax diagrams</em>, are a graphical representation of context-free grammars.  They are read left to right, following possible "rail" tracks; the sequence of symbols encountered on the track defines the language. To produce railroad diagrams, we implement a function <code>syntax_diagram()</code>.</p>
</div>
</div>
</div>
</div>

<details id="Excursion:-Implementing-syntax_diagram()">
<summary>Implementing <code>syntax_diagram()</code></summary>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We use <a href="RailroadDiagrams.html">RailroadDiagrams</a>, an external library for visualization.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="kn">from</span> <span class="nn"><a href="RailroadDiagrams.html" class="import" target="_blank">RailroadDiagrams</a></span> <span class="kn">import</span> <span class="n">NonTerminal</span><span class="p">,</span> <span class="n">Terminal</span><span class="p">,</span> <span class="n">Choice</span><span class="p">,</span> <span class="n">HorizontalChoice</span><span class="p">,</span> <span class="n">Sequence</span>
<span class="kn">from</span> <span class="nn"><a href="RailroadDiagrams.html" class="import" target="_blank">RailroadDiagrams</a></span> <span class="kn">import</span> <span class="n">show_diagram</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="kn">from</span> <span class="nn"><a href="https://ipython.readthedocs.io/en/stable/api/generated/IPython.display.html" class="import" target="_blank">IPython.display</a></span> <span class="kn">import</span> <span class="n">SVG</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We first define the method <code>syntax_diagram_symbol()</code> to visualize a given symbol.  Terminal symbols are denoted as ovals, whereas nonterminal symbols (such as <code>&lt;term&gt;</code>) are denoted as rectangles.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">syntax_diagram_symbol</span><span class="p">(</span><span class="n">symbol</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">is_nonterminal</span><span class="p">(</span><span class="n">symbol</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">NonTerminal</span><span class="p">(</span><span class="n">symbol</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Terminal</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">SVG</span><span class="p">(</span><span class="n">show_diagram</span><span class="p">(</span><span class="n">syntax_diagram_symbol</span><span class="p">(</span><span class="s1">'&lt;term&gt;'</span><span class="p">)))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_svg output_subarea output_execute_result">
<svg class="railroad-diagram" height="62" viewbox="0 0 154.0 62" width="154.0">
<g transform="translate(.5 .5)">
<style>/* &amp;lt;![CDATA[ */
    svg.railroad-diagram {
    }
    svg.railroad-diagram path {
        stroke-width:3;
        stroke:black;
        fill:white;
    }
    svg.railroad-diagram text {
        font:14px "Fira Mono", monospace;
        text-anchor:middle;
    }
    svg.railroad-diagram text.label{
        text-anchor:start;
    }
    svg.railroad-diagram text.comment{
        font:italic 12px "Fira Mono", monospace;
    }
    svg.railroad-diagram rect{
        stroke-width:2;
        stroke:black;
        fill:mistyrose;
    }

/* ]]&amp;gt; */
</style><g>
<path d="M20 21v20m10 -20v20m-10 -10h20"/></g><path d="M40 31h10"/><g class="non-terminal">
<path d="M50 31h0.0"/><path d="M104.0 31h0.0"/><rect height="22" width="54.0" x="50.0" y="20"/><text x="77.0" y="35">term</text></g><path d="M104.0 31h10"/><path d="M 114.0 31 h 20 m -10 -10 v 20 m 10 -20 v 20"/></g></svg>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We define <code>syntax_diagram_expr()</code> to visualize expansion alternatives.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">syntax_diagram_expr</span><span class="p">(</span><span class="n">expansion</span><span class="p">:</span> <span class="n">Expansion</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
    <span class="c1"># In later chapters, we allow expansions to be tuples,</span>
    <span class="c1"># with the expansion being the first element</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expansion</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="n">expansion</span> <span class="o">=</span> <span class="n">expansion</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">symbols</span> <span class="o">=</span> <span class="p">[</span><span class="n">sym</span> <span class="k">for</span> <span class="n">sym</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">RE_NONTERMINAL</span><span class="p">,</span> <span class="n">expansion</span><span class="p">)</span> <span class="k">if</span> <span class="n">sym</span> <span class="o">!=</span> <span class="s2">""</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">symbols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">symbols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">""</span><span class="p">]</span>  <span class="c1"># special case: empty expansion</span>

    <span class="k">return</span> <span class="n">Sequence</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">syntax_diagram_symbol</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span> <span class="k">for</span> <span class="n">sym</span> <span class="ow">in</span> <span class="n">symbols</span><span class="p">])</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">SVG</span><span class="p">(</span><span class="n">show_diagram</span><span class="p">(</span><span class="n">syntax_diagram_expr</span><span class="p">(</span><span class="n">EXPR_GRAMMAR</span><span class="p">[</span><span class="s1">'&lt;term&gt;'</span><span class="p">][</span><span class="mi">0</span><span class="p">])))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_svg output_subarea output_execute_result">
<svg class="railroad-diagram" height="62" viewbox="0 0 310.5 62" width="310.5">
<g transform="translate(.5 .5)">
<style>/* &amp;lt;![CDATA[ */
    svg.railroad-diagram {
    }
    svg.railroad-diagram path {
        stroke-width:3;
        stroke:black;
        fill:white;
    }
    svg.railroad-diagram text {
        font:14px "Fira Mono", monospace;
        text-anchor:middle;
    }
    svg.railroad-diagram text.label{
        text-anchor:start;
    }
    svg.railroad-diagram text.comment{
        font:italic 12px "Fira Mono", monospace;
    }
    svg.railroad-diagram rect{
        stroke-width:2;
        stroke:black;
        fill:mistyrose;
    }

/* ]]&amp;gt; */
</style><g>
<path d="M20 21v20m10 -20v20m-10 -10h20"/></g><path d="M40 31h10"/><g>
<path d="M50 31h0.0"/><path d="M260.5 31h0.0"/><g class="non-terminal">
<path d="M50.0 31h0.0"/><path d="M121.0 31h0.0"/><rect height="22" width="71.0" x="50.0" y="20"/><text x="85.5" y="35">factor</text></g><path d="M121.0 31h10"/><path d="M131.0 31h10"/><g class="terminal">
<path d="M141.0 31h0.0"/><path d="M186.5 31h0.0"/><rect height="22" rx="10" ry="10" width="45.5" x="141.0" y="20"/><text x="163.75" y="35"> * </text></g><path d="M186.5 31h10"/><path d="M196.5 31h10"/><g class="non-terminal">
<path d="M206.5 31h0.0"/><path d="M260.5 31h0.0"/><rect height="22" width="54.0" x="206.5" y="20"/><text x="233.5" y="35">term</text></g></g><path d="M260.5 31h10"/><path d="M 270.5 31 h 20 m -10 -10 v 20 m 10 -20 v 20"/></g></svg>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>This is the first alternative of <code>&lt;term&gt;</code> – a <code>&lt;factor&gt;</code> followed by <code>*</code> and a <code>&lt;term&gt;</code>.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Next, we define <code>syntax_diagram_alt()</code> for displaying alternate expressions.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="kn">from</span> <span class="nn"><a href="https://docs.python.org/3/library/itertools.html" class="import" target="_blank">itertools</a></span> <span class="kn">import</span> <span class="n">zip_longest</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">syntax_diagram_alt</span><span class="p">(</span><span class="n">alt</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Expansion</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
    <span class="n">max_len</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">alt_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">alt</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">alt_len</span> <span class="o">&gt;</span> <span class="n">max_len</span><span class="p">:</span>
        <span class="n">iter_len</span> <span class="o">=</span> <span class="n">alt_len</span> <span class="o">//</span> <span class="n">max_len</span>
        <span class="n">alts</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">zip_longest</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">alt</span><span class="p">[</span><span class="n">i</span><span class="p">::</span><span class="n">iter_len</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iter_len</span><span class="p">)]))</span>
        <span class="n">exprs</span> <span class="o">=</span> <span class="p">[[</span><span class="n">syntax_diagram_expr</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span> <span class="k">for</span> <span class="n">expr</span> <span class="ow">in</span> <span class="n">alt</span>
                  <span class="k">if</span> <span class="n">expr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span> <span class="k">for</span> <span class="n">alt</span> <span class="ow">in</span> <span class="n">alts</span><span class="p">]</span>
        <span class="n">choices</span> <span class="o">=</span> <span class="p">[</span><span class="n">Choice</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="o">*</span><span class="n">expr</span><span class="p">)</span> <span class="k">for</span> <span class="n">expr</span> <span class="ow">in</span> <span class="n">exprs</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">HorizontalChoice</span><span class="p">(</span><span class="o">*</span><span class="n">choices</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Choice</span><span class="p">(</span><span class="n">alt_len</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="o">*</span><span class="p">[</span><span class="n">syntax_diagram_expr</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span> <span class="k">for</span> <span class="n">expr</span> <span class="ow">in</span> <span class="n">alt</span><span class="p">])</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">SVG</span><span class="p">(</span><span class="n">show_diagram</span><span class="p">(</span><span class="n">syntax_diagram_alt</span><span class="p">(</span><span class="n">EXPR_GRAMMAR</span><span class="p">[</span><span class="s1">'&lt;digit&gt;'</span><span class="p">])))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_svg output_subarea output_execute_result">
<svg class="railroad-diagram" height="109" viewbox="0 0 522.5 109" width="522.5">
<g transform="translate(.5 .5)">
<style>/* &amp;lt;![CDATA[ */
    svg.railroad-diagram {
    }
    svg.railroad-diagram path {
        stroke-width:3;
        stroke:black;
        fill:white;
    }
    svg.railroad-diagram text {
        font:14px "Fira Mono", monospace;
        text-anchor:middle;
    }
    svg.railroad-diagram text.label{
        text-anchor:start;
    }
    svg.railroad-diagram text.comment{
        font:italic 12px "Fira Mono", monospace;
    }
    svg.railroad-diagram rect{
        stroke-width:2;
        stroke:black;
        fill:mistyrose;
    }

/* ]]&amp;gt; */
</style><g>
<path d="M20 59v20m10 -20v20m-10 -10h20"/></g><g>
<path d="M40 69h0.0"/><path d="M482.5 69h0.0"/><path d="M40.0 69a10 10 0 0 0 10 -10v-29a10 10 0 0 1 10 -10h324.0"/><path d="M138.5 89h324.0a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10"/><path d="M40.0 69h10"/><g>
<path d="M50.0 69h0.0"/><path d="M118.5 69h0.0"/><path d="M50.0 69a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/><g>
<path d="M70.0 39h0.0"/><path d="M98.5 39h0.0"/><g class="terminal">
<path d="M70.0 39h0.0"/><path d="M98.5 39h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="70.0" y="28"/><text x="84.25" y="43">0</text></g></g><path d="M98.5 39a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><path d="M50.0 69h20"/><g>
<path d="M70.0 69h0.0"/><path d="M98.5 69h0.0"/><g class="terminal">
<path d="M70.0 69h0.0"/><path d="M98.5 69h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="70.0" y="58"/><text x="84.25" y="73">1</text></g></g><path d="M98.5 69h20"/></g><path d="M118.5 69a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10"/><path d="M118.5 20a10 10 0 0 1 10 10v29a10 10 0 0 0 10 10"/><g>
<path d="M138.5 69h0.0"/><path d="M207.0 69h0.0"/><path d="M138.5 69a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/><g>
<path d="M158.5 39h0.0"/><path d="M187.0 39h0.0"/><g class="terminal">
<path d="M158.5 39h0.0"/><path d="M187.0 39h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="158.5" y="28"/><text x="172.75" y="43">2</text></g></g><path d="M187.0 39a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><path d="M138.5 69h20"/><g>
<path d="M158.5 69h0.0"/><path d="M187.0 69h0.0"/><g class="terminal">
<path d="M158.5 69h0.0"/><path d="M187.0 69h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="158.5" y="58"/><text x="172.75" y="73">3</text></g></g><path d="M187.0 69h20"/></g><path d="M207.0 69a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10"/><path d="M207.0 20a10 10 0 0 1 10 10v29a10 10 0 0 0 10 10"/><g>
<path d="M227.0 69h0.0"/><path d="M295.5 69h0.0"/><path d="M227.0 69a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/><g>
<path d="M247.0 39h0.0"/><path d="M275.5 39h0.0"/><g class="terminal">
<path d="M247.0 39h0.0"/><path d="M275.5 39h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="247.0" y="28"/><text x="261.25" y="43">4</text></g></g><path d="M275.5 39a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><path d="M227.0 69h20"/><g>
<path d="M247.0 69h0.0"/><path d="M275.5 69h0.0"/><g class="terminal">
<path d="M247.0 69h0.0"/><path d="M275.5 69h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="247.0" y="58"/><text x="261.25" y="73">5</text></g></g><path d="M275.5 69h20"/></g><path d="M295.5 69a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10"/><path d="M295.5 20a10 10 0 0 1 10 10v29a10 10 0 0 0 10 10"/><g>
<path d="M315.5 69h0.0"/><path d="M384.0 69h0.0"/><path d="M315.5 69a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/><g>
<path d="M335.5 39h0.0"/><path d="M364.0 39h0.0"/><g class="terminal">
<path d="M335.5 39h0.0"/><path d="M364.0 39h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="335.5" y="28"/><text x="349.75" y="43">6</text></g></g><path d="M364.0 39a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><path d="M315.5 69h20"/><g>
<path d="M335.5 69h0.0"/><path d="M364.0 69h0.0"/><g class="terminal">
<path d="M335.5 69h0.0"/><path d="M364.0 69h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="335.5" y="58"/><text x="349.75" y="73">7</text></g></g><path d="M364.0 69h20"/></g><path d="M384.0 69a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10"/><path d="M384.0 20a10 10 0 0 1 10 10v29a10 10 0 0 0 10 10"/><g>
<path d="M404.0 69h0.0"/><path d="M472.5 69h0.0"/><path d="M404.0 69a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/><g>
<path d="M424.0 39h0.0"/><path d="M452.5 39h0.0"/><g class="terminal">
<path d="M424.0 39h0.0"/><path d="M452.5 39h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="424.0" y="28"/><text x="438.25" y="43">8</text></g></g><path d="M452.5 39a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><path d="M404.0 69h20"/><g>
<path d="M424.0 69h0.0"/><path d="M452.5 69h0.0"/><g class="terminal">
<path d="M424.0 69h0.0"/><path d="M452.5 69h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="424.0" y="58"/><text x="438.25" y="73">9</text></g></g><path d="M452.5 69h20"/></g><path d="M472.5 69h10"/></g><path d="M 482.5 69 h 20 m -10 -10 v 20 m 10 -20 v 20"/></g></svg>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We see that a <code>&lt;digit&gt;</code> can be any single digit from <code>0</code> to <code>9</code>.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Finally, we define <code>syntax_diagram()</code> which given a grammar, displays the syntax diagram of its rules.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">syntax_diagram</span><span class="p">(</span><span class="n">grammar</span><span class="p">:</span> <span class="n">Grammar</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn"><a href="https://ipython.readthedocs.io/en/stable/api/generated/IPython.display.html" class="import" target="_blank">IPython.display</a></span> <span class="kn">import</span> <span class="n">SVG</span><span class="p">,</span> <span class="n">display</span>

    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">grammar</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">display</span><span class="p">(</span><span class="n">SVG</span><span class="p">(</span><span class="n">show_diagram</span><span class="p">(</span><span class="n">syntax_diagram_alt</span><span class="p">(</span><span class="n">grammar</span><span class="p">[</span><span class="n">key</span><span class="p">]))))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

</details>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let us use <code>syntax_diagram()</code> to produce a railroad diagram of our expression grammar:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">syntax_diagram</span><span class="p">(</span><span class="n">EXPR_GRAMMAR</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>start
</pre>
</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<svg class="railroad-diagram" height="62" viewbox="0 0 174.0 62" width="174.0">
<g transform="translate(.5 .5)">
<style>/* &amp;lt;![CDATA[ */
    svg.railroad-diagram {
    }
    svg.railroad-diagram path {
        stroke-width:3;
        stroke:black;
        fill:white;
    }
    svg.railroad-diagram text {
        font:14px "Fira Mono", monospace;
        text-anchor:middle;
    }
    svg.railroad-diagram text.label{
        text-anchor:start;
    }
    svg.railroad-diagram text.comment{
        font:italic 12px "Fira Mono", monospace;
    }
    svg.railroad-diagram rect{
        stroke-width:2;
        stroke:black;
        fill:mistyrose;
    }

/* ]]&amp;gt; */
</style><g>
<path d="M20 21v20m10 -20v20m-10 -10h20"/></g><g>
<path d="M40 31h0.0"/><path d="M134.0 31h0.0"/><path d="M40.0 31h20"/><g>
<path d="M60.0 31h0.0"/><path d="M114.0 31h0.0"/><g class="non-terminal">
<path d="M60.0 31h0.0"/><path d="M114.0 31h0.0"/><rect height="22" width="54.0" x="60.0" y="20"/><text x="87.0" y="35">expr</text></g></g><path d="M114.0 31h20"/></g><path d="M 134.0 31 h 20 m -10 -10 v 20 m 10 -20 v 20"/></g></svg>

</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>expr
</pre>
</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<svg class="railroad-diagram" height="122" viewbox="0 0 313.5 122" width="313.5">
<g transform="translate(.5 .5)">
<style>/* &amp;lt;![CDATA[ */
    svg.railroad-diagram {
    }
    svg.railroad-diagram path {
        stroke-width:3;
        stroke:black;
        fill:white;
    }
    svg.railroad-diagram text {
        font:14px "Fira Mono", monospace;
        text-anchor:middle;
    }
    svg.railroad-diagram text.label{
        text-anchor:start;
    }
    svg.railroad-diagram text.comment{
        font:italic 12px "Fira Mono", monospace;
    }
    svg.railroad-diagram rect{
        stroke-width:2;
        stroke:black;
        fill:mistyrose;
    }

/* ]]&amp;gt; */
</style><g>
<path d="M20 51v20m10 -20v20m-10 -10h20"/></g><g>
<path d="M40 61h0.0"/><path d="M273.5 61h0.0"/><path d="M40.0 61a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/><g>
<path d="M60.0 31h0.0"/><path d="M253.5 31h0.0"/><g class="non-terminal">
<path d="M60.0 31h0.0"/><path d="M114.0 31h0.0"/><rect height="22" width="54.0" x="60.0" y="20"/><text x="87.0" y="35">term</text></g><path d="M114.0 31h10"/><path d="M124.0 31h10"/><g class="terminal">
<path d="M134.0 31h0.0"/><path d="M179.5 31h0.0"/><rect height="22" rx="10" ry="10" width="45.5" x="134.0" y="20"/><text x="156.75" y="35"> + </text></g><path d="M179.5 31h10"/><path d="M189.5 31h10"/><g class="non-terminal">
<path d="M199.5 31h0.0"/><path d="M253.5 31h0.0"/><rect height="22" width="54.0" x="199.5" y="20"/><text x="226.5" y="35">expr</text></g></g><path d="M253.5 31a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><path d="M40.0 61h20"/><g>
<path d="M60.0 61h0.0"/><path d="M253.5 61h0.0"/><g class="non-terminal">
<path d="M60.0 61h0.0"/><path d="M114.0 61h0.0"/><rect height="22" width="54.0" x="60.0" y="50"/><text x="87.0" y="65">term</text></g><path d="M114.0 61h10"/><path d="M124.0 61h10"/><g class="terminal">
<path d="M134.0 61h0.0"/><path d="M179.5 61h0.0"/><rect height="22" rx="10" ry="10" width="45.5" x="134.0" y="50"/><text x="156.75" y="65"> - </text></g><path d="M179.5 61h10"/><path d="M189.5 61h10"/><g class="non-terminal">
<path d="M199.5 61h0.0"/><path d="M253.5 61h0.0"/><rect height="22" width="54.0" x="199.5" y="50"/><text x="226.5" y="65">expr</text></g></g><path d="M253.5 61h20"/><path d="M40.0 61a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><g>
<path d="M60.0 91h69.75"/><path d="M183.75 91h69.75"/><g class="non-terminal">
<path d="M129.75 91h0.0"/><path d="M183.75 91h0.0"/><rect height="22" width="54.0" x="129.75" y="80"/><text x="156.75" y="95">term</text></g></g><path d="M253.5 91a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/></g><path d="M 273.5 61 h 20 m -10 -10 v 20 m 10 -20 v 20"/></g></svg>

</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>term
</pre>
</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<svg class="railroad-diagram" height="122" viewbox="0 0 330.5 122" width="330.5">
<g transform="translate(.5 .5)">
<style>/* &amp;lt;![CDATA[ */
    svg.railroad-diagram {
    }
    svg.railroad-diagram path {
        stroke-width:3;
        stroke:black;
        fill:white;
    }
    svg.railroad-diagram text {
        font:14px "Fira Mono", monospace;
        text-anchor:middle;
    }
    svg.railroad-diagram text.label{
        text-anchor:start;
    }
    svg.railroad-diagram text.comment{
        font:italic 12px "Fira Mono", monospace;
    }
    svg.railroad-diagram rect{
        stroke-width:2;
        stroke:black;
        fill:mistyrose;
    }

/* ]]&amp;gt; */
</style><g>
<path d="M20 51v20m10 -20v20m-10 -10h20"/></g><g>
<path d="M40 61h0.0"/><path d="M290.5 61h0.0"/><path d="M40.0 61a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/><g>
<path d="M60.0 31h0.0"/><path d="M270.5 31h0.0"/><g class="non-terminal">
<path d="M60.0 31h0.0"/><path d="M131.0 31h0.0"/><rect height="22" width="71.0" x="60.0" y="20"/><text x="95.5" y="35">factor</text></g><path d="M131.0 31h10"/><path d="M141.0 31h10"/><g class="terminal">
<path d="M151.0 31h0.0"/><path d="M196.5 31h0.0"/><rect height="22" rx="10" ry="10" width="45.5" x="151.0" y="20"/><text x="173.75" y="35"> * </text></g><path d="M196.5 31h10"/><path d="M206.5 31h10"/><g class="non-terminal">
<path d="M216.5 31h0.0"/><path d="M270.5 31h0.0"/><rect height="22" width="54.0" x="216.5" y="20"/><text x="243.5" y="35">term</text></g></g><path d="M270.5 31a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><path d="M40.0 61h20"/><g>
<path d="M60.0 61h0.0"/><path d="M270.5 61h0.0"/><g class="non-terminal">
<path d="M60.0 61h0.0"/><path d="M131.0 61h0.0"/><rect height="22" width="71.0" x="60.0" y="50"/><text x="95.5" y="65">factor</text></g><path d="M131.0 61h10"/><path d="M141.0 61h10"/><g class="terminal">
<path d="M151.0 61h0.0"/><path d="M196.5 61h0.0"/><rect height="22" rx="10" ry="10" width="45.5" x="151.0" y="50"/><text x="173.75" y="65"> / </text></g><path d="M196.5 61h10"/><path d="M206.5 61h10"/><g class="non-terminal">
<path d="M216.5 61h0.0"/><path d="M270.5 61h0.0"/><rect height="22" width="54.0" x="216.5" y="50"/><text x="243.5" y="65">term</text></g></g><path d="M270.5 61h20"/><path d="M40.0 61a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><g>
<path d="M60.0 91h69.75"/><path d="M200.75 91h69.75"/><g class="non-terminal">
<path d="M129.75 91h0.0"/><path d="M200.75 91h0.0"/><rect height="22" width="71.0" x="129.75" y="80"/><text x="165.25" y="95">factor</text></g></g><path d="M270.5 91a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/></g><path d="M 290.5 61 h 20 m -10 -10 v 20 m 10 -20 v 20"/></g></svg>

</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>factor
</pre>
</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<svg class="railroad-diagram" height="182" viewbox="0 0 347.5 182" width="347.5">
<g transform="translate(.5 .5)">
<style>/* &amp;lt;![CDATA[ */
    svg.railroad-diagram {
    }
    svg.railroad-diagram path {
        stroke-width:3;
        stroke:black;
        fill:white;
    }
    svg.railroad-diagram text {
        font:14px "Fira Mono", monospace;
        text-anchor:middle;
    }
    svg.railroad-diagram text.label{
        text-anchor:start;
    }
    svg.railroad-diagram text.comment{
        font:italic 12px "Fira Mono", monospace;
    }
    svg.railroad-diagram rect{
        stroke-width:2;
        stroke:black;
        fill:mistyrose;
    }

/* ]]&amp;gt; */
</style><g>
<path d="M20 81v20m10 -20v20m-10 -10h20"/></g><g>
<path d="M40 91h0.0"/><path d="M307.5 91h0.0"/><path d="M40.0 91a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/><g>
<path d="M60.0 61h54.0"/><path d="M233.5 61h54.0"/><g class="terminal">
<path d="M114.0 61h0.0"/><path d="M142.5 61h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="114.0" y="50"/><text x="128.25" y="65">-</text></g><path d="M142.5 61h10"/><path d="M152.5 61h10"/><g class="non-terminal">
<path d="M162.5 61h0.0"/><path d="M233.5 61h0.0"/><rect height="22" width="71.0" x="162.5" y="50"/><text x="198.0" y="65">factor</text></g></g><path d="M287.5 61a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><path d="M40.0 91a10 10 0 0 0 10 -10v-40a10 10 0 0 1 10 -10"/><g>
<path d="M60.0 31h54.0"/><path d="M233.5 31h54.0"/><g class="terminal">
<path d="M114.0 31h0.0"/><path d="M142.5 31h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="114.0" y="20"/><text x="128.25" y="35">+</text></g><path d="M142.5 31h10"/><path d="M152.5 31h10"/><g class="non-terminal">
<path d="M162.5 31h0.0"/><path d="M233.5 31h0.0"/><rect height="22" width="71.0" x="162.5" y="20"/><text x="198.0" y="35">factor</text></g></g><path d="M287.5 31a10 10 0 0 1 10 10v40a10 10 0 0 0 10 10"/><path d="M40.0 91h20"/><g>
<path d="M60.0 91h38.25"/><path d="M249.25 91h38.25"/><g class="terminal">
<path d="M98.25 91h0.0"/><path d="M126.75 91h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="98.25" y="80"/><text x="112.5" y="95">(</text></g><path d="M126.75 91h10"/><path d="M136.75 91h10"/><g class="non-terminal">
<path d="M146.75 91h0.0"/><path d="M200.75 91h0.0"/><rect height="22" width="54.0" x="146.75" y="80"/><text x="173.75" y="95">expr</text></g><path d="M200.75 91h10"/><path d="M210.75 91h10"/><g class="terminal">
<path d="M220.75 91h0.0"/><path d="M249.25 91h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="220.75" y="80"/><text x="235.0" y="95">)</text></g></g><path d="M287.5 91h20"/><path d="M40.0 91a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><g>
<path d="M60.0 121h0.0"/><path d="M287.5 121h0.0"/><g class="non-terminal">
<path d="M60.0 121h0.0"/><path d="M139.5 121h0.0"/><rect height="22" width="79.5" x="60.0" y="110"/><text x="99.75" y="125">integer</text></g><path d="M139.5 121h10"/><path d="M149.5 121h10"/><g class="terminal">
<path d="M159.5 121h0.0"/><path d="M188.0 121h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="159.5" y="110"/><text x="173.75" y="125">.</text></g><path d="M188.0 121h10"/><path d="M198.0 121h10"/><g class="non-terminal">
<path d="M208.0 121h0.0"/><path d="M287.5 121h0.0"/><rect height="22" width="79.5" x="208.0" y="110"/><text x="247.75" y="125">integer</text></g></g><path d="M287.5 121a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/><path d="M40.0 91a10 10 0 0 1 10 10v40a10 10 0 0 0 10 10"/><g>
<path d="M60.0 151h74.0"/><path d="M213.5 151h74.0"/><g class="non-terminal">
<path d="M134.0 151h0.0"/><path d="M213.5 151h0.0"/><rect height="22" width="79.5" x="134.0" y="140"/><text x="173.75" y="155">integer</text></g></g><path d="M287.5 151a10 10 0 0 0 10 -10v-40a10 10 0 0 1 10 -10"/></g><path d="M 307.5 91 h 20 m -10 -10 v 20 m 10 -20 v 20"/></g></svg>

</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>integer
</pre>
</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<svg class="railroad-diagram" height="92" viewbox="0 0 282.0 92" width="282.0">
<g transform="translate(.5 .5)">
<style>/* &amp;lt;![CDATA[ */
    svg.railroad-diagram {
    }
    svg.railroad-diagram path {
        stroke-width:3;
        stroke:black;
        fill:white;
    }
    svg.railroad-diagram text {
        font:14px "Fira Mono", monospace;
        text-anchor:middle;
    }
    svg.railroad-diagram text.label{
        text-anchor:start;
    }
    svg.railroad-diagram text.comment{
        font:italic 12px "Fira Mono", monospace;
    }
    svg.railroad-diagram rect{
        stroke-width:2;
        stroke:black;
        fill:mistyrose;
    }

/* ]]&amp;gt; */
</style><g>
<path d="M20 51v20m10 -20v20m-10 -10h20"/></g><g>
<path d="M40 61h0.0"/><path d="M242.0 61h0.0"/><path d="M40.0 61a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/><g>
<path d="M60.0 31h0.0"/><path d="M222.0 31h0.0"/><g class="non-terminal">
<path d="M60.0 31h0.0"/><path d="M122.5 31h0.0"/><rect height="22" width="62.5" x="60.0" y="20"/><text x="91.25" y="35">digit</text></g><path d="M122.5 31h10"/><path d="M132.5 31h10"/><g class="non-terminal">
<path d="M142.5 31h0.0"/><path d="M222.0 31h0.0"/><rect height="22" width="79.5" x="142.5" y="20"/><text x="182.25" y="35">integer</text></g></g><path d="M222.0 31a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><path d="M40.0 61h20"/><g>
<path d="M60.0 61h49.75"/><path d="M172.25 61h49.75"/><g class="non-terminal">
<path d="M109.75 61h0.0"/><path d="M172.25 61h0.0"/><rect height="22" width="62.5" x="109.75" y="50"/><text x="141.0" y="65">digit</text></g></g><path d="M222.0 61h20"/></g><path d="M 242.0 61 h 20 m -10 -10 v 20 m 10 -20 v 20"/></g></svg>

</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>digit
</pre>
</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<svg class="railroad-diagram" height="109" viewbox="0 0 522.5 109" width="522.5">
<g transform="translate(.5 .5)">
<style>/* &amp;lt;![CDATA[ */
    svg.railroad-diagram {
    }
    svg.railroad-diagram path {
        stroke-width:3;
        stroke:black;
        fill:white;
    }
    svg.railroad-diagram text {
        font:14px "Fira Mono", monospace;
        text-anchor:middle;
    }
    svg.railroad-diagram text.label{
        text-anchor:start;
    }
    svg.railroad-diagram text.comment{
        font:italic 12px "Fira Mono", monospace;
    }
    svg.railroad-diagram rect{
        stroke-width:2;
        stroke:black;
        fill:mistyrose;
    }

/* ]]&amp;gt; */
</style><g>
<path d="M20 59v20m10 -20v20m-10 -10h20"/></g><g>
<path d="M40 69h0.0"/><path d="M482.5 69h0.0"/><path d="M40.0 69a10 10 0 0 0 10 -10v-29a10 10 0 0 1 10 -10h324.0"/><path d="M138.5 89h324.0a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10"/><path d="M40.0 69h10"/><g>
<path d="M50.0 69h0.0"/><path d="M118.5 69h0.0"/><path d="M50.0 69a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/><g>
<path d="M70.0 39h0.0"/><path d="M98.5 39h0.0"/><g class="terminal">
<path d="M70.0 39h0.0"/><path d="M98.5 39h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="70.0" y="28"/><text x="84.25" y="43">0</text></g></g><path d="M98.5 39a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><path d="M50.0 69h20"/><g>
<path d="M70.0 69h0.0"/><path d="M98.5 69h0.0"/><g class="terminal">
<path d="M70.0 69h0.0"/><path d="M98.5 69h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="70.0" y="58"/><text x="84.25" y="73">1</text></g></g><path d="M98.5 69h20"/></g><path d="M118.5 69a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10"/><path d="M118.5 20a10 10 0 0 1 10 10v29a10 10 0 0 0 10 10"/><g>
<path d="M138.5 69h0.0"/><path d="M207.0 69h0.0"/><path d="M138.5 69a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/><g>
<path d="M158.5 39h0.0"/><path d="M187.0 39h0.0"/><g class="terminal">
<path d="M158.5 39h0.0"/><path d="M187.0 39h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="158.5" y="28"/><text x="172.75" y="43">2</text></g></g><path d="M187.0 39a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><path d="M138.5 69h20"/><g>
<path d="M158.5 69h0.0"/><path d="M187.0 69h0.0"/><g class="terminal">
<path d="M158.5 69h0.0"/><path d="M187.0 69h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="158.5" y="58"/><text x="172.75" y="73">3</text></g></g><path d="M187.0 69h20"/></g><path d="M207.0 69a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10"/><path d="M207.0 20a10 10 0 0 1 10 10v29a10 10 0 0 0 10 10"/><g>
<path d="M227.0 69h0.0"/><path d="M295.5 69h0.0"/><path d="M227.0 69a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/><g>
<path d="M247.0 39h0.0"/><path d="M275.5 39h0.0"/><g class="terminal">
<path d="M247.0 39h0.0"/><path d="M275.5 39h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="247.0" y="28"/><text x="261.25" y="43">4</text></g></g><path d="M275.5 39a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><path d="M227.0 69h20"/><g>
<path d="M247.0 69h0.0"/><path d="M275.5 69h0.0"/><g class="terminal">
<path d="M247.0 69h0.0"/><path d="M275.5 69h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="247.0" y="58"/><text x="261.25" y="73">5</text></g></g><path d="M275.5 69h20"/></g><path d="M295.5 69a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10"/><path d="M295.5 20a10 10 0 0 1 10 10v29a10 10 0 0 0 10 10"/><g>
<path d="M315.5 69h0.0"/><path d="M384.0 69h0.0"/><path d="M315.5 69a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/><g>
<path d="M335.5 39h0.0"/><path d="M364.0 39h0.0"/><g class="terminal">
<path d="M335.5 39h0.0"/><path d="M364.0 39h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="335.5" y="28"/><text x="349.75" y="43">6</text></g></g><path d="M364.0 39a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><path d="M315.5 69h20"/><g>
<path d="M335.5 69h0.0"/><path d="M364.0 69h0.0"/><g class="terminal">
<path d="M335.5 69h0.0"/><path d="M364.0 69h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="335.5" y="58"/><text x="349.75" y="73">7</text></g></g><path d="M364.0 69h20"/></g><path d="M384.0 69a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10"/><path d="M384.0 20a10 10 0 0 1 10 10v29a10 10 0 0 0 10 10"/><g>
<path d="M404.0 69h0.0"/><path d="M472.5 69h0.0"/><path d="M404.0 69a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/><g>
<path d="M424.0 39h0.0"/><path d="M452.5 39h0.0"/><g class="terminal">
<path d="M424.0 39h0.0"/><path d="M452.5 39h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="424.0" y="28"/><text x="438.25" y="43">8</text></g></g><path d="M452.5 39a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><path d="M404.0 69h20"/><g>
<path d="M424.0 69h0.0"/><path d="M452.5 69h0.0"/><g class="terminal">
<path d="M424.0 69h0.0"/><path d="M452.5 69h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="424.0" y="58"/><text x="438.25" y="73">9</text></g></g><path d="M452.5 69h20"/></g><path d="M472.5 69h10"/></g><path d="M 482.5 69 h 20 m -10 -10 v 20 m 10 -20 v 20"/></g></svg>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>This railroad representation will come in handy as it comes to visualizing the structure of grammars – especially for more complex grammars.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Some-Grammars">Some Grammars</h2><p>Let us create (and visualize) some more grammars and use them for fuzzing.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="A-CGI-Grammar">A CGI Grammar</h3><p>Here's a grammar for <code>cgi_decode()</code> introduced in the <a href="Coverage.html">chapter on coverage</a>.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">CGI_GRAMMAR</span><span class="p">:</span> <span class="n">Grammar</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"&lt;start&gt;"</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">"&lt;string&gt;"</span><span class="p">],</span>

    <span class="s2">"&lt;string&gt;"</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">"&lt;letter&gt;"</span><span class="p">,</span> <span class="s2">"&lt;letter&gt;&lt;string&gt;"</span><span class="p">],</span>

    <span class="s2">"&lt;letter&gt;"</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">"&lt;plus&gt;"</span><span class="p">,</span> <span class="s2">"&lt;percent&gt;"</span><span class="p">,</span> <span class="s2">"&lt;other&gt;"</span><span class="p">],</span>

    <span class="s2">"&lt;plus&gt;"</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">"+"</span><span class="p">],</span>

    <span class="s2">"&lt;percent&gt;"</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">"%&lt;hexdigit&gt;&lt;hexdigit&gt;"</span><span class="p">],</span>

    <span class="s2">"&lt;hexdigit&gt;"</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">"0"</span><span class="p">,</span> <span class="s2">"1"</span><span class="p">,</span> <span class="s2">"2"</span><span class="p">,</span> <span class="s2">"3"</span><span class="p">,</span> <span class="s2">"4"</span><span class="p">,</span> <span class="s2">"5"</span><span class="p">,</span> <span class="s2">"6"</span><span class="p">,</span> <span class="s2">"7"</span><span class="p">,</span>
            <span class="s2">"8"</span><span class="p">,</span> <span class="s2">"9"</span><span class="p">,</span> <span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">,</span> <span class="s2">"c"</span><span class="p">,</span> <span class="s2">"d"</span><span class="p">,</span> <span class="s2">"e"</span><span class="p">,</span> <span class="s2">"f"</span><span class="p">],</span>

    <span class="s2">"&lt;other&gt;"</span><span class="p">:</span>  <span class="c1"># Actually, could be _all_ letters</span>
        <span class="p">[</span><span class="s2">"0"</span><span class="p">,</span> <span class="s2">"1"</span><span class="p">,</span> <span class="s2">"2"</span><span class="p">,</span> <span class="s2">"3"</span><span class="p">,</span> <span class="s2">"4"</span><span class="p">,</span> <span class="s2">"5"</span><span class="p">,</span> <span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">,</span> <span class="s2">"c"</span><span class="p">,</span> <span class="s2">"d"</span><span class="p">,</span> <span class="s2">"e"</span><span class="p">,</span> <span class="s2">"-"</span><span class="p">,</span> <span class="s2">"_"</span><span class="p">],</span>
<span class="p">}</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">syntax_diagram</span><span class="p">(</span><span class="n">CGI_GRAMMAR</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>start
</pre>
</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<svg class="railroad-diagram" height="62" viewbox="0 0 191.0 62" width="191.0">
<g transform="translate(.5 .5)">
<style>/* &amp;lt;![CDATA[ */
    svg.railroad-diagram {
    }
    svg.railroad-diagram path {
        stroke-width:3;
        stroke:black;
        fill:white;
    }
    svg.railroad-diagram text {
        font:14px "Fira Mono", monospace;
        text-anchor:middle;
    }
    svg.railroad-diagram text.label{
        text-anchor:start;
    }
    svg.railroad-diagram text.comment{
        font:italic 12px "Fira Mono", monospace;
    }
    svg.railroad-diagram rect{
        stroke-width:2;
        stroke:black;
        fill:mistyrose;
    }

/* ]]&amp;gt; */
</style><g>
<path d="M20 21v20m10 -20v20m-10 -10h20"/></g><g>
<path d="M40 31h0.0"/><path d="M151.0 31h0.0"/><path d="M40.0 31h20"/><g>
<path d="M60.0 31h0.0"/><path d="M131.0 31h0.0"/><g class="non-terminal">
<path d="M60.0 31h0.0"/><path d="M131.0 31h0.0"/><rect height="22" width="71.0" x="60.0" y="20"/><text x="95.5" y="35">string</text></g></g><path d="M131.0 31h20"/></g><path d="M 151.0 31 h 20 m -10 -10 v 20 m 10 -20 v 20"/></g></svg>

</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>string
</pre>
</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<svg class="railroad-diagram" height="92" viewbox="0 0 282.0 92" width="282.0">
<g transform="translate(.5 .5)">
<style>/* &amp;lt;![CDATA[ */
    svg.railroad-diagram {
    }
    svg.railroad-diagram path {
        stroke-width:3;
        stroke:black;
        fill:white;
    }
    svg.railroad-diagram text {
        font:14px "Fira Mono", monospace;
        text-anchor:middle;
    }
    svg.railroad-diagram text.label{
        text-anchor:start;
    }
    svg.railroad-diagram text.comment{
        font:italic 12px "Fira Mono", monospace;
    }
    svg.railroad-diagram rect{
        stroke-width:2;
        stroke:black;
        fill:mistyrose;
    }

/* ]]&amp;gt; */
</style><g>
<path d="M20 51v20m10 -20v20m-10 -10h20"/></g><g>
<path d="M40 61h0.0"/><path d="M242.0 61h0.0"/><path d="M40.0 61a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/><g>
<path d="M60.0 31h45.5"/><path d="M176.5 31h45.5"/><g class="non-terminal">
<path d="M105.5 31h0.0"/><path d="M176.5 31h0.0"/><rect height="22" width="71.0" x="105.5" y="20"/><text x="141.0" y="35">letter</text></g></g><path d="M222.0 31a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><path d="M40.0 61h20"/><g>
<path d="M60.0 61h0.0"/><path d="M222.0 61h0.0"/><g class="non-terminal">
<path d="M60.0 61h0.0"/><path d="M131.0 61h0.0"/><rect height="22" width="71.0" x="60.0" y="50"/><text x="95.5" y="65">letter</text></g><path d="M131.0 61h10"/><path d="M141.0 61h10"/><g class="non-terminal">
<path d="M151.0 61h0.0"/><path d="M222.0 61h0.0"/><rect height="22" width="71.0" x="151.0" y="50"/><text x="186.5" y="65">string</text></g></g><path d="M222.0 61h20"/></g><path d="M 242.0 61 h 20 m -10 -10 v 20 m 10 -20 v 20"/></g></svg>

</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>letter
</pre>
</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<svg class="railroad-diagram" height="122" viewbox="0 0 199.5 122" width="199.5">
<g transform="translate(.5 .5)">
<style>/* &amp;lt;![CDATA[ */
    svg.railroad-diagram {
    }
    svg.railroad-diagram path {
        stroke-width:3;
        stroke:black;
        fill:white;
    }
    svg.railroad-diagram text {
        font:14px "Fira Mono", monospace;
        text-anchor:middle;
    }
    svg.railroad-diagram text.label{
        text-anchor:start;
    }
    svg.railroad-diagram text.comment{
        font:italic 12px "Fira Mono", monospace;
    }
    svg.railroad-diagram rect{
        stroke-width:2;
        stroke:black;
        fill:mistyrose;
    }

/* ]]&amp;gt; */
</style><g>
<path d="M20 51v20m10 -20v20m-10 -10h20"/></g><g>
<path d="M40 61h0.0"/><path d="M159.5 61h0.0"/><path d="M40.0 61a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/><g>
<path d="M60.0 31h12.75"/><path d="M126.75 31h12.75"/><g class="non-terminal">
<path d="M72.75 31h0.0"/><path d="M126.75 31h0.0"/><rect height="22" width="54.0" x="72.75" y="20"/><text x="99.75" y="35">plus</text></g></g><path d="M139.5 31a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><path d="M40.0 61h20"/><g>
<path d="M60.0 61h0.0"/><path d="M139.5 61h0.0"/><g class="non-terminal">
<path d="M60.0 61h0.0"/><path d="M139.5 61h0.0"/><rect height="22" width="79.5" x="60.0" y="50"/><text x="99.75" y="65">percent</text></g></g><path d="M139.5 61h20"/><path d="M40.0 61a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><g>
<path d="M60.0 91h8.5"/><path d="M131.0 91h8.5"/><g class="non-terminal">
<path d="M68.5 91h0.0"/><path d="M131.0 91h0.0"/><rect height="22" width="62.5" x="68.5" y="80"/><text x="99.75" y="95">other</text></g></g><path d="M139.5 91a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/></g><path d="M 159.5 61 h 20 m -10 -10 v 20 m 10 -20 v 20"/></g></svg>

</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>plus
</pre>
</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<svg class="railroad-diagram" height="62" viewbox="0 0 148.5 62" width="148.5">
<g transform="translate(.5 .5)">
<style>/* &amp;lt;![CDATA[ */
    svg.railroad-diagram {
    }
    svg.railroad-diagram path {
        stroke-width:3;
        stroke:black;
        fill:white;
    }
    svg.railroad-diagram text {
        font:14px "Fira Mono", monospace;
        text-anchor:middle;
    }
    svg.railroad-diagram text.label{
        text-anchor:start;
    }
    svg.railroad-diagram text.comment{
        font:italic 12px "Fira Mono", monospace;
    }
    svg.railroad-diagram rect{
        stroke-width:2;
        stroke:black;
        fill:mistyrose;
    }

/* ]]&amp;gt; */
</style><g>
<path d="M20 21v20m10 -20v20m-10 -10h20"/></g><g>
<path d="M40 31h0.0"/><path d="M108.5 31h0.0"/><path d="M40.0 31h20"/><g>
<path d="M60.0 31h0.0"/><path d="M88.5 31h0.0"/><g class="terminal">
<path d="M60.0 31h0.0"/><path d="M88.5 31h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="60.0" y="20"/><text x="74.25" y="35">+</text></g></g><path d="M88.5 31h20"/></g><path d="M 108.5 31 h 20 m -10 -10 v 20 m 10 -20 v 20"/></g></svg>

</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>percent
</pre>
</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<svg class="railroad-diagram" height="62" viewbox="0 0 364.5 62" width="364.5">
<g transform="translate(.5 .5)">
<style>/* &amp;lt;![CDATA[ */
    svg.railroad-diagram {
    }
    svg.railroad-diagram path {
        stroke-width:3;
        stroke:black;
        fill:white;
    }
    svg.railroad-diagram text {
        font:14px "Fira Mono", monospace;
        text-anchor:middle;
    }
    svg.railroad-diagram text.label{
        text-anchor:start;
    }
    svg.railroad-diagram text.comment{
        font:italic 12px "Fira Mono", monospace;
    }
    svg.railroad-diagram rect{
        stroke-width:2;
        stroke:black;
        fill:mistyrose;
    }

/* ]]&amp;gt; */
</style><g>
<path d="M20 21v20m10 -20v20m-10 -10h20"/></g><g>
<path d="M40 31h0.0"/><path d="M324.5 31h0.0"/><path d="M40.0 31h20"/><g>
<path d="M60.0 31h0.0"/><path d="M304.5 31h0.0"/><g class="terminal">
<path d="M60.0 31h0.0"/><path d="M88.5 31h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="60.0" y="20"/><text x="74.25" y="35">%</text></g><path d="M88.5 31h10"/><path d="M98.5 31h10"/><g class="non-terminal">
<path d="M108.5 31h0.0"/><path d="M196.5 31h0.0"/><rect height="22" width="88.0" x="108.5" y="20"/><text x="152.5" y="35">hexdigit</text></g><path d="M196.5 31h10"/><path d="M206.5 31h10"/><g class="non-terminal">
<path d="M216.5 31h0.0"/><path d="M304.5 31h0.0"/><rect height="22" width="88.0" x="216.5" y="20"/><text x="260.5" y="35">hexdigit</text></g></g><path d="M304.5 31h20"/></g><path d="M 324.5 31 h 20 m -10 -10 v 20 m 10 -20 v 20"/></g></svg>

</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>hexdigit
</pre>
</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<svg class="railroad-diagram" height="138" viewbox="0 0 611.0 138" width="611.0">
<g transform="translate(.5 .5)">
<style>/* &amp;lt;![CDATA[ */
    svg.railroad-diagram {
    }
    svg.railroad-diagram path {
        stroke-width:3;
        stroke:black;
        fill:white;
    }
    svg.railroad-diagram text {
        font:14px "Fira Mono", monospace;
        text-anchor:middle;
    }
    svg.railroad-diagram text.label{
        text-anchor:start;
    }
    svg.railroad-diagram text.comment{
        font:italic 12px "Fira Mono", monospace;
    }
    svg.railroad-diagram rect{
        stroke-width:2;
        stroke:black;
        fill:mistyrose;
    }

/* ]]&amp;gt; */
</style><g>
<path d="M20 59v20m10 -20v20m-10 -10h20"/></g><g>
<path d="M40 69h0.0"/><path d="M571.0 69h0.0"/><path d="M40.0 69a10 10 0 0 0 10 -10v-29a10 10 0 0 1 10 -10h412.5"/><path d="M138.5 118h412.5a10 10 0 0 0 10 -10v-29a10 10 0 0 1 10 -10"/><path d="M40.0 69h10"/><g>
<path d="M50.0 69h0.0"/><path d="M118.5 69h0.0"/><path d="M50.0 69a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/><g>
<path d="M70.0 39h0.0"/><path d="M98.5 39h0.0"/><g class="terminal">
<path d="M70.0 39h0.0"/><path d="M98.5 39h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="70.0" y="28"/><text x="84.25" y="43">0</text></g></g><path d="M98.5 39a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><path d="M50.0 69h20"/><g>
<path d="M70.0 69h0.0"/><path d="M98.5 69h0.0"/><g class="terminal">
<path d="M70.0 69h0.0"/><path d="M98.5 69h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="70.0" y="58"/><text x="84.25" y="73">1</text></g></g><path d="M98.5 69h20"/><path d="M50.0 69a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><g>
<path d="M70.0 99h0.0"/><path d="M98.5 99h0.0"/><g class="terminal">
<path d="M70.0 99h0.0"/><path d="M98.5 99h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="70.0" y="88"/><text x="84.25" y="103">2</text></g></g><path d="M98.5 99a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/></g><path d="M118.5 69a10 10 0 0 1 10 10v29a10 10 0 0 0 10 10"/><path d="M118.5 20a10 10 0 0 1 10 10v29a10 10 0 0 0 10 10"/><g>
<path d="M138.5 69h0.0"/><path d="M207.0 69h0.0"/><path d="M138.5 69a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/><g>
<path d="M158.5 39h0.0"/><path d="M187.0 39h0.0"/><g class="terminal">
<path d="M158.5 39h0.0"/><path d="M187.0 39h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="158.5" y="28"/><text x="172.75" y="43">3</text></g></g><path d="M187.0 39a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><path d="M138.5 69h20"/><g>
<path d="M158.5 69h0.0"/><path d="M187.0 69h0.0"/><g class="terminal">
<path d="M158.5 69h0.0"/><path d="M187.0 69h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="158.5" y="58"/><text x="172.75" y="73">4</text></g></g><path d="M187.0 69h20"/><path d="M138.5 69a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><g>
<path d="M158.5 99h0.0"/><path d="M187.0 99h0.0"/><g class="terminal">
<path d="M158.5 99h0.0"/><path d="M187.0 99h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="158.5" y="88"/><text x="172.75" y="103">5</text></g></g><path d="M187.0 99a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/></g><path d="M207.0 69a10 10 0 0 1 10 10v29a10 10 0 0 0 10 10"/><path d="M207.0 20a10 10 0 0 1 10 10v29a10 10 0 0 0 10 10"/><g>
<path d="M227.0 69h0.0"/><path d="M295.5 69h0.0"/><path d="M227.0 69a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/><g>
<path d="M247.0 39h0.0"/><path d="M275.5 39h0.0"/><g class="terminal">
<path d="M247.0 39h0.0"/><path d="M275.5 39h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="247.0" y="28"/><text x="261.25" y="43">6</text></g></g><path d="M275.5 39a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><path d="M227.0 69h20"/><g>
<path d="M247.0 69h0.0"/><path d="M275.5 69h0.0"/><g class="terminal">
<path d="M247.0 69h0.0"/><path d="M275.5 69h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="247.0" y="58"/><text x="261.25" y="73">7</text></g></g><path d="M275.5 69h20"/><path d="M227.0 69a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><g>
<path d="M247.0 99h0.0"/><path d="M275.5 99h0.0"/><g class="terminal">
<path d="M247.0 99h0.0"/><path d="M275.5 99h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="247.0" y="88"/><text x="261.25" y="103">8</text></g></g><path d="M275.5 99a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/></g><path d="M295.5 69a10 10 0 0 1 10 10v29a10 10 0 0 0 10 10"/><path d="M295.5 20a10 10 0 0 1 10 10v29a10 10 0 0 0 10 10"/><g>
<path d="M315.5 69h0.0"/><path d="M384.0 69h0.0"/><path d="M315.5 69a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/><g>
<path d="M335.5 39h0.0"/><path d="M364.0 39h0.0"/><g class="terminal">
<path d="M335.5 39h0.0"/><path d="M364.0 39h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="335.5" y="28"/><text x="349.75" y="43">9</text></g></g><path d="M364.0 39a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><path d="M315.5 69h20"/><g>
<path d="M335.5 69h0.0"/><path d="M364.0 69h0.0"/><g class="terminal">
<path d="M335.5 69h0.0"/><path d="M364.0 69h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="335.5" y="58"/><text x="349.75" y="73">a</text></g></g><path d="M364.0 69h20"/><path d="M315.5 69a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><g>
<path d="M335.5 99h0.0"/><path d="M364.0 99h0.0"/><g class="terminal">
<path d="M335.5 99h0.0"/><path d="M364.0 99h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="335.5" y="88"/><text x="349.75" y="103">b</text></g></g><path d="M364.0 99a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/></g><path d="M384.0 69a10 10 0 0 1 10 10v29a10 10 0 0 0 10 10"/><path d="M384.0 20a10 10 0 0 1 10 10v29a10 10 0 0 0 10 10"/><g>
<path d="M404.0 69h0.0"/><path d="M472.5 69h0.0"/><path d="M404.0 69a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/><g>
<path d="M424.0 39h0.0"/><path d="M452.5 39h0.0"/><g class="terminal">
<path d="M424.0 39h0.0"/><path d="M452.5 39h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="424.0" y="28"/><text x="438.25" y="43">c</text></g></g><path d="M452.5 39a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><path d="M404.0 69h20"/><g>
<path d="M424.0 69h0.0"/><path d="M452.5 69h0.0"/><g class="terminal">
<path d="M424.0 69h0.0"/><path d="M452.5 69h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="424.0" y="58"/><text x="438.25" y="73">d</text></g></g><path d="M452.5 69h20"/><path d="M404.0 69a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><g>
<path d="M424.0 99h0.0"/><path d="M452.5 99h0.0"/><g class="terminal">
<path d="M424.0 99h0.0"/><path d="M452.5 99h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="424.0" y="88"/><text x="438.25" y="103">e</text></g></g><path d="M452.5 99a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/></g><path d="M472.5 69a10 10 0 0 1 10 10v29a10 10 0 0 0 10 10"/><path d="M472.5 20a10 10 0 0 1 10 10v29a10 10 0 0 0 10 10"/><g>
<path d="M492.5 69h0.0"/><path d="M561.0 69h0.0"/><path d="M492.5 69h20"/><g>
<path d="M512.5 69h0.0"/><path d="M541.0 69h0.0"/><g class="terminal">
<path d="M512.5 69h0.0"/><path d="M541.0 69h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="512.5" y="58"/><text x="526.75" y="73">f</text></g></g><path d="M541.0 69h20"/></g><path d="M561.0 69h10"/></g><path d="M 571.0 69 h 20 m -10 -10 v 20 m 10 -20 v 20"/></g></svg>

</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>other
</pre>
</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<svg class="railroad-diagram" height="109" viewbox="0 0 699.5 109" width="699.5">
<g transform="translate(.5 .5)">
<style>/* &amp;lt;![CDATA[ */
    svg.railroad-diagram {
    }
    svg.railroad-diagram path {
        stroke-width:3;
        stroke:black;
        fill:white;
    }
    svg.railroad-diagram text {
        font:14px "Fira Mono", monospace;
        text-anchor:middle;
    }
    svg.railroad-diagram text.label{
        text-anchor:start;
    }
    svg.railroad-diagram text.comment{
        font:italic 12px "Fira Mono", monospace;
    }
    svg.railroad-diagram rect{
        stroke-width:2;
        stroke:black;
        fill:mistyrose;
    }

/* ]]&amp;gt; */
</style><g>
<path d="M20 59v20m10 -20v20m-10 -10h20"/></g><g>
<path d="M40 69h0.0"/><path d="M659.5 69h0.0"/><path d="M40.0 69a10 10 0 0 0 10 -10v-29a10 10 0 0 1 10 -10h501.0"/><path d="M138.5 89h501.0a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10"/><path d="M40.0 69h10"/><g>
<path d="M50.0 69h0.0"/><path d="M118.5 69h0.0"/><path d="M50.0 69a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/><g>
<path d="M70.0 39h0.0"/><path d="M98.5 39h0.0"/><g class="terminal">
<path d="M70.0 39h0.0"/><path d="M98.5 39h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="70.0" y="28"/><text x="84.25" y="43">0</text></g></g><path d="M98.5 39a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><path d="M50.0 69h20"/><g>
<path d="M70.0 69h0.0"/><path d="M98.5 69h0.0"/><g class="terminal">
<path d="M70.0 69h0.0"/><path d="M98.5 69h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="70.0" y="58"/><text x="84.25" y="73">1</text></g></g><path d="M98.5 69h20"/></g><path d="M118.5 69a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10"/><path d="M118.5 20a10 10 0 0 1 10 10v29a10 10 0 0 0 10 10"/><g>
<path d="M138.5 69h0.0"/><path d="M207.0 69h0.0"/><path d="M138.5 69a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/><g>
<path d="M158.5 39h0.0"/><path d="M187.0 39h0.0"/><g class="terminal">
<path d="M158.5 39h0.0"/><path d="M187.0 39h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="158.5" y="28"/><text x="172.75" y="43">2</text></g></g><path d="M187.0 39a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><path d="M138.5 69h20"/><g>
<path d="M158.5 69h0.0"/><path d="M187.0 69h0.0"/><g class="terminal">
<path d="M158.5 69h0.0"/><path d="M187.0 69h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="158.5" y="58"/><text x="172.75" y="73">3</text></g></g><path d="M187.0 69h20"/></g><path d="M207.0 69a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10"/><path d="M207.0 20a10 10 0 0 1 10 10v29a10 10 0 0 0 10 10"/><g>
<path d="M227.0 69h0.0"/><path d="M295.5 69h0.0"/><path d="M227.0 69a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/><g>
<path d="M247.0 39h0.0"/><path d="M275.5 39h0.0"/><g class="terminal">
<path d="M247.0 39h0.0"/><path d="M275.5 39h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="247.0" y="28"/><text x="261.25" y="43">4</text></g></g><path d="M275.5 39a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><path d="M227.0 69h20"/><g>
<path d="M247.0 69h0.0"/><path d="M275.5 69h0.0"/><g class="terminal">
<path d="M247.0 69h0.0"/><path d="M275.5 69h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="247.0" y="58"/><text x="261.25" y="73">5</text></g></g><path d="M275.5 69h20"/></g><path d="M295.5 69a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10"/><path d="M295.5 20a10 10 0 0 1 10 10v29a10 10 0 0 0 10 10"/><g>
<path d="M315.5 69h0.0"/><path d="M384.0 69h0.0"/><path d="M315.5 69a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/><g>
<path d="M335.5 39h0.0"/><path d="M364.0 39h0.0"/><g class="terminal">
<path d="M335.5 39h0.0"/><path d="M364.0 39h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="335.5" y="28"/><text x="349.75" y="43">a</text></g></g><path d="M364.0 39a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><path d="M315.5 69h20"/><g>
<path d="M335.5 69h0.0"/><path d="M364.0 69h0.0"/><g class="terminal">
<path d="M335.5 69h0.0"/><path d="M364.0 69h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="335.5" y="58"/><text x="349.75" y="73">b</text></g></g><path d="M364.0 69h20"/></g><path d="M384.0 69a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10"/><path d="M384.0 20a10 10 0 0 1 10 10v29a10 10 0 0 0 10 10"/><g>
<path d="M404.0 69h0.0"/><path d="M472.5 69h0.0"/><path d="M404.0 69a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/><g>
<path d="M424.0 39h0.0"/><path d="M452.5 39h0.0"/><g class="terminal">
<path d="M424.0 39h0.0"/><path d="M452.5 39h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="424.0" y="28"/><text x="438.25" y="43">c</text></g></g><path d="M452.5 39a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><path d="M404.0 69h20"/><g>
<path d="M424.0 69h0.0"/><path d="M452.5 69h0.0"/><g class="terminal">
<path d="M424.0 69h0.0"/><path d="M452.5 69h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="424.0" y="58"/><text x="438.25" y="73">d</text></g></g><path d="M452.5 69h20"/></g><path d="M472.5 69a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10"/><path d="M472.5 20a10 10 0 0 1 10 10v29a10 10 0 0 0 10 10"/><g>
<path d="M492.5 69h0.0"/><path d="M561.0 69h0.0"/><path d="M492.5 69a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/><g>
<path d="M512.5 39h0.0"/><path d="M541.0 39h0.0"/><g class="terminal">
<path d="M512.5 39h0.0"/><path d="M541.0 39h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="512.5" y="28"/><text x="526.75" y="43">e</text></g></g><path d="M541.0 39a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><path d="M492.5 69h20"/><g>
<path d="M512.5 69h0.0"/><path d="M541.0 69h0.0"/><g class="terminal">
<path d="M512.5 69h0.0"/><path d="M541.0 69h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="512.5" y="58"/><text x="526.75" y="73">-</text></g></g><path d="M541.0 69h20"/></g><path d="M561.0 69a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10"/><path d="M561.0 20a10 10 0 0 1 10 10v29a10 10 0 0 0 10 10"/><g>
<path d="M581.0 69h0.0"/><path d="M649.5 69h0.0"/><path d="M581.0 69h20"/><g>
<path d="M601.0 69h0.0"/><path d="M629.5 69h0.0"/><g class="terminal">
<path d="M601.0 69h0.0"/><path d="M629.5 69h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="601.0" y="58"/><text x="615.25" y="73">_</text></g></g><path d="M629.5 69h20"/></g><path d="M649.5 69h10"/></g><path d="M 659.5 69 h 20 m -10 -10 v 20 m 10 -20 v 20"/></g></svg>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>In contrast to <a href="Fuzzer.html">basic fuzzing</a> or <a href="MutationFuzzer.html">mutation-based fuzzing</a>, the grammar quickly produces all sorts of combinations:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">simple_grammar_fuzzer</span><span class="p">(</span><span class="n">grammar</span><span class="o">=</span><span class="n">CGI_GRAMMAR</span><span class="p">,</span> <span class="n">max_nonterminals</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>+%9a
+++%ce+
+_
+%c6c
++
+%cd+5
1%ee
%b9%d5
%96
%57d%42
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="A-URL-Grammar">A URL Grammar</h3><p>The same properties we have seen for CGI input also hold for more complex inputs.  Let us use a grammar to produce numerous valid URLs:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">URL_GRAMMAR</span><span class="p">:</span> <span class="n">Grammar</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"&lt;start&gt;"</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">"&lt;url&gt;"</span><span class="p">],</span>
    <span class="s2">"&lt;url&gt;"</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">"&lt;scheme&gt;://&lt;authority&gt;&lt;path&gt;&lt;query&gt;"</span><span class="p">],</span>
    <span class="s2">"&lt;scheme&gt;"</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">"http"</span><span class="p">,</span> <span class="s2">"https"</span><span class="p">,</span> <span class="s2">"ftp"</span><span class="p">,</span> <span class="s2">"ftps"</span><span class="p">],</span>
    <span class="s2">"&lt;authority&gt;"</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">"&lt;host&gt;"</span><span class="p">,</span> <span class="s2">"&lt;host&gt;:&lt;port&gt;"</span><span class="p">,</span> <span class="s2">"&lt;userinfo&gt;@&lt;host&gt;"</span><span class="p">,</span> <span class="s2">"&lt;userinfo&gt;@&lt;host&gt;:&lt;port&gt;"</span><span class="p">],</span>
    <span class="s2">"&lt;host&gt;"</span><span class="p">:</span>  <span class="c1"># Just a few</span>
        <span class="p">[</span><span class="s2">"cispa.saarland"</span><span class="p">,</span> <span class="s2">"www.google.com"</span><span class="p">,</span> <span class="s2">"fuzzingbook.com"</span><span class="p">],</span>
    <span class="s2">"&lt;port&gt;"</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">"80"</span><span class="p">,</span> <span class="s2">"8080"</span><span class="p">,</span> <span class="s2">"&lt;nat&gt;"</span><span class="p">],</span>
    <span class="s2">"&lt;nat&gt;"</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">"&lt;digit&gt;"</span><span class="p">,</span> <span class="s2">"&lt;digit&gt;&lt;digit&gt;"</span><span class="p">],</span>
    <span class="s2">"&lt;digit&gt;"</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">"0"</span><span class="p">,</span> <span class="s2">"1"</span><span class="p">,</span> <span class="s2">"2"</span><span class="p">,</span> <span class="s2">"3"</span><span class="p">,</span> <span class="s2">"4"</span><span class="p">,</span> <span class="s2">"5"</span><span class="p">,</span> <span class="s2">"6"</span><span class="p">,</span> <span class="s2">"7"</span><span class="p">,</span> <span class="s2">"8"</span><span class="p">,</span> <span class="s2">"9"</span><span class="p">],</span>
    <span class="s2">"&lt;userinfo&gt;"</span><span class="p">:</span>  <span class="c1"># Just one</span>
        <span class="p">[</span><span class="s2">"user:password"</span><span class="p">],</span>
    <span class="s2">"&lt;path&gt;"</span><span class="p">:</span>  <span class="c1"># Just a few</span>
        <span class="p">[</span><span class="s2">""</span><span class="p">,</span> <span class="s2">"/"</span><span class="p">,</span> <span class="s2">"/&lt;id&gt;"</span><span class="p">],</span>
    <span class="s2">"&lt;id&gt;"</span><span class="p">:</span>  <span class="c1"># Just a few</span>
        <span class="p">[</span><span class="s2">"abc"</span><span class="p">,</span> <span class="s2">"def"</span><span class="p">,</span> <span class="s2">"x&lt;digit&gt;&lt;digit&gt;"</span><span class="p">],</span>
    <span class="s2">"&lt;query&gt;"</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">""</span><span class="p">,</span> <span class="s2">"?&lt;params&gt;"</span><span class="p">],</span>
    <span class="s2">"&lt;params&gt;"</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">"&lt;param&gt;"</span><span class="p">,</span> <span class="s2">"&lt;param&gt;&amp;&lt;params&gt;"</span><span class="p">],</span>
    <span class="s2">"&lt;param&gt;"</span><span class="p">:</span>  <span class="c1"># Just a few</span>
        <span class="p">[</span><span class="s2">"&lt;id&gt;=&lt;id&gt;"</span><span class="p">,</span> <span class="s2">"&lt;id&gt;=&lt;nat&gt;"</span><span class="p">],</span>
<span class="p">}</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">syntax_diagram</span><span class="p">(</span><span class="n">URL_GRAMMAR</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>start
</pre>
</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<svg class="railroad-diagram" height="62" viewbox="0 0 165.5 62" width="165.5">
<g transform="translate(.5 .5)">
<style>/* &amp;lt;![CDATA[ */
    svg.railroad-diagram {
    }
    svg.railroad-diagram path {
        stroke-width:3;
        stroke:black;
        fill:white;
    }
    svg.railroad-diagram text {
        font:14px "Fira Mono", monospace;
        text-anchor:middle;
    }
    svg.railroad-diagram text.label{
        text-anchor:start;
    }
    svg.railroad-diagram text.comment{
        font:italic 12px "Fira Mono", monospace;
    }
    svg.railroad-diagram rect{
        stroke-width:2;
        stroke:black;
        fill:mistyrose;
    }

/* ]]&amp;gt; */
</style><g>
<path d="M20 21v20m10 -20v20m-10 -10h20"/></g><g>
<path d="M40 31h0.0"/><path d="M125.5 31h0.0"/><path d="M40.0 31h20"/><g>
<path d="M60.0 31h0.0"/><path d="M105.5 31h0.0"/><g class="non-terminal">
<path d="M60.0 31h0.0"/><path d="M105.5 31h0.0"/><rect height="22" width="45.5" x="60.0" y="20"/><text x="82.75" y="35">url</text></g></g><path d="M105.5 31h20"/></g><path d="M 125.5 31 h 20 m -10 -10 v 20 m 10 -20 v 20"/></g></svg>

</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>url
</pre>
</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<svg class="railroad-diagram" height="62" viewbox="0 0 529.5 62" width="529.5">
<g transform="translate(.5 .5)">
<style>/* &amp;lt;![CDATA[ */
    svg.railroad-diagram {
    }
    svg.railroad-diagram path {
        stroke-width:3;
        stroke:black;
        fill:white;
    }
    svg.railroad-diagram text {
        font:14px "Fira Mono", monospace;
        text-anchor:middle;
    }
    svg.railroad-diagram text.label{
        text-anchor:start;
    }
    svg.railroad-diagram text.comment{
        font:italic 12px "Fira Mono", monospace;
    }
    svg.railroad-diagram rect{
        stroke-width:2;
        stroke:black;
        fill:mistyrose;
    }

/* ]]&amp;gt; */
</style><g>
<path d="M20 21v20m10 -20v20m-10 -10h20"/></g><g>
<path d="M40 31h0.0"/><path d="M489.5 31h0.0"/><path d="M40.0 31h20"/><g>
<path d="M60.0 31h0.0"/><path d="M469.5 31h0.0"/><g class="non-terminal">
<path d="M60.0 31h0.0"/><path d="M131.0 31h0.0"/><rect height="22" width="71.0" x="60.0" y="20"/><text x="95.5" y="35">scheme</text></g><path d="M131.0 31h10"/><path d="M141.0 31h10"/><g class="terminal">
<path d="M151.0 31h0.0"/><path d="M196.5 31h0.0"/><rect height="22" rx="10" ry="10" width="45.5" x="151.0" y="20"/><text x="173.75" y="35">://</text></g><path d="M196.5 31h10"/><path d="M206.5 31h10"/><g class="non-terminal">
<path d="M216.5 31h0.0"/><path d="M313.0 31h0.0"/><rect height="22" width="96.5" x="216.5" y="20"/><text x="264.75" y="35">authority</text></g><path d="M313.0 31h10"/><path d="M323.0 31h10"/><g class="non-terminal">
<path d="M333.0 31h0.0"/><path d="M387.0 31h0.0"/><rect height="22" width="54.0" x="333.0" y="20"/><text x="360.0" y="35">path</text></g><path d="M387.0 31h10"/><path d="M397.0 31h10"/><g class="non-terminal">
<path d="M407.0 31h0.0"/><path d="M469.5 31h0.0"/><rect height="22" width="62.5" x="407.0" y="20"/><text x="438.25" y="35">query</text></g></g><path d="M469.5 31h20"/></g><path d="M 489.5 31 h 20 m -10 -10 v 20 m 10 -20 v 20"/></g></svg>

</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>scheme
</pre>
</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<svg class="railroad-diagram" height="152" viewbox="0 0 182.5 152" width="182.5">
<g transform="translate(.5 .5)">
<style>/* &amp;lt;![CDATA[ */
    svg.railroad-diagram {
    }
    svg.railroad-diagram path {
        stroke-width:3;
        stroke:black;
        fill:white;
    }
    svg.railroad-diagram text {
        font:14px "Fira Mono", monospace;
        text-anchor:middle;
    }
    svg.railroad-diagram text.label{
        text-anchor:start;
    }
    svg.railroad-diagram text.comment{
        font:italic 12px "Fira Mono", monospace;
    }
    svg.railroad-diagram rect{
        stroke-width:2;
        stroke:black;
        fill:mistyrose;
    }

/* ]]&amp;gt; */
</style><g>
<path d="M20 81v20m10 -20v20m-10 -10h20"/></g><g>
<path d="M40 91h0.0"/><path d="M142.5 91h0.0"/><path d="M40.0 91a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/><g>
<path d="M60.0 61h0.0"/><path d="M122.5 61h0.0"/><g class="terminal">
<path d="M60.0 61h0.0"/><path d="M122.5 61h0.0"/><rect height="22" rx="10" ry="10" width="62.5" x="60.0" y="50"/><text x="91.25" y="65">https</text></g></g><path d="M122.5 61a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><path d="M40.0 91a10 10 0 0 0 10 -10v-40a10 10 0 0 1 10 -10"/><g>
<path d="M60.0 31h4.25"/><path d="M118.25 31h4.25"/><g class="terminal">
<path d="M64.25 31h0.0"/><path d="M118.25 31h0.0"/><rect height="22" rx="10" ry="10" width="54.0" x="64.25" y="20"/><text x="91.25" y="35">http</text></g></g><path d="M122.5 31a10 10 0 0 1 10 10v40a10 10 0 0 0 10 10"/><path d="M40.0 91h20"/><g>
<path d="M60.0 91h8.5"/><path d="M114.0 91h8.5"/><g class="terminal">
<path d="M68.5 91h0.0"/><path d="M114.0 91h0.0"/><rect height="22" rx="10" ry="10" width="45.5" x="68.5" y="80"/><text x="91.25" y="95">ftp</text></g></g><path d="M122.5 91h20"/><path d="M40.0 91a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><g>
<path d="M60.0 121h4.25"/><path d="M118.25 121h4.25"/><g class="terminal">
<path d="M64.25 121h0.0"/><path d="M118.25 121h0.0"/><rect height="22" rx="10" ry="10" width="54.0" x="64.25" y="110"/><text x="91.25" y="125">ftps</text></g></g><path d="M122.5 121a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/></g><path d="M 142.5 91 h 20 m -10 -10 v 20 m 10 -20 v 20"/></g></svg>

</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>authority
</pre>
</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<svg class="railroad-diagram" height="152" viewbox="0 0 453.0 152" width="453.0">
<g transform="translate(.5 .5)">
<style>/* &amp;lt;![CDATA[ */
    svg.railroad-diagram {
    }
    svg.railroad-diagram path {
        stroke-width:3;
        stroke:black;
        fill:white;
    }
    svg.railroad-diagram text {
        font:14px "Fira Mono", monospace;
        text-anchor:middle;
    }
    svg.railroad-diagram text.label{
        text-anchor:start;
    }
    svg.railroad-diagram text.comment{
        font:italic 12px "Fira Mono", monospace;
    }
    svg.railroad-diagram rect{
        stroke-width:2;
        stroke:black;
        fill:mistyrose;
    }

/* ]]&amp;gt; */
</style><g>
<path d="M20 81v20m10 -20v20m-10 -10h20"/></g><g>
<path d="M40 91h0.0"/><path d="M413.0 91h0.0"/><path d="M40.0 91a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/><g>
<path d="M60.0 61h78.25"/><path d="M314.75 61h78.25"/><g class="non-terminal">
<path d="M138.25 61h0.0"/><path d="M192.25 61h0.0"/><rect height="22" width="54.0" x="138.25" y="50"/><text x="165.25" y="65">host</text></g><path d="M192.25 61h10"/><path d="M202.25 61h10"/><g class="terminal">
<path d="M212.25 61h0.0"/><path d="M240.75 61h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="212.25" y="50"/><text x="226.5" y="65">:</text></g><path d="M240.75 61h10"/><path d="M250.75 61h10"/><g class="non-terminal">
<path d="M260.75 61h0.0"/><path d="M314.75 61h0.0"/><rect height="22" width="54.0" x="260.75" y="50"/><text x="287.75" y="65">port</text></g></g><path d="M393.0 61a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><path d="M40.0 91a10 10 0 0 0 10 -10v-40a10 10 0 0 1 10 -10"/><g>
<path d="M60.0 31h139.5"/><path d="M253.5 31h139.5"/><g class="non-terminal">
<path d="M199.5 31h0.0"/><path d="M253.5 31h0.0"/><rect height="22" width="54.0" x="199.5" y="20"/><text x="226.5" y="35">host</text></g></g><path d="M393.0 31a10 10 0 0 1 10 10v40a10 10 0 0 0 10 10"/><path d="M40.0 91h20"/><g>
<path d="M60.0 91h61.25"/><path d="M331.75 91h61.25"/><g class="non-terminal">
<path d="M121.25 91h0.0"/><path d="M209.25 91h0.0"/><rect height="22" width="88.0" x="121.25" y="80"/><text x="165.25" y="95">userinfo</text></g><path d="M209.25 91h10"/><path d="M219.25 91h10"/><g class="terminal">
<path d="M229.25 91h0.0"/><path d="M257.75 91h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="229.25" y="80"/><text x="243.5" y="95">@</text></g><path d="M257.75 91h10"/><path d="M267.75 91h10"/><g class="non-terminal">
<path d="M277.75 91h0.0"/><path d="M331.75 91h0.0"/><rect height="22" width="54.0" x="277.75" y="80"/><text x="304.75" y="95">host</text></g></g><path d="M393.0 91h20"/><path d="M40.0 91a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><g>
<path d="M60.0 121h0.0"/><path d="M393.0 121h0.0"/><g class="non-terminal">
<path d="M60.0 121h0.0"/><path d="M148.0 121h0.0"/><rect height="22" width="88.0" x="60.0" y="110"/><text x="104.0" y="125">userinfo</text></g><path d="M148.0 121h10"/><path d="M158.0 121h10"/><g class="terminal">
<path d="M168.0 121h0.0"/><path d="M196.5 121h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="168.0" y="110"/><text x="182.25" y="125">@</text></g><path d="M196.5 121h10"/><path d="M206.5 121h10"/><g class="non-terminal">
<path d="M216.5 121h0.0"/><path d="M270.5 121h0.0"/><rect height="22" width="54.0" x="216.5" y="110"/><text x="243.5" y="125">host</text></g><path d="M270.5 121h10"/><path d="M280.5 121h10"/><g class="terminal">
<path d="M290.5 121h0.0"/><path d="M319.0 121h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="290.5" y="110"/><text x="304.75" y="125">:</text></g><path d="M319.0 121h10"/><path d="M329.0 121h10"/><g class="non-terminal">
<path d="M339.0 121h0.0"/><path d="M393.0 121h0.0"/><rect height="22" width="54.0" x="339.0" y="110"/><text x="366.0" y="125">port</text></g></g><path d="M393.0 121a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/></g><path d="M 413.0 91 h 20 m -10 -10 v 20 m 10 -20 v 20"/></g></svg>

</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>host
</pre>
</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<svg class="railroad-diagram" height="122" viewbox="0 0 267.5 122" width="267.5">
<g transform="translate(.5 .5)">
<style>/* &amp;lt;![CDATA[ */
    svg.railroad-diagram {
    }
    svg.railroad-diagram path {
        stroke-width:3;
        stroke:black;
        fill:white;
    }
    svg.railroad-diagram text {
        font:14px "Fira Mono", monospace;
        text-anchor:middle;
    }
    svg.railroad-diagram text.label{
        text-anchor:start;
    }
    svg.railroad-diagram text.comment{
        font:italic 12px "Fira Mono", monospace;
    }
    svg.railroad-diagram rect{
        stroke-width:2;
        stroke:black;
        fill:mistyrose;
    }

/* ]]&amp;gt; */
</style><g>
<path d="M20 51v20m10 -20v20m-10 -10h20"/></g><g>
<path d="M40 61h0.0"/><path d="M227.5 61h0.0"/><path d="M40.0 61a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/><g>
<path d="M60.0 31h4.25"/><path d="M203.25 31h4.25"/><g class="terminal">
<path d="M64.25 31h0.0"/><path d="M203.25 31h0.0"/><rect height="22" rx="10" ry="10" width="139.0" x="64.25" y="20"/><text x="133.75" y="35">cispa.saarland</text></g></g><path d="M207.5 31a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><path d="M40.0 61h20"/><g>
<path d="M60.0 61h4.25"/><path d="M203.25 61h4.25"/><g class="terminal">
<path d="M64.25 61h0.0"/><path d="M203.25 61h0.0"/><rect height="22" rx="10" ry="10" width="139.0" x="64.25" y="50"/><text x="133.75" y="65">www.google.com</text></g></g><path d="M207.5 61h20"/><path d="M40.0 61a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><g>
<path d="M60.0 91h0.0"/><path d="M207.5 91h0.0"/><g class="terminal">
<path d="M60.0 91h0.0"/><path d="M207.5 91h0.0"/><rect height="22" rx="10" ry="10" width="147.5" x="60.0" y="80"/><text x="133.75" y="95">fuzzingbook.com</text></g></g><path d="M207.5 91a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/></g><path d="M 227.5 61 h 20 m -10 -10 v 20 m 10 -20 v 20"/></g></svg>

</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>port
</pre>
</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<svg class="railroad-diagram" height="122" viewbox="0 0 174.0 122" width="174.0">
<g transform="translate(.5 .5)">
<style>/* &amp;lt;![CDATA[ */
    svg.railroad-diagram {
    }
    svg.railroad-diagram path {
        stroke-width:3;
        stroke:black;
        fill:white;
    }
    svg.railroad-diagram text {
        font:14px "Fira Mono", monospace;
        text-anchor:middle;
    }
    svg.railroad-diagram text.label{
        text-anchor:start;
    }
    svg.railroad-diagram text.comment{
        font:italic 12px "Fira Mono", monospace;
    }
    svg.railroad-diagram rect{
        stroke-width:2;
        stroke:black;
        fill:mistyrose;
    }

/* ]]&amp;gt; */
</style><g>
<path d="M20 51v20m10 -20v20m-10 -10h20"/></g><g>
<path d="M40 61h0.0"/><path d="M134.0 61h0.0"/><path d="M40.0 61a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/><g>
<path d="M60.0 31h8.5"/><path d="M105.5 31h8.5"/><g class="terminal">
<path d="M68.5 31h0.0"/><path d="M105.5 31h0.0"/><rect height="22" rx="10" ry="10" width="37.0" x="68.5" y="20"/><text x="87.0" y="35">80</text></g></g><path d="M114.0 31a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><path d="M40.0 61h20"/><g>
<path d="M60.0 61h0.0"/><path d="M114.0 61h0.0"/><g class="terminal">
<path d="M60.0 61h0.0"/><path d="M114.0 61h0.0"/><rect height="22" rx="10" ry="10" width="54.0" x="60.0" y="50"/><text x="87.0" y="65">8080</text></g></g><path d="M114.0 61h20"/><path d="M40.0 61a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><g>
<path d="M60.0 91h4.25"/><path d="M109.75 91h4.25"/><g class="non-terminal">
<path d="M64.25 91h0.0"/><path d="M109.75 91h0.0"/><rect height="22" width="45.5" x="64.25" y="80"/><text x="87.0" y="95">nat</text></g></g><path d="M114.0 91a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/></g><path d="M 134.0 61 h 20 m -10 -10 v 20 m 10 -20 v 20"/></g></svg>

</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>nat
</pre>
</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<svg class="railroad-diagram" height="92" viewbox="0 0 265.0 92" width="265.0">
<g transform="translate(.5 .5)">
<style>/* &amp;lt;![CDATA[ */
    svg.railroad-diagram {
    }
    svg.railroad-diagram path {
        stroke-width:3;
        stroke:black;
        fill:white;
    }
    svg.railroad-diagram text {
        font:14px "Fira Mono", monospace;
        text-anchor:middle;
    }
    svg.railroad-diagram text.label{
        text-anchor:start;
    }
    svg.railroad-diagram text.comment{
        font:italic 12px "Fira Mono", monospace;
    }
    svg.railroad-diagram rect{
        stroke-width:2;
        stroke:black;
        fill:mistyrose;
    }

/* ]]&amp;gt; */
</style><g>
<path d="M20 51v20m10 -20v20m-10 -10h20"/></g><g>
<path d="M40 61h0.0"/><path d="M225.0 61h0.0"/><path d="M40.0 61a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/><g>
<path d="M60.0 31h41.25"/><path d="M163.75 31h41.25"/><g class="non-terminal">
<path d="M101.25 31h0.0"/><path d="M163.75 31h0.0"/><rect height="22" width="62.5" x="101.25" y="20"/><text x="132.5" y="35">digit</text></g></g><path d="M205.0 31a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><path d="M40.0 61h20"/><g>
<path d="M60.0 61h0.0"/><path d="M205.0 61h0.0"/><g class="non-terminal">
<path d="M60.0 61h0.0"/><path d="M122.5 61h0.0"/><rect height="22" width="62.5" x="60.0" y="50"/><text x="91.25" y="65">digit</text></g><path d="M122.5 61h10"/><path d="M132.5 61h10"/><g class="non-terminal">
<path d="M142.5 61h0.0"/><path d="M205.0 61h0.0"/><rect height="22" width="62.5" x="142.5" y="50"/><text x="173.75" y="65">digit</text></g></g><path d="M205.0 61h20"/></g><path d="M 225.0 61 h 20 m -10 -10 v 20 m 10 -20 v 20"/></g></svg>

</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>digit
</pre>
</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<svg class="railroad-diagram" height="109" viewbox="0 0 522.5 109" width="522.5">
<g transform="translate(.5 .5)">
<style>/* &amp;lt;![CDATA[ */
    svg.railroad-diagram {
    }
    svg.railroad-diagram path {
        stroke-width:3;
        stroke:black;
        fill:white;
    }
    svg.railroad-diagram text {
        font:14px "Fira Mono", monospace;
        text-anchor:middle;
    }
    svg.railroad-diagram text.label{
        text-anchor:start;
    }
    svg.railroad-diagram text.comment{
        font:italic 12px "Fira Mono", monospace;
    }
    svg.railroad-diagram rect{
        stroke-width:2;
        stroke:black;
        fill:mistyrose;
    }

/* ]]&amp;gt; */
</style><g>
<path d="M20 59v20m10 -20v20m-10 -10h20"/></g><g>
<path d="M40 69h0.0"/><path d="M482.5 69h0.0"/><path d="M40.0 69a10 10 0 0 0 10 -10v-29a10 10 0 0 1 10 -10h324.0"/><path d="M138.5 89h324.0a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10"/><path d="M40.0 69h10"/><g>
<path d="M50.0 69h0.0"/><path d="M118.5 69h0.0"/><path d="M50.0 69a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/><g>
<path d="M70.0 39h0.0"/><path d="M98.5 39h0.0"/><g class="terminal">
<path d="M70.0 39h0.0"/><path d="M98.5 39h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="70.0" y="28"/><text x="84.25" y="43">0</text></g></g><path d="M98.5 39a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><path d="M50.0 69h20"/><g>
<path d="M70.0 69h0.0"/><path d="M98.5 69h0.0"/><g class="terminal">
<path d="M70.0 69h0.0"/><path d="M98.5 69h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="70.0" y="58"/><text x="84.25" y="73">1</text></g></g><path d="M98.5 69h20"/></g><path d="M118.5 69a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10"/><path d="M118.5 20a10 10 0 0 1 10 10v29a10 10 0 0 0 10 10"/><g>
<path d="M138.5 69h0.0"/><path d="M207.0 69h0.0"/><path d="M138.5 69a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/><g>
<path d="M158.5 39h0.0"/><path d="M187.0 39h0.0"/><g class="terminal">
<path d="M158.5 39h0.0"/><path d="M187.0 39h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="158.5" y="28"/><text x="172.75" y="43">2</text></g></g><path d="M187.0 39a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><path d="M138.5 69h20"/><g>
<path d="M158.5 69h0.0"/><path d="M187.0 69h0.0"/><g class="terminal">
<path d="M158.5 69h0.0"/><path d="M187.0 69h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="158.5" y="58"/><text x="172.75" y="73">3</text></g></g><path d="M187.0 69h20"/></g><path d="M207.0 69a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10"/><path d="M207.0 20a10 10 0 0 1 10 10v29a10 10 0 0 0 10 10"/><g>
<path d="M227.0 69h0.0"/><path d="M295.5 69h0.0"/><path d="M227.0 69a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/><g>
<path d="M247.0 39h0.0"/><path d="M275.5 39h0.0"/><g class="terminal">
<path d="M247.0 39h0.0"/><path d="M275.5 39h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="247.0" y="28"/><text x="261.25" y="43">4</text></g></g><path d="M275.5 39a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><path d="M227.0 69h20"/><g>
<path d="M247.0 69h0.0"/><path d="M275.5 69h0.0"/><g class="terminal">
<path d="M247.0 69h0.0"/><path d="M275.5 69h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="247.0" y="58"/><text x="261.25" y="73">5</text></g></g><path d="M275.5 69h20"/></g><path d="M295.5 69a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10"/><path d="M295.5 20a10 10 0 0 1 10 10v29a10 10 0 0 0 10 10"/><g>
<path d="M315.5 69h0.0"/><path d="M384.0 69h0.0"/><path d="M315.5 69a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/><g>
<path d="M335.5 39h0.0"/><path d="M364.0 39h0.0"/><g class="terminal">
<path d="M335.5 39h0.0"/><path d="M364.0 39h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="335.5" y="28"/><text x="349.75" y="43">6</text></g></g><path d="M364.0 39a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><path d="M315.5 69h20"/><g>
<path d="M335.5 69h0.0"/><path d="M364.0 69h0.0"/><g class="terminal">
<path d="M335.5 69h0.0"/><path d="M364.0 69h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="335.5" y="58"/><text x="349.75" y="73">7</text></g></g><path d="M364.0 69h20"/></g><path d="M384.0 69a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10"/><path d="M384.0 20a10 10 0 0 1 10 10v29a10 10 0 0 0 10 10"/><g>
<path d="M404.0 69h0.0"/><path d="M472.5 69h0.0"/><path d="M404.0 69a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/><g>
<path d="M424.0 39h0.0"/><path d="M452.5 39h0.0"/><g class="terminal">
<path d="M424.0 39h0.0"/><path d="M452.5 39h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="424.0" y="28"/><text x="438.25" y="43">8</text></g></g><path d="M452.5 39a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><path d="M404.0 69h20"/><g>
<path d="M424.0 69h0.0"/><path d="M452.5 69h0.0"/><g class="terminal">
<path d="M424.0 69h0.0"/><path d="M452.5 69h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="424.0" y="58"/><text x="438.25" y="73">9</text></g></g><path d="M452.5 69h20"/></g><path d="M472.5 69h10"/></g><path d="M 482.5 69 h 20 m -10 -10 v 20 m 10 -20 v 20"/></g></svg>

</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>userinfo
</pre>
</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<svg class="railroad-diagram" height="62" viewbox="0 0 250.5 62" width="250.5">
<g transform="translate(.5 .5)">
<style>/* &amp;lt;![CDATA[ */
    svg.railroad-diagram {
    }
    svg.railroad-diagram path {
        stroke-width:3;
        stroke:black;
        fill:white;
    }
    svg.railroad-diagram text {
        font:14px "Fira Mono", monospace;
        text-anchor:middle;
    }
    svg.railroad-diagram text.label{
        text-anchor:start;
    }
    svg.railroad-diagram text.comment{
        font:italic 12px "Fira Mono", monospace;
    }
    svg.railroad-diagram rect{
        stroke-width:2;
        stroke:black;
        fill:mistyrose;
    }

/* ]]&amp;gt; */
</style><g>
<path d="M20 21v20m10 -20v20m-10 -10h20"/></g><g>
<path d="M40 31h0.0"/><path d="M210.5 31h0.0"/><path d="M40.0 31h20"/><g>
<path d="M60.0 31h0.0"/><path d="M190.5 31h0.0"/><g class="terminal">
<path d="M60.0 31h0.0"/><path d="M190.5 31h0.0"/><rect height="22" rx="10" ry="10" width="130.5" x="60.0" y="20"/><text x="125.25" y="35">user:password</text></g></g><path d="M190.5 31h20"/></g><path d="M 210.5 31 h 20 m -10 -10 v 20 m 10 -20 v 20"/></g></svg>

</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>path
</pre>
</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<svg class="railroad-diagram" height="122" viewbox="0 0 205.5 122" width="205.5">
<g transform="translate(.5 .5)">
<style>/* &amp;lt;![CDATA[ */
    svg.railroad-diagram {
    }
    svg.railroad-diagram path {
        stroke-width:3;
        stroke:black;
        fill:white;
    }
    svg.railroad-diagram text {
        font:14px "Fira Mono", monospace;
        text-anchor:middle;
    }
    svg.railroad-diagram text.label{
        text-anchor:start;
    }
    svg.railroad-diagram text.comment{
        font:italic 12px "Fira Mono", monospace;
    }
    svg.railroad-diagram rect{
        stroke-width:2;
        stroke:black;
        fill:mistyrose;
    }

/* ]]&amp;gt; */
</style><g>
<path d="M20 51v20m10 -20v20m-10 -10h20"/></g><g>
<path d="M40 61h0.0"/><path d="M165.5 61h0.0"/><path d="M40.0 61a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/><g>
<path d="M60.0 31h32.75"/><path d="M112.75 31h32.75"/><g class="terminal">
<path d="M92.75 31h0.0"/><path d="M112.75 31h0.0"/><rect height="22" rx="10" ry="10" width="20.0" x="92.75" y="20"/><text x="102.75" y="35"/></g></g><path d="M145.5 31a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><path d="M40.0 61h20"/><g>
<path d="M60.0 61h28.5"/><path d="M117.0 61h28.5"/><g class="terminal">
<path d="M88.5 61h0.0"/><path d="M117.0 61h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="88.5" y="50"/><text x="102.75" y="65">/</text></g></g><path d="M145.5 61h20"/><path d="M40.0 61a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><g>
<path d="M60.0 91h0.0"/><path d="M145.5 91h0.0"/><g class="terminal">
<path d="M60.0 91h0.0"/><path d="M88.5 91h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="60.0" y="80"/><text x="74.25" y="95">/</text></g><path d="M88.5 91h10"/><path d="M98.5 91h10"/><g class="non-terminal">
<path d="M108.5 91h0.0"/><path d="M145.5 91h0.0"/><rect height="22" width="37.0" x="108.5" y="80"/><text x="127.0" y="95">id</text></g></g><path d="M145.5 91a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/></g><path d="M 165.5 61 h 20 m -10 -10 v 20 m 10 -20 v 20"/></g></svg>

</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>id
</pre>
</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<svg class="railroad-diagram" height="122" viewbox="0 0 313.5 122" width="313.5">
<g transform="translate(.5 .5)">
<style>/* &amp;lt;![CDATA[ */
    svg.railroad-diagram {
    }
    svg.railroad-diagram path {
        stroke-width:3;
        stroke:black;
        fill:white;
    }
    svg.railroad-diagram text {
        font:14px "Fira Mono", monospace;
        text-anchor:middle;
    }
    svg.railroad-diagram text.label{
        text-anchor:start;
    }
    svg.railroad-diagram text.comment{
        font:italic 12px "Fira Mono", monospace;
    }
    svg.railroad-diagram rect{
        stroke-width:2;
        stroke:black;
        fill:mistyrose;
    }

/* ]]&amp;gt; */
</style><g>
<path d="M20 51v20m10 -20v20m-10 -10h20"/></g><g>
<path d="M40 61h0.0"/><path d="M273.5 61h0.0"/><path d="M40.0 61a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/><g>
<path d="M60.0 31h74.0"/><path d="M179.5 31h74.0"/><g class="terminal">
<path d="M134.0 31h0.0"/><path d="M179.5 31h0.0"/><rect height="22" rx="10" ry="10" width="45.5" x="134.0" y="20"/><text x="156.75" y="35">abc</text></g></g><path d="M253.5 31a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><path d="M40.0 61h20"/><g>
<path d="M60.0 61h74.0"/><path d="M179.5 61h74.0"/><g class="terminal">
<path d="M134.0 61h0.0"/><path d="M179.5 61h0.0"/><rect height="22" rx="10" ry="10" width="45.5" x="134.0" y="50"/><text x="156.75" y="65">def</text></g></g><path d="M253.5 61h20"/><path d="M40.0 61a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><g>
<path d="M60.0 91h0.0"/><path d="M253.5 91h0.0"/><g class="terminal">
<path d="M60.0 91h0.0"/><path d="M88.5 91h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="60.0" y="80"/><text x="74.25" y="95">x</text></g><path d="M88.5 91h10"/><path d="M98.5 91h10"/><g class="non-terminal">
<path d="M108.5 91h0.0"/><path d="M171.0 91h0.0"/><rect height="22" width="62.5" x="108.5" y="80"/><text x="139.75" y="95">digit</text></g><path d="M171.0 91h10"/><path d="M181.0 91h10"/><g class="non-terminal">
<path d="M191.0 91h0.0"/><path d="M253.5 91h0.0"/><rect height="22" width="62.5" x="191.0" y="80"/><text x="222.25" y="95">digit</text></g></g><path d="M253.5 91a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/></g><path d="M 273.5 61 h 20 m -10 -10 v 20 m 10 -20 v 20"/></g></svg>

</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>query
</pre>
</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<svg class="railroad-diagram" height="92" viewbox="0 0 239.5 92" width="239.5">
<g transform="translate(.5 .5)">
<style>/* &amp;lt;![CDATA[ */
    svg.railroad-diagram {
    }
    svg.railroad-diagram path {
        stroke-width:3;
        stroke:black;
        fill:white;
    }
    svg.railroad-diagram text {
        font:14px "Fira Mono", monospace;
        text-anchor:middle;
    }
    svg.railroad-diagram text.label{
        text-anchor:start;
    }
    svg.railroad-diagram text.comment{
        font:italic 12px "Fira Mono", monospace;
    }
    svg.railroad-diagram rect{
        stroke-width:2;
        stroke:black;
        fill:mistyrose;
    }

/* ]]&amp;gt; */
</style><g>
<path d="M20 51v20m10 -20v20m-10 -10h20"/></g><g>
<path d="M40 61h0.0"/><path d="M199.5 61h0.0"/><path d="M40.0 61a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/><g>
<path d="M60.0 31h49.75"/><path d="M129.75 31h49.75"/><g class="terminal">
<path d="M109.75 31h0.0"/><path d="M129.75 31h0.0"/><rect height="22" rx="10" ry="10" width="20.0" x="109.75" y="20"/><text x="119.75" y="35"/></g></g><path d="M179.5 31a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><path d="M40.0 61h20"/><g>
<path d="M60.0 61h0.0"/><path d="M179.5 61h0.0"/><g class="terminal">
<path d="M60.0 61h0.0"/><path d="M88.5 61h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="60.0" y="50"/><text x="74.25" y="65">?</text></g><path d="M88.5 61h10"/><path d="M98.5 61h10"/><g class="non-terminal">
<path d="M108.5 61h0.0"/><path d="M179.5 61h0.0"/><rect height="22" width="71.0" x="108.5" y="50"/><text x="144.0" y="65">params</text></g></g><path d="M179.5 61h20"/></g><path d="M 199.5 61 h 20 m -10 -10 v 20 m 10 -20 v 20"/></g></svg>

</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>params
</pre>
</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<svg class="railroad-diagram" height="92" viewbox="0 0 322.0 92" width="322.0">
<g transform="translate(.5 .5)">
<style>/* &amp;lt;![CDATA[ */
    svg.railroad-diagram {
    }
    svg.railroad-diagram path {
        stroke-width:3;
        stroke:black;
        fill:white;
    }
    svg.railroad-diagram text {
        font:14px "Fira Mono", monospace;
        text-anchor:middle;
    }
    svg.railroad-diagram text.label{
        text-anchor:start;
    }
    svg.railroad-diagram text.comment{
        font:italic 12px "Fira Mono", monospace;
    }
    svg.railroad-diagram rect{
        stroke-width:2;
        stroke:black;
        fill:mistyrose;
    }

/* ]]&amp;gt; */
</style><g>
<path d="M20 51v20m10 -20v20m-10 -10h20"/></g><g>
<path d="M40 61h0.0"/><path d="M282.0 61h0.0"/><path d="M40.0 61a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/><g>
<path d="M60.0 31h69.75"/><path d="M192.25 31h69.75"/><g class="non-terminal">
<path d="M129.75 31h0.0"/><path d="M192.25 31h0.0"/><rect height="22" width="62.5" x="129.75" y="20"/><text x="161.0" y="35">param</text></g></g><path d="M262.0 31a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><path d="M40.0 61h20"/><g>
<path d="M60.0 61h0.0"/><path d="M262.0 61h0.0"/><g class="non-terminal">
<path d="M60.0 61h0.0"/><path d="M122.5 61h0.0"/><rect height="22" width="62.5" x="60.0" y="50"/><text x="91.25" y="65">param</text></g><path d="M122.5 61h10"/><path d="M132.5 61h10"/><g class="terminal">
<path d="M142.5 61h0.0"/><path d="M171.0 61h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="142.5" y="50"/><text x="156.75" y="65">&amp;</text></g><path d="M171.0 61h10"/><path d="M181.0 61h10"/><g class="non-terminal">
<path d="M191.0 61h0.0"/><path d="M262.0 61h0.0"/><rect height="22" width="71.0" x="191.0" y="50"/><text x="226.5" y="65">params</text></g></g><path d="M262.0 61h20"/></g><path d="M 282.0 61 h 20 m -10 -10 v 20 m 10 -20 v 20"/></g></svg>

</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>param
</pre>
</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<svg class="railroad-diagram" height="92" viewbox="0 0 271.0 92" width="271.0">
<g transform="translate(.5 .5)">
<style>/* &amp;lt;![CDATA[ */
    svg.railroad-diagram {
    }
    svg.railroad-diagram path {
        stroke-width:3;
        stroke:black;
        fill:white;
    }
    svg.railroad-diagram text {
        font:14px "Fira Mono", monospace;
        text-anchor:middle;
    }
    svg.railroad-diagram text.label{
        text-anchor:start;
    }
    svg.railroad-diagram text.comment{
        font:italic 12px "Fira Mono", monospace;
    }
    svg.railroad-diagram rect{
        stroke-width:2;
        stroke:black;
        fill:mistyrose;
    }

/* ]]&amp;gt; */
</style><g>
<path d="M20 51v20m10 -20v20m-10 -10h20"/></g><g>
<path d="M40 61h0.0"/><path d="M231.0 61h0.0"/><path d="M40.0 61a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/><g>
<path d="M60.0 31h4.25"/><path d="M206.75 31h4.25"/><g class="non-terminal">
<path d="M64.25 31h0.0"/><path d="M101.25 31h0.0"/><rect height="22" width="37.0" x="64.25" y="20"/><text x="82.75" y="35">id</text></g><path d="M101.25 31h10"/><path d="M111.25 31h10"/><g class="terminal">
<path d="M121.25 31h0.0"/><path d="M149.75 31h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="121.25" y="20"/><text x="135.5" y="35">=</text></g><path d="M149.75 31h10"/><path d="M159.75 31h10"/><g class="non-terminal">
<path d="M169.75 31h0.0"/><path d="M206.75 31h0.0"/><rect height="22" width="37.0" x="169.75" y="20"/><text x="188.25" y="35">id</text></g></g><path d="M211.0 31a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><path d="M40.0 61h20"/><g>
<path d="M60.0 61h0.0"/><path d="M211.0 61h0.0"/><g class="non-terminal">
<path d="M60.0 61h0.0"/><path d="M97.0 61h0.0"/><rect height="22" width="37.0" x="60.0" y="50"/><text x="78.5" y="65">id</text></g><path d="M97.0 61h10"/><path d="M107.0 61h10"/><g class="terminal">
<path d="M117.0 61h0.0"/><path d="M145.5 61h0.0"/><rect height="22" rx="10" ry="10" width="28.5" x="117.0" y="50"/><text x="131.25" y="65">=</text></g><path d="M145.5 61h10"/><path d="M155.5 61h10"/><g class="non-terminal">
<path d="M165.5 61h0.0"/><path d="M211.0 61h0.0"/><rect height="22" width="45.5" x="165.5" y="50"/><text x="188.25" y="65">nat</text></g></g><path d="M211.0 61h20"/></g><path d="M 231.0 61 h 20 m -10 -10 v 20 m 10 -20 v 20"/></g></svg>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Again, within milliseconds, we can produce plenty of valid inputs.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">simple_grammar_fuzzer</span><span class="p">(</span><span class="n">grammar</span><span class="o">=</span><span class="n">URL_GRAMMAR</span><span class="p">,</span> <span class="n">max_nonterminals</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>https://user:password@cispa.saarland:80/
http://fuzzingbook.com?def=56&amp;x89=3&amp;x46=48&amp;def=def
ftp://cispa.saarland/?x71=5&amp;x35=90&amp;def=abc
https://cispa.saarland:80/def?def=7&amp;x23=abc
https://fuzzingbook.com:80/
https://fuzzingbook.com:80/abc?def=abc&amp;abc=x14&amp;def=abc&amp;abc=2&amp;def=38
ftps://fuzzingbook.com/x87
https://user:password@fuzzingbook.com:6?def=54&amp;x44=abc
http://fuzzingbook.com:80?x33=25&amp;def=8
http://fuzzingbook.com:8080/def
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="A-Natural-Language-Grammar">A Natural Language Grammar</h3><p>Finally, grammars are not limited to <em>formal languages</em> such as computer inputs, but can also be used to produce <em>natural language</em>.  This is the grammar we used to pick a title for this book:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">TITLE_GRAMMAR</span><span class="p">:</span> <span class="n">Grammar</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"&lt;start&gt;"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"&lt;title&gt;"</span><span class="p">],</span>
    <span class="s2">"&lt;title&gt;"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"&lt;topic&gt;: &lt;subtopic&gt;"</span><span class="p">],</span>
    <span class="s2">"&lt;topic&gt;"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"Generating Software Tests"</span><span class="p">,</span> <span class="s2">"&lt;fuzzing-prefix&gt;Fuzzing"</span><span class="p">,</span> <span class="s2">"The Fuzzing Book"</span><span class="p">],</span>
    <span class="s2">"&lt;fuzzing-prefix&gt;"</span><span class="p">:</span> <span class="p">[</span><span class="s2">""</span><span class="p">,</span> <span class="s2">"The Art of "</span><span class="p">,</span> <span class="s2">"The Joy of "</span><span class="p">],</span>
    <span class="s2">"&lt;subtopic&gt;"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"&lt;subtopic-main&gt;"</span><span class="p">,</span>
                   <span class="s2">"&lt;subtopic-prefix&gt;&lt;subtopic-main&gt;"</span><span class="p">,</span>
                   <span class="s2">"&lt;subtopic-main&gt;&lt;subtopic-suffix&gt;"</span><span class="p">],</span>
    <span class="s2">"&lt;subtopic-main&gt;"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"Breaking Software"</span><span class="p">,</span>
                        <span class="s2">"Generating Software Tests"</span><span class="p">,</span>
                        <span class="s2">"Principles, Techniques and Tools"</span><span class="p">],</span>
    <span class="s2">"&lt;subtopic-prefix&gt;"</span><span class="p">:</span> <span class="p">[</span><span class="s2">""</span><span class="p">,</span> <span class="s2">"Tools and Techniques for "</span><span class="p">],</span>
    <span class="s2">"&lt;subtopic-suffix&gt;"</span><span class="p">:</span> <span class="p">[</span><span class="s2">" for &lt;reader-property&gt; and &lt;reader-property&gt;"</span><span class="p">,</span>
                          <span class="s2">" for &lt;software-property&gt; and &lt;software-property&gt;"</span><span class="p">],</span>
    <span class="s2">"&lt;reader-property&gt;"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"Fun"</span><span class="p">,</span> <span class="s2">"Profit"</span><span class="p">],</span>
    <span class="s2">"&lt;software-property&gt;"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"Robustness"</span><span class="p">,</span> <span class="s2">"Reliability"</span><span class="p">,</span> <span class="s2">"Security"</span><span class="p">],</span>
<span class="p">}</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">syntax_diagram</span><span class="p">(</span><span class="n">TITLE_GRAMMAR</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>start
</pre>
</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<svg class="railroad-diagram" height="62" viewbox="0 0 182.5 62" width="182.5">
<g transform="translate(.5 .5)">
<style>/* &amp;lt;![CDATA[ */
    svg.railroad-diagram {
    }
    svg.railroad-diagram path {
        stroke-width:3;
        stroke:black;
        fill:white;
    }
    svg.railroad-diagram text {
        font:14px "Fira Mono", monospace;
        text-anchor:middle;
    }
    svg.railroad-diagram text.label{
        text-anchor:start;
    }
    svg.railroad-diagram text.comment{
        font:italic 12px "Fira Mono", monospace;
    }
    svg.railroad-diagram rect{
        stroke-width:2;
        stroke:black;
        fill:mistyrose;
    }

/* ]]&amp;gt; */
</style><g>
<path d="M20 21v20m10 -20v20m-10 -10h20"/></g><g>
<path d="M40 31h0.0"/><path d="M142.5 31h0.0"/><path d="M40.0 31h20"/><g>
<path d="M60.0 31h0.0"/><path d="M122.5 31h0.0"/><g class="non-terminal">
<path d="M60.0 31h0.0"/><path d="M122.5 31h0.0"/><rect height="22" width="62.5" x="60.0" y="20"/><text x="91.25" y="35">title</text></g></g><path d="M122.5 31h20"/></g><path d="M 142.5 31 h 20 m -10 -10 v 20 m 10 -20 v 20"/></g></svg>

</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>title
</pre>
</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<svg class="railroad-diagram" height="62" viewbox="0 0 347.5 62" width="347.5">
<g transform="translate(.5 .5)">
<style>/* &amp;lt;![CDATA[ */
    svg.railroad-diagram {
    }
    svg.railroad-diagram path {
        stroke-width:3;
        stroke:black;
        fill:white;
    }
    svg.railroad-diagram text {
        font:14px "Fira Mono", monospace;
        text-anchor:middle;
    }
    svg.railroad-diagram text.label{
        text-anchor:start;
    }
    svg.railroad-diagram text.comment{
        font:italic 12px "Fira Mono", monospace;
    }
    svg.railroad-diagram rect{
        stroke-width:2;
        stroke:black;
        fill:mistyrose;
    }

/* ]]&amp;gt; */
</style><g>
<path d="M20 21v20m10 -20v20m-10 -10h20"/></g><g>
<path d="M40 31h0.0"/><path d="M307.5 31h0.0"/><path d="M40.0 31h20"/><g>
<path d="M60.0 31h0.0"/><path d="M287.5 31h0.0"/><g class="non-terminal">
<path d="M60.0 31h0.0"/><path d="M122.5 31h0.0"/><rect height="22" width="62.5" x="60.0" y="20"/><text x="91.25" y="35">topic</text></g><path d="M122.5 31h10"/><path d="M132.5 31h10"/><g class="terminal">
<path d="M142.5 31h0.0"/><path d="M179.5 31h0.0"/><rect height="22" rx="10" ry="10" width="37.0" x="142.5" y="20"/><text x="161.0" y="35">: </text></g><path d="M179.5 31h10"/><path d="M189.5 31h10"/><g class="non-terminal">
<path d="M199.5 31h0.0"/><path d="M287.5 31h0.0"/><rect height="22" width="88.0" x="199.5" y="20"/><text x="243.5" y="35">subtopic</text></g></g><path d="M287.5 31h20"/></g><path d="M 307.5 31 h 20 m -10 -10 v 20 m 10 -20 v 20"/></g></svg>

</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>topic
</pre>
</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<svg class="railroad-diagram" height="122" viewbox="0 0 358.5 122" width="358.5">
<g transform="translate(.5 .5)">
<style>/* &amp;lt;![CDATA[ */
    svg.railroad-diagram {
    }
    svg.railroad-diagram path {
        stroke-width:3;
        stroke:black;
        fill:white;
    }
    svg.railroad-diagram text {
        font:14px "Fira Mono", monospace;
        text-anchor:middle;
    }
    svg.railroad-diagram text.label{
        text-anchor:start;
    }
    svg.railroad-diagram text.comment{
        font:italic 12px "Fira Mono", monospace;
    }
    svg.railroad-diagram rect{
        stroke-width:2;
        stroke:black;
        fill:mistyrose;
    }

/* ]]&amp;gt; */
</style><g>
<path d="M20 51v20m10 -20v20m-10 -10h20"/></g><g>
<path d="M40 61h0.0"/><path d="M318.5 61h0.0"/><path d="M40.0 61a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/><g>
<path d="M60.0 31h3.0"/><path d="M295.5 31h3.0"/><g class="terminal">
<path d="M63.0 31h0.0"/><path d="M295.5 31h0.0"/><rect height="22" rx="10" ry="10" width="232.5" x="63.0" y="20"/><text x="179.25" y="35">Generating Software Tests</text></g></g><path d="M298.5 31a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><path d="M40.0 61h20"/><g>
<path d="M60.0 61h0.0"/><path d="M298.5 61h0.0"/><g class="non-terminal">
<path d="M60.0 61h0.0"/><path d="M199.0 61h0.0"/><rect height="22" width="139.0" x="60.0" y="50"/><text x="129.5" y="65">fuzzing-prefix</text></g><path d="M199.0 61h10"/><path d="M209.0 61h10"/><g class="terminal">
<path d="M219.0 61h0.0"/><path d="M298.5 61h0.0"/><rect height="22" rx="10" ry="10" width="79.5" x="219.0" y="50"/><text x="258.75" y="65">Fuzzing</text></g></g><path d="M298.5 61h20"/><path d="M40.0 61a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><g>
<path d="M60.0 91h41.25"/><path d="M257.25 91h41.25"/><g class="terminal">
<path d="M101.25 91h0.0"/><path d="M257.25 91h0.0"/><rect height="22" rx="10" ry="10" width="156.0" x="101.25" y="80"/><text x="179.25" y="95">The Fuzzing Book</text></g></g><path d="M298.5 91a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/></g><path d="M 318.5 61 h 20 m -10 -10 v 20 m 10 -20 v 20"/></g></svg>

</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>fuzzing-prefix
</pre>
</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<svg class="railroad-diagram" height="122" viewbox="0 0 233.5 122" width="233.5">
<g transform="translate(.5 .5)">
<style>/* &amp;lt;![CDATA[ */
    svg.railroad-diagram {
    }
    svg.railroad-diagram path {
        stroke-width:3;
        stroke:black;
        fill:white;
    }
    svg.railroad-diagram text {
        font:14px "Fira Mono", monospace;
        text-anchor:middle;
    }
    svg.railroad-diagram text.label{
        text-anchor:start;
    }
    svg.railroad-diagram text.comment{
        font:italic 12px "Fira Mono", monospace;
    }
    svg.railroad-diagram rect{
        stroke-width:2;
        stroke:black;
        fill:mistyrose;
    }

/* ]]&amp;gt; */
</style><g>
<path d="M20 51v20m10 -20v20m-10 -10h20"/></g><g>
<path d="M40 61h0.0"/><path d="M193.5 61h0.0"/><path d="M40.0 61a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/><g>
<path d="M60.0 31h46.75"/><path d="M126.75 31h46.75"/><g class="terminal">
<path d="M106.75 31h0.0"/><path d="M126.75 31h0.0"/><rect height="22" rx="10" ry="10" width="20.0" x="106.75" y="20"/><text x="116.75" y="35"/></g></g><path d="M173.5 31a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><path d="M40.0 61h20"/><g>
<path d="M60.0 61h0.0"/><path d="M173.5 61h0.0"/><g class="terminal">
<path d="M60.0 61h0.0"/><path d="M173.5 61h0.0"/><rect height="22" rx="10" ry="10" width="113.5" x="60.0" y="50"/><text x="116.75" y="65">The Art of </text></g></g><path d="M173.5 61h20"/><path d="M40.0 61a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><g>
<path d="M60.0 91h0.0"/><path d="M173.5 91h0.0"/><g class="terminal">
<path d="M60.0 91h0.0"/><path d="M173.5 91h0.0"/><rect height="22" rx="10" ry="10" width="113.5" x="60.0" y="80"/><text x="116.75" y="95">The Joy of </text></g></g><path d="M173.5 91a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/></g><path d="M 193.5 61 h 20 m -10 -10 v 20 m 10 -20 v 20"/></g></svg>

</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>subtopic
</pre>
</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<svg class="railroad-diagram" height="122" viewbox="0 0 418.0 122" width="418.0">
<g transform="translate(.5 .5)">
<style>/* &amp;lt;![CDATA[ */
    svg.railroad-diagram {
    }
    svg.railroad-diagram path {
        stroke-width:3;
        stroke:black;
        fill:white;
    }
    svg.railroad-diagram text {
        font:14px "Fira Mono", monospace;
        text-anchor:middle;
    }
    svg.railroad-diagram text.label{
        text-anchor:start;
    }
    svg.railroad-diagram text.comment{
        font:italic 12px "Fira Mono", monospace;
    }
    svg.railroad-diagram rect{
        stroke-width:2;
        stroke:black;
        fill:mistyrose;
    }

/* ]]&amp;gt; */
</style><g>
<path d="M20 51v20m10 -20v20m-10 -10h20"/></g><g>
<path d="M40 61h0.0"/><path d="M378.0 61h0.0"/><path d="M40.0 61a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/><g>
<path d="M60.0 31h83.75"/><path d="M274.25 31h83.75"/><g class="non-terminal">
<path d="M143.75 31h0.0"/><path d="M274.25 31h0.0"/><rect height="22" width="130.5" x="143.75" y="20"/><text x="209.0" y="35">subtopic-main</text></g></g><path d="M358.0 31a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><path d="M40.0 61h20"/><g>
<path d="M60.0 61h0.0"/><path d="M358.0 61h0.0"/><g class="non-terminal">
<path d="M60.0 61h0.0"/><path d="M207.5 61h0.0"/><rect height="22" width="147.5" x="60.0" y="50"/><text x="133.75" y="65">subtopic-prefix</text></g><path d="M207.5 61h10"/><path d="M217.5 61h10"/><g class="non-terminal">
<path d="M227.5 61h0.0"/><path d="M358.0 61h0.0"/><rect height="22" width="130.5" x="227.5" y="50"/><text x="292.75" y="65">subtopic-main</text></g></g><path d="M358.0 61h20"/><path d="M40.0 61a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><g>
<path d="M60.0 91h0.0"/><path d="M358.0 91h0.0"/><g class="non-terminal">
<path d="M60.0 91h0.0"/><path d="M190.5 91h0.0"/><rect height="22" width="130.5" x="60.0" y="80"/><text x="125.25" y="95">subtopic-main</text></g><path d="M190.5 91h10"/><path d="M200.5 91h10"/><g class="non-terminal">
<path d="M210.5 91h0.0"/><path d="M358.0 91h0.0"/><rect height="22" width="147.5" x="210.5" y="80"/><text x="284.25" y="95">subtopic-suffix</text></g></g><path d="M358.0 91a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/></g><path d="M 378.0 61 h 20 m -10 -10 v 20 m 10 -20 v 20"/></g></svg>

</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>subtopic-main
</pre>
</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<svg class="railroad-diagram" height="122" viewbox="0 0 412.0 122" width="412.0">
<g transform="translate(.5 .5)">
<style>/* &amp;lt;![CDATA[ */
    svg.railroad-diagram {
    }
    svg.railroad-diagram path {
        stroke-width:3;
        stroke:black;
        fill:white;
    }
    svg.railroad-diagram text {
        font:14px "Fira Mono", monospace;
        text-anchor:middle;
    }
    svg.railroad-diagram text.label{
        text-anchor:start;
    }
    svg.railroad-diagram text.comment{
        font:italic 12px "Fira Mono", monospace;
    }
    svg.railroad-diagram rect{
        stroke-width:2;
        stroke:black;
        fill:mistyrose;
    }

/* ]]&amp;gt; */
</style><g>
<path d="M20 51v20m10 -20v20m-10 -10h20"/></g><g>
<path d="M40 61h0.0"/><path d="M372.0 61h0.0"/><path d="M40.0 61a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/><g>
<path d="M60.0 31h63.75"/><path d="M288.25 31h63.75"/><g class="terminal">
<path d="M123.75 31h0.0"/><path d="M288.25 31h0.0"/><rect height="22" rx="10" ry="10" width="164.5" x="123.75" y="20"/><text x="206.0" y="35">Breaking Software</text></g></g><path d="M352.0 31a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><path d="M40.0 61h20"/><g>
<path d="M60.0 61h29.75"/><path d="M322.25 61h29.75"/><g class="terminal">
<path d="M89.75 61h0.0"/><path d="M322.25 61h0.0"/><rect height="22" rx="10" ry="10" width="232.5" x="89.75" y="50"/><text x="206.0" y="65">Generating Software Tests</text></g></g><path d="M352.0 61h20"/><path d="M40.0 61a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><g>
<path d="M60.0 91h0.0"/><path d="M352.0 91h0.0"/><g class="terminal">
<path d="M60.0 91h0.0"/><path d="M352.0 91h0.0"/><rect height="22" rx="10" ry="10" width="292.0" x="60.0" y="80"/><text x="206.0" y="95">Principles, Techniques and Tools</text></g></g><path d="M352.0 91a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/></g><path d="M 372.0 61 h 20 m -10 -10 v 20 m 10 -20 v 20"/></g></svg>

</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>subtopic-prefix
</pre>
</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<svg class="railroad-diagram" height="92" viewbox="0 0 352.5 92" width="352.5">
<g transform="translate(.5 .5)">
<style>/* &amp;lt;![CDATA[ */
    svg.railroad-diagram {
    }
    svg.railroad-diagram path {
        stroke-width:3;
        stroke:black;
        fill:white;
    }
    svg.railroad-diagram text {
        font:14px "Fira Mono", monospace;
        text-anchor:middle;
    }
    svg.railroad-diagram text.label{
        text-anchor:start;
    }
    svg.railroad-diagram text.comment{
        font:italic 12px "Fira Mono", monospace;
    }
    svg.railroad-diagram rect{
        stroke-width:2;
        stroke:black;
        fill:mistyrose;
    }

/* ]]&amp;gt; */
</style><g>
<path d="M20 51v20m10 -20v20m-10 -10h20"/></g><g>
<path d="M40 61h0.0"/><path d="M312.5 61h0.0"/><path d="M40.0 61a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/><g>
<path d="M60.0 31h106.25"/><path d="M186.25 31h106.25"/><g class="terminal">
<path d="M166.25 31h0.0"/><path d="M186.25 31h0.0"/><rect height="22" rx="10" ry="10" width="20.0" x="166.25" y="20"/><text x="176.25" y="35"/></g></g><path d="M292.5 31a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><path d="M40.0 61h20"/><g>
<path d="M60.0 61h0.0"/><path d="M292.5 61h0.0"/><g class="terminal">
<path d="M60.0 61h0.0"/><path d="M292.5 61h0.0"/><rect height="22" rx="10" ry="10" width="232.5" x="60.0" y="50"/><text x="176.25" y="65">Tools and Techniques for </text></g></g><path d="M292.5 61h20"/></g><path d="M 312.5 61 h 20 m -10 -10 v 20 m 10 -20 v 20"/></g></svg>

</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>subtopic-suffix
</pre>
</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<svg class="railroad-diagram" height="92" viewbox="0 0 634.0 92" width="634.0">
<g transform="translate(.5 .5)">
<style>/* &amp;lt;![CDATA[ */
    svg.railroad-diagram {
    }
    svg.railroad-diagram path {
        stroke-width:3;
        stroke:black;
        fill:white;
    }
    svg.railroad-diagram text {
        font:14px "Fira Mono", monospace;
        text-anchor:middle;
    }
    svg.railroad-diagram text.label{
        text-anchor:start;
    }
    svg.railroad-diagram text.comment{
        font:italic 12px "Fira Mono", monospace;
    }
    svg.railroad-diagram rect{
        stroke-width:2;
        stroke:black;
        fill:mistyrose;
    }

/* ]]&amp;gt; */
</style><g>
<path d="M20 51v20m10 -20v20m-10 -10h20"/></g><g>
<path d="M40 61h0.0"/><path d="M594.0 61h0.0"/><path d="M40.0 61a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/><g>
<path d="M60.0 31h17.0"/><path d="M557.0 31h17.0"/><g class="terminal">
<path d="M77.0 31h0.0"/><path d="M139.5 31h0.0"/><rect height="22" rx="10" ry="10" width="62.5" x="77.0" y="20"/><text x="108.25" y="35"> for </text></g><path d="M139.5 31h10"/><path d="M149.5 31h10"/><g class="non-terminal">
<path d="M159.5 31h0.0"/><path d="M307.0 31h0.0"/><rect height="22" width="147.5" x="159.5" y="20"/><text x="233.25" y="35">reader-property</text></g><path d="M307.0 31h10"/><path d="M317.0 31h10"/><g class="terminal">
<path d="M327.0 31h0.0"/><path d="M389.5 31h0.0"/><rect height="22" rx="10" ry="10" width="62.5" x="327.0" y="20"/><text x="358.25" y="35"> and </text></g><path d="M389.5 31h10"/><path d="M399.5 31h10"/><g class="non-terminal">
<path d="M409.5 31h0.0"/><path d="M557.0 31h0.0"/><rect height="22" width="147.5" x="409.5" y="20"/><text x="483.25" y="35">reader-property</text></g></g><path d="M574.0 31a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><path d="M40.0 61h20"/><g>
<path d="M60.0 61h0.0"/><path d="M574.0 61h0.0"/><g class="terminal">
<path d="M60.0 61h0.0"/><path d="M122.5 61h0.0"/><rect height="22" rx="10" ry="10" width="62.5" x="60.0" y="50"/><text x="91.25" y="65"> for </text></g><path d="M122.5 61h10"/><path d="M132.5 61h10"/><g class="non-terminal">
<path d="M142.5 61h0.0"/><path d="M307.0 61h0.0"/><rect height="22" width="164.5" x="142.5" y="50"/><text x="224.75" y="65">software-property</text></g><path d="M307.0 61h10"/><path d="M317.0 61h10"/><g class="terminal">
<path d="M327.0 61h0.0"/><path d="M389.5 61h0.0"/><rect height="22" rx="10" ry="10" width="62.5" x="327.0" y="50"/><text x="358.25" y="65"> and </text></g><path d="M389.5 61h10"/><path d="M399.5 61h10"/><g class="non-terminal">
<path d="M409.5 61h0.0"/><path d="M574.0 61h0.0"/><rect height="22" width="164.5" x="409.5" y="50"/><text x="491.75" y="65">software-property</text></g></g><path d="M574.0 61h20"/></g><path d="M 594.0 61 h 20 m -10 -10 v 20 m 10 -20 v 20"/></g></svg>

</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>reader-property
</pre>
</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<svg class="railroad-diagram" height="92" viewbox="0 0 191.0 92" width="191.0">
<g transform="translate(.5 .5)">
<style>/* &amp;lt;![CDATA[ */
    svg.railroad-diagram {
    }
    svg.railroad-diagram path {
        stroke-width:3;
        stroke:black;
        fill:white;
    }
    svg.railroad-diagram text {
        font:14px "Fira Mono", monospace;
        text-anchor:middle;
    }
    svg.railroad-diagram text.label{
        text-anchor:start;
    }
    svg.railroad-diagram text.comment{
        font:italic 12px "Fira Mono", monospace;
    }
    svg.railroad-diagram rect{
        stroke-width:2;
        stroke:black;
        fill:mistyrose;
    }

/* ]]&amp;gt; */
</style><g>
<path d="M20 51v20m10 -20v20m-10 -10h20"/></g><g>
<path d="M40 61h0.0"/><path d="M151.0 61h0.0"/><path d="M40.0 61a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/><g>
<path d="M60.0 31h12.75"/><path d="M118.25 31h12.75"/><g class="terminal">
<path d="M72.75 31h0.0"/><path d="M118.25 31h0.0"/><rect height="22" rx="10" ry="10" width="45.5" x="72.75" y="20"/><text x="95.5" y="35">Fun</text></g></g><path d="M131.0 31a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><path d="M40.0 61h20"/><g>
<path d="M60.0 61h0.0"/><path d="M131.0 61h0.0"/><g class="terminal">
<path d="M60.0 61h0.0"/><path d="M131.0 61h0.0"/><rect height="22" rx="10" ry="10" width="71.0" x="60.0" y="50"/><text x="95.5" y="65">Profit</text></g></g><path d="M131.0 61h20"/></g><path d="M 151.0 61 h 20 m -10 -10 v 20 m 10 -20 v 20"/></g></svg>

</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>software-property
</pre>
</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<svg class="railroad-diagram" height="122" viewbox="0 0 233.5 122" width="233.5">
<g transform="translate(.5 .5)">
<style>/* &amp;lt;![CDATA[ */
    svg.railroad-diagram {
    }
    svg.railroad-diagram path {
        stroke-width:3;
        stroke:black;
        fill:white;
    }
    svg.railroad-diagram text {
        font:14px "Fira Mono", monospace;
        text-anchor:middle;
    }
    svg.railroad-diagram text.label{
        text-anchor:start;
    }
    svg.railroad-diagram text.comment{
        font:italic 12px "Fira Mono", monospace;
    }
    svg.railroad-diagram rect{
        stroke-width:2;
        stroke:black;
        fill:mistyrose;
    }

/* ]]&amp;gt; */
</style><g>
<path d="M20 51v20m10 -20v20m-10 -10h20"/></g><g>
<path d="M40 61h0.0"/><path d="M193.5 61h0.0"/><path d="M40.0 61a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/><g>
<path d="M60.0 31h4.25"/><path d="M169.25 31h4.25"/><g class="terminal">
<path d="M64.25 31h0.0"/><path d="M169.25 31h0.0"/><rect height="22" rx="10" ry="10" width="105.0" x="64.25" y="20"/><text x="116.75" y="35">Robustness</text></g></g><path d="M173.5 31a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><path d="M40.0 61h20"/><g>
<path d="M60.0 61h0.0"/><path d="M173.5 61h0.0"/><g class="terminal">
<path d="M60.0 61h0.0"/><path d="M173.5 61h0.0"/><rect height="22" rx="10" ry="10" width="113.5" x="60.0" y="50"/><text x="116.75" y="65">Reliability</text></g></g><path d="M173.5 61h20"/><path d="M40.0 61a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"/><g>
<path d="M60.0 91h12.75"/><path d="M160.75 91h12.75"/><g class="terminal">
<path d="M72.75 91h0.0"/><path d="M160.75 91h0.0"/><rect height="22" rx="10" ry="10" width="88.0" x="72.75" y="80"/><text x="116.75" y="95">Security</text></g></g><path d="M173.5 91a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"/></g><path d="M 193.5 61 h 20 m -10 -10 v 20 m 10 -20 v 20"/></g></svg>

</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="kn">from</span> <span class="nn"><a href="https://docs.python.org/3/library/typing.html" class="import" target="_blank">typing</a></span> <span class="kn">import</span> <span class="n">Set</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">titles</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">titles</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
    <span class="n">titles</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">simple_grammar_fuzzer</span><span class="p">(</span>
        <span class="n">grammar</span><span class="o">=</span><span class="n">TITLE_GRAMMAR</span><span class="p">,</span> <span class="n">max_nonterminals</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>
<span class="n">titles</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>{'Fuzzing: Generating Software Tests',
 'Fuzzing: Principles, Techniques and Tools',
 'Generating Software Tests: Breaking Software',
 'Generating Software Tests: Breaking Software for Robustness and Robustness',
 'Generating Software Tests: Principles, Techniques and Tools',
 'Generating Software Tests: Principles, Techniques and Tools for Profit and Fun',
 'Generating Software Tests: Tools and Techniques for Principles, Techniques and Tools',
 'The Fuzzing Book: Breaking Software',
 'The Fuzzing Book: Generating Software Tests for Profit and Profit',
 'The Fuzzing Book: Generating Software Tests for Robustness and Robustness'}
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>(If you find that there is redundancy ("Robustness and Robustness") in here: In <a href="GrammarCoverageFuzzer.html">our chapter on coverage-based fuzzing</a>, we will show how to cover each expansion only once.  And if you like some alternatives more than others, <a href="ProbabilisticGrammarFuzzer.html">probabilistic grammar fuzzing</a> will be there for you.)</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Grammars-as-Mutation-Seeds">Grammars as Mutation Seeds</h2></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>One very useful property of grammars is that they produce mostly valid inputs.  From a syntactical standpoint, the inputs are actually <em>always</em> valid, as they satisfy the constraints of the given grammar.  (Of course, one needs a valid grammar in the first place.)  However, there are also <em>semantic</em> properties that cannot be easily expressed in a grammar.  If, say, for a URL, the port range is supposed to be between 1024 and 2048, this is hard to write in a grammar.  If one has to satisfy more complex constraints, one quickly reaches the limits of what a grammar can express.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>One way around this is to attach constraints to grammars, as we will discuss <a href="FuzzingWithConstraints.html">later in this book</a>.  Another possibility is to put together the strengths of grammar-based fuzzing and <a href="MutationFuzzer.html">mutation-based fuzzing</a>.  The idea is to use the grammar-generated inputs as <em>seeds</em> for further mutation-based fuzzing.  This way, we can explore not only <em>valid</em> inputs, but also check out the <em>boundaries</em> between valid and invalid inputs.  This is particularly interesting as  slightly invalid inputs allow finding parser errors (which are often abundant).  As with fuzzing in general, it is the unexpected which reveals errors in programs.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>To use our generated inputs as seeds, we can feed them directly into the mutation fuzzers introduced earlier:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="kn">from</span> <span class="nn"><a href="MutationFuzzer.html" class="import" target="_blank">MutationFuzzer</a></span> <span class="kn">import</span> <span class="n">MutationFuzzer</span>  <span class="c1"># minor dependency</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">number_of_seeds</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">seeds</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">simple_grammar_fuzzer</span><span class="p">(</span>
        <span class="n">grammar</span><span class="o">=</span><span class="n">URL_GRAMMAR</span><span class="p">,</span>
        <span class="n">max_nonterminals</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_seeds</span><span class="p">)]</span>
<span class="n">seeds</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>['ftps://user:password@www.google.com:80',
 'http://cispa.saarland/',
 'ftp://www.google.com:42/',
 'ftps://user:password@fuzzingbook.com:39?abc=abc',
 'https://www.google.com?x33=1&amp;x06=1',
 'http://www.google.com:02/',
 'https://user:password@www.google.com/',
 'ftp://cispa.saarland:8080/?abc=abc&amp;def=def&amp;abc=5',
 'http://www.google.com:80/def?def=abc',
 'http://user:password@cispa.saarland/']
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">m</span> <span class="o">=</span> <span class="n">MutationFuzzer</span><span class="p">(</span><span class="n">seeds</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">)]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>['ftps://user:password@www.google.com:80',
 'http://cispa.saarland/',
 'ftp://www.google.com:42/',
 'ftps://user:password@fuzzingbook.com:39?abc=abc',
 'https://www.google.com?x33=1&amp;x06=1',
 'http://www.google.com:02/',
 'https://user:password@www.google.com/',
 'ftp://cispa.saarland:8080/?abc=abc&amp;def=def&amp;abc=5',
 'http://www.google.com:80/def?def=abc',
 'http://user:password@cispa.saarland/',
 'Eh4tp:www.coogle.com:80/def?d%f=abc',
 'ftps://}ser:passwod@fuzzingbook.com:9?abc=abc',
 'uftp//cispa.sRaarland:808&amp;0?abc=abc&amp;def=defabc=5',
 'http://user:paswor9d@cispar.saarland/v',
 'ftp://Www.g\x7fogle.cAom:42/',
 'hht://userC:qassMword@cispy.csaarland/',
 'httx://ww.googlecom:80defde`f=ac',
 'htt://cispq.waarlnd/',
 'htFtp\t://cmspa./saarna(md/',
 'ft:/www.google.com:42\x0f']
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>While the first 10 <code>fuzz()</code> calls return the seeded inputs (as designed), the later ones again create arbitrary mutations.  Using <code>MutationCoverageFuzzer</code> instead of <code>MutationFuzzer</code>, we could again have our search guided by coverage – and thus bring together the best of multiple worlds.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="A-Grammar-Toolbox">A Grammar Toolbox</h2><p>Let us now introduce a few techniques that help us writing grammars.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Escapes">Escapes</h3><p>With <code>&lt;</code> and <code>&gt;</code> delimiting nonterminals in our grammars, how can we actually express that some input should contain <code>&lt;</code> and <code>&gt;</code>?  The answer is simple: Just introduce a symbol for them.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">simple_nonterminal_grammar</span><span class="p">:</span> <span class="n">Grammar</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"&lt;start&gt;"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"&lt;nonterminal&gt;"</span><span class="p">],</span>
    <span class="s2">"&lt;nonterminal&gt;"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"&lt;left-angle&gt;&lt;identifier&gt;&lt;right-angle&gt;"</span><span class="p">],</span>
    <span class="s2">"&lt;left-angle&gt;"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"&lt;"</span><span class="p">],</span>
    <span class="s2">"&lt;right-angle&gt;"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"&gt;"</span><span class="p">],</span>
    <span class="s2">"&lt;identifier&gt;"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"id"</span><span class="p">]</span>  <span class="c1"># for now</span>
<span class="p">}</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>In <code>simple_nonterminal_grammar</code>, neither the expansion for <code>&lt;left-angle&gt;</code> nor the expansion for <code>&lt;right-angle&gt;</code> can be mistaken for a nonterminal. Hence, we can produce as many as we want.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>(Note that this does not work with <code>simple_grammar_fuzzer()</code>, but rather with the <code>GrammarFuzzer</code> class we'll introduce in the next chapter.)</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Extending-Grammars">Extending Grammars</h3><p>In the course of this book, we frequently run into the issue of creating a grammar by <em>extending</em> an existing grammar with new features.  Such an extension is very much like subclassing in object-oriented programming.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>To create a new grammar $g'$ from an existing grammar $g$, we first copy $g$ into $g'$, and then go and extend existing rules with new alternatives and/or add new symbols.  Here's an example, extending the above <code>nonterminal</code> grammar with a better rule for identifiers:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/copy.html" class="import" target="_blank">copy</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">nonterminal_grammar</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">simple_nonterminal_grammar</span><span class="p">)</span>
<span class="n">nonterminal_grammar</span><span class="p">[</span><span class="s2">"&lt;identifier&gt;"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"&lt;idchar&gt;"</span><span class="p">,</span> <span class="s2">"&lt;identifier&gt;&lt;idchar&gt;"</span><span class="p">]</span>
<span class="n">nonterminal_grammar</span><span class="p">[</span><span class="s2">"&lt;idchar&gt;"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'a'</span><span class="p">,</span> <span class="s1">'b'</span><span class="p">,</span> <span class="s1">'c'</span><span class="p">,</span> <span class="s1">'d'</span><span class="p">]</span>  <span class="c1"># for now</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">nonterminal_grammar</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>{'&lt;start&gt;': ['&lt;nonterminal&gt;'],
 '&lt;nonterminal&gt;': ['&lt;left-angle&gt;&lt;identifier&gt;&lt;right-angle&gt;'],
 '&lt;left-angle&gt;': ['&lt;'],
 '&lt;right-angle&gt;': ['&gt;'],
 '&lt;identifier&gt;': ['&lt;idchar&gt;', '&lt;identifier&gt;&lt;idchar&gt;'],
 '&lt;idchar&gt;': ['a', 'b', 'c', 'd']}
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Since such an extension of grammars is a common operation, we introduce a custom function <code>extend_grammar()</code> which first copies the given grammar and then updates it from a dictionary, using the Python dictionary <code>update()</code> method:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">extend_grammar</span><span class="p">(</span><span class="n">grammar</span><span class="p">:</span> <span class="n">Grammar</span><span class="p">,</span> <span class="n">extension</span><span class="p">:</span> <span class="n">Grammar</span> <span class="o">=</span> <span class="p">{})</span> <span class="o">-&gt;</span> <span class="n">Grammar</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Create a copy of `grammar`, updated with `extension`."""</span>
    <span class="n">new_grammar</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">grammar</span><span class="p">)</span>
    <span class="n">new_grammar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">extension</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">new_grammar</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>This call to <code>extend_grammar()</code> extends <code>simple_nonterminal_grammar</code> to <code>nonterminal_grammar</code> just like the "manual" example above:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">nonterminal_grammar</span> <span class="o">=</span> <span class="n">extend_grammar</span><span class="p">(</span><span class="n">simple_nonterminal_grammar</span><span class="p">,</span>
                                     <span class="p">{</span>
                                         <span class="s2">"&lt;identifier&gt;"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"&lt;idchar&gt;"</span><span class="p">,</span> <span class="s2">"&lt;identifier&gt;&lt;idchar&gt;"</span><span class="p">],</span>
                                         <span class="c1"># for now</span>
                                         <span class="s2">"&lt;idchar&gt;"</span><span class="p">:</span> <span class="p">[</span><span class="s1">'a'</span><span class="p">,</span> <span class="s1">'b'</span><span class="p">,</span> <span class="s1">'c'</span><span class="p">,</span> <span class="s1">'d'</span><span class="p">]</span>
                                     <span class="p">}</span>
                                     <span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Character-Classes">Character Classes</h3></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>In the above <code>nonterminal_grammar</code>, we have enumerated only the first few letters; indeed, enumerating all letters or digits in a grammar manually, as in <code>&lt;idchar&gt; ::= 'a' | 'b' | 'c' ...</code> is a bit painful.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>However, remember that grammars are part of a program, and can thus also be constructed programmatically.  We introduce a function <code>srange()</code> which constructs a list of characters in a string:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/string.html" class="import" target="_blank">string</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">srange</span><span class="p">(</span><span class="n">characters</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Expansion</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">"""Construct a list with all characters in the string"""</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">characters</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>If we pass it the constant <code>string.ascii_letters</code>, which holds all ASCII letters, <code>srange()</code> returns a list of all ASCII letters:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ'
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">srange</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span><span class="p">)[:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j']
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We can use such constants in our grammar to quickly define identifiers:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">nonterminal_grammar</span> <span class="o">=</span> <span class="n">extend_grammar</span><span class="p">(</span><span class="n">nonterminal_grammar</span><span class="p">,</span>
                                     <span class="p">{</span>
                                         <span class="s2">"&lt;idchar&gt;"</span><span class="p">:</span> <span class="p">(</span><span class="n">srange</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span><span class="p">)</span> <span class="o">+</span> 
                                                      <span class="n">srange</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">digits</span><span class="p">)</span> <span class="o">+</span> 
                                                      <span class="n">srange</span><span class="p">(</span><span class="s2">"-_"</span><span class="p">))</span>
                                     <span class="p">}</span>
                                     <span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="p">[</span><span class="n">simple_grammar_fuzzer</span><span class="p">(</span><span class="n">nonterminal_grammar</span><span class="p">,</span> <span class="s2">"&lt;identifier&gt;"</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>['b', 'd', 'V9', 'x4c', 'YdiEWj', 'c', 'xd', '7', 'vIU', 'QhKD']
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The shortcut <code>crange(start, end)</code> returns a list of all characters in the ASCII range of <code>start</code> to (including) <code>end</code>:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">crange</span><span class="p">(</span><span class="n">character_start</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">character_end</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Expansion</span><span class="p">]:</span>
    <span class="k">return</span> <span class="p">[</span><span class="nb">chr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">character_start</span><span class="p">),</span> <span class="nb">ord</span><span class="p">(</span><span class="n">character_end</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We can use this to express ranges of characters:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">crange</span><span class="p">(</span><span class="s1">'0'</span><span class="p">,</span> <span class="s1">'9'</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>['0', '1', '2', '3', '4', '5', '6', '7', '8', '9']
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">assert</span> <span class="n">crange</span><span class="p">(</span><span class="s1">'a'</span><span class="p">,</span> <span class="s1">'z'</span><span class="p">)</span> <span class="o">==</span> <span class="n">srange</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Grammar-Shortcuts">Grammar Shortcuts</h3></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>In the above <code>nonterminal_grammar</code>, as in other grammars, we have to express repetitions of characters using <em>recursion</em>, that is, by referring to the original definition:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">nonterminal_grammar</span><span class="p">[</span><span class="s2">"&lt;identifier&gt;"</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>['&lt;idchar&gt;', '&lt;identifier&gt;&lt;idchar&gt;']
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>It could be a bit easier if we simply could state that a nonterminal should be a non-empty sequence of letters – for instance, as in</p>

<pre><code>&lt;identifier&gt; = &lt;idchar&gt;+</code></pre>
<p>where <code>+</code> denotes a non-empty repetition of the symbol it follows.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Operators such as <code>+</code> are frequently introduced as handy <em>shortcuts</em> in grammars.  Formally, our grammars come in the so-called <a href="https://en.wikipedia.org/wiki/Backus-Naur_form">Backus-Naur form</a>, or <em>BNF</em> for short.  Operators <em>extend</em> BNF to so-called _extended BNF<em>, or </em>EBNF* for short:</p>
<ul>
<li>The form <code>&lt;symbol&gt;?</code> indicates that <code>&lt;symbol&gt;</code> is optional – that is, it can occur 0 or 1 times.</li>
<li>The form <code>&lt;symbol&gt;+</code> indicates that <code>&lt;symbol&gt;</code> can occur 1 or more times repeatedly.</li>
<li>The form <code>&lt;symbol&gt;*</code> indicates that <code>&lt;symbol&gt;</code> can occur 0 or more times.  (In other words, it is an optional repetition.)</li>
</ul>
<p>To make matters even more interesting, we would like to use <em>parentheses</em> with the above shortcuts.  Thus, <code>(&lt;foo&gt;&lt;bar&gt;)?</code> indicates that the sequence of <code>&lt;foo&gt;</code> and <code>&lt;bar&gt;</code> is optional.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Using such operators, we can define the identifier rule in a simpler way.  To this end, let us create a copy of the original grammar and modify the <code>&lt;identifier&gt;</code> rule:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">nonterminal_ebnf_grammar</span> <span class="o">=</span> <span class="n">extend_grammar</span><span class="p">(</span><span class="n">nonterminal_grammar</span><span class="p">,</span>
                                          <span class="p">{</span>
                                              <span class="s2">"&lt;identifier&gt;"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"&lt;idchar&gt;+"</span><span class="p">]</span>
                                          <span class="p">}</span>
                                          <span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Likewise, we can simplify the expression grammar.  Consider how signs are optional, and how integers can be expressed as sequences of digits.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">EXPR_EBNF_GRAMMAR</span><span class="p">:</span> <span class="n">Grammar</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"&lt;start&gt;"</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">"&lt;expr&gt;"</span><span class="p">],</span>

    <span class="s2">"&lt;expr&gt;"</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">"&lt;term&gt; + &lt;expr&gt;"</span><span class="p">,</span> <span class="s2">"&lt;term&gt; - &lt;expr&gt;"</span><span class="p">,</span> <span class="s2">"&lt;term&gt;"</span><span class="p">],</span>

    <span class="s2">"&lt;term&gt;"</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">"&lt;factor&gt; * &lt;term&gt;"</span><span class="p">,</span> <span class="s2">"&lt;factor&gt; / &lt;term&gt;"</span><span class="p">,</span> <span class="s2">"&lt;factor&gt;"</span><span class="p">],</span>

    <span class="s2">"&lt;factor&gt;"</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">"&lt;sign&gt;?&lt;factor&gt;"</span><span class="p">,</span> <span class="s2">"(&lt;expr&gt;)"</span><span class="p">,</span> <span class="s2">"&lt;integer&gt;(.&lt;integer&gt;)?"</span><span class="p">],</span>

    <span class="s2">"&lt;sign&gt;"</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">"+"</span><span class="p">,</span> <span class="s2">"-"</span><span class="p">],</span>

    <span class="s2">"&lt;integer&gt;"</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">"&lt;digit&gt;+"</span><span class="p">],</span>

    <span class="s2">"&lt;digit&gt;"</span><span class="p">:</span>
        <span class="n">srange</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">digits</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let us implement a function <code>convert_ebnf_grammar()</code> that takes such an EBNF grammar and automatically translates it into a BNF grammar.</p>
</div>
</div>
</div>
</div>

<details id="Excursion:-Implementing-convert_ebnf_grammar()">
<summary>Implementing <code>convert_ebnf_grammar()</code></summary>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Our aim is to convert EBNF grammars such as the ones above into a regular BNF grammar.  This is done by four rules:</p>
<ol>
<li>An expression <code>(content)op</code>, where <code>op</code> is one of <code>?</code>, <code>+</code>, <code>*</code>, becomes <code>&lt;new-symbol&gt;op</code>, with a new rule <code>&lt;new-symbol&gt; ::= content</code>.</li>
<li>An expression <code>&lt;symbol&gt;?</code> becomes <code>&lt;new-symbol&gt;</code>, where <code>&lt;new-symbol&gt; ::= &lt;empty&gt; | &lt;symbol&gt;</code>.</li>
<li>An expression <code>&lt;symbol&gt;+</code> becomes <code>&lt;new-symbol&gt;</code>, where <code>&lt;new-symbol&gt; ::= &lt;symbol&gt; | &lt;symbol&gt;&lt;new-symbol&gt;</code>.</li>
<li>An expression <code>&lt;symbol&gt;*</code> becomes <code>&lt;new-symbol&gt;</code>, where <code>&lt;new-symbol&gt; ::= &lt;empty&gt; | &lt;symbol&gt;&lt;new-symbol&gt;</code>.</li>
</ol>
<p>Here, <code>&lt;empty&gt;</code> expands to the empty string, as in <code>&lt;empty&gt; ::=</code>.  (This is also called an <em>epsilon expansion</em>.)</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>If these operators remind you of <em>regular expressions</em>, this is not by accident: Actually, any basic regular expression can be converted into a grammar using the above rules (and character classes with <code>crange()</code>, as defined above).</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Applying these rules on the examples above yields the following results:</p>
<ul>
<li><code>&lt;idchar&gt;+</code> becomes <code>&lt;idchar&gt;&lt;new-symbol&gt;</code> with <code>&lt;new-symbol&gt; ::= &lt;idchar&gt; | &lt;idchar&gt;&lt;new-symbol&gt;</code>.  </li>
<li><code>&lt;integer&gt;(.&lt;integer&gt;)?</code> becomes <code>&lt;integer&gt;&lt;new-symbol&gt;</code> with <code>&lt;new-symbol&gt; ::= &lt;empty&gt; | .&lt;integer&gt;</code>.</li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let us implement these rules in three steps.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h5 id="Creating-New-Symbols">Creating New Symbols</h5><p>First, we need a mechanism to create new symbols.  This is fairly straightforward.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">new_symbol</span><span class="p">(</span><span class="n">grammar</span><span class="p">:</span> <span class="n">Grammar</span><span class="p">,</span> <span class="n">symbol_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"&lt;symbol&gt;"</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Return a new symbol for `grammar` based on `symbol_name`"""</span>
    <span class="k">if</span> <span class="n">symbol_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">grammar</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">symbol_name</span>

    <span class="n">count</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">tentative_symbol_name</span> <span class="o">=</span> <span class="n">symbol_name</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">"-"</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">count</span><span class="p">)</span> <span class="o">+</span> <span class="s2">"&gt;"</span>
        <span class="k">if</span> <span class="n">tentative_symbol_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">grammar</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">tentative_symbol_name</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">assert</span> <span class="n">new_symbol</span><span class="p">(</span><span class="n">EXPR_EBNF_GRAMMAR</span><span class="p">,</span> <span class="s1">'&lt;expr&gt;'</span><span class="p">)</span> <span class="o">==</span> <span class="s1">'&lt;expr-1&gt;'</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h5 id="Expanding-Parenthesized-Expressions">Expanding Parenthesized Expressions</h5></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Next, we need a means to extract parenthesized expressions from our expansions and expand them according to the rules above.  Let's start with extracting expressions:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">RE_PARENTHESIZED_EXPR</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">'\([^()]*\)[?+*]'</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">parenthesized_expressions</span><span class="p">(</span><span class="n">expansion</span><span class="p">:</span> <span class="n">Expansion</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="c1"># In later chapters, we allow expansions to be tuples,</span>
    <span class="c1"># with the expansion being the first element</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expansion</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="n">expansion</span> <span class="o">=</span> <span class="n">expansion</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">RE_PARENTHESIZED_EXPR</span><span class="p">,</span> <span class="n">expansion</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">assert</span> <span class="n">parenthesized_expressions</span><span class="p">(</span><span class="s2">"(&lt;foo&gt;)* (&lt;foo&gt;&lt;bar&gt;)+ (+&lt;foo&gt;)? &lt;integer&gt;(.&lt;integer&gt;)?"</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span>
    <span class="s1">'(&lt;foo&gt;)*'</span><span class="p">,</span> <span class="s1">'(&lt;foo&gt;&lt;bar&gt;)+'</span><span class="p">,</span> <span class="s1">'(+&lt;foo&gt;)?'</span><span class="p">,</span> <span class="s1">'(.&lt;integer&gt;)?'</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We can now use these to apply rule number 1, above, introducing new symbols for expressions in parentheses.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">convert_ebnf_parentheses</span><span class="p">(</span><span class="n">ebnf_grammar</span><span class="p">:</span> <span class="n">Grammar</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Grammar</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Convert a grammar in extended BNF to BNF"""</span>
    <span class="n">grammar</span> <span class="o">=</span> <span class="n">extend_grammar</span><span class="p">(</span><span class="n">ebnf_grammar</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">nonterminal</span> <span class="ow">in</span> <span class="n">ebnf_grammar</span><span class="p">:</span>
        <span class="n">expansions</span> <span class="o">=</span> <span class="n">ebnf_grammar</span><span class="p">[</span><span class="n">nonterminal</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">expansions</span><span class="p">)):</span>
            <span class="n">expansion</span> <span class="o">=</span> <span class="n">expansions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expansion</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">expansion</span> <span class="o">=</span> <span class="n">expansion</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">parenthesized_exprs</span> <span class="o">=</span> <span class="n">parenthesized_expressions</span><span class="p">(</span><span class="n">expansion</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parenthesized_exprs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">break</span>

                <span class="k">for</span> <span class="n">expr</span> <span class="ow">in</span> <span class="n">parenthesized_exprs</span><span class="p">:</span>
                    <span class="n">operator</span> <span class="o">=</span> <span class="n">expr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span>
                    <span class="n">contents</span> <span class="o">=</span> <span class="n">expr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>

                    <span class="n">new_sym</span> <span class="o">=</span> <span class="n">new_symbol</span><span class="p">(</span><span class="n">grammar</span><span class="p">)</span>

                    <span class="n">exp</span> <span class="o">=</span> <span class="n">grammar</span><span class="p">[</span><span class="n">nonterminal</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">opts</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exp</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                        <span class="p">(</span><span class="n">exp</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span> <span class="o">=</span> <span class="n">exp</span>
                    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exp</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>

                    <span class="n">expansion</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">new_sym</span> <span class="o">+</span> <span class="n">operator</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">opts</span><span class="p">:</span>
                        <span class="n">grammar</span><span class="p">[</span><span class="n">nonterminal</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">expansion</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">grammar</span><span class="p">[</span><span class="n">nonterminal</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">expansion</span>

                    <span class="n">grammar</span><span class="p">[</span><span class="n">new_sym</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">contents</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">grammar</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>This does the conversion as sketched above:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">convert_ebnf_parentheses</span><span class="p">({</span><span class="s2">"&lt;number&gt;"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"&lt;integer&gt;(.&lt;integer&gt;)?"</span><span class="p">]})</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>{'&lt;number&gt;': ['&lt;integer&gt;&lt;symbol&gt;?'], '&lt;symbol&gt;': ['.&lt;integer&gt;']}
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>It even works for nested parenthesized expressions:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">convert_ebnf_parentheses</span><span class="p">({</span><span class="s2">"&lt;foo&gt;"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"((&lt;foo&gt;)?)+"</span><span class="p">]})</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>{'&lt;foo&gt;': ['&lt;symbol-1&gt;+'], '&lt;symbol&gt;': ['&lt;foo&gt;'], '&lt;symbol-1&gt;': ['&lt;symbol&gt;?']}
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h5 id="Expanding-Operators">Expanding Operators</h5><p>After expanding parenthesized expressions, we now need to take care of symbols followed by operators (<code>?</code>, <code>*</code>, <code>+</code>).  As with <code>convert_ebnf_parentheses()</code>, above, we first extract all symbols followed by an operator.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">RE_EXTENDED_NONTERMINAL</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">'(&lt;[^&lt;&gt; ]*&gt;[?+*])'</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">extended_nonterminals</span><span class="p">(</span><span class="n">expansion</span><span class="p">:</span> <span class="n">Expansion</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="c1"># In later chapters, we allow expansions to be tuples,</span>
    <span class="c1"># with the expansion being the first element</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expansion</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="n">expansion</span> <span class="o">=</span> <span class="n">expansion</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">RE_EXTENDED_NONTERMINAL</span><span class="p">,</span> <span class="n">expansion</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">assert</span> <span class="n">extended_nonterminals</span><span class="p">(</span>
    <span class="s2">"&lt;foo&gt;* &lt;bar&gt;+ &lt;elem&gt;? &lt;none&gt;"</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="s1">'&lt;foo&gt;*'</span><span class="p">,</span> <span class="s1">'&lt;bar&gt;+'</span><span class="p">,</span> <span class="s1">'&lt;elem&gt;?'</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Our converter extracts the symbol and the operator, and adds new symbols according to the rules laid out above.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">convert_ebnf_operators</span><span class="p">(</span><span class="n">ebnf_grammar</span><span class="p">:</span> <span class="n">Grammar</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Grammar</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Convert a grammar in extended BNF to BNF"""</span>
    <span class="n">grammar</span> <span class="o">=</span> <span class="n">extend_grammar</span><span class="p">(</span><span class="n">ebnf_grammar</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">nonterminal</span> <span class="ow">in</span> <span class="n">ebnf_grammar</span><span class="p">:</span>
        <span class="n">expansions</span> <span class="o">=</span> <span class="n">ebnf_grammar</span><span class="p">[</span><span class="n">nonterminal</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">expansions</span><span class="p">)):</span>
            <span class="n">expansion</span> <span class="o">=</span> <span class="n">expansions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">extended_symbols</span> <span class="o">=</span> <span class="n">extended_nonterminals</span><span class="p">(</span><span class="n">expansion</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">extended_symbol</span> <span class="ow">in</span> <span class="n">extended_symbols</span><span class="p">:</span>
                <span class="n">operator</span> <span class="o">=</span> <span class="n">extended_symbol</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span>
                <span class="n">original_symbol</span> <span class="o">=</span> <span class="n">extended_symbol</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">assert</span> <span class="n">original_symbol</span> <span class="ow">in</span> <span class="n">ebnf_grammar</span><span class="p">,</span> \
                    <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">original_symbol</span><span class="si">}</span><span class="s2"> is not defined in grammar"</span>

                <span class="n">new_sym</span> <span class="o">=</span> <span class="n">new_symbol</span><span class="p">(</span><span class="n">grammar</span><span class="p">,</span> <span class="n">original_symbol</span><span class="p">)</span>

                <span class="n">exp</span> <span class="o">=</span> <span class="n">grammar</span><span class="p">[</span><span class="n">nonterminal</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                <span class="n">opts</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exp</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                    <span class="p">(</span><span class="n">exp</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span> <span class="o">=</span> <span class="n">exp</span>
                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exp</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>

                <span class="n">new_exp</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">extended_symbol</span><span class="p">,</span> <span class="n">new_sym</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">opts</span><span class="p">:</span>
                    <span class="n">grammar</span><span class="p">[</span><span class="n">nonterminal</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">new_exp</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">grammar</span><span class="p">[</span><span class="n">nonterminal</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_exp</span>

                <span class="k">if</span> <span class="n">operator</span> <span class="o">==</span> <span class="s1">'?'</span><span class="p">:</span>
                    <span class="n">grammar</span><span class="p">[</span><span class="n">new_sym</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">""</span><span class="p">,</span> <span class="n">original_symbol</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="s1">'*'</span><span class="p">:</span>
                    <span class="n">grammar</span><span class="p">[</span><span class="n">new_sym</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">""</span><span class="p">,</span> <span class="n">original_symbol</span> <span class="o">+</span> <span class="n">new_sym</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="s1">'+'</span><span class="p">:</span>
                    <span class="n">grammar</span><span class="p">[</span><span class="n">new_sym</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">original_symbol</span><span class="p">,</span> <span class="n">original_symbol</span> <span class="o">+</span> <span class="n">new_sym</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">grammar</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">convert_ebnf_operators</span><span class="p">({</span><span class="s2">"&lt;integer&gt;"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"&lt;digit&gt;+"</span><span class="p">],</span> <span class="s2">"&lt;digit&gt;"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"0"</span><span class="p">]})</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>{'&lt;integer&gt;': ['&lt;digit-1&gt;'],
 '&lt;digit&gt;': ['0'],
 '&lt;digit-1&gt;': ['&lt;digit&gt;', '&lt;digit&gt;&lt;digit-1&gt;']}
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h5 id="All-Together">All Together</h5><p>We can combine the two, first extending parentheses and then operators:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">convert_ebnf_grammar</span><span class="p">(</span><span class="n">ebnf_grammar</span><span class="p">:</span> <span class="n">Grammar</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Grammar</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">convert_ebnf_operators</span><span class="p">(</span><span class="n">convert_ebnf_parentheses</span><span class="p">(</span><span class="n">ebnf_grammar</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

</details>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Here's an example of using <code>convert_ebnf_grammar()</code>:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">convert_ebnf_grammar</span><span class="p">({</span><span class="s2">"&lt;authority&gt;"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"(&lt;userinfo&gt;@)?&lt;host&gt;(:&lt;port&gt;)?"</span><span class="p">]})</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>{'&lt;authority&gt;': ['&lt;symbol-2&gt;&lt;host&gt;&lt;symbol-1-1&gt;'],
 '&lt;symbol&gt;': ['&lt;userinfo&gt;@'],
 '&lt;symbol-1&gt;': [':&lt;port&gt;'],
 '&lt;symbol-2&gt;': ['', '&lt;symbol&gt;'],
 '&lt;symbol-1-1&gt;': ['', '&lt;symbol-1&gt;']}
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">expr_grammar</span> <span class="o">=</span> <span class="n">convert_ebnf_grammar</span><span class="p">(</span><span class="n">EXPR_EBNF_GRAMMAR</span><span class="p">)</span>
<span class="n">expr_grammar</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>{'&lt;start&gt;': ['&lt;expr&gt;'],
 '&lt;expr&gt;': ['&lt;term&gt; + &lt;expr&gt;', '&lt;term&gt; - &lt;expr&gt;', '&lt;term&gt;'],
 '&lt;term&gt;': ['&lt;factor&gt; * &lt;term&gt;', '&lt;factor&gt; / &lt;term&gt;', '&lt;factor&gt;'],
 '&lt;factor&gt;': ['&lt;sign-1&gt;&lt;factor&gt;', '(&lt;expr&gt;)', '&lt;integer&gt;&lt;symbol-1&gt;'],
 '&lt;sign&gt;': ['+', '-'],
 '&lt;integer&gt;': ['&lt;digit-1&gt;'],
 '&lt;digit&gt;': ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9'],
 '&lt;symbol&gt;': ['.&lt;integer&gt;'],
 '&lt;sign-1&gt;': ['', '&lt;sign&gt;'],
 '&lt;symbol-1&gt;': ['', '&lt;symbol&gt;'],
 '&lt;digit-1&gt;': ['&lt;digit&gt;', '&lt;digit&gt;&lt;digit-1&gt;']}
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Success! We have nicely converted the EBNF grammar into BNF.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>With character classes and EBNF grammar conversion, we have two powerful tools that make the writing of grammars easier.  We will use these again and again as it comes to working with grammars.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Grammar-Extensions">Grammar Extensions</h3></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>During the course of this book, we frequently want to specify <em>additional information</em> for grammars, such as <a href="ProbabilisticGrammarFuzzer.html"><em>probabilities</em></a> or <a href="GeneratorGrammarFuzzer.html"><em>constraints</em></a>.  To support these extensions, as well as possibly others, we define an <em>annotation</em> mechanism.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Our concept for annotating grammars is to add <em>annotations</em> to individual expansions.  To this end, we allow that an expansion cannot only be a string, but also a <em>pair</em> of a string and a set of attributes, as in</p>
<div class="highlight"><pre><span/><span class="s2">"&lt;expr&gt;"</span><span class="p">:</span>
        <span class="p">[(</span><span class="s2">"&lt;term&gt; + &lt;expr&gt;"</span><span class="p">,</span> <span class="n">opts</span><span class="p">(</span><span class="n">min_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">)),</span>
         <span class="p">(</span><span class="s2">"&lt;term&gt; - &lt;expr&gt;"</span><span class="p">,</span> <span class="n">opts</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span>
         <span class="s2">"&lt;term&gt;"</span><span class="p">]</span>
</pre></div>
<p>Here, the <code>opts()</code> function would allow us to express annotations that apply to the individual expansions; in this case, the addition would be annotated with a <code>min_depth</code> value of 10, and the subtraction with a <code>max_depth</code> value of 2.  The meaning of these annotations is left to the individual algorithms dealing with the grammars; the general idea, though, is that they can be ignored.</p>
</div>
</div>
</div>
</div>

<details id="Excursion:-Implementing-opts()">
<summary>Implementing <code>opts()</code></summary>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Our <code>opts()</code> helper function returns a mapping of its arguments to values:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">opts</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
    <span class="k">return</span> <span class="n">kwargs</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">opts</span><span class="p">(</span><span class="n">min_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>{'min_depth': 10}
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>To deal with both expansion strings and pairs of expansions and annotations, we access the expansion string and the associated annotations via designated helper functions, <code>exp_string()</code> and <code>exp_opts()</code>:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">exp_string</span><span class="p">(</span><span class="n">expansion</span><span class="p">:</span> <span class="n">Expansion</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Return the string to be expanded"""</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expansion</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">expansion</span>
    <span class="k">return</span> <span class="n">expansion</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">exp_string</span><span class="p">((</span><span class="s2">"&lt;term&gt; + &lt;expr&gt;"</span><span class="p">,</span> <span class="n">opts</span><span class="p">(</span><span class="n">min_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">)))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>'&lt;term&gt; + &lt;expr&gt;'
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">exp_opts</span><span class="p">(</span><span class="n">expansion</span><span class="p">:</span> <span class="n">Expansion</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">"""Return the options of an expansion.  If options are not defined, return {}"""</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expansion</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{}</span>
    <span class="k">return</span> <span class="n">expansion</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">exp_opt</span><span class="p">(</span><span class="n">expansion</span><span class="p">:</span> <span class="n">Expansion</span><span class="p">,</span> <span class="n">attribute</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Return the given attribution of an expansion.</span>
<span class="sd">    If attribute is not defined, return None"""</span>
    <span class="k">return</span> <span class="n">exp_opts</span><span class="p">(</span><span class="n">expansion</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">exp_opts</span><span class="p">((</span><span class="s2">"&lt;term&gt; + &lt;expr&gt;"</span><span class="p">,</span> <span class="n">opts</span><span class="p">(</span><span class="n">min_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">)))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>{'min_depth': 10}
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">exp_opt</span><span class="p">((</span><span class="s2">"&lt;term&gt; - &lt;expr&gt;"</span><span class="p">,</span> <span class="n">opts</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span> <span class="s1">'max_depth'</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>2
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Finally, we define a helper function that sets a particular option:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">set_opts</span><span class="p">(</span><span class="n">grammar</span><span class="p">:</span> <span class="n">Grammar</span><span class="p">,</span> <span class="n">symbol</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">expansion</span><span class="p">:</span> <span class="n">Expansion</span><span class="p">,</span> 
             <span class="n">opts</span><span class="p">:</span> <span class="n">Option</span> <span class="o">=</span> <span class="p">{})</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Set the options of the given expansion of grammar[symbol] to opts"""</span>
    <span class="n">expansions</span> <span class="o">=</span> <span class="n">grammar</span><span class="p">[</span><span class="n">symbol</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">exp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">expansions</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">exp_string</span><span class="p">(</span><span class="n">exp</span><span class="p">)</span> <span class="o">!=</span> <span class="n">exp_string</span><span class="p">(</span><span class="n">expansion</span><span class="p">):</span>
            <span class="k">continue</span>

        <span class="n">new_opts</span> <span class="o">=</span> <span class="n">exp_opts</span><span class="p">(</span><span class="n">exp</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">opts</span> <span class="o">==</span> <span class="p">{}</span> <span class="ow">or</span> <span class="n">new_opts</span> <span class="o">==</span> <span class="p">{}:</span>
            <span class="n">new_opts</span> <span class="o">=</span> <span class="n">opts</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">opts</span><span class="p">:</span>
                <span class="n">new_opts</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">opts</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">new_opts</span> <span class="o">==</span> <span class="p">{}:</span>
            <span class="n">grammar</span><span class="p">[</span><span class="n">symbol</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">exp_string</span><span class="p">(</span><span class="n">exp</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">grammar</span><span class="p">[</span><span class="n">symbol</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">exp_string</span><span class="p">(</span><span class="n">exp</span><span class="p">),</span> <span class="n">new_opts</span><span class="p">)</span>

        <span class="k">return</span>

    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
        <span class="s2">"no expansion "</span> <span class="o">+</span>
        <span class="nb">repr</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span> <span class="o">+</span>
        <span class="s2">" -&gt; "</span> <span class="o">+</span>
        <span class="nb">repr</span><span class="p">(</span>
            <span class="n">exp_string</span><span class="p">(</span><span class="n">expansion</span><span class="p">)))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

</details>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Checking-Grammars">Checking Grammars</h2><p>Since grammars are represented as strings, it is fairly easy to introduce errors.  So let us introduce a helper function that checks a grammar for consistency.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The helper function <code>is_valid_grammar()</code> iterates over a grammar to check whether all used symbols are defined, and vice versa, which is very useful for debugging; it also checks whether all symbols are reachable from the start symbol.  You don't have to delve into details here, but as always, it is important to get the input data straight before we make use of it.</p>
</div>
</div>
</div>
</div>

<details id="Excursion:-Implementing-is_valid_grammar()">
<summary>Implementing <code>is_valid_grammar()</code></summary>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/sys.html" class="import" target="_blank">sys</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">def_used_nonterminals</span><span class="p">(</span><span class="n">grammar</span><span class="p">:</span> <span class="n">Grammar</span><span class="p">,</span> <span class="n">start_symbol</span><span class="p">:</span> 
                          <span class="nb">str</span> <span class="o">=</span> <span class="n">START_SYMBOL</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> 
                                                       <span class="n">Optional</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]:</span>
<span class="w">    </span><span class="sd">"""Return a pair (`defined_nonterminals`, `used_nonterminals`) in `grammar`.</span>
<span class="sd">    In case of error, return (`None`, `None`)."""</span>

    <span class="n">defined_nonterminals</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">used_nonterminals</span> <span class="o">=</span> <span class="p">{</span><span class="n">start_symbol</span><span class="p">}</span>

    <span class="k">for</span> <span class="n">defined_nonterminal</span> <span class="ow">in</span> <span class="n">grammar</span><span class="p">:</span>
        <span class="n">defined_nonterminals</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">defined_nonterminal</span><span class="p">)</span>
        <span class="n">expansions</span> <span class="o">=</span> <span class="n">grammar</span><span class="p">[</span><span class="n">defined_nonterminal</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expansions</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">defined_nonterminal</span><span class="p">)</span> <span class="o">+</span> <span class="s2">": expansion is not a list"</span><span class="p">,</span>
                  <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">expansions</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">defined_nonterminal</span><span class="p">)</span> <span class="o">+</span> <span class="s2">": expansion list empty"</span><span class="p">,</span>
                  <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">expansion</span> <span class="ow">in</span> <span class="n">expansions</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expansion</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                <span class="n">expansion</span> <span class="o">=</span> <span class="n">expansion</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expansion</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">defined_nonterminal</span><span class="p">)</span> <span class="o">+</span> <span class="s2">": "</span>
                      <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">expansion</span><span class="p">)</span> <span class="o">+</span> <span class="s2">": not a string"</span><span class="p">,</span>
                      <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

            <span class="k">for</span> <span class="n">used_nonterminal</span> <span class="ow">in</span> <span class="n">nonterminals</span><span class="p">(</span><span class="n">expansion</span><span class="p">):</span>
                <span class="n">used_nonterminals</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">used_nonterminal</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">defined_nonterminals</span><span class="p">,</span> <span class="n">used_nonterminals</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">reachable_nonterminals</span><span class="p">(</span><span class="n">grammar</span><span class="p">:</span> <span class="n">Grammar</span><span class="p">,</span>
                           <span class="n">start_symbol</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">START_SYMBOL</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="n">reachable</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_find_reachable_nonterminals</span><span class="p">(</span><span class="n">grammar</span><span class="p">,</span> <span class="n">symbol</span><span class="p">):</span>
        <span class="k">nonlocal</span> <span class="n">reachable</span>
        <span class="n">reachable</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">expansion</span> <span class="ow">in</span> <span class="n">grammar</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="k">for</span> <span class="n">nonterminal</span> <span class="ow">in</span> <span class="n">nonterminals</span><span class="p">(</span><span class="n">expansion</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">nonterminal</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">reachable</span><span class="p">:</span>
                    <span class="n">_find_reachable_nonterminals</span><span class="p">(</span><span class="n">grammar</span><span class="p">,</span> <span class="n">nonterminal</span><span class="p">)</span>

    <span class="n">_find_reachable_nonterminals</span><span class="p">(</span><span class="n">grammar</span><span class="p">,</span> <span class="n">start_symbol</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">reachable</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">unreachable_nonterminals</span><span class="p">(</span><span class="n">grammar</span><span class="p">:</span> <span class="n">Grammar</span><span class="p">,</span>
                             <span class="n">start_symbol</span><span class="o">=</span><span class="n">START_SYMBOL</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="k">return</span> <span class="n">grammar</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">-</span> <span class="n">reachable_nonterminals</span><span class="p">(</span><span class="n">grammar</span><span class="p">,</span> <span class="n">start_symbol</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">opts_used</span><span class="p">(</span><span class="n">grammar</span><span class="p">:</span> <span class="n">Grammar</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="n">used_opts</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="n">grammar</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">expansion</span> <span class="ow">in</span> <span class="n">grammar</span><span class="p">[</span><span class="n">symbol</span><span class="p">]:</span>
            <span class="n">used_opts</span> <span class="o">|=</span> <span class="nb">set</span><span class="p">(</span><span class="n">exp_opts</span><span class="p">(</span><span class="n">expansion</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">used_opts</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">is_valid_grammar</span><span class="p">(</span><span class="n">grammar</span><span class="p">:</span> <span class="n">Grammar</span><span class="p">,</span>
                     <span class="n">start_symbol</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">START_SYMBOL</span><span class="p">,</span> 
                     <span class="n">supported_opts</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">())</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Check if the given `grammar` is valid.</span>
<span class="sd">       `start_symbol`: optional start symbol (default: `&lt;start&gt;`)</span>
<span class="sd">       `supported_opts`: options supported (default: none)"""</span>

    <span class="n">defined_nonterminals</span><span class="p">,</span> <span class="n">used_nonterminals</span> <span class="o">=</span> \
        <span class="n">def_used_nonterminals</span><span class="p">(</span><span class="n">grammar</span><span class="p">,</span> <span class="n">start_symbol</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">defined_nonterminals</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">used_nonterminals</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># Do not complain about '&lt;start&gt;' being not used,</span>
    <span class="c1"># even if start_symbol is different</span>
    <span class="k">if</span> <span class="n">START_SYMBOL</span> <span class="ow">in</span> <span class="n">grammar</span><span class="p">:</span>
        <span class="n">used_nonterminals</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">START_SYMBOL</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">unused_nonterminal</span> <span class="ow">in</span> <span class="n">defined_nonterminals</span> <span class="o">-</span> <span class="n">used_nonterminals</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">unused_nonterminal</span><span class="p">)</span> <span class="o">+</span> <span class="s2">": defined, but not used. Consider applying trim_grammar() on the grammar"</span><span class="p">,</span>
              <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">undefined_nonterminal</span> <span class="ow">in</span> <span class="n">used_nonterminals</span> <span class="o">-</span> <span class="n">defined_nonterminals</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">undefined_nonterminal</span><span class="p">)</span> <span class="o">+</span> <span class="s2">": used, but not defined"</span><span class="p">,</span>
              <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>

    <span class="c1"># Symbols must be reachable either from &lt;start&gt; or given start symbol</span>
    <span class="n">unreachable</span> <span class="o">=</span> <span class="n">unreachable_nonterminals</span><span class="p">(</span><span class="n">grammar</span><span class="p">,</span> <span class="n">start_symbol</span><span class="p">)</span>
    <span class="n">msg_start_symbol</span> <span class="o">=</span> <span class="n">start_symbol</span>

    <span class="k">if</span> <span class="n">START_SYMBOL</span> <span class="ow">in</span> <span class="n">grammar</span><span class="p">:</span>
        <span class="n">unreachable</span> <span class="o">=</span> <span class="n">unreachable</span> <span class="o">-</span> \
            <span class="n">reachable_nonterminals</span><span class="p">(</span><span class="n">grammar</span><span class="p">,</span> <span class="n">START_SYMBOL</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">start_symbol</span> <span class="o">!=</span> <span class="n">START_SYMBOL</span><span class="p">:</span>
            <span class="n">msg_start_symbol</span> <span class="o">+=</span> <span class="s2">" or "</span> <span class="o">+</span> <span class="n">START_SYMBOL</span>

    <span class="k">for</span> <span class="n">unreachable_nonterminal</span> <span class="ow">in</span> <span class="n">unreachable</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">unreachable_nonterminal</span><span class="p">)</span> <span class="o">+</span> <span class="s2">": unreachable from "</span> <span class="o">+</span> <span class="n">msg_start_symbol</span> <span class="o">+</span> <span class="s2">". Consider applying trim_grammar() on the grammar"</span><span class="p">,</span>
              <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>

    <span class="n">used_but_not_supported_opts</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">supported_opts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">used_but_not_supported_opts</span> <span class="o">=</span> <span class="n">opts_used</span><span class="p">(</span>
            <span class="n">grammar</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">supported_opts</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">opt</span> <span class="ow">in</span> <span class="n">used_but_not_supported_opts</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">"warning: option "</span> <span class="o">+</span>
                <span class="nb">repr</span><span class="p">(</span><span class="n">opt</span><span class="p">)</span> <span class="o">+</span>
                <span class="s2">" is not supported"</span><span class="p">,</span>
                <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">used_nonterminals</span> <span class="o">==</span> <span class="n">defined_nonterminals</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">unreachable</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>To make a grammar suitable for <code>is_valid_grammar()</code>, the following function may be useful.
The function <code>trim_grammar()</code> automatically <em>removes</em> rules for nonterminals that are no longer needed.
This is useful if you have added new rules that <em>remove</em> some extensions, rendering some nonterminals obsolete.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">trim_grammar</span><span class="p">(</span><span class="n">grammar</span><span class="p">:</span> <span class="n">Grammar</span><span class="p">,</span> <span class="n">start_symbol</span><span class="o">=</span><span class="n">START_SYMBOL</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Grammar</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Create a copy of `grammar` where all unused and unreachable nonterminals are removed."""</span>
    <span class="n">new_grammar</span> <span class="o">=</span> <span class="n">extend_grammar</span><span class="p">(</span><span class="n">grammar</span><span class="p">)</span>
    <span class="n">defined_nonterminals</span><span class="p">,</span> <span class="n">used_nonterminals</span> <span class="o">=</span> \
        <span class="n">def_used_nonterminals</span><span class="p">(</span><span class="n">grammar</span><span class="p">,</span> <span class="n">start_symbol</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">defined_nonterminals</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">used_nonterminals</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">new_grammar</span>

    <span class="n">unused</span> <span class="o">=</span> <span class="n">defined_nonterminals</span> <span class="o">-</span> <span class="n">used_nonterminals</span>
    <span class="n">unreachable</span> <span class="o">=</span> <span class="n">unreachable_nonterminals</span><span class="p">(</span><span class="n">grammar</span><span class="p">,</span> <span class="n">start_symbol</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">nonterminal</span> <span class="ow">in</span> <span class="n">unused</span> <span class="o">|</span> <span class="n">unreachable</span><span class="p">:</span>
        <span class="k">del</span> <span class="n">new_grammar</span><span class="p">[</span><span class="n">nonterminal</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">new_grammar</span>
</pre></div>

</div>
</div></div>
</div>
</div>

</details>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let us make use of <code>is_valid_grammar()</code>. Our grammars defined above pass the test:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">assert</span> <span class="n">is_valid_grammar</span><span class="p">(</span><span class="n">EXPR_GRAMMAR</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">is_valid_grammar</span><span class="p">(</span><span class="n">CGI_GRAMMAR</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">is_valid_grammar</span><span class="p">(</span><span class="n">URL_GRAMMAR</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The check can also be applied to EBNF grammars:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">assert</span> <span class="n">is_valid_grammar</span><span class="p">(</span><span class="n">EXPR_EBNF_GRAMMAR</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>These do not pass the test, though:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">assert</span> <span class="ow">not</span> <span class="n">is_valid_grammar</span><span class="p">({</span><span class="s2">"&lt;start&gt;"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"&lt;x&gt;"</span><span class="p">],</span> <span class="s2">"&lt;y&gt;"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"1"</span><span class="p">]})</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>'&lt;y&gt;': defined, but not used. Consider applying trim_grammar() on the grammar
'&lt;x&gt;': used, but not defined
'&lt;y&gt;': unreachable from &lt;start&gt;. Consider applying trim_grammar() on the grammar
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">assert</span> <span class="ow">not</span> <span class="n">is_valid_grammar</span><span class="p">({</span><span class="s2">"&lt;start&gt;"</span><span class="p">:</span> <span class="s2">"123"</span><span class="p">})</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>'&lt;start&gt;': expansion is not a list
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">assert</span> <span class="ow">not</span> <span class="n">is_valid_grammar</span><span class="p">({</span><span class="s2">"&lt;start&gt;"</span><span class="p">:</span> <span class="p">[]})</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>'&lt;start&gt;': expansion list empty
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">assert</span> <span class="ow">not</span> <span class="n">is_valid_grammar</span><span class="p">({</span><span class="s2">"&lt;start&gt;"</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]})</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>'&lt;start&gt;': 1: not a string
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>(The <code>#type: ignore</code> annotations avoid static checkers flagging the above as errors).</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>From here on, we will always use <code>is_valid_grammar()</code> when defining a grammar.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Lessons-Learned">Lessons Learned</h2><ul>
<li>Grammars are powerful tools to express and produce syntactically valid inputs.</li>
<li>Inputs produced from grammars can be used as is, or used as seeds for mutation-based fuzzing.</li>
<li>Grammars can be extended with character classes and operators to make writing easier.</li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Next-Steps">Next Steps</h2><p>As they make a great foundation for generating software tests, we use grammars again and again in this book.  As a sneak preview, we can use grammars to <a href="ConfigurationFuzzer.html">fuzz configurations</a>:</p>

<pre><code>&lt;options&gt; ::= &lt;option&gt;*
&lt;option&gt; ::= -h | --version | -v | -d | -i | --global-config &lt;filename&gt;</code></pre>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We can use grammars for <a href="APIFuzzer.html">fuzzing functions and APIs</a> and <a href="WebFuzzer.html">fuzzing graphical user interfaces</a>:</p>

<pre><code>&lt;call-sequence&gt; ::= &lt;call&gt;*
&lt;call&gt; ::= urlparse(&lt;url&gt;) | urlsplit(&lt;url&gt;)</code></pre>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We can assign <a href="ProbabilisticGrammarFuzzer.html">probabilities</a> and <a href="GeneratorGrammarFuzzer.html">constraints</a> to individual expansions:</p>

<pre><code>&lt;term&gt;: 50% &lt;factor&gt; * &lt;term&gt; |  30% &lt;factor&gt; / &lt;term&gt; | 20% &lt;factor&gt;
&lt;integer&gt;: &lt;digit&gt;+ { &lt;integer&gt; &gt;= 100 }</code></pre>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>All these extras become especially valuable as we can</p>
<ol>
<li><em>infer grammars automatically</em>, dropping the need to specify them manually, and</li>
<li><em>guide them towards specific goals</em> such as coverage or critical functions;</li>
</ol>
<p>which we also discuss for all techniques in this book.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>To get there, however, we still have a bit of homework to do.  In particular, we first have to learn how to</p>
<ul>
<li><a href="GrammarFuzzer.html">create an efficient grammar fuzzer</a></li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Background">Background</h2><p>As one of the foundations of human language, grammars have been around as long as human language existed.  The first <em>formalization</em> of generative grammars was by Dakṣiputra Pāṇini in 350 BC [<a href="https://en.wikipedia.org/wiki/P%C4%81%E1%B9%87ini%23A%E1%B9%A3%E1%B9%AD%C4%81dhy%C4%81y%C4%AB">Dakṣiputra Pāṇini, 350 BCE</a>].  As a general means to express formal languages for both data and programs, their role in computer science cannot be overstated.  The seminal work by Chomsky [<a href="https://chomsky.info/wp-content/uploads/195609-.pdf">Chomsky <em>et al</em>, 1956</a>] introduced the central models of regular languages, context-free grammars, context-sensitive grammars, and universal grammars as they are used (and taught) in computer science as a means to specify input and programming languages ever since.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The use of grammars for <em>producing</em> test inputs goes back to Burkhardt [<a href="https://doi.org/10.1007/BF02235512">Burkhardt <em>et al</em>, 1967</a>], to be later rediscovered and applied by Hanford [<a href="https://doi.org/10.1147/sj.94.0242">Hanford <em>et al</em>, 1970</a>] and Purdom [<a href="https://doi.org/10.1007/BF01932308">Purdom <em>et al</em>, 1972</a>].  The most important use of grammar testing since then has been <em>compiler testing</em>.  Actually, grammar-based testing is one important reason why compilers and Web browsers work as they should:</p>
<ul>
<li><p>The <a href="https://embed.cs.utah.edu/csmith/">CSmith</a> tool [<a href="https://doi.org/10.1145/1993498.1993532">Yang <em>et al</em>, 2011</a>] specifically targets C programs, starting with a C grammar and then applying additional steps, such as referring to variables and functions defined earlier or ensuring integer and type safety.  Their authors have used it "to find and report more than 400 previously unknown compiler bugs."</p>
</li>
<li><p>The <a href="http://issta2016.cispa.saarland/interview-with-christian-holler/">LangFuzz</a> work [<a href="https://www.usenix.org/system/files/conference/usenixsecurity12/sec12-final73.pdf">Holler <em>et al</em>, 2012</a>], which shares two authors with this book, uses a generic grammar to produce outputs, and is used day and night to generate JavaScript programs and test their interpreters; as of today, it has found more than 2,600 bugs in browsers such as Mozilla Firefox, Google Chrome, and Microsoft Edge.</p>
</li>
<li><p>The <a href="http://web.cs.ucdavis.edu/~su/emi-project/">EMI Project</a> [<a href="https://doi.org/10.1145/2594291.2594334">Le <em>et al</em>, 2014</a>] uses grammars to stress-test C compilers, transforming known tests into alternative programs that should be semantically equivalent over all inputs.  Again, this has led to more than 100 bugs in C compilers being fixed.</p>
</li>
<li><p><a href="https://github.com/renatahodovan/grammarinator">Grammarinator</a> [<a href="https://www.researchgate.net/publication/328510752_Grammarinator_a_grammar-based_open_source_fuzzer">Hodován <em>et al</em>, 2018</a>] is an open-source grammar fuzzer (written in Python!), using the popular ANTLR format as grammar specification.  Like LangFuzz, it uses the grammar for both parsing and producing, and has found more than 100 issues in the <em>JerryScript</em> lightweight JavaScript engine and an associated platform.</p>
</li>
<li><p><a href="https://github.com/googleprojectzero/domato">Domato</a> is a generic grammar generation engine that is specifically used for fuzzing DOM input.  It has revealed a number of security issues in popular Web browsers.</p>
</li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Compilers and Web browsers, of course, are not only domains where grammars are needed for testing, but also domains where grammars are well-known.  Our claim in this book is that grammars can be used to generate almost <em>any</em> input, and our aim is to empower you to do precisely that.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Exercises">Exercises</h2></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Exercise-1:-A-JSON-Grammar">Exercise 1: A JSON Grammar</h3><p>Take a look at the <a href="http://www.json.org">JSON specification</a> and derive a grammar from it:</p>
<ul>
<li>Use <em>character classes</em> to express valid characters</li>
<li>Use EBNF to express repetitions and optional parts</li>
<li>Assume that<ul>
<li>a string is a sequence of digits, ASCII letters, punctuation and space characters without quotes or escapes</li>
<li>whitespace is just a single space.</li>
</ul>
</li>
<li>Use <code>is_valid_grammar()</code> to ensure the grammar is valid.</li>
</ul>
<p>Feed the grammar into <code>simple_grammar_fuzzer()</code>.  Do you encounter any errors, and why?</p>

    
<p/><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/HEAD?labpath=docs%2Fnotebooks/Grammars.ipynb#Exercises" target="_blank">Use the notebook</a> to work on the exercises and see solutions.</div>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Exercise-2:-Finding-Bugs">Exercise 2: Finding Bugs</h3><p>The name <code>simple_grammar_fuzzer()</code> does not come by accident: The way it expands grammars is limited in several ways.  What happens if you apply <code>simple_grammar_fuzzer()</code> on <code>nonterminal_grammar</code> and <code>expr_grammar</code>, as defined above, and why?</p>

    
<p/><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/HEAD?labpath=docs%2Fnotebooks/Grammars.ipynb#Exercises" target="_blank">Use the notebook</a> to work on the exercises and see solutions.</div>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Exercise-3:-Grammars-with-Regular-Expressions">Exercise 3: Grammars with Regular Expressions</h3><p>In a <em>grammar extended with regular expressions</em>, we can use the special form</p>

<pre><code>/regex/</code></pre>
<p>to include regular expressions in expansions.  For instance, we can have a rule</p>

<pre><code>&lt;integer&gt; ::= /[+-]?[0-9]+/</code></pre>
<p>to quickly express that an integer is an optional sign, followed by a sequence of digits.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="Part-1:-Convert-regular-expressions">Part 1: Convert regular expressions</h4><p>Write a converter <code>convert_regex(r)</code> that takes a regular expression <code>r</code> and creates an equivalent grammar.  Support the following regular expression constructs:</p>
<ul>
<li><code>*</code>, <code>+</code>, <code>?</code>, <code>()</code> should work just in EBNFs, above.</li>
<li><code>a|b</code> should translate into a list of alternatives <code>[a, b]</code>.</li>
<li><code>.</code> should match any character except newline.</li>
<li><code>[abc]</code> should translate into <code>srange("abc")</code></li>
<li><code>[^abc]</code> should translate into the set of ASCII characters <em>except</em> <code>srange("abc")</code>.</li>
<li><code>[a-b]</code> should translate into <code>crange(a, b)</code></li>
<li><code>[^a-b]</code> should translate into the set of ASCII characters <em>except</em> <code>crange(a, b)</code>.</li>
</ul>
<p>Example: <code>convert_regex(r"[0-9]+")</code> should yield a grammar such as</p>
<div class="highlight"><pre><span/><span class="p">{</span>
    <span class="s2">"&lt;start&gt;"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"&lt;s1&gt;"</span><span class="p">],</span>
    <span class="s2">"&lt;s1&gt;"</span><span class="p">:</span> <span class="p">[</span> <span class="s2">"&lt;s2&gt;"</span><span class="p">,</span> <span class="s2">"&lt;s1&gt;&lt;s2&gt;"</span> <span class="p">],</span>
    <span class="s2">"&lt;s2&gt;"</span><span class="p">:</span> <span class="n">crange</span><span class="p">(</span><span class="s1">'0'</span><span class="p">,</span> <span class="s1">'9'</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>

    
<p/><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/HEAD?labpath=docs%2Fnotebooks/Grammars.ipynb#Exercises" target="_blank">Use the notebook</a> to work on the exercises and see solutions.</div>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="Part-2:-Identify-and-expand-regular-expressions">Part 2: Identify and expand regular expressions</h4><p>Write a converter <code>convert_regex_grammar(g)</code> that takes a EBNF grammar <code>g</code> containing regular expressions in the form <code>/.../</code> and creates an equivalent BNF grammar.  Support the regular expression constructs as above.</p>
<p>Example: <code>convert_regex_grammar({ "&lt;integer&gt;" : "/[+-]?[0-9]+/" })</code> should yield a grammar such as</p>
<div class="highlight"><pre><span/><span class="p">{</span>
    <span class="s2">"&lt;integer&gt;"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"&lt;s1&gt;&lt;s3&gt;"</span><span class="p">],</span>
    <span class="s2">"&lt;s1&gt;"</span><span class="p">:</span> <span class="p">[</span> <span class="s2">""</span><span class="p">,</span> <span class="s2">"&lt;s2&gt;"</span> <span class="p">],</span>
    <span class="s2">"&lt;s2&gt;"</span><span class="p">:</span> <span class="n">srange</span><span class="p">(</span><span class="s2">"+-"</span><span class="p">),</span>
    <span class="s2">"&lt;s3&gt;"</span><span class="p">:</span> <span class="p">[</span> <span class="s2">"&lt;s4&gt;"</span><span class="p">,</span> <span class="s2">"&lt;s4&gt;&lt;s3&gt;"</span> <span class="p">],</span>
    <span class="s2">"&lt;s4&gt;"</span><span class="p">:</span> <span class="n">crange</span><span class="p">(</span><span class="s1">'0'</span><span class="p">,</span> <span class="s1">'9'</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Optional: Support <em>escapes</em> in regular expressions: <code>\c</code> translates to the literal character <code>c</code>; <code>\/</code> translates to <code>/</code> (and thus does not end the regular expression); <code>\\</code> translates to <code>\</code>.</p>

    
<p/><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/HEAD?labpath=docs%2Fnotebooks/Grammars.ipynb#Exercises" target="_blank">Use the notebook</a> to work on the exercises and see solutions.</div>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Exercise-4:-Defining-Grammars-as-Functions-(Advanced)">Exercise 4: Defining Grammars as Functions (Advanced)</h3><p>To obtain a nicer syntax for specifying grammars, one can make use of Python constructs which then will be <em>parsed</em> by an additional function.  For instance, we can imagine a grammar definition which uses <code>|</code> as a means to separate alternatives:</p>

    
<p/><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/HEAD?labpath=docs%2Fnotebooks/Grammars.ipynb#Exercises" target="_blank">Use the notebook</a> to work on the exercises and see solutions.</div>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">expression_grammar_fn</span><span class="p">():</span>
    <span class="n">start</span> <span class="o">=</span> <span class="s2">"&lt;expr&gt;"</span>
    <span class="n">expr</span> <span class="o">=</span> <span class="s2">"&lt;term&gt; + &lt;expr&gt;"</span> <span class="o">|</span> <span class="s2">"&lt;term&gt; - &lt;expr&gt;"</span>
    <span class="n">term</span> <span class="o">=</span> <span class="s2">"&lt;factor&gt; * &lt;term&gt;"</span> <span class="o">|</span> <span class="s2">"&lt;factor&gt; / &lt;term&gt;"</span> <span class="o">|</span> <span class="s2">"&lt;factor&gt;"</span>
    <span class="n">factor</span> <span class="o">=</span> <span class="s2">"+&lt;factor&gt;"</span> <span class="o">|</span> <span class="s2">"-&lt;factor&gt;"</span> <span class="o">|</span> <span class="s2">"(&lt;expr&gt;)"</span> <span class="o">|</span> <span class="s2">"&lt;integer&gt;.&lt;integer&gt;"</span> <span class="o">|</span> <span class="s2">"&lt;integer&gt;"</span>
    <span class="n">integer</span> <span class="o">=</span> <span class="s2">"&lt;digit&gt;&lt;integer&gt;"</span> <span class="o">|</span> <span class="s2">"&lt;digit&gt;"</span>
    <span class="n">digit</span> <span class="o">=</span> <span class="s1">'0'</span> <span class="o">|</span> <span class="s1">'1'</span> <span class="o">|</span> <span class="s1">'2'</span> <span class="o">|</span> <span class="s1">'3'</span> <span class="o">|</span> <span class="s1">'4'</span> <span class="o">|</span> <span class="s1">'5'</span> <span class="o">|</span> <span class="s1">'6'</span> <span class="o">|</span> <span class="s1">'7'</span> <span class="o">|</span> <span class="s1">'8'</span> <span class="o">|</span> <span class="s1">'9'</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>If we execute <code>expression_grammar_fn()</code>, this will yield an error.  Yet, the purpose of <code>expression_grammar_fn()</code> is not to be executed, but to be used as <em>data</em> from which the grammar will be constructed.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">with</span> <span class="n">ExpectError</span><span class="p">():</span>
    <span class="n">expression_grammar_fn</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>Traceback (most recent call last):
  File "/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_8783/1271268731.py", line 2, in &lt;module&gt;
    expression_grammar_fn()
  File "/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_8783/3029408019.py", line 3, in expression_grammar_fn
    expr = "&lt;term&gt; + &lt;expr&gt;" | "&lt;term&gt; - &lt;expr&gt;"
           ~~~~~~~~~~~~~~~~~~^~~~~~~~~~~~~~~~~~~
TypeError: unsupported operand type(s) for |: 'str' and 'str' (expected)
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>To this end, we make use of the <code>ast</code> (abstract syntax tree) and <code>inspect</code> (code inspection) modules.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/ast.html" class="import" target="_blank">ast</a></span>
<span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/inspect.html" class="import" target="_blank">inspect</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>First, we obtain the source code of <code>expression_grammar_fn()</code>...</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">source</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getsource</span><span class="p">(</span><span class="n">expression_grammar_fn</span><span class="p">)</span>
<span class="n">source</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>'def expression_grammar_fn():\n    start = "&lt;expr&gt;"\n    expr = "&lt;term&gt; + &lt;expr&gt;" | "&lt;term&gt; - &lt;expr&gt;"\n    term = "&lt;factor&gt; * &lt;term&gt;" | "&lt;factor&gt; / &lt;term&gt;" | "&lt;factor&gt;"\n    factor = "+&lt;factor&gt;" | "-&lt;factor&gt;" | "(&lt;expr&gt;)" | "&lt;integer&gt;.&lt;integer&gt;" | "&lt;integer&gt;"\n    integer = "&lt;digit&gt;&lt;integer&gt;" | "&lt;digit&gt;"\n    digit = \'0\' | \'1\' | \'2\' | \'3\' | \'4\' | \'5\' | \'6\' | \'7\' | \'8\' | \'9\'\n'
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>... which we then parse into an abstract syntax tree:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">tree</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We can now parse the tree to find operators and alternatives.  <code>get_alternatives()</code> iterates over all nodes <code>op</code> of the tree; If the node looks like a binary <em>or</em> (<code>|</code>) operation, we drill deeper and recurse. If not, we have reached a single production, and we try to get the expression from the production. We define the <code>to_expr</code> parameter depending on how we want to represent the production. In this case, we represent a single production by a single string.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">get_alternatives</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">to_expr</span><span class="o">=</span><span class="k">lambda</span> <span class="n">o</span><span class="p">:</span> <span class="n">o</span><span class="o">.</span><span class="n">s</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">BinOp</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">op</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">BitOr</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">get_alternatives</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="n">to_expr</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="n">to_expr</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">right</span><span class="p">)]</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">to_expr</span><span class="p">(</span><span class="n">op</span><span class="p">)]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p><code>funct_parser()</code> takes the abstract syntax tree of a function (say, <code>expression_grammar_fn()</code>) and iterates over all assignments:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">funct_parser</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">to_expr</span><span class="o">=</span><span class="k">lambda</span> <span class="n">o</span><span class="p">:</span> <span class="n">o</span><span class="o">.</span><span class="n">s</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span><span class="n">assign</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span><span class="p">:</span> <span class="n">get_alternatives</span><span class="p">(</span><span class="n">assign</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">to_expr</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">assign</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">body</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">body</span><span class="p">}</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The result is a grammar in our regular format:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">grammar</span> <span class="o">=</span> <span class="n">funct_parser</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
<span class="k">for</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="n">grammar</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="s2">"::="</span><span class="p">,</span> <span class="n">grammar</span><span class="p">[</span><span class="n">symbol</span><span class="p">])</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>start ::= ['&lt;expr&gt;']
expr ::= ['&lt;term&gt; + &lt;expr&gt;', '&lt;term&gt; - &lt;expr&gt;']
term ::= ['&lt;factor&gt; * &lt;term&gt;', '&lt;factor&gt; / &lt;term&gt;', '&lt;factor&gt;']
factor ::= ['+&lt;factor&gt;', '-&lt;factor&gt;', '(&lt;expr&gt;)', '&lt;integer&gt;.&lt;integer&gt;', '&lt;integer&gt;']
integer ::= ['&lt;digit&gt;&lt;integer&gt;', '&lt;digit&gt;']
digit ::= ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9']
</pre>
</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_8783/1939255217.py:1: DeprecationWarning: Attribute s is deprecated and will be removed in Python 3.14; use value instead
  def funct_parser(tree, to_expr=lambda o: o.s):
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="Part-1-(a):-One-Single-Function">Part 1 (a): One Single Function</h4><p>Write a single function <code>define_grammar(fn)</code> that takes a grammar defined as function (such as <code>expression_grammar_fn()</code>) and returns a regular grammar.</p>

    
<p/><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/HEAD?labpath=docs%2Fnotebooks/Grammars.ipynb#Exercises" target="_blank">Use the notebook</a> to work on the exercises and see solutions.</div>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="Part-1-(b):-Alternative-representations">Part 1 (b): Alternative representations</h4></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We note that the grammar representation we designed previously does not allow simple generation of alternatives such as <code>srange()</code> and <code>crange()</code>. Further, one may find the string representation of expressions limiting.  It turns out that it is simple to extend our grammar definition to support grammars such as below:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">define_name</span><span class="p">(</span><span class="n">o</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">o</span><span class="o">.</span><span class="n">id</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">)</span> <span class="k">else</span> <span class="n">o</span><span class="o">.</span><span class="n">s</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">define_expr</span><span class="p">(</span><span class="n">op</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">BinOp</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">op</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Add</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="o">*</span><span class="n">define_expr</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">left</span><span class="p">),</span> <span class="n">define_name</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">right</span><span class="p">))</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">define_name</span><span class="p">(</span><span class="n">op</span><span class="p">),)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">define_ex_grammar</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">define_grammar</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">define_expr</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The grammar:</p>
<div class="highlight"><pre><span/><span class="nd">@define_ex_grammar</span>
<span class="k">def</span> <span class="nf">expression_grammar</span><span class="p">():</span>
    <span class="n">start</span>   <span class="o">=</span> <span class="n">expr</span>
    <span class="n">expr</span>    <span class="o">=</span> <span class="p">(</span><span class="n">term</span> <span class="o">+</span> <span class="s1">'+'</span> <span class="o">+</span> <span class="n">expr</span>
            <span class="o">|</span>  <span class="n">term</span> <span class="o">+</span> <span class="s1">'-'</span> <span class="o">+</span> <span class="n">expr</span><span class="p">)</span>
    <span class="n">term</span>    <span class="o">=</span> <span class="p">(</span><span class="n">factor</span> <span class="o">+</span> <span class="s1">'*'</span> <span class="o">+</span> <span class="n">term</span>
            <span class="o">|</span>  <span class="n">factor</span> <span class="o">+</span> <span class="s1">'/'</span> <span class="o">+</span> <span class="n">term</span>
            <span class="o">|</span>  <span class="n">factor</span><span class="p">)</span>
    <span class="n">factor</span>  <span class="o">=</span> <span class="p">(</span><span class="s1">'+'</span> <span class="o">+</span> <span class="n">factor</span>
            <span class="o">|</span>  <span class="s1">'-'</span> <span class="o">+</span> <span class="n">factor</span>
            <span class="o">|</span>  <span class="s1">'('</span> <span class="o">+</span> <span class="n">expr</span> <span class="o">+</span> <span class="s1">')'</span>
            <span class="o">|</span>  <span class="n">integer</span> <span class="o">+</span> <span class="s1">'.'</span> <span class="o">+</span> <span class="n">integer</span>
            <span class="o">|</span>  <span class="n">integer</span><span class="p">)</span>
    <span class="n">integer</span> <span class="o">=</span> <span class="p">(</span><span class="n">digit</span> <span class="o">+</span> <span class="n">integer</span>
            <span class="o">|</span>  <span class="n">digit</span><span class="p">)</span>
    <span class="n">digit</span>   <span class="o">=</span> <span class="s1">'0'</span> <span class="o">|</span> <span class="s1">'1'</span> <span class="o">|</span> <span class="s1">'2'</span> <span class="o">|</span> <span class="s1">'3'</span> <span class="o">|</span> <span class="s1">'4'</span> <span class="o">|</span> <span class="s1">'5'</span> <span class="o">|</span> <span class="s1">'6'</span> <span class="o">|</span> <span class="s1">'7'</span> <span class="o">|</span> <span class="s1">'8'</span> <span class="o">|</span> <span class="s1">'9'</span>

<span class="k">for</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="n">expression_grammar</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="s2">"::="</span><span class="p">,</span> <span class="n">expression_grammar</span><span class="p">[</span><span class="n">symbol</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p><strong>Note.</strong> The grammar data structure thus obtained is a little more detailed than the standard data structure. It represents each production as a tuple.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We note that we have not enabled <code>srange()</code> or <code>crange()</code> in the above grammar. How would you go about adding these? (<em>Hint:</em> wrap <code>define_expr()</code> to look for <code>ast.Call</code>)</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="Part-2:-Extended-Grammars">Part 2: Extended Grammars</h4><p>Introduce an operator <code>*</code> that takes a pair <code>(min, max)</code> where <code>min</code> and <code>max</code> are the minimum and maximum number of repetitions, respectively.  A missing value <code>min</code> stands for zero; a missing value <code>max</code> for infinity.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">identifier_grammar_fn</span><span class="p">():</span>
    <span class="n">identifier</span> <span class="o">=</span> <span class="n">idchar</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>With the <code>*</code> operator, we can generalize the EBNF operators – <code>?</code> becomes (0,1), <code>*</code> becomes (0,), and <code>+</code> becomes (1,).  Write a converter that takes an extended grammar defined using <code>*</code>, parse it, and convert it into BNF.</p>

    
<p/><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/HEAD?labpath=docs%2Fnotebooks/Grammars.ipynb#Exercises" target="_blank">Use the notebook</a> to work on the exercises and see solutions.</div>
</div>
</div>
</div>
</div>

        
<p class="imprint">
<img style="float:right" src="../Images/2f3faa36146c6fb38bbab67add09aa5f.png" alt="Creative Commons License" data-original-src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png"/>
The content of this project is licensed under the
<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.
The source code that is part of the content, as well as the source code used to format and display that content is licensed under the <a href="https://github.com/uds-se/fuzzingbook/blob/master/LICENSE.md#mit-license">MIT License</a>.
<a href="https://github.com/uds-se/fuzzingbook/commits/master/notebooks/Grammars.ipynb" target="_blank)">Last change: 2024-06-30 18:31:28+02:00</a> • 
<a href="#citation" id="cite" onclick="revealCitation()">Cite</a> •
<a href="https://cispa.de/en/impressum" target="_blank">Imprint</a>
</p>



<div id="citation" class="citation" style="display: none;">
<a name="citation"/>
<h2>How to Cite this Work</h2>
<p>
Andreas Zeller, Rahul Gopinath, Marcel Böhme, Gordon Fraser, and Christian Holler: "<a href="https://www.fuzzingbook.org/html/Grammars.html">Fuzzing with Grammars</a>".  In Andreas Zeller, Rahul Gopinath, Marcel Böhme, Gordon Fraser, and Christian Holler, "<a href="https://www.fuzzingbook.org/">The Fuzzing Book</a>", <a href="https://www.fuzzingbook.org/html/Grammars.html">https://www.fuzzingbook.org/html/Grammars.html</a>.  Retrieved 2024-06-30 18:31:28+02:00.
</p>
<pre>
@incollection{fuzzingbook2024:Grammars,
    author = {Andreas Zeller and Rahul Gopinath and Marcel B{\"o}hme and Gordon Fraser and Christian Holler},
    booktitle = {The Fuzzing Book},
    title = {Fuzzing with Grammars},
    year = {2024},
    publisher = {CISPA Helmholtz Center for Information Security},
    howpublished = {\url{https://www.fuzzingbook.org/html/Grammars.html}},
    note = {Retrieved 2024-06-30 18:31:28+02:00},
    url = {https://www.fuzzingbook.org/html/Grammars.html},
    urldate = {2024-06-30 18:31:28+02:00}
}
</pre>
</div>

          
</body>
</html>