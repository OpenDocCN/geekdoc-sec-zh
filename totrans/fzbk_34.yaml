- en: Testing Web Applications
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[http://www.fuzzingbook.org/html/WebFuzzer.html](http://www.fuzzingbook.org/html/WebFuzzer.html)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: In this chapter, we explore how to generate tests for Graphical User Interfaces
    (GUIs), notably on Web interfaces. We set up a (vulnerable) Web server and demonstrate
    how to systematically explore its behavior – first with handwritten grammars,
    then with grammars automatically inferred from the user interface. We also show
    how to conduct systematic attacks on these servers, notably with code and SQL
    injection.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: Synopsis
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: To [use the code provided in this chapter](Importing.html), write
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: and then make use of the following features.
  prefs: []
  type: TYPE_NORMAL
- en: This chapter provides a simple (and vulnerable) Web server and two experimental
    fuzzers that are applied to it.
  prefs: []
  type: TYPE_NORMAL
- en: Fuzzing Web Forms
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '`WebFormFuzzer` demonstrates how to interact with a Web form. Given a URL with
    a Web form, it automatically extracts a grammar that produces a URL; this URL
    contains values for all form elements. Support is limited to GET forms and a subset
    of HTML form elements.'
  prefs: []
  type: TYPE_NORMAL
- en: 'Here''s the grammar extracted for our vulnerable Web server:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: Using it for fuzzing yields a path with all form values filled; accessing this
    path acts like filling out and submitting the form.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: Repeated calls to `WebFormFuzzer.fuzz()` invoke the form again and again, each
    time with different (fuzzed) values.
  prefs: []
  type: TYPE_NORMAL
- en: Internally, `WebFormFuzzer` builds on a helper class named `HTMLGrammarMiner`;
    you can extend its functionality to include more features.
  prefs: []
  type: TYPE_NORMAL
- en: SQL Injection Attacks
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '`SQLInjectionFuzzer` is an experimental extension of `WebFormFuzzer` whose
    constructor takes an additional *payload* – an SQL command to be injected and
    executed on the server. Otherwise, it is used like `WebFormFuzzer`:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: As you can see, the path to be retrieved contains the payload encoded into one
    of the form field values.
  prefs: []
  type: TYPE_NORMAL
- en: Internally, `SQLInjectionFuzzer` builds on a helper class named `SQLInjectionGrammarMiner`;
    you can extend its functionality to include more features.
  prefs: []
  type: TYPE_NORMAL
- en: '`SQLInjectionFuzzer` is a proof-of-concept on how to build a malicious fuzzer;
    you should study and extend its code to make actual use of it.'
  prefs: []
  type: TYPE_NORMAL
- en: '<svg width="594pt" height="451pt" viewBox="0.00 0.00 593.88 450.50" xmlns:xlink="http://www.w3.org/1999/xlink"><g
    id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 446.5)"><g
    id="node1" class="node"><title>WebFormFuzzer</title> <g id="a_node1"><a xlink:href="#"
    xlink:title="class WebFormFuzzer:'
  prefs: []
  type: TYPE_NORMAL
- en: 'A Fuzzer for Web forms"><text text-anchor="start" x="17" y="-177.7" font-family="Patua
    One, Helvetica, sans-serif" font-weight="bold" font-size="14.00" fill="#b03a2e">WebFormFuzzer</text>
    <g id="a_node1_0"><a xlink:href="#" xlink:title="WebFormFuzzer"><g id="a_node1_1"><a
    xlink:href="#" xlink:title="__init__(self, url: str, *, grammar_miner_class: Optional[type]
    = None, **grammar_fuzzer_options):'
  prefs: []
  type: TYPE_NORMAL
- en: Constructor.
  prefs: []
  type: TYPE_NORMAL
- en: '`url` - the URL of the Web form to fuzz.'
  prefs: []
  type: TYPE_NORMAL
- en: '`grammar_miner_class` - the class of the grammar miner'
  prefs: []
  type: TYPE_NORMAL
- en: 'to use (default: `HTMLGrammarMiner`)'
  prefs: []
  type: TYPE_NORMAL
- en: 'Other keyword arguments are passed to the `GrammarFuzzer` constructor"><text
    text-anchor="start" x="28.25" y="-155.5" font-family="''Fira Mono'', ''Source
    Code Pro'', ''Courier'', monospace" font-weight="bold" font-style="italic" font-size="10.00">__init__()</text></a></g>
    <g id="a_node1_2"><a xlink:href="#" xlink:title="get_grammar(self, html_text:
    str):'
  prefs: []
  type: TYPE_NORMAL
- en: Obtain the grammar for the given HTML `html_text`.
  prefs: []
  type: TYPE_NORMAL
- en: 'To be overloaded in subclasses."><text text-anchor="start" x="28.25" y="-142.75"
    font-family="''Fira Mono'', ''Source Code Pro'', ''Courier'', monospace" font-style="italic"
    font-size="10.00">get_grammar()</text></a></g> <g id="a_node1_3"><a xlink:href="#"
    xlink:title="get_html(self, url: str):'
  prefs: []
  type: TYPE_NORMAL
- en: Retrieve the HTML text for the given URL `url`.
  prefs: []
  type: TYPE_NORMAL
- en: 'To be overloaded in subclasses."><text text-anchor="start" x="28.25" y="-130"
    font-family="''Fira Mono'', ''Source Code Pro'', ''Courier'', monospace" font-style="italic"
    font-size="10.00">get_html()</text></a></g></a></g></a></g></g> <g id="node2"
    class="node"><title>GrammarFuzzer</title> <g id="a_node2"><a xlink:href="GrammarFuzzer.html"
    xlink:title="class GrammarFuzzer:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Produce strings from grammars efficiently, using derivation trees."><text text-anchor="start"
    x="17.38" y="-303.7" font-family="Patua One, Helvetica, sans-serif" font-weight="bold"
    font-size="14.00" fill="#b03a2e">GrammarFuzzer</text> <g id="a_node2_4"><a xlink:href="#"
    xlink:title="GrammarFuzzer"><g id="a_node2_5"><a xlink:href="GrammarFuzzer.html"
    xlink:title="__init__(self, grammar: Dict[str, List[Expansion]], start_symbol:
    str = ''<start>'', min_nonterminals: int = 0, max_nonterminals: int = 10, disp:
    bool = False, log: Union[bool, int] = False) -> None:'
  prefs: []
  type: TYPE_NORMAL
- en: Produce strings from `grammar`, starting with `start_symbol`.
  prefs: []
  type: TYPE_NORMAL
- en: If `min_nonterminals` or `max_nonterminals` is given, use them as limits
  prefs: []
  type: TYPE_NORMAL
- en: for the number of nonterminals produced.
  prefs: []
  type: TYPE_NORMAL
- en: If `disp` is set, display the intermediate derivation trees.
  prefs: []
  type: TYPE_NORMAL
- en: 'If `log` is set, show intermediate steps as text on standard output."><text
    text-anchor="start" x="34.25" y="-281.5" font-family="''Fira Mono'', ''Source
    Code Pro'', ''Courier'', monospace" font-weight="bold" font-style="italic" font-size="10.00">__init__()</text></a></g>
    <g id="a_node2_6"><a xlink:href="GrammarFuzzer.html" xlink:title="fuzz(self) ->
    str:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Produce a string from the grammar."><text text-anchor="start" x="34.25" y="-268.75"
    font-family="''Fira Mono'', ''Source Code Pro'', ''Courier'', monospace" font-weight="bold"
    font-style="italic" font-size="10.00">fuzz()</text></a></g> <g id="a_node2_7"><a
    xlink:href="GrammarFuzzer.html" xlink:title="fuzz_tree(self) -> DerivationTree:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Produce a derivation tree from the grammar."><text text-anchor="start" x="34.25"
    y="-256" font-family="''Fira Mono'', ''Source Code Pro'', ''Courier'', monospace"
    font-weight="bold" font-size="10.00">fuzz_tree()</text></a></g></a></g></a></g></g>
    <g id="edge1" class="edge"><title>WebFormFuzzer->GrammarFuzzer</title></g> <g
    id="node3" class="node"><title>Fuzzer</title> <g id="a_node3"><a xlink:href="Fuzzer.html"
    xlink:title="class Fuzzer:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Base class for fuzzers."><text text-anchor="start" x="46.62" y="-425.7" font-family="Patua
    One, Helvetica, sans-serif" font-weight="bold" font-size="14.00" fill="#b03a2e">Fuzzer</text>
    <g id="a_node3_8"><a xlink:href="#" xlink:title="Fuzzer"><g id="a_node3_9"><a
    xlink:href="Fuzzer.html" xlink:title="__init__(self) -> None:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Constructor"><text text-anchor="start" x="37.25" y="-403.5" font-family="''Fira
    Mono'', ''Source Code Pro'', ''Courier'', monospace" font-weight="bold" font-style="italic"
    font-size="10.00">__init__()</text></a></g> <g id="a_node3_10"><a xlink:href="Fuzzer.html"
    xlink:title="fuzz(self) -> str:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Return fuzz input"><text text-anchor="start" x="37.25" y="-390.75" font-family="''Fira
    Mono'', ''Source Code Pro'', ''Courier'', monospace" font-weight="bold" font-style="italic"
    font-size="10.00">fuzz()</text></a></g> <g id="a_node3_11"><a xlink:href="Fuzzer.html"
    xlink:title="run(self, runner: Fuzzer.Runner = <Fuzzer.Runner object>) -> Tuple[subprocess.CompletedProcess,
    str]:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Run `runner` with fuzz input"><text text-anchor="start" x="37.25" y="-378"
    font-family="''Fira Mono'', ''Source Code Pro'', ''Courier'', monospace" font-weight="bold"
    font-size="10.00">run()</text></a></g> <g id="a_node3_12"><a xlink:href="Fuzzer.html"
    xlink:title="runs(self, runner: Fuzzer.Runner = <Fuzzer.PrintRunner object>, trials:
    int = 10) -> List[Tuple[subprocess.CompletedProcess, str]]:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Run `runner` with fuzz input, `trials` times"><text text-anchor="start" x="37.25"
    y="-365.25" font-family="''Fira Mono'', ''Source Code Pro'', ''Courier'', monospace"
    font-weight="bold" font-size="10.00">runs()</text></a></g></a></g></a></g></g>
    <g id="edge2" class="edge"><title>GrammarFuzzer->Fuzzer</title></g> <g id="node4"
    class="node"><title>SQLInjectionFuzzer</title> <g id="a_node4"><a xlink:href="#"
    xlink:title="class SQLInjectionFuzzer:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Simple demonstrator of a SQL Injection Fuzzer"><text text-anchor="start" x="8"
    y="-47.7" font-family="Patua One, Helvetica, sans-serif" font-weight="bold" font-size="14.00"
    fill="#b03a2e">SQLInjectionFuzzer</text> <g id="a_node4_13"><a xlink:href="#"
    xlink:title="SQLInjectionFuzzer"><g id="a_node4_14"><a xlink:href="#" xlink:title="__init__(self,
    url: str, sql_payload: str = '''', *, sql_injection_grammar_miner_class: Optional[type]
    = None, **kwargs):'
  prefs: []
  type: TYPE_NORMAL
- en: Constructor.
  prefs: []
  type: TYPE_NORMAL
- en: '`url` - the Web page (with a form) to retrieve'
  prefs: []
  type: TYPE_NORMAL
- en: '`sql_payload` - the SQL command to execute'
  prefs: []
  type: TYPE_NORMAL
- en: '`sql_injection_grammar_miner_class` - the miner to be used'
  prefs: []
  type: TYPE_NORMAL
- en: '(default: SQLInjectionGrammarMiner)'
  prefs: []
  type: TYPE_NORMAL
- en: 'Other keyword arguments are passed to `WebFormFuzzer`."><text text-anchor="start"
    x="28.25" y="-25.5" font-family="''Fira Mono'', ''Source Code Pro'', ''Courier'',
    monospace" font-weight="bold" font-style="italic" font-size="10.00">__init__()</text></a></g>
    <g id="a_node4_15"><a xlink:href="#" xlink:title="get_grammar(self, html_text):'
  prefs: []
  type: TYPE_NORMAL
- en: 'Obtain a grammar with SQL injection commands"><text text-anchor="start" x="28.25"
    y="-12.75" font-family="''Fira Mono'', ''Source Code Pro'', ''Courier'', monospace"
    font-style="italic" font-size="10.00">get_grammar()</text></a></g></a></g></a></g></g>
    <g id="edge3" class="edge"><title>SQLInjectionFuzzer->WebFormFuzzer</title></g>
    <g id="node5" class="node"><title>WebRunner</title> <g id="a_node5"><a xlink:href="#"
    xlink:title="class WebRunner:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Runner for a Web server"><text text-anchor="start" x="160.5" y="-47.7" font-family="Patua
    One, Helvetica, sans-serif" font-weight="bold" font-size="14.00" fill="#b03a2e">WebRunner</text>
    <g id="a_node5_16"><a xlink:href="#" xlink:title="WebRunner"><g id="a_node5_17"><a
    xlink:href="#" xlink:title="__init__(self, base_url: Optional[str] = None):'
  prefs: []
  type: TYPE_NORMAL
- en: 'Initialize"><text text-anchor="start" x="167.25" y="-25.5" font-family="''Fira
    Mono'', ''Source Code Pro'', ''Courier'', monospace" font-weight="bold" font-style="italic"
    font-size="10.00">__init__()</text></a></g> <g id="a_node5_18"><a xlink:href="#"
    xlink:title="run(self, url: str) -> Tuple[str, str]:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Run the runner with the given input"><text text-anchor="start" x="167.25" y="-12.75"
    font-family="''Fira Mono'', ''Source Code Pro'', ''Courier'', monospace" font-weight="bold"
    font-style="italic" font-size="10.00">run()</text></a></g></a></g></a></g></g>
    <g id="node6" class="node"><title>Runner</title> <g id="a_node6"><a xlink:href="Fuzzer.html"
    xlink:title="class Runner:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Base class for testing inputs."><text text-anchor="start" x="174.38" y="-194.45"
    font-family="Patua One, Helvetica, sans-serif" font-weight="bold" font-size="14.00"
    fill="#b03a2e">Runner</text> <g id="a_node6_19"><a xlink:href="#" xlink:title="Runner"><g
    id="a_node6_20"><a xlink:href="Fuzzer.html" xlink:title="FAIL = ''FAIL''"><text
    text-anchor="start" x="167.25" y="-171.25" font-family="''Fira Mono'', ''Source
    Code Pro'', ''Courier'', monospace" font-size="10.00">FAIL</text></a></g> <g id="a_node6_21"><a
    xlink:href="Fuzzer.html" xlink:title="PASS = ''PASS''"><text text-anchor="start"
    x="167.25" y="-158.5" font-family="''Fira Mono'', ''Source Code Pro'', ''Courier'',
    monospace" font-size="10.00">PASS</text></a></g> <g id="a_node6_22"><a xlink:href="Fuzzer.html"
    xlink:title="UNRESOLVED = ''UNRESOLVED''"><text text-anchor="start" x="167.25"
    y="-145.75" font-family="''Fira Mono'', ''Source Code Pro'', ''Courier'', monospace"
    font-size="10.00">UNRESOLVED</text></a></g></a></g> <g id="a_node6_23"><a xlink:href="#"
    xlink:title="Runner"><g id="a_node6_24"><a xlink:href="Fuzzer.html" xlink:title="__init__(self)
    -> None:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Initialize"><text text-anchor="start" x="167.25" y="-126" font-family="''Fira
    Mono'', ''Source Code Pro'', ''Courier'', monospace" font-weight="bold" font-style="italic"
    font-size="10.00">__init__()</text></a></g> <g id="a_node6_25"><a xlink:href="Fuzzer.html"
    xlink:title="run(self, inp: str) -> Any:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Run the runner with the given input"><text text-anchor="start" x="167.25" y="-113.25"
    font-family="''Fira Mono'', ''Source Code Pro'', ''Courier'', monospace" font-weight="bold"
    font-style="italic" font-size="10.00">run()</text></a></g></a></g></a></g></g>
    <g id="edge4" class="edge"><title>WebRunner->Runner</title></g> <g id="node7"
    class="node"><title>HTMLGrammarMiner</title> <g id="a_node7"><a xlink:href="#"
    xlink:title="class HTMLGrammarMiner:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Mine a grammar from a HTML form"><text text-anchor="start" x="287.88" y="-181.7"
    font-family="Patua One, Helvetica, sans-serif" font-weight="bold" font-size="14.00"
    fill="#b03a2e">HTMLGrammarMiner</text> <g id="a_node7_26"><a xlink:href="#" xlink:title="HTMLGrammarMiner"><g
    id="a_node7_27"><a xlink:href="#" xlink:title="QUERY_GRAMMAR = {''<start>'': [''<action>?<query>''],
    ''<string>'': [''<letter>'', ''<letter><text text-anchor="start" x="315.25" y="-158.5"
    font-family="''Fira Mono'', ''Source Code Pro'', ''Courier'', monospace" font-size="10.00">QUERY_GRAMMAR</text><string>''],
    ''<letter>'': [''<plus>'', ''<percent>'', ''<other>''], ''<plus>'': [''+''], ''<percent>'':
    [''%<hexdigit-1><hexdigit>''], ''<hexdigit>'': [''0'', ''1'', ''2'', ''3'', ''4'',
    ''5'', ''6'', ''7'', ''8'', ''9'', ''a'', ''b'', ''c'', ''d'', ''e'', ''f''],
    ''<other>'': [''0'', ''1'', ''2'', ''3'', ''4'', ''5'', ''a'', ''b'', ''c'', ''d'',
    ''e'', ''-'', ''_''], ''<text>'': [''<string>''], ''<number>'': [''<digits>''],
    ''<digits>'': [''<digit>'', ''<digits><digit>''], ''<digit>'': [''0'', ''1'',
    ''2'', ''3'', ''4'', ''5'', ''6'', ''7'', ''8'', ''9''], ''<checkbox>'': [''<_checkbox>''],
    ''<_checkbox>'': [''on'', ''off''], ''<email>'': [''<_email>''], ''<_email>'':
    [''<string>%40<string>''], ''<password>'': [''<_password>''], ''<_password>'':
    [''abcABC.123''], ''<hexdigit-1>'': [''3'', ''4'', ''5'', ''6'', ''7''], ''<submit>'':
    ['''']}"></a></g></a></g> <g id="a_node7_28"><a xlink:href="#" xlink:title="HTMLGrammarMiner"><g
    id="a_node7_29"><a xlink:href="#" xlink:title="__init__(self, html_text: str)
    -> None:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Constructor. `html_text` is the HTML string to parse."><text text-anchor="start"
    x="312.25" y="-138.75" font-family="''Fira Mono'', ''Source Code Pro'', ''Courier'',
    monospace" font-weight="bold" font-size="10.00">__init__()</text></a></g> <g id="a_node7_30"><a
    xlink:href="#" xlink:title="mine_grammar(self) -> Dict[str, List[Expansion]]:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Extract a grammar from the given HTML text"><text text-anchor="start" x="312.25"
    y="-125" font-family="''Fira Mono'', ''Source Code Pro'', ''Courier'', monospace"
    font-size="10.00">mine_grammar()</text></a></g></a></g></a></g></g> <g id="node8"
    class="node"><title>SQLInjectionGrammarMiner</title> <g id="a_node8"><a xlink:href="#"
    xlink:title="class SQLInjectionGrammarMiner:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Demonstration of an automatic SQL Injection attack grammar miner"><text text-anchor="start"
    x="268" y="-51.7" font-family="Patua One, Helvetica, sans-serif" font-weight="bold"
    font-size="14.00" fill="#b03a2e">SQLInjectionGrammarMiner</text> <g id="a_node8_31"><a
    xlink:href="#" xlink:title="SQLInjectionGrammarMiner"><g id="a_node8_32"><a xlink:href="#"
    xlink:title="ATTACKS = [&quot;<string>'' <sql-values>); <sql-payload>; <sql-comment>&quot;,
    &quot;<string>'' <sql-comment>&quot;, &quot;'' OR 1=1<sql-comment>''&quot;, ''<number>
    OR 1=1'']"><text text-anchor="start" x="333.25" y="-28.5" font-family="''Fira
    Mono'', ''Source Code Pro'', ''Courier'', monospace" font-size="10.00">ATTACKS</text></a></g></a></g>
    <g id="a_node8_33"><a xlink:href="#" xlink:title="SQLInjectionGrammarMiner"><g
    id="a_node8_34"><a xlink:href="#" xlink:title="__init__(self, html_text: str,
    sql_payload: str):'
  prefs: []
  type: TYPE_NORMAL
- en: Constructor.
  prefs: []
  type: TYPE_NORMAL
- en: '`html_text` - the HTML form to be attacked'
  prefs: []
  type: TYPE_NORMAL
- en: '`sql_payload` - the SQL command to be executed"><text text-anchor="start" x="324.25"
    y="-8.75" font-family="''Fira Mono'', ''Source Code Pro'', ''Courier'', monospace"
    font-weight="bold" font-style="italic" font-size="10.00">__init__()</text></a></g></a></g></a></g></g>
    <g id="edge5" class="edge"><title>SQLInjectionGrammarMiner->HTMLGrammarMiner</title></g>
    <g id="node9" class="node"><title>Legend</title> <text text-anchor="start" x="466.62"
    y="-50.25" font-family="Patua One, Helvetica, sans-serif" font-weight="bold" font-size="10.00"
    fill="#b03a2e">Legend</text> <text text-anchor="start" x="466.62" y="-40.25" font-family="Patua
    One, Helvetica, sans-serif" font-size="10.00">• </text> <text text-anchor="start"
    x="472.62" y="-40.25" font-family="''Fira Mono'', ''Source Code Pro'', ''Courier'',
    monospace" font-weight="bold" font-size="8.00">public_method()</text> <text text-anchor="start"
    x="466.62" y="-30.25" font-family="Patua One, Helvetica, sans-serif" font-size="10.00">• </text>
    <text text-anchor="start" x="472.62" y="-30.25" font-family="''Fira Mono'', ''Source
    Code Pro'', ''Courier'', monospace" font-size="8.00">private_method()</text> <text
    text-anchor="start" x="466.62" y="-20.25" font-family="Patua One, Helvetica, sans-serif"
    font-size="10.00">• </text> <text text-anchor="start" x="472.62" y="-20.25" font-family="''Fira
    Mono'', ''Source Code Pro'', ''Courier'', monospace" font-style="italic" font-size="8.00">overloaded_method()</text>
    <text text-anchor="start" x="466.62" y="-11.2" font-family="Helvetica,sans-Serif"
    font-size="9.00">Hover over names to see doc</text></g></g></svg>'
  prefs: []
  type: TYPE_NORMAL
- en: A Web User Interface
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Let us start with a simple example. We want to set up a *Web server* that allows
    readers of this book to buy fuzzingbook-branded fan articles ("swag"). In reality,
    we would make use of an existing Web shop (or an appropriate framework) for this
    purpose. For the purpose of this book, we *write our own Web server*, building
    on the HTTP server facilities provided by the Python library.
  prefs: []
  type: TYPE_NORMAL
- en: <details id="Excursion:-Implementing-a-Web-Server"><summary>Implementing a Web
    Server</summary>
  prefs: []
  type: TYPE_NORMAL
- en: All of our Web server is defined in a `HTTPRequestHandler`, which, as the name
    suggests, handles arbitrary Web page requests.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: Taking Orders
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 'For our Web server, we need a number of Web pages:'
  prefs: []
  type: TYPE_NORMAL
- en: We want one page where customers can place an order.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: We want one page where they see their order confirmed.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Additionally, we need pages display error messages such as "Page Not Found".
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'We start with the order form. The dictionary `FUZZINGBOOK_SWAG` holds the items
    that customers can order, together with long descriptions:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE8]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE9]'
  prefs: []
  type: TYPE_PRE
- en: This is the HTML code for the order form. The menu for selecting the swag to
    be ordered is created dynamically from `FUZZINGBOOK_SWAG`. We omit plenty of details
    such as precise shipping address, payment, shopping cart, and more.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs: []
  type: TYPE_PRE
- en: 'This is what the order form looks like:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE11]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE12]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE13]'
  prefs: []
  type: TYPE_PRE
- en: This form is not yet functional, as there is no server behind it; pressing "place
    order" will lead you to a nonexistent page.
  prefs: []
  type: TYPE_NORMAL
- en: Order Confirmation
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 'Once we have gotten an order, we show a confirmation page, which is instantiated
    with the customer information submitted before. Here is the HTML and the rendering:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE14]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE15]'
  prefs: []
  type: TYPE_PRE
- en: '**Thank you for your Fuzzingbook Order!**'
  prefs: []
  type: TYPE_NORMAL
- en: We will send **One FuzzingBook Rotary Hammer** to Jane Doe in Seattle, 98104
  prefs: []
  type: TYPE_NORMAL
- en: A confirmation mail will be sent to doe@example.com.
  prefs: []
  type: TYPE_NORMAL
- en: Want more swag? Use our [order form](/)!
  prefs: []
  type: TYPE_NORMAL
- en: Terms and Conditions
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: A website can only be complete if it has the necessary legalese. This page shows
    some terms and conditions.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE16]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE17]'
  prefs: []
  type: TYPE_PRE
- en: '**Fuzzingbook Terms and Conditions**'
  prefs: []
  type: TYPE_NORMAL
- en: The content of this project is licensed under the [Creative Commons Attribution-NonCommercial-ShareAlike
    4.0 International License.](https://creativecommons.org/licenses/by-nc-sa/4.0/)
  prefs: []
  type: TYPE_NORMAL
- en: To place an order, use our [order form](/).
  prefs: []
  type: TYPE_NORMAL
- en: Storing Orders
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: To store orders, we make use of a *database*, stored in the file `orders.db`.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE18]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE19]'
  prefs: []
  type: TYPE_PRE
- en: To interact with the database, we use *SQL commands*. The following commands
    create a table with five text columns for item, name, email, city, and zip – the
    exact same fields we also use in our HTML form.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE20]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE21]'
  prefs: []
  type: TYPE_PRE
- en: 'At this point, the database is still empty:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE22]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE23]'
  prefs: []
  type: TYPE_PRE
- en: 'We can add entries using the SQL `INSERT` command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE24]'
  prefs: []
  type: TYPE_PRE
- en: 'These values are now in the database:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE25]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE26]'
  prefs: []
  type: TYPE_PRE
- en: 'We can also delete entries from the table again (say, after completion of the
    order):'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE27]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE28]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE29]'
  prefs: []
  type: TYPE_PRE
- en: Handling HTTP Requests
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: We have an order form and a database; now we need a Web server which brings
    it all together. The Python `http.server` module provides everything we need to
    build a simple HTTP server. A `HTTPRequestHandler` is an object that takes and
    processes HTTP requests – in particular, `GET` requests for retrieving Web pages.
  prefs: []
  type: TYPE_NORMAL
- en: We implement the `do_GET()` method that, based on the given path, branches off
    to serve the requested Web pages. Requesting the path `/` produces the order form;
    a path beginning with `/order` sends an order to be processed. All other requests
    end in a `Page Not Found` message.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE30]'
  prefs: []
  type: TYPE_PRE
- en: Order Form
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
- en: 'Accessing the home page (i.e. getting the page at `/`) is simple: We go and
    serve the `html_order_form` as defined above.'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE31]'
  prefs: []
  type: TYPE_PRE
- en: 'Likewise, we can send out the terms and conditions:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE32]'
  prefs: []
  type: TYPE_PRE
- en: Processing Orders
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
- en: When the user clicks `Submit` on the order form, the Web browser creates and
    retrieves a URL of the form
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE33]'
  prefs: []
  type: TYPE_PRE
- en: where each `field_i` is the name of the field in the HTML form, and `value_i`
    is the value provided by the user. Values use the CGI encoding we have seen in
    the [chapter on coverage](Coverage.html) – that is, spaces are converted into
    `+`, and characters that are not digits or letters are converted into `%nn`, where
    `nn` is the hexadecimal value of the character.
  prefs: []
  type: TYPE_NORMAL
- en: 'If Jane Doe `<doe@example.com>` from Seattle orders a T-Shirt, this is the
    URL the browser creates:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE34]'
  prefs: []
  type: TYPE_PRE
- en: When processing a query, the attribute `self.path` of the HTTP request handler
    holds the path accessed – i.e., everything after `<hostname>`. The helper method
    `get_field_values()` takes `self.path` and returns a dictionary of values.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE35]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE36]'
  prefs: []
  type: TYPE_PRE
- en: The method `handle_order()` takes these values from the URL, stores the order,
    and returns a page confirming the order. If anything goes wrong, it sends an internal
    server error.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE37]'
  prefs: []
  type: TYPE_PRE
- en: Storing the order makes use of the database connection defined above; we create
    an SQL command instantiated with the values as extracted from the URL.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE38]'
  prefs: []
  type: TYPE_PRE
- en: After storing the order, we send the confirmation HTML page, which again is
    instantiated with the values from the URL.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE39]'
  prefs: []
  type: TYPE_PRE
- en: Other HTTP commands
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
- en: Besides the `GET` command (which does all the heavy lifting), HTTP servers can
    also support other HTTP commands; we support the `HEAD` command, which returns
    the head information of a Web page. In our case, this is always empty.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE40]'
  prefs: []
  type: TYPE_PRE
- en: Error Handling
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: We have defined pages for submitting and processing orders; now we also need
    a few pages for errors that might occur.
  prefs: []
  type: TYPE_NORMAL
- en: Page Not Found
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
- en: This page is displayed if a non-existing page (i.e. anything except `/` or `/order`)
    is requested.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE41]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE42]'
  prefs: []
  type: TYPE_PRE
- en: '**Sorry.**'
  prefs: []
  type: TYPE_NORMAL
- en: This page does not exist. Try our [order form](/) instead.
  prefs: []
  type: TYPE_NORMAL
- en: The method `not_found()` takes care of sending this out with the appropriate
    HTTP status code.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE43]'
  prefs: []
  type: TYPE_PRE
- en: Internal Errors
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
- en: This page is shown for any internal errors that might occur. For diagnostic
    purposes, we have it include the traceback of the failing function.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE44]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE45]'
  prefs: []
  type: TYPE_PRE
- en: '**Internal Server Error**'
  prefs: []
  type: TYPE_NORMAL
- en: The server has encountered an internal error. Go to our [order form](/).
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE46]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE47]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE48]'
  prefs: []
  type: TYPE_PRE
- en: Logging
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: Our server runs as a separate process in the background, waiting to receive
    commands at all time. To see what it is doing, we implement a special logging
    mechanism. The `httpd_message_queue` establishes a queue into which one process
    (the server) can store Python objects, and in which another process (the notebook)
    can retrieve them. We use this to pass log messages from the server, which we
    can then display in the notebook.
  prefs: []
  type: TYPE_NORMAL
- en: For multiprocessing, we use the `multiprocess` module - a variant of the standard
    Python `multiprocessing` module that also works in notebooks. If you are running
    this code outside a notebook, you can also use `multiprocessing` instead.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE49]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE50]'
  prefs: []
  type: TYPE_PRE
- en: 'Let us place two messages in the queue:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE51]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE52]'
  prefs: []
  type: TYPE_PRE
- en: 'To distinguish server messages from other parts of the notebook, we format
    them specially:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE53]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE54]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE55]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE56]'
  prefs: []
  type: TYPE_PRE
- en: 'The method `print_httpd_messages()` prints all messages accumulated in the
    queue so far:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE57]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE58]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE59]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE60]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE61]'
  prefs: []
  type: TYPE_PRE
- en: 'With `clear_httpd_messages()`, we can silently discard all pending messages:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE62]'
  prefs: []
  type: TYPE_PRE
- en: 'The method `log_message()` in the request handler makes use of the queue to
    store its messages:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE63]'
  prefs: []
  type: TYPE_PRE
- en: 'In [the chapter on carving](Carver.html), we had introduced a `webbrowser()`
    method which retrieves the contents of the given URL. We now extend it such that
    it also prints out any log messages produced by the server:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE64]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE65]'
  prefs: []
  type: TYPE_PRE
- en: With `webbrowser()`, we are now ready to get the Web server up and running.</details>
  prefs: []
  type: TYPE_NORMAL
- en: Running the Server
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: We run the server on the *local host* – that is, the same machine which also
    runs this notebook. We check for an accessible port and put the resulting URL
    in the queue created earlier.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE66]'
  prefs: []
  type: TYPE_PRE
- en: The function `start_httpd()` starts the server in a separate process, which
    we start using the `multiprocess` module. It retrieves its URL from the message
    queue and returns it, such that we can start talking to the server.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE67]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE68]'
  prefs: []
  type: TYPE_PRE
- en: 'Let us now start the server and save its URL:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE69]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE70]'
  prefs: []
  type: TYPE_PRE
- en: Interacting with the Server
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Let us now access the server just created.
  prefs: []
  type: TYPE_NORMAL
- en: Direct Browser Access
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: If you are running the Jupyter notebook server on the local host as well, you
    can now access the server directly at the given URL. Simply open the address in
    `httpd_url` by clicking on the link below.
  prefs: []
  type: TYPE_NORMAL
- en: '**Note**: This only works if you are running the Jupyter notebook server on
    the local host.'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE71]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE72]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE73]'
  prefs: []
  type: TYPE_PRE
- en: Even more convenient, you may be able to interact directly with the server using
    the window below.
  prefs: []
  type: TYPE_NORMAL
- en: '**Note**: This only works if you are running the Jupyter notebook server on
    the local host.'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE74]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE75]'
  prefs: []
  type: TYPE_PRE
- en: 'After interaction, you can retrieve the messages produced by the server:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE76]'
  prefs: []
  type: TYPE_PRE
- en: 'We can also see any orders placed in the `orders` database (`db`):'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE77]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE78]'
  prefs: []
  type: TYPE_PRE
- en: 'And we can clear the order database:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE79]'
  prefs: []
  type: TYPE_PRE
- en: Retrieving the Home Page
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 'Even if our browser cannot directly interact with the server, the *notebook*
    can. We can, for instance, retrieve the contents of the home page and display
    them:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE80]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE81]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE82]'
  prefs: []
  type: TYPE_PRE
- en: Placing Orders
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: To test this form, we can generate URLs with orders and have the server process
    them.
  prefs: []
  type: TYPE_NORMAL
- en: The method `urljoin()` puts together a base URL (i.e., the URL of our server)
    and a path – say, the path towards our order.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE83]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE84]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE85]'
  prefs: []
  type: TYPE_PRE
- en: 'With `urljoin()`, we can create a full URL that is the same as the one generated
    by the browser as we submit the order form. Sending this URL to the browser effectively
    places the order, as we can see in the server log produced:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE86]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE87]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE88]'
  prefs: []
  type: TYPE_PRE
- en: 'The web page returned confirms the order:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE89]'
  prefs: []
  type: TYPE_PRE
- en: '**Thank you for your Fuzzingbook Order!**'
  prefs: []
  type: TYPE_NORMAL
- en: We will send **One FuzzingBook T-Shirt** to Jane Doe in Seattle, 98104
  prefs: []
  type: TYPE_NORMAL
- en: A confirmation mail will be sent to doe@example.com.
  prefs: []
  type: TYPE_NORMAL
- en: Want more swag? Use our [order form](/)!
  prefs: []
  type: TYPE_NORMAL
- en: 'And the order is in the database, too:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE90]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE91]'
  prefs: []
  type: TYPE_PRE
- en: Error Messages
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 'We can also test whether the server correctly responds to invalid requests.
    Nonexistent pages, for instance, are correctly handled:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE92]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE93]'
  prefs: []
  type: TYPE_PRE
- en: '**Sorry.**'
  prefs: []
  type: TYPE_NORMAL
- en: This page does not exist. Try our [order form](/) instead.
  prefs: []
  type: TYPE_NORMAL
- en: You may remember we also have a page for internal server errors. Can we get
    the server to produce this page? To find this out, we have to test the server
    thoroughly – which we do in the remainder of this chapter.
  prefs: []
  type: TYPE_NORMAL
- en: Fuzzing Input Forms
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: After setting up and starting the server, let us now go and systematically test
    it – first with expected, and then with less expected values.
  prefs: []
  type: TYPE_NORMAL
- en: Fuzzing with Expected Values
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Since placing orders is all done by creating appropriate URLs, we define a [grammar](Grammars.html)
    `ORDER_GRAMMAR` which encodes ordering URLs. It comes with a few sample values
    for names, email addresses, cities and (random) digits.
  prefs: []
  type: TYPE_NORMAL
- en: <details id="Excursion:-Implementing-cgi_decode()"><summary>Implementing cgi_decode()</summary>
  prefs: []
  type: TYPE_NORMAL
- en: 'To make it easier to define strings that become part of a URL, we define the
    function `cgi_encode()`, taking a string and automatically encoding it into CGI:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE94]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE95]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE96]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE97]'
  prefs: []
  type: TYPE_PRE
- en: 'The optional parameter `do_not_encode` allows us to skip certain characters
    from encoding. This is useful when encoding grammar rules:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE98]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE99]'
  prefs: []
  type: TYPE_PRE
- en: '`cgi_encode()` is the exact counterpart of the `cgi_decode()` function defined
    in the [chapter on coverage](Coverage.html):'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE100]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE101]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE102]</details>'
  prefs: []
  type: TYPE_NORMAL
- en: 'In the grammar, we make use of `cgi_encode()` to encode strings:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE103]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE104]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE105]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE106]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE107]'
  prefs: []
  type: TYPE_PRE
- en: <svg class="railroad-diagram" height="62" viewBox="0 0 182.5 62" width="182.5"><g
    transform="translate(.5 .5)"><g><g><g class="non-terminal"><text x="91.25" y="35">order</text></g></g></g></g></svg>
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE108]'
  prefs: []
  type: TYPE_PRE
- en: <svg class="railroad-diagram" height="62" viewBox="0 0 976.0 62" width="976.0"><g
    transform="translate(.5 .5)"><g><g><g class="terminal"><text x="121.0" y="35">/order?item=</text></g>
    <g class="non-terminal"><text x="229.0" y="35">item</text></g> <g class="terminal"><text
    x="311.5" y="35">&name=</text></g> <g class="non-terminal"><text x="394.0" y="35">name</text></g>
    <g class="terminal"><text x="480.75" y="35">&email=</text></g> <g class="non-terminal"><text
    x="571.75" y="35">email</text></g> <g class="terminal"><text x="658.5" y="35">&city=</text></g>
    <g class="non-terminal"><text x="741.0" y="35">city</text></g> <g class="terminal"><text
    x="819.25" y="35">&zip=</text></g> <g class="non-terminal"><text x="893.25" y="35">zip</text></g></g></g></g></svg>
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE109]'
  prefs: []
  type: TYPE_PRE
- en: <svg class="railroad-diagram" height="122" viewBox="0 0 199.5 122" width="199.5"><g
    transform="translate(.5 .5)"><g><g><g class="terminal"><text x="99.75" y="35">tshirt</text></g></g>
    <g><g class="terminal"><text x="99.75" y="65">drill</text></g></g> <g><g class="terminal"><text
    x="99.75" y="95">lockset</text></g></g></g></g></svg>
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE110]'
  prefs: []
  type: TYPE_PRE
- en: <svg class="railroad-diagram" height="92" viewBox="0 0 225.0 92" width="225.0"><g
    transform="translate(.5 .5)"><g><g><g class="terminal"><text x="112.5" y="35">Jane+Doe</text></g></g>
    <g><g class="terminal"><text x="112.5" y="65">John+Smith</text></g></g></g></g></svg>
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE111]'
  prefs: []
  type: TYPE_PRE
- en: <svg class="railroad-diagram" height="92" viewBox="0 0 318.5 92" width="318.5"><g
    transform="translate(.5 .5)"><g><g><g class="terminal"><text x="159.25" y="35">j.doe%40example.com</text></g></g>
    <g><g class="terminal"><text x="159.25" y="65">j_smith%40example.com</text></g></g></g></g></svg>
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE112]'
  prefs: []
  type: TYPE_PRE
- en: <svg class="railroad-diagram" height="92" viewBox="0 0 208.0 92" width="208.0"><g
    transform="translate(.5 .5)"><g><g><g class="terminal"><text x="104.0" y="35">Seattle</text></g></g>
    <g><g class="terminal"><text x="104.0" y="65">New+York</text></g></g></g></g></svg>
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE113]'
  prefs: []
  type: TYPE_PRE
- en: <svg class="railroad-diagram" height="62" viewBox="0 0 512.5 62" width="512.5"><g
    transform="translate(.5 .5)"><g><g><g class="non-terminal"><text x="91.25" y="35">digit</text></g>
    <g class="non-terminal"><text x="173.75" y="35">digit</text></g> <g class="non-terminal"><text
    x="256.25" y="35">digit</text></g> <g class="non-terminal"><text x="338.75" y="35">digit</text></g>
    <g class="non-terminal"><text x="421.25" y="35">digit</text></g></g></g></g></svg>
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE114]'
  prefs: []
  type: TYPE_PRE
- en: <svg class="railroad-diagram" height="109" viewBox="0 0 522.5 109" width="522.5"><g
    transform="translate(.5 .5)"><g><g><g><g class="terminal"><text x="84.25" y="43">0</text></g></g>
    <g><g class="terminal"><text x="84.25" y="73">1</text></g></g></g> <g><g><g class="terminal"><text
    x="172.75" y="43">2</text></g></g> <g><g class="terminal"><text x="172.75" y="73">3</text></g></g></g>
    <g><g><g class="terminal"><text x="261.25" y="43">4</text></g></g> <g><g class="terminal"><text
    x="261.25" y="73">5</text></g></g></g> <g><g><g class="terminal"><text x="349.75"
    y="43">6</text></g></g> <g><g class="terminal"><text x="349.75" y="73">7</text></g></g></g>
    <g><g><g class="terminal"><text x="438.25" y="43">8</text></g></g> <g><g class="terminal"><text
    x="438.25" y="73">9</text></g></g></g></g></g></svg>
  prefs: []
  type: TYPE_NORMAL
- en: 'Using [one of our grammar fuzzers](GrammarFuzzer.iynb), we can instantiate
    this grammar and generate URLs:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE115]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE116]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE117]'
  prefs: []
  type: TYPE_PRE
- en: 'Sending these URLs to the server will have them processed correctly:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE118]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE119]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE120]'
  prefs: []
  type: TYPE_PRE
- en: '**Thank you for your Fuzzingbook Order!**'
  prefs: []
  type: TYPE_NORMAL
- en: We will send **One FuzzingBook Lock Set** to Jane Doe in Seattle, 16631
  prefs: []
  type: TYPE_NORMAL
- en: A confirmation mail will be sent to j_smith@example.com.
  prefs: []
  type: TYPE_NORMAL
- en: Want more swag? Use our [order form](/)!
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE121]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE122]'
  prefs: []
  type: TYPE_PRE
- en: Fuzzing with Unexpected Values
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'We can now see that the server does a good job when faced with "standard" values.
    But what happens if we feed it non-standard values? To this end, we make use of
    a [mutation fuzzer](MutationFuzzer.html) which inserts random changes into the
    URL. Our seed (i.e. the value to be mutated) comes from the grammar fuzzer:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE123]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE124]'
  prefs: []
  type: TYPE_PRE
- en: Mutating this string yields mutations not only in the field values, but also
    in field names as well as the URL structure.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE125]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE126]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE127]'
  prefs: []
  type: TYPE_PRE
- en: Let us fuzz a little until we get an internal server error. We use the Python
    `requests` module to interact with the Web server such that we can directly access
    the HTTP status code.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE128]'
  prefs: []
  type: TYPE_PRE
- en: 'That didn''t take long. Here''s the offending URL:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE129]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE130]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE131]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE132]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE133]'
  prefs: []
  type: TYPE_PRE
- en: '**Internal Server Error**'
  prefs: []
  type: TYPE_NORMAL
- en: The server has encountered an internal error. Go to our [order form](/).
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE134]'
  prefs: []
  type: TYPE_PRE
- en: 'How does the URL cause this internal error? We make use of [delta debugging](Reducer.html)
    to minimize the failure-inducing path, setting up a `WebRunner` class to define
    the failure condition:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE135]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE136]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE137]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE138]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE139]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE140]'
  prefs: []
  type: TYPE_PRE
- en: 'This is the minimized path:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE141]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE142]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE143]'
  prefs: []
  type: TYPE_PRE
- en: 'It turns out that our server encounters an internal error if we do not supply
    the requested fields:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE144]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE145]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE146]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE147]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE148]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE149]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE150]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE151]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE152]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE153]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE154]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE155]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE156]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE157]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE158]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE159]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE160]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE161]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE162]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE163]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE164]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE165]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE166]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE167]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE168]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE169]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE170]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE171]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE172]'
  prefs: []
  type: TYPE_PRE
- en: '**Internal Server Error**'
  prefs: []
  type: TYPE_NORMAL
- en: The server has encountered an internal error. Go to our [order form](/).
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE173]'
  prefs: []
  type: TYPE_PRE
- en: We see that we might have a lot to do to make our Web server more robust against
    unexpected inputs. The [exercises](#Exercises) give some instructions on what
    to do.
  prefs: []
  type: TYPE_NORMAL
- en: Extracting Grammars for Input Forms
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: In our previous examples, we have assumed that we have a grammar that produces
    valid (or less valid) order queries. However, such a grammar does not need to
    be specified manually; we can also *extract it automatically* from a Web page
    at hand. This way, we can apply our test generators on arbitrary Web forms without
    a manual specification step.
  prefs: []
  type: TYPE_NORMAL
- en: Searching HTML for Input Fields
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'The key idea of our approach is to identify all input fields in a form. To
    this end, let us take a look at how the individual elements in our order form
    are encoded in HTML:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE174]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE175]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE176]'
  prefs: []
  type: TYPE_PRE
- en: We see that there is a number of form elements that accept inputs, in particular
    `<input>`, but also `<select>` and `<option>`. The idea now is to *parse* the
    HTML of the Web page in question, to extract these individual input elements,
    and then to create a *grammar* that produces a matching URL, effectively filling
    out the form.
  prefs: []
  type: TYPE_NORMAL
- en: To parse the HTML page, we could define a grammar to parse HTML and make use
    of [our own parser infrastructure](Parser.html). However, it is much easier to
    not reinvent the wheel and instead build on the existing, dedicated `HTMLParser`
    class from the Python library.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE177]'
  prefs: []
  type: TYPE_PRE
- en: During parsing, we search for `<form>` tags and save the associated action (i.e.,
    the URL to be invoked when the form is submitted) in the `action` attribute. While
    processing the form, we create a map `fields` that holds all input fields we have
    seen; it maps field names to the respective HTML input types (`"text"`, `"number"`,
    `"checkbox"`, etc.). Exclusive selection options map to a list of possible values;
    the `select` stack holds the currently active selection.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE178]'
  prefs: []
  type: TYPE_PRE
- en: While parsing, the parser calls `handle_starttag()` for every opening tag (such
    as `<form>`) found; conversely, it invokes `handle_endtag()` for closing tags
    (such as `</form>`). `attributes` gives us a map of associated attributes and
    values.
  prefs: []
  type: TYPE_NORMAL
- en: 'Here is how we process the individual tags:'
  prefs: []
  type: TYPE_NORMAL
- en: When we find a `<form>` tag, we save the associated action in the `action` attribute;
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: When we find an `<input>` tag or similar, we save the type in the `fields` attribute;
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: When we find a `<select>` tag or similar, we push its name on the `select` stack;
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: When we find an `<option>` tag, we append the option to the list associated
    with the last pushed `<select>` tag.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE179]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE180]'
  prefs: []
  type: TYPE_PRE
- en: Our implementation handles only one form per Web page; it also works on HTML
    only, ignoring all interaction coming from JavaScript. Also, it does not support
    all HTML input types.
  prefs: []
  type: TYPE_NORMAL
- en: 'Let us put this parser to action. We create a class `HTMLGrammarMiner` that
    takes a HTML document to parse. It then returns the associated action and the
    associated fields:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE181]'
  prefs: []
  type: TYPE_PRE
- en: 'Applied on our order form, this is what we get:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE182]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE183]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE184]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE185]'
  prefs: []
  type: TYPE_PRE
- en: From this structure, we can now generate a grammar that automatically produces
    valid form submission URLs.
  prefs: []
  type: TYPE_NORMAL
- en: Mining Grammars for Web Pages
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'To create a grammar from the fields extracted from HTML, we build on the `CGI_GRAMMAR`
    defined in the [chapter on grammars](Grammars.html). The key idea is to define
    rules for every HTML input type: An HTML `number` type will get values from the
    `<number>` rule; likewise, values for the HTML `email` type will be defined from
    the `<email>` rule. Our default grammar provides very simple rules for these types.'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE186]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE187]'
  prefs: []
  type: TYPE_PRE
- en: Our grammar miner now takes the fields extracted from HTML, converting them
    into rules. Essentially, every input field encountered gets included in the resulting
    query URL; and it gets a rule expanding it into the appropriate type.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE188]'
  prefs: []
  type: TYPE_PRE
- en: 'Let us show `HTMLGrammarMiner` in action, again applied on our order form.
    Here is the full resulting grammar:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE189]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE190]'
  prefs: []
  type: TYPE_PRE
- en: 'Let us take a look into the structure of the grammar. It produces URL paths
    of this form:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE191]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE192]'
  prefs: []
  type: TYPE_PRE
- en: 'Here, the `<action>` comes from the `action` attribute of the HTML form:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE193]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE194]'
  prefs: []
  type: TYPE_PRE
- en: 'The `<query>` is composed of the individual field items:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE195]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE196]'
  prefs: []
  type: TYPE_PRE
- en: 'Each of these fields has the form `<field-name>=<field-type>`, where `<field-type>`
    is already defined in the grammar:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE197]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE198]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE199]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE200]'
  prefs: []
  type: TYPE_PRE
- en: 'These are the query URLs produced from the grammar. We see that these are similar
    to the ones produced from our hand-crafted grammar, except that the string values
    for names, email addresses, and cities are now completely random:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE201]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE202]'
  prefs: []
  type: TYPE_PRE
- en: 'We can again feed these directly into our Web browser:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE203]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE204]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE205]'
  prefs: []
  type: TYPE_PRE
- en: '**Thank you for your Fuzzingbook Order!**'
  prefs: []
  type: TYPE_NORMAL
- en: We will send **One FuzzingBook Rotary Hammer** to in cdb, 3230
  prefs: []
  type: TYPE_NORMAL
- en: A confirmation mail will be sent to 5F @p a .
  prefs: []
  type: TYPE_NORMAL
- en: Want more swag? Use our [order form](/)!
  prefs: []
  type: TYPE_NORMAL
- en: We see (one more time) that we can mine a grammar automatically from given data.
  prefs: []
  type: TYPE_NORMAL
- en: A Fuzzer for Web Forms
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: To make things most convenient, let us define a `WebFormFuzzer` class that does
    everything in one place. Given a URL, it extracts its HTML content, mines the
    grammar and then produces inputs for it.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE206]'
  prefs: []
  type: TYPE_PRE
- en: 'All it now takes to fuzz a Web form is to provide its URL:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE207]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE208]'
  prefs: []
  type: TYPE_PRE
- en: 'We can combine the fuzzer with a `WebRunner` as defined above to run the resulting
    fuzz inputs directly on our Web server:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE209]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE210]'
  prefs: []
  type: TYPE_PRE
- en: 'While convenient to use, this fuzzer is still very rudimentary:'
  prefs: []
  type: TYPE_NORMAL
- en: It is limited to one form per page.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: It only supports `GET` actions (i.e., inputs encoded into the URL). A full Web
    form fuzzer would have to at least support `POST` actions.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The fuzzer is build on HTML only. There is no Javascript handling for dynamic
    Web pages.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Let us clear any pending messages before we get to the next section:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE211]'
  prefs: []
  type: TYPE_PRE
- en: Crawling User Interfaces
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: So far, we have assumed there would be only one form to explore. A real Web
    server, of course, has several pages – and possibly several forms, too. We define
    a simple *crawler* that explores all the links that originate from one page.
  prefs: []
  type: TYPE_NORMAL
- en: Our crawler is pretty straightforward. Its main component is again a `HTMLParser`
    that analyzes the HTML code for links of the form
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE212]'
  prefs: []
  type: TYPE_PRE
- en: and saves all the links found in a list called `links`.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE213]'
  prefs: []
  type: TYPE_PRE
- en: 'The actual crawler comes as a *generator function* `crawl()` which produces
    one URL after another. By default, it returns only URLs that reside on the same
    host; the parameter `max_pages` controls how many pages (default: 1) should be
    scanned. We also respect the `robots.txt` file on the remote site to check which
    pages we are allowed to scan.'
  prefs: []
  type: TYPE_NORMAL
- en: <details id="Excursion:-Implementing-a-Crawler"><summary>Implementing a Crawler</summary>
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE214]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE215]</details>'
  prefs: []
  type: TYPE_NORMAL
- en: We can run the crawler on our own server, where it will quickly return the order
    page and the terms and conditions page.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE216]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE217]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE218]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE219]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE220]'
  prefs: []
  type: TYPE_PRE
- en: We can also crawl over other sites, such as the home page of this project.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE221]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE222]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE223]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE224]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE225]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE226]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE227]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE228]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE229]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE230]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE231]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE232]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE233]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE234]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE235]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE236]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE237]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE238]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE239]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE240]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE241]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE242]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE243]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE244]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE245]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE246]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE247]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE248]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE249]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE250]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE251]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE252]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE253]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE254]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE255]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE256]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE257]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE258]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE259]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE260]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE261]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE262]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE263]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE264]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE265]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE266]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE267]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE268]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE269]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE270]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE271]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE272]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE273]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE274]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE275]'
  prefs: []
  type: TYPE_PRE
- en: 'Once we have crawled over all the links of a site, we can generate tests for
    all the forms we found:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE276]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE277]'
  prefs: []
  type: TYPE_PRE
- en: For even better effects, one could integrate crawling and fuzzing – and also
    analyze the order confirmation pages for further links. We leave this to the reader
    as an exercise.
  prefs: []
  type: TYPE_NORMAL
- en: 'Let us get rid of any server messages accumulated above:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE278]'
  prefs: []
  type: TYPE_PRE
- en: Crafting Web Attacks
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Before we close the chapter, let us take a look at a special class of "uncommon"
    inputs that not only yield generic failures, but actually allow *attackers* to
    manipulate the server at their will. We will illustrate three common attacks using
    our server, which (surprise) actually turns out to be vulnerable against all of
    them.
  prefs: []
  type: TYPE_NORMAL
- en: HTML Injection Attacks
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: The first kind of attack we look at is *HTML injection*. The idea of HTML injection
    is to supply the Web server with *data that can also be interpreted as HTML*.
    If this HTML data is then displayed to users in their Web browsers, it can serve
    malicious purposes, although (seemingly) originating from a reputable site. If
    this data is also *stored*, it becomes a *persistent* attack; the attacker does
    not even have to lure victims towards specific pages.
  prefs: []
  type: TYPE_NORMAL
- en: Here is an example of a (simple) HTML injection. For the `name` field, we not
    only use plain text, but also embed HTML tags – in this case, a link towards a
    malware-hosting site.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE279]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE280]'
  prefs: []
  type: TYPE_PRE
- en: 'If we use this grammar to create inputs, the resulting URL will have all of
    the HTML encoded in:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE281]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE282]'
  prefs: []
  type: TYPE_PRE
- en: 'What happens if we send this string to our Web server? It turns out that the
    HTML is left in the confirmation page and shown as link. This also happens in
    the log:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE283]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE284]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE285]'
  prefs: []
  type: TYPE_PRE
- en: '**Thank you for your Fuzzingbook Order!**'
  prefs: []
  type: TYPE_NORMAL
- en: We will send **One FuzzingBook Rotary Hammer** to Jane Doe
  prefs: []
  type: TYPE_NORMAL
- en: '**[Click here for cute cat pictures!](www.lots.of.malware)**'
  prefs: []
  type: TYPE_NORMAL
- en: in Seattle, 02805
  prefs: []
  type: TYPE_NORMAL
- en: A confirmation mail will be sent to j_smith@example.com.
  prefs: []
  type: TYPE_NORMAL
- en: Want more swag? Use our [order form](/)!
  prefs: []
  type: TYPE_NORMAL
- en: 'Since the link seemingly comes from a trusted origin, users are much more likely
    to follow it. The link is even persistent, as it is stored in the database:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE286]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE287]'
  prefs: []
  type: TYPE_PRE
- en: This means that if anyone ever queries the database (for instance, operators
    processing the order), they will also see the link, multiplying its impact. By
    carefully crafting the injected HTML, one can thus expose malicious content to
    numerous users – until the injected HTML is finally deleted.
  prefs: []
  type: TYPE_NORMAL
- en: Cross-Site Scripting Attacks
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: If one can inject HTML code into a Web page, one can also inject *JavaScript*
    code as part of the injected HTML. This code would then be executed as soon as
    the injected HTML is rendered.
  prefs: []
  type: TYPE_NORMAL
- en: This is particularly dangerous because executed JavaScript always executes in
    the *origin* of the page which contains it. Therefore, an attacker can normally
    not force a user to run JavaScript in any origin he does not control himself.
    When an attacker, however, can inject his code into a vulnerable Web application,
    he can have the client run the code with the (trusted) Web application as origin.
  prefs: []
  type: TYPE_NORMAL
- en: In such a *cross-site scripting* (*XSS*) attack, the injected script can do
    a lot more than just plain HTML. For instance, the code can access sensitive page
    content or session cookies. If the code in question runs in the operator's browser
    (for instance, because an operator is reviewing the list of orders), it could
    retrieve any other information shown on the screen and thus steal order details
    for a variety of customers.
  prefs: []
  type: TYPE_NORMAL
- en: Here is a very simple example of a script injection. Whenever the name is displayed,
    it causes the browser to "steal" the current *session cookie* – the piece of data
    the browser uses to identify the user with the server. In our case, we could steal
    the cookie of the Jupyter session.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE288]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE289]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE290]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE291]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE292]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE293]'
  prefs: []
  type: TYPE_PRE
- en: '**Thank you for your Fuzzingbook Order!**'
  prefs: []
  type: TYPE_NORMAL
- en: We will send **One FuzzingBook Lock Set** to Jane Doe in Seattle, 34506
  prefs: []
  type: TYPE_NORMAL
- en: A confirmation mail will be sent to j.doe@example.com.
  prefs: []
  type: TYPE_NORMAL
- en: Want more swag? Use our [order form](/)!
  prefs: []
  type: TYPE_NORMAL
- en: The message looks as always – but if you have a look at your browser title,
    it should now show the first 10 characters of your "secret" notebook cookie. Instead
    of showing its prefix in the title, the script could also silently send the cookie
    to a remote server, allowing attackers to highjack your current notebook session
    and interact with the server on your behalf. It could also go and access and send
    any other data that is shown in your browser or otherwise available. It could
    run a *keylogger* and steal passwords and other sensitive data as it is typed
    in. Again, it will do so every time the compromised order with Jane Doe's name
    is shown in the browser and the associated script is executed.
  prefs: []
  type: TYPE_NORMAL
- en: 'Let us go and reset the title to a less sensitive value:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE294]'
  prefs: []
  type: TYPE_PRE
- en: SQL Injection Attacks
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Cross-site scripts have the same privileges as web pages – most notably, they
    cannot access or change data outside your browser. So-called *SQL injection* targets
    *databases*, allowing to inject commands that can read or modify data in the database,
    or change the purpose of the original query.
  prefs: []
  type: TYPE_NORMAL
- en: 'To understand how SQL injection works, let us take a look at the code that
    produces the SQL command to insert a new order into the database:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE295]'
  prefs: []
  type: TYPE_PRE
- en: What happens if any of the values (say, `name`) has a value that *can also be
    interpreted as a SQL command?* Then, instead of the intended `INSERT` command,
    we would execute the command imposed by `name`.
  prefs: []
  type: TYPE_NORMAL
- en: 'Let us illustrate this by an example. We set the individual values as they
    would be found during execution:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE296]'
  prefs: []
  type: TYPE_PRE
- en: 'and format the string as seen above:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE297]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE298]'
  prefs: []
  type: TYPE_PRE
- en: 'All fine, right? But now, we define a very "special" name that can also be
    interpreted as a SQL command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE299]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE300]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE301]'
  prefs: []
  type: TYPE_PRE
- en: What happens here is that we now get a command to insert values into the database
    (with a few "dummy" values `x`), followed by a SQL `DELETE` command that would
    *delete all entries* of the orders table. The string `--` starts a SQL *comment*
    such that the remainder of the original query would be easily ignored. By crafting
    strings that can also be interpreted as SQL commands, attackers can alter or delete
    database data, bypass authentication mechanisms and many more.
  prefs: []
  type: TYPE_NORMAL
- en: Is our server also vulnerable to such attacks? Of course, it is. We create a
    special grammar such that we can set the `<name>` parameter to a string with SQL
    injection, just as shown above.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE302]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE303]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE304]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE305]'
  prefs: []
  type: TYPE_PRE
- en: 'These are the current orders:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE306]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE307]'
  prefs: []
  type: TYPE_PRE
- en: Let us go and send our URL with SQL injection to the server. From the log, we
    see that the "malicious" SQL command is formed just as sketched above, and executed,
    too.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE308]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE309]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE310]'
  prefs: []
  type: TYPE_PRE
- en: 'All orders are now gone:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE311]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE312]'
  prefs: []
  type: TYPE_PRE
- en: 'This effect is also illustrated [in this very popular XKCD comic](https://xkcd.com/327/):'
  prefs: []
  type: TYPE_NORMAL
- en: '![https://xkcd.com/327/](../Images/8280ec9ae131d70c215e85006e2c6c91.png){width=100%}'
  prefs: []
  type: TYPE_NORMAL
- en: Even if we had not been able to execute arbitrary commands, being able to compromise
    an orders database offers several possibilities for mischief. For instance, we
    could use the address and matching credit card number of an existing person to
    go through validation and submit an order, only to have the order then delivered
    to an address of our choice. We could also use SQL injection to inject HTML and
    JavaScript code as above, bypassing possible sanitization geared at these domains.
  prefs: []
  type: TYPE_NORMAL
- en: To avoid such effects, the remedy is to *sanitize* all third-party inputs – no
    character in the input must be interpretable as plain HTML, JavaScript, or SQL.
    This is achieved by properly *quoting* and *escaping* inputs. The [exercises](#Exercises)
    give some instructions on what to do.
  prefs: []
  type: TYPE_NORMAL
- en: Leaking Internal Information
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'To craft the above SQL queries, we have used *insider information* – for instance,
    we knew the name of the table as well as its structure. Surely, an attacker would
    not know this and thus not be able to run the attack, right? Unfortunately, it
    turns out we are leaking all of this information out to the world in the first
    place. The error message produced by our server reveals everything we need:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE313]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE314]'
  prefs: []
  type: TYPE_PRE
- en: '**Internal Server Error**'
  prefs: []
  type: TYPE_NORMAL
- en: The server has encountered an internal error. Go to our [order form](/).
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE315]'
  prefs: []
  type: TYPE_PRE
- en: The best way to avoid information leakage through failures is of course not
    to fail in the first place. But if you fail, *make it hard for the attacker to
    establish a link between the attack and the failure.* In particular,
  prefs: []
  type: TYPE_NORMAL
- en: Do not produce "internal error" messages (and certainly not ones with internal
    information).
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Do not become unresponsive; just go back to the home page and ask the user to
    supply correct data.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: One more time, the [exercises](#Exercises) give some instructions on how to
    fix the server.
  prefs: []
  type: TYPE_NORMAL
- en: If you can manipulate the server not only to alter information, but also to
    *retrieve* information, you can learn about table names and structure by accessing
    special *tables* (also called *data dictionary*) in which database servers store
    their metadata. In the MySQL server, for instance, the special table `information_schema`
    holds metadata such as the names of databases and tables, data types of columns,
    or access privileges.
  prefs: []
  type: TYPE_NORMAL
- en: Fully Automatic Web Attacks
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'So far, we have demonstrated the above attacks using our manually written order
    grammar. However, the attacks also work for generated grammars. We extend `HTMLGrammarMiner`
    by adding a number of common SQL injection attacks:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE316]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE317]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE318]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE319]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE320]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE321]'
  prefs: []
  type: TYPE_PRE
- en: 'We see that several fields now are tested for vulnerabilities:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE322]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE323]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE324]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE325]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE326]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE327]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE328]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE329]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE330]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE331]'
  prefs: []
  type: TYPE_PRE
- en: We create a `SQLInjectionFuzzer` that does it all automatically.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE332]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE333]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE334]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE335]'
  prefs: []
  type: TYPE_PRE
- en: 'Our attack was successful! After less than a second of testing, our database
    is empty:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE336]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE337]'
  prefs: []
  type: TYPE_PRE
- en: 'Again, note the level of possible automation: We can'
  prefs: []
  type: TYPE_NORMAL
- en: Crawl the Web pages of a host for possible forms
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Automatically identify form fields and possible values
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Inject SQL (or HTML, or JavaScript) into any of these fields
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: and all of this fully automatically, not needing anything but the URL of the
    site.
  prefs: []
  type: TYPE_NORMAL
- en: The bad news is that with a tool set as the above, anyone can attack websites.
    The even worse news is that such penetration tests take place every day, on every
    website. The good news, though, is that after reading this chapter, you now get
    an idea of how Web servers are attacked every day – and what you as a Web server
    maintainer could and should do to prevent this.
  prefs: []
  type: TYPE_NORMAL
- en: Lessons Learned
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: User Interfaces (on the Web and elsewhere) should be tested with *expected*
    and *unexpected* values.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: One can *mine grammars from user interfaces*, allowing for their widespread
    testing.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Consequent *sanitizing* of inputs prevents common attacks such as code and SQL
    injection.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Do not attempt to write a Web server yourself, as you are likely to repeat all
    the mistakes of others.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'We''re done, so we can clean up:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE338]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE339]'
  prefs: []
  type: TYPE_PRE
- en: Next Steps
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: From here, the next step is [GUI Fuzzing](GUIFuzzer.html), going from HTML-
    and Web-based user interfaces to generic user interfaces (including JavaScript
    and mobile user interfaces).
  prefs: []
  type: TYPE_NORMAL
- en: If you are interested in security testing, do not miss our [chapter on information
    flow](InformationFlow.html), showing how to systematically detect information
    leaks; this also addresses the issue of SQL Injection attacks.
  prefs: []
  type: TYPE_NORMAL
- en: Background
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The [Wikipedia pages on Web application security](https://en.wikipedia.org/wiki/Web_application_security)
    are a mandatory read for anyone building, maintaining, or testing Web applications.
    In 2012, cross-site scripting and SQL injection, as discussed in this chapter,
    made up more than 50% of Web application vulnerabilities.
  prefs: []
  type: TYPE_NORMAL
- en: The [Wikipedia page on penetration testing](https://en.wikipedia.org/wiki/Penetration_test)
    provides a comprehensive overview on the history of penetration testing, as well
    as collections of vulnerabilities.
  prefs: []
  type: TYPE_NORMAL
- en: The [OWASP Zed Attack Proxy Project](https://www.owasp.org/index.php/OWASP_Zed_Attack_Proxy_Project)
    (ZAP) is an open source website security scanner including several of the features
    discussed above, and many many more.
  prefs: []
  type: TYPE_NORMAL
- en: Exercises
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Exercise 1: Fix the Server'
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Create a `BetterHTTPRequestHandler` class that fixes the several issues of
    `SimpleHTTPRequestHandler`:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Part 1: Silent Failures'
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: Set up the server such that it does not reveal internal information – in particular,
    tracebacks and HTTP status codes.
  prefs: []
  type: TYPE_NORMAL
- en: '[Use the notebook](https://mybinder.org/v2/gh/uds-se/fuzzingbook/HEAD?labpath=docs%2Fnotebooks/WebFuzzer.ipynb#Exercises)
    to work on the exercises and see solutions.'
  prefs: []
  type: TYPE_NORMAL
- en: 'Part 2: Sanitized HTML'
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: Set up the server such that it is not vulnerable against HTML and JavaScript
    injection attacks, notably by using methods such as `html.escape()` to escape
    special characters when showing them.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE340]'
  prefs: []
  type: TYPE_PRE
- en: '[Use the notebook](https://mybinder.org/v2/gh/uds-se/fuzzingbook/HEAD?labpath=docs%2Fnotebooks/WebFuzzer.ipynb#Exercises)
    to work on the exercises and see solutions.'
  prefs: []
  type: TYPE_NORMAL
- en: 'Part 3: Sanitized SQL'
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: Set up the server such that it is not vulnerable against SQL injection attacks,
    notably by using *SQL parameter substitution.*
  prefs: []
  type: TYPE_NORMAL
- en: '[Use the notebook](https://mybinder.org/v2/gh/uds-se/fuzzingbook/HEAD?labpath=docs%2Fnotebooks/WebFuzzer.ipynb#Exercises)
    to work on the exercises and see solutions.'
  prefs: []
  type: TYPE_NORMAL
- en: 'Part 4: A Robust Server'
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: Set up the server such that it does not crash with invalid or missing fields.
  prefs: []
  type: TYPE_NORMAL
- en: '[Use the notebook](https://mybinder.org/v2/gh/uds-se/fuzzingbook/HEAD?labpath=docs%2Fnotebooks/WebFuzzer.ipynb#Exercises)
    to work on the exercises and see solutions.'
  prefs: []
  type: TYPE_NORMAL
- en: 'Part 5: Test it!'
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: Test your improved server whether your measures have been successful.
  prefs: []
  type: TYPE_NORMAL
- en: '[Use the notebook](https://mybinder.org/v2/gh/uds-se/fuzzingbook/HEAD?labpath=docs%2Fnotebooks/WebFuzzer.ipynb#Exercises)
    to work on the exercises and see solutions.'
  prefs: []
  type: TYPE_NORMAL
- en: 'Exercise 2: Protect the Server'
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Assume that it is not possible for you to alter the server code. Create a *filter*
    that is run on all URLs before they are passed to the server.
  prefs: []
  type: TYPE_NORMAL
- en: '[Use the notebook](https://mybinder.org/v2/gh/uds-se/fuzzingbook/HEAD?labpath=docs%2Fnotebooks/WebFuzzer.ipynb#Exercises)
    to work on the exercises and see solutions.'
  prefs: []
  type: TYPE_NORMAL
- en: 'Part 1: A Blacklisting Filter'
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: Set up a filter function `blacklist(url)` that returns `False` for URLs that
    should not reach the server. Check the URL for whether it contains HTML, JavaScript,
    or SQL fragments.
  prefs: []
  type: TYPE_NORMAL
- en: '[Use the notebook](https://mybinder.org/v2/gh/uds-se/fuzzingbook/HEAD?labpath=docs%2Fnotebooks/WebFuzzer.ipynb#Exercises)
    to work on the exercises and see solutions.'
  prefs: []
  type: TYPE_NORMAL
- en: 'Part 2: A Whitelisting Filter'
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: Set up a filter function `whitelist(url)` that returns `True` for URLs that
    are allowed to reach the server. Check the URL for whether it conforms to expectations;
    use a [parser](Parser.html) and a dedicated grammar for this purpose.
  prefs: []
  type: TYPE_NORMAL
- en: '[Use the notebook](https://mybinder.org/v2/gh/uds-se/fuzzingbook/HEAD?labpath=docs%2Fnotebooks/WebFuzzer.ipynb#Exercises)
    to work on the exercises and see solutions.'
  prefs: []
  type: TYPE_NORMAL
- en: 'Exercise 3: Input Patterns'
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: To fill out forms, fuzzers could be much smarter in how they generate input
    values. Starting with HTML 5, input fields can have a `pattern` attribute defining
    a *regular expression* that an input value has to satisfy. A 5-digit ZIP code,
    for instance, could be defined by the pattern
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE341]'
  prefs: []
  type: TYPE_PRE
- en: Extract such patterns from the HTML page and convert them into equivalent grammar
    production rules, ensuring that only inputs satisfying the patterns are produced.
  prefs: []
  type: TYPE_NORMAL
- en: '[Use the notebook](https://mybinder.org/v2/gh/uds-se/fuzzingbook/HEAD?labpath=docs%2Fnotebooks/WebFuzzer.ipynb#Exercises)
    to work on the exercises and see solutions.'
  prefs: []
  type: TYPE_NORMAL
- en: 'Exercise 4: Coverage-Driven Web Fuzzing'
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Combine the above fuzzers with [coverage-driven](GrammarCoverageFuzzer.html)
    and [search-based](SearchBasedFuzzer.html) approaches to maximize feature and
    code coverage.
  prefs: []
  type: TYPE_NORMAL
- en: '[Use the notebook](https://mybinder.org/v2/gh/uds-se/fuzzingbook/HEAD?labpath=docs%2Fnotebooks/WebFuzzer.ipynb#Exercises)
    to work on the exercises and see solutions.'
  prefs: []
  type: TYPE_NORMAL
- en: '![Creative Commons License](../Images/2f3faa36146c6fb38bbab67add09aa5f.png)
    The content of this project is licensed under the [Creative Commons Attribution-NonCommercial-ShareAlike
    4.0 International License](https://creativecommons.org/licenses/by-nc-sa/4.0/).
    The source code that is part of the content, as well as the source code used to
    format and display that content is licensed under the [MIT License](https://github.com/uds-se/fuzzingbook/blob/master/LICENSE.md#mit-license).
    [Last change: 2024-01-31 17:32:56+01:00](https://github.com/uds-se/fuzzingbook/commits/master/notebooks/WebFuzzer.ipynb)
    • [Cite](#citation) • [Imprint](https://cispa.de/en/impressum)'
  prefs: []
  type: TYPE_IMG
- en: How to Cite this Work
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Andreas Zeller, Rahul Gopinath, Marcel Böhme, Gordon Fraser, and Christian
    Holler: "[Testing Web Applications](https://www.fuzzingbook.org/html/WebFuzzer.html)".
    In Andreas Zeller, Rahul Gopinath, Marcel Böhme, Gordon Fraser, and Christian
    Holler, "[The Fuzzing Book](https://www.fuzzingbook.org/)", [https://www.fuzzingbook.org/html/WebFuzzer.html](https://www.fuzzingbook.org/html/WebFuzzer.html).
    Retrieved 2024-01-31 17:32:56+01:00.'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE342]'
  prefs: []
  type: TYPE_PRE
