<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Efficient Grammar Fuzzing</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Efficient Grammar Fuzzing</h1>
<blockquote>原文：<a href="http://www.fuzzingbook.org/html/GrammarFuzzer.html">http://www.fuzzingbook.org/html/GrammarFuzzer.html</a></blockquote>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>In the <a href="Grammars.html">chapter on grammars</a>, we have seen how to use <em>grammars</em> for very effective and efficient testing.  In this chapter, we refine the previous <em>string-based</em> algorithm into a <em>tree-based</em> algorithm, which is much faster and allows for much more control over the production of fuzz inputs.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The algorithm in this chapter serves as a foundation for several more techniques; this chapter thus is a "hub" in the book.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="kn">from</span> <span class="nn"><a href="https://github.com/uds-se/fuzzingbook//tree/master/notebooks/shared/bookutils" class="import" target="_blank">bookutils</a></span> <span class="kn">import</span> <span class="n">YouTubeVideo</span>
<span class="n">YouTubeVideo</span><span class="p">(</span><span class="s1">'Ohl8TLcLl3A'</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_html rendered_html output_subarea output_execute_result">

        

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p><strong>Prerequisites</strong></p>
<ul>
<li>You should know how grammar-based fuzzing works, e.g. from the <a href="Grammars.html">chapter on grammars</a>.</li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><div class="synopsis"><h2 id="Synopsis">Synopsis</h2><!-- Automatically generated. Do not edit. -->

<p>To <a href="Importing.html">use the code provided in this chapter</a>, write</p>
<div class="highlight"><pre><span/><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn"><a href="GrammarFuzzer.html" class="import" target="_blank">fuzzingbook.GrammarFuzzer</a></span> <span class="kn">import</span> <span class="o">&lt;</span><span class="n">identifier</span><span class="o">&gt;</span>
</pre></div>
<p>and then make use of the following features.</p>
<h3 id="Efficient-Grammar-Fuzzing">Efficient Grammar Fuzzing</h3><p>This chapter introduces <code>GrammarFuzzer</code>, an efficient grammar fuzzer that takes a grammar to produce syntactically valid input strings.  Here's a typical usage:</p>
<div class="highlight"><pre><span/><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn"><a href="Grammars.html" class="import" target="_blank">Grammars</a></span> <span class="kn">import</span> <span class="n">US_PHONE_GRAMMAR</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">phone_fuzzer</span> <span class="o">=</span> <span class="n">GrammarFuzzer</span><span class="p">(</span><span class="n">US_PHONE_GRAMMAR</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">phone_fuzzer</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span>
<span class="s1">'(771)306-0659'</span>
</pre></div>
<p>The <code>GrammarFuzzer</code> constructor takes a number of keyword arguments to control its behavior.  <code>start_symbol</code>, for instance, allows setting the symbol that expansion starts with (instead of <code>&lt;start&gt;</code>):</p>
<div class="highlight"><pre><span/><span class="o">&gt;&gt;&gt;</span> <span class="n">area_fuzzer</span> <span class="o">=</span> <span class="n">GrammarFuzzer</span><span class="p">(</span><span class="n">US_PHONE_GRAMMAR</span><span class="p">,</span> <span class="n">start_symbol</span><span class="o">=</span><span class="s1">'&lt;area&gt;'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">area_fuzzer</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span>
<span class="s1">'409'</span>
</pre></div>
<p>Here's how to parameterize the <code>GrammarFuzzer</code> constructor:</p>
<div class="highlight"><pre><span/><span class="n">Produce</span> <span class="n">strings</span> <span class="kn">from</span> <span class="err">`</span><span class="n">grammar</span><span class="err">`</span><span class="p">,</span> <span class="n">starting</span> <span class="k">with</span> <span class="err">`</span><span class="n">start_symbol</span><span class="err">`</span><span class="o">.</span>
<span class="n">If</span> <span class="err">`</span><span class="n">min_nonterminals</span><span class="err">`</span> <span class="ow">or</span> <span class="err">`</span><span class="n">max_nonterminals</span><span class="err">`</span> <span class="ow">is</span> <span class="n">given</span><span class="p">,</span> <span class="n">use</span> <span class="n">them</span> <span class="k">as</span> <span class="n">limits</span> 
<span class="k">for</span> <span class="n">the</span> <span class="n">number</span> <span class="n">of</span> <span class="n">nonterminals</span> <span class="n">produced</span><span class="o">.</span>  
<span class="n">If</span> <span class="err">`</span><span class="n">disp</span><span class="err">`</span> <span class="ow">is</span> <span class="nb">set</span><span class="p">,</span> <span class="n">display</span> <span class="n">the</span> <span class="n">intermediate</span> <span class="n">derivation</span> <span class="n">trees</span><span class="o">.</span>
<span class="n">If</span> <span class="err">`</span><span class="n">log</span><span class="err">`</span> <span class="ow">is</span> <span class="nb">set</span><span class="p">,</span> <span class="n">show</span> <span class="n">intermediate</span> <span class="n">steps</span> <span class="k">as</span> <span class="n">text</span> <span class="n">on</span> <span class="n">standard</span> <span class="n">output</span><span class="o">.</span>
</pre></div>
<p>

<!-- Generated by graphviz version 12.2.1 (20241206.2353)
 -->
<!-- Pages: 1 -->
<svg width="324pt" height="458pt" viewbox="0.00 0.00 323.62 458.25" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 454.25)">
<g id="a_graph0"><a xlink:title="GrammarFuzzer class hierarchy">
<polygon fill="white" stroke="none" points="-4,4 -4,-454.25 319.62,-454.25 319.62,4 -4,4"/>
</a>
</g>
<!-- GrammarFuzzer -->
<g id="node1" class="node">
<title>GrammarFuzzer</title>
<g id="a_node1"><a xlink:href="#" xlink:title="class GrammarFuzzer:&#10;Produce strings from grammars efficiently, using derivation trees.">
<polygon fill="none" stroke="black" points="0,-0.5 0,-327.75 178,-327.75 178,-0.5 0,-0.5"/>
<text text-anchor="start" x="39.12" y="-311.45" font-family="Patua One, Helvetica, sans-serif" font-weight="bold" font-size="14.00" fill="#b03a2e">GrammarFuzzer</text>
<polyline fill="none" stroke="black" points="0,-301.75 178,-301.75"/>
<g id="a_node1_0"><a xlink:href="#" xlink:title="GrammarFuzzer">
<g id="a_node1_1"><a xlink:href="#" xlink:title="__init__(self, grammar: Dict[str, List[Expansion]], start_symbol: str = '&lt;start&gt;', min_nonterminals: int = 0, max_nonterminals: int = 10, disp: bool = False, log: Union[bool, int] = False) -&gt; None:&#10;Produce strings from `grammar`, starting with `start_symbol`.&#10;If `min_nonterminals` or `max_nonterminals` is given, use them as limits&#10;for the number of nonterminals produced.&#10;If `disp` is set, display the intermediate derivation trees.&#10;If `log` is set, show intermediate steps as text on standard output.">
<text text-anchor="start" x="8" y="-289.25" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-style="italic" font-size="10.00">__init__()</text>
</a>
</g>
<g id="a_node1_2"><a xlink:href="#" xlink:title="fuzz(self) -&gt; str:&#10;Produce a string from the grammar.">
<text text-anchor="start" x="8" y="-276.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-style="italic" font-size="10.00">fuzz()</text>
</a>
</g>
<g id="a_node1_3"><a xlink:href="#" xlink:title="fuzz_tree(self) -&gt; DerivationTree:&#10;Produce a derivation tree from the grammar.">
<text text-anchor="start" x="8" y="-263.75" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00">fuzz_tree()</text>
</a>
</g>
<g id="a_node1_4"><a xlink:href="#" xlink:title="any_possible_expansions(self, node: DerivationTree) -&gt; bool">
<text text-anchor="start" x="8" y="-250" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00">any_possible_expansions()</text>
</a>
</g>
<g id="a_node1_5"><a xlink:href="#" xlink:title="check_grammar(self) -&gt; None:&#10;Check the grammar passed">
<text text-anchor="start" x="8" y="-237.25" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00">check_grammar()</text>
</a>
</g>
<g id="a_node1_6"><a xlink:href="#" xlink:title="choose_node_expansion(self, node: DerivationTree, children_alternatives: List[List[DerivationTree]]) -&gt; int:&#10;Return index of expansion in `children_alternatives` to be selected.&#10;'children_alternatives`: a list of possible children for `node`.&#10;Defaults to random. To be overloaded in subclasses.">
<text text-anchor="start" x="8" y="-225.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00">choose_node_expansion()</text>
</a>
</g>
<g id="a_node1_7"><a xlink:href="#" xlink:title="choose_tree_expansion(self, tree: DerivationTree, children: List[DerivationTree]) -&gt; int:&#10;Return index of subtree in `children` to be selected for expansion.&#10;Defaults to random.">
<text text-anchor="start" x="8" y="-211.75" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00">choose_tree_expansion()</text>
</a>
</g>
<g id="a_node1_8"><a xlink:href="#" xlink:title="expand_node(self, node: DerivationTree) -&gt; DerivationTree">
<text text-anchor="start" x="8" y="-199" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00">expand_node()</text>
</a>
</g>
<g id="a_node1_9"><a xlink:href="#" xlink:title="expand_node_by_cost(self, node: DerivationTree, choose: Callable = &lt;built-in function min&gt;) -&gt; DerivationTree">
<text text-anchor="start" x="8" y="-186.25" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00">expand_node_by_cost()</text>
</a>
</g>
<g id="a_node1_10"><a xlink:href="#" xlink:title="expand_node_max_cost(self, node: DerivationTree) -&gt; DerivationTree">
<text text-anchor="start" x="8" y="-173.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00">expand_node_max_cost()</text>
</a>
</g>
<g id="a_node1_11"><a xlink:href="#" xlink:title="expand_node_min_cost(self, node: DerivationTree) -&gt; DerivationTree">
<text text-anchor="start" x="8" y="-160.75" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00">expand_node_min_cost()</text>
</a>
</g>
<g id="a_node1_12"><a xlink:href="#" xlink:title="expand_node_randomly(self, node: DerivationTree) -&gt; DerivationTree:&#10;Choose a random expansion for `node` and return it">
<text text-anchor="start" x="8" y="-148" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00">expand_node_randomly()</text>
</a>
</g>
<g id="a_node1_13"><a xlink:href="#" xlink:title="expand_tree(self, tree: DerivationTree) -&gt; DerivationTree:&#10;Expand `tree` in a three-phase strategy until all expansions are complete.">
<text text-anchor="start" x="8" y="-135.25" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00">expand_tree()</text>
</a>
</g>
<g id="a_node1_14"><a xlink:href="#" xlink:title="expand_tree_once(self, tree: DerivationTree) -&gt; DerivationTree:&#10;Choose an unexpanded symbol in tree; expand it.&#10;Can be overloaded in subclasses.">
<text text-anchor="start" x="8" y="-123.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00">expand_tree_once()</text>
</a>
</g>
<g id="a_node1_15"><a xlink:href="#" xlink:title="expand_tree_with_strategy(self, tree: DerivationTree, expand_node_method: Callable, limit: Optional[int] = None):&#10;Expand tree using `expand_node_method` as node expansion function&#10;until the number of possible expansions reaches `limit`.">
<text text-anchor="start" x="8" y="-109.75" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00">expand_tree_with_strategy()</text>
</a>
</g>
<g id="a_node1_16"><a xlink:href="#" xlink:title="expansion_cost(self, expansion: Expansion, seen: Set[str] = set()) -&gt; Union[int, float]">
<text text-anchor="start" x="8" y="-97" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00">expansion_cost()</text>
</a>
</g>
<g id="a_node1_17"><a xlink:href="#" xlink:title="expansion_to_children(self, expansion: Expansion) -&gt; List[DerivationTree]">
<text text-anchor="start" x="8" y="-84.25" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00">expansion_to_children()</text>
</a>
</g>
<g id="a_node1_18"><a xlink:href="#" xlink:title="init_tree(self) -&gt; DerivationTree">
<text text-anchor="start" x="8" y="-71.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00">init_tree()</text>
</a>
</g>
<g id="a_node1_19"><a xlink:href="#" xlink:title="log_tree(self, tree: DerivationTree) -&gt; None:&#10;Output a tree if self.log is set; if self.display is also set, show the tree structure">
<text text-anchor="start" x="8" y="-58.75" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00">log_tree()</text>
</a>
</g>
<g id="a_node1_20"><a xlink:href="#" xlink:title="possible_expansions(self, node: DerivationTree) -&gt; int">
<text text-anchor="start" x="8" y="-46" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00">possible_expansions()</text>
</a>
</g>
<g id="a_node1_21"><a xlink:href="#" xlink:title="process_chosen_children(self, chosen_children: List[DerivationTree], expansion: Expansion) -&gt; List[DerivationTree]:&#10;Process children after selection.  By default, does nothing.">
<text text-anchor="start" x="8" y="-33.25" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00">process_chosen_children()</text>
</a>
</g>
<g id="a_node1_22"><a xlink:href="#" xlink:title="supported_opts(self) -&gt; Set[str]:&#10;Set of supported options. To be overloaded in subclasses.">
<text text-anchor="start" x="8" y="-21.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00">supported_opts()</text>
</a>
</g>
<g id="a_node1_23"><a xlink:href="#" xlink:title="symbol_cost(self, symbol: str, seen: Set[str] = set()) -&gt; Union[int, float]">
<text text-anchor="start" x="8" y="-7.75" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00">symbol_cost()</text>
</a>
</g>
</a>
</g>
</a>
</g>
</g>
<!-- Fuzzer -->
<g id="node2" class="node">
<title>Fuzzer</title>
<g id="a_node2"><a xlink:href="Fuzzer.html" xlink:title="class Fuzzer:&#10;Base class for fuzzers.">
<polygon fill="none" stroke="black" points="51,-364.75 51,-449.75 127,-449.75 127,-364.75 51,-364.75"/>
<text text-anchor="start" x="68.38" y="-433.45" font-family="Patua One, Helvetica, sans-serif" font-weight="bold" font-size="14.00" fill="#b03a2e">Fuzzer</text>
<polyline fill="none" stroke="black" points="51,-423.75 127,-423.75"/>
<g id="a_node2_24"><a xlink:href="#" xlink:title="Fuzzer">
<g id="a_node2_25"><a xlink:href="Fuzzer.html" xlink:title="__init__(self) -&gt; None:&#10;Constructor">
<text text-anchor="start" x="59" y="-411.25" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-style="italic" font-size="10.00">__init__()</text>
</a>
</g>
<g id="a_node2_26"><a xlink:href="Fuzzer.html" xlink:title="fuzz(self) -&gt; str:&#10;Return fuzz input">
<text text-anchor="start" x="59" y="-398.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-style="italic" font-size="10.00">fuzz()</text>
</a>
</g>
<g id="a_node2_27"><a xlink:href="Fuzzer.html" xlink:title="run(self, runner: Fuzzer.Runner = &lt;Fuzzer.Runner object&gt;) -&gt; Tuple[subprocess.CompletedProcess, str]:&#10;Run `runner` with fuzz input">
<text text-anchor="start" x="59" y="-385.75" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00">run()</text>
</a>
</g>
<g id="a_node2_28"><a xlink:href="Fuzzer.html" xlink:title="runs(self, runner: Fuzzer.Runner = &lt;Fuzzer.PrintRunner object&gt;, trials: int = 10) -&gt; List[Tuple[subprocess.CompletedProcess, str]]:&#10;Run `runner` with fuzz input, `trials` times">
<text text-anchor="start" x="59" y="-373" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00">runs()</text>
</a>
</g>
</a>
</g>
</a>
</g>
</g>
<!-- GrammarFuzzer&#45;&gt;Fuzzer -->
<g id="edge1" class="edge">
<title>GrammarFuzzer-&gt;Fuzzer</title>
<path fill="none" stroke="black" d="M89,-327.96C89,-336.73 89,-345.15 89,-353.01"/>
<polygon fill="none" stroke="black" points="85.5,-352.96 89,-362.96 92.5,-352.96 85.5,-352.96"/>
</g>
<!-- Legend -->
<g id="node3" class="node">
<title>Legend</title>
<text text-anchor="start" x="196.38" y="-180.12" font-family="Patua One, Helvetica, sans-serif" font-weight="bold" font-size="10.00" fill="#b03a2e">Legend</text>
<text text-anchor="start" x="196.38" y="-170.12" font-family="Patua One, Helvetica, sans-serif" font-size="10.00">• </text>
<text text-anchor="start" x="202.38" y="-170.12" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="8.00">public_method()</text>
<text text-anchor="start" x="196.38" y="-160.12" font-family="Patua One, Helvetica, sans-serif" font-size="10.00">• </text>
<text text-anchor="start" x="202.38" y="-160.12" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="8.00">private_method()</text>
<text text-anchor="start" x="196.38" y="-150.12" font-family="Patua One, Helvetica, sans-serif" font-size="10.00">• </text>
<text text-anchor="start" x="202.38" y="-150.12" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="8.00">overloaded_method()</text>
<text text-anchor="start" x="196.38" y="-141.07" font-family="Helvetica,sans-Serif" font-size="9.00">Hover over names to see doc</text>
</g>
</g>
</svg>
</p>
<h3 id="Derivation-Trees">Derivation Trees</h3><p>Internally, <code>GrammarFuzzer</code> makes use of <a href="#Derivation-Trees">derivation trees</a>, which it expands step by step.  After producing a string, the tree produced can be accessed in the <code>derivation_tree</code> attribute.</p>
<div class="highlight"><pre><span/><span class="o">&gt;&gt;&gt;</span> <span class="n">display_tree</span><span class="p">(</span><span class="n">phone_fuzzer</span><span class="o">.</span><span class="n">derivation_tree</span><span class="p">)</span>
</pre></div>
<p>

<!-- Generated by graphviz version 12.2.1 (20241206.2353)
 -->
<!-- Pages: 1 -->
<svg width="636pt" height="223pt" viewbox="0.00 0.00 635.75 223.25" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 219.25)">
<polygon fill="white" stroke="none" points="-4,4 -4,-219.25 631.75,-219.25 631.75,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="265.12" y="-201.95" font-family="Times,serif" font-size="14.00">&lt;start&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="265.12" y="-151.7" font-family="Times,serif" font-size="14.00">&lt;phone-number&gt;</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0-&gt;1</title>
<path fill="none" stroke="black" d="M265.12,-201.21C265.12,-194.99 265.12,-184.9 265.12,-176.14"/>
<polygon fill="black" stroke="black" points="268.63,-176.35 265.13,-166.35 261.63,-176.35 268.63,-176.35"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="113.12" y="-101.45" font-family="Times,serif" font-size="14.00">( (40)</text>
</g>
<!-- 1&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>1-&gt;2</title>
<path fill="none" stroke="black" d="M245.87,-150.76C218.79,-142.17 169.38,-126.48 139.08,-116.86"/>
<polygon fill="black" stroke="black" points="140.15,-113.53 129.56,-113.84 138.03,-120.2 140.15,-113.53"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="166.12" y="-101.45" font-family="Times,serif" font-size="14.00">&lt;area&gt;</text>
</g>
<!-- 1&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>1-&gt;3</title>
<path fill="none" stroke="black" d="M252.59,-150.76C236.59,-142.97 208.64,-129.35 188.85,-119.7"/>
<polygon fill="black" stroke="black" points="190.44,-116.58 179.92,-115.35 187.38,-122.88 190.44,-116.58"/>
</g>
<!-- 10 -->
<g id="node11" class="node">
<title>10</title>
<text text-anchor="middle" x="232.12" y="-101.45" font-family="Times,serif" font-size="14.00">) (41)</text>
</g>
<!-- 1&#45;&gt;10 -->
<g id="edge10" class="edge">
<title>1-&gt;10</title>
<path fill="none" stroke="black" d="M261.08,-150.96C256.53,-144.3 248.95,-133.23 242.69,-124.07"/>
<polygon fill="black" stroke="black" points="245.59,-122.12 237.06,-115.84 239.82,-126.07 245.59,-122.12"/>
</g>
<!-- 11 -->
<g id="node12" class="node">
<title>11</title>
<text text-anchor="middle" x="299.12" y="-101.45" font-family="Times,serif" font-size="14.00">&lt;exchange&gt;</text>
</g>
<!-- 1&#45;&gt;11 -->
<g id="edge11" class="edge">
<title>1-&gt;11</title>
<path fill="none" stroke="black" d="M269.29,-150.96C274.04,-144.23 281.96,-132.98 288.45,-123.77"/>
<polygon fill="black" stroke="black" points="291.15,-126.02 294.05,-115.83 285.43,-121.99 291.15,-126.02"/>
</g>
<!-- 18 -->
<g id="node19" class="node">
<title>18</title>
<text text-anchor="middle" x="366.12" y="-101.45" font-family="Times,serif" font-size="14.00">- (45)</text>
</g>
<!-- 1&#45;&gt;18 -->
<g id="edge18" class="edge">
<title>1-&gt;18</title>
<path fill="none" stroke="black" d="M277.92,-150.76C294.31,-142.93 323.02,-129.22 343.22,-119.57"/>
<polygon fill="black" stroke="black" points="344.56,-122.81 352.07,-115.34 341.54,-116.49 344.56,-122.81"/>
</g>
<!-- 19 -->
<g id="node20" class="node">
<title>19</title>
<text text-anchor="middle" x="489.12" y="-101.45" font-family="Times,serif" font-size="14.00">&lt;line&gt;</text>
</g>
<!-- 1&#45;&gt;19 -->
<g id="edge19" class="edge">
<title>1-&gt;19</title>
<path fill="none" stroke="black" d="M293.49,-150.76C336.22,-141.56 416.65,-124.24 459.88,-114.92"/>
<polygon fill="black" stroke="black" points="460.51,-118.37 469.54,-112.84 459.03,-111.53 460.51,-118.37"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="34.12" y="-51.2" font-family="Times,serif" font-size="14.00">&lt;lead-digit&gt;</text>
</g>
<!-- 3&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>3-&gt;4</title>
<path fill="none" stroke="black" d="M149.41,-100.51C127.19,-92.39 87.66,-77.94 61.17,-68.26"/>
<polygon fill="black" stroke="black" points="62.72,-65.1 52.13,-64.96 60.32,-71.68 62.72,-65.1"/>
</g>
<!-- 6 -->
<g id="node7" class="node">
<title>6</title>
<text text-anchor="middle" x="107.12" y="-51.2" font-family="Times,serif" font-size="14.00">&lt;digit&gt;</text>
</g>
<!-- 3&#45;&gt;6 -->
<g id="edge6" class="edge">
<title>3-&gt;6</title>
<path fill="none" stroke="black" d="M158.89,-100.71C150.04,-93.47 134.81,-81.02 123.15,-71.48"/>
<polygon fill="black" stroke="black" points="125.55,-68.92 115.59,-65.3 121.12,-74.34 125.55,-68.92"/>
</g>
<!-- 8 -->
<g id="node9" class="node">
<title>8</title>
<text text-anchor="middle" x="166.12" y="-51.2" font-family="Times,serif" font-size="14.00">&lt;digit&gt;</text>
</g>
<!-- 3&#45;&gt;8 -->
<g id="edge8" class="edge">
<title>3-&gt;8</title>
<path fill="none" stroke="black" d="M166.12,-100.71C166.12,-94.49 166.12,-84.4 166.12,-75.64"/>
<polygon fill="black" stroke="black" points="169.63,-75.85 166.13,-65.85 162.63,-75.85 169.63,-75.85"/>
</g>
<!-- 5 -->
<g id="node6" class="node">
<title>5</title>
<text text-anchor="middle" x="34.12" y="-0.95" font-family="Times,serif" font-size="14.00">7 (55)</text>
</g>
<!-- 4&#45;&gt;5 -->
<g id="edge5" class="edge">
<title>4-&gt;5</title>
<path fill="none" stroke="black" d="M34.12,-50.46C34.12,-44.24 34.12,-34.15 34.12,-25.39"/>
<polygon fill="black" stroke="black" points="37.63,-25.6 34.13,-15.6 30.63,-25.6 37.63,-25.6"/>
</g>
<!-- 7 -->
<g id="node8" class="node">
<title>7</title>
<text text-anchor="middle" x="107.12" y="-0.95" font-family="Times,serif" font-size="14.00">7 (55)</text>
</g>
<!-- 6&#45;&gt;7 -->
<g id="edge7" class="edge">
<title>6-&gt;7</title>
<path fill="none" stroke="black" d="M107.12,-50.46C107.12,-44.24 107.12,-34.15 107.12,-25.39"/>
<polygon fill="black" stroke="black" points="110.63,-25.6 107.13,-15.6 103.63,-25.6 110.63,-25.6"/>
</g>
<!-- 9 -->
<g id="node10" class="node">
<title>9</title>
<text text-anchor="middle" x="166.12" y="-0.95" font-family="Times,serif" font-size="14.00">1 (49)</text>
</g>
<!-- 8&#45;&gt;9 -->
<g id="edge9" class="edge">
<title>8-&gt;9</title>
<path fill="none" stroke="black" d="M166.12,-50.46C166.12,-44.24 166.12,-34.15 166.12,-25.39"/>
<polygon fill="black" stroke="black" points="169.63,-25.6 166.13,-15.6 162.63,-25.6 169.63,-25.6"/>
</g>
<!-- 12 -->
<g id="node13" class="node">
<title>12</title>
<text text-anchor="middle" x="239.12" y="-51.2" font-family="Times,serif" font-size="14.00">&lt;lead-digit&gt;</text>
</g>
<!-- 11&#45;&gt;12 -->
<g id="edge12" class="edge">
<title>11-&gt;12</title>
<path fill="none" stroke="black" d="M291.77,-100.71C282.77,-93.47 267.28,-81.02 255.42,-71.48"/>
<polygon fill="black" stroke="black" points="257.71,-68.83 247.72,-65.29 253.32,-74.28 257.71,-68.83"/>
</g>
<!-- 14 -->
<g id="node15" class="node">
<title>14</title>
<text text-anchor="middle" x="312.12" y="-51.2" font-family="Times,serif" font-size="14.00">&lt;digit&gt;</text>
</g>
<!-- 11&#45;&gt;14 -->
<g id="edge14" class="edge">
<title>11-&gt;14</title>
<path fill="none" stroke="black" d="M300.72,-100.71C302.41,-94.41 305.18,-84.17 307.56,-75.33"/>
<polygon fill="black" stroke="black" points="310.9,-76.37 310.12,-65.8 304.14,-74.55 310.9,-76.37"/>
</g>
<!-- 16 -->
<g id="node17" class="node">
<title>16</title>
<text text-anchor="middle" x="371.12" y="-51.2" font-family="Times,serif" font-size="14.00">&lt;digit&gt;</text>
</g>
<!-- 11&#45;&gt;16 -->
<g id="edge16" class="edge">
<title>11-&gt;16</title>
<path fill="none" stroke="black" d="M308.24,-100.51C319.45,-93 338.73,-80.09 352.99,-70.53"/>
<polygon fill="black" stroke="black" points="354.69,-73.6 361.05,-65.13 350.79,-67.79 354.69,-73.6"/>
</g>
<!-- 13 -->
<g id="node14" class="node">
<title>13</title>
<text text-anchor="middle" x="239.12" y="-0.95" font-family="Times,serif" font-size="14.00">3 (51)</text>
</g>
<!-- 12&#45;&gt;13 -->
<g id="edge13" class="edge">
<title>12-&gt;13</title>
<path fill="none" stroke="black" d="M239.12,-50.46C239.12,-44.24 239.12,-34.15 239.12,-25.39"/>
<polygon fill="black" stroke="black" points="242.63,-25.6 239.13,-15.6 235.63,-25.6 242.63,-25.6"/>
</g>
<!-- 15 -->
<g id="node16" class="node">
<title>15</title>
<text text-anchor="middle" x="312.12" y="-0.95" font-family="Times,serif" font-size="14.00">0 (48)</text>
</g>
<!-- 14&#45;&gt;15 -->
<g id="edge15" class="edge">
<title>14-&gt;15</title>
<path fill="none" stroke="black" d="M312.12,-50.46C312.12,-44.24 312.12,-34.15 312.12,-25.39"/>
<polygon fill="black" stroke="black" points="315.63,-25.6 312.13,-15.6 308.63,-25.6 315.63,-25.6"/>
</g>
<!-- 17 -->
<g id="node18" class="node">
<title>17</title>
<text text-anchor="middle" x="371.12" y="-0.95" font-family="Times,serif" font-size="14.00">6 (54)</text>
</g>
<!-- 16&#45;&gt;17 -->
<g id="edge17" class="edge">
<title>16-&gt;17</title>
<path fill="none" stroke="black" d="M371.12,-50.46C371.12,-44.24 371.12,-34.15 371.12,-25.39"/>
<polygon fill="black" stroke="black" points="374.63,-25.6 371.13,-15.6 367.63,-25.6 374.63,-25.6"/>
</g>
<!-- 20 -->
<g id="node21" class="node">
<title>20</title>
<text text-anchor="middle" x="430.12" y="-51.2" font-family="Times,serif" font-size="14.00">&lt;digit&gt;</text>
</g>
<!-- 19&#45;&gt;20 -->
<g id="edge20" class="edge">
<title>19-&gt;20</title>
<path fill="none" stroke="black" d="M481.89,-100.71C473.04,-93.47 457.81,-81.02 446.15,-71.48"/>
<polygon fill="black" stroke="black" points="448.55,-68.92 438.59,-65.3 444.12,-74.34 448.55,-68.92"/>
</g>
<!-- 22 -->
<g id="node23" class="node">
<title>22</title>
<text text-anchor="middle" x="489.12" y="-51.2" font-family="Times,serif" font-size="14.00">&lt;digit&gt;</text>
</g>
<!-- 19&#45;&gt;22 -->
<g id="edge22" class="edge">
<title>19-&gt;22</title>
<path fill="none" stroke="black" d="M489.12,-100.71C489.12,-94.49 489.12,-84.4 489.12,-75.64"/>
<polygon fill="black" stroke="black" points="492.63,-75.85 489.13,-65.85 485.63,-75.85 492.63,-75.85"/>
</g>
<!-- 24 -->
<g id="node25" class="node">
<title>24</title>
<text text-anchor="middle" x="548.12" y="-51.2" font-family="Times,serif" font-size="14.00">&lt;digit&gt;</text>
</g>
<!-- 19&#45;&gt;24 -->
<g id="edge24" class="edge">
<title>19-&gt;24</title>
<path fill="none" stroke="black" d="M496.36,-100.71C505.21,-93.47 520.44,-81.02 532.1,-71.48"/>
<polygon fill="black" stroke="black" points="534.13,-74.34 539.66,-65.3 529.7,-68.92 534.13,-74.34"/>
</g>
<!-- 26 -->
<g id="node27" class="node">
<title>26</title>
<text text-anchor="middle" x="607.12" y="-51.2" font-family="Times,serif" font-size="14.00">&lt;digit&gt;</text>
</g>
<!-- 19&#45;&gt;26 -->
<g id="edge26" class="edge">
<title>19-&gt;26</title>
<path fill="none" stroke="black" d="M504.07,-100.51C523.58,-92.54 558.01,-78.46 581.67,-68.79"/>
<polygon fill="black" stroke="black" points="582.97,-72.03 590.9,-65.01 580.32,-65.55 582.97,-72.03"/>
</g>
<!-- 21 -->
<g id="node22" class="node">
<title>21</title>
<text text-anchor="middle" x="430.12" y="-0.95" font-family="Times,serif" font-size="14.00">0 (48)</text>
</g>
<!-- 20&#45;&gt;21 -->
<g id="edge21" class="edge">
<title>20-&gt;21</title>
<path fill="none" stroke="black" d="M430.12,-50.46C430.12,-44.24 430.12,-34.15 430.12,-25.39"/>
<polygon fill="black" stroke="black" points="433.63,-25.6 430.13,-15.6 426.63,-25.6 433.63,-25.6"/>
</g>
<!-- 23 -->
<g id="node24" class="node">
<title>23</title>
<text text-anchor="middle" x="489.12" y="-0.95" font-family="Times,serif" font-size="14.00">6 (54)</text>
</g>
<!-- 22&#45;&gt;23 -->
<g id="edge23" class="edge">
<title>22-&gt;23</title>
<path fill="none" stroke="black" d="M489.12,-50.46C489.12,-44.24 489.12,-34.15 489.12,-25.39"/>
<polygon fill="black" stroke="black" points="492.63,-25.6 489.13,-15.6 485.63,-25.6 492.63,-25.6"/>
</g>
<!-- 25 -->
<g id="node26" class="node">
<title>25</title>
<text text-anchor="middle" x="548.12" y="-0.95" font-family="Times,serif" font-size="14.00">5 (53)</text>
</g>
<!-- 24&#45;&gt;25 -->
<g id="edge25" class="edge">
<title>24-&gt;25</title>
<path fill="none" stroke="black" d="M548.12,-50.46C548.12,-44.24 548.12,-34.15 548.12,-25.39"/>
<polygon fill="black" stroke="black" points="551.63,-25.6 548.13,-15.6 544.63,-25.6 551.63,-25.6"/>
</g>
<!-- 27 -->
<g id="node28" class="node">
<title>27</title>
<text text-anchor="middle" x="607.12" y="-0.95" font-family="Times,serif" font-size="14.00">9 (57)</text>
</g>
<!-- 26&#45;&gt;27 -->
<g id="edge27" class="edge">
<title>26-&gt;27</title>
<path fill="none" stroke="black" d="M607.12,-50.46C607.12,-44.24 607.12,-34.15 607.12,-25.39"/>
<polygon fill="black" stroke="black" points="610.63,-25.6 607.13,-15.6 603.63,-25.6 610.63,-25.6"/>
</g>
</g>
</svg>
</p>
<p>In the internal representation of a derivation tree, a <em>node</em> is a pair (<code>symbol</code>, <code>children</code>).  For nonterminals, <code>symbol</code> is the symbol that is being expanded, and <code>children</code> is a list of further nodes.  For terminals, <code>symbol</code> is the terminal string, and <code>children</code> is empty.</p>
<div class="highlight"><pre><span/><span class="o">&gt;&gt;&gt;</span> <span class="n">phone_fuzzer</span><span class="o">.</span><span class="n">derivation_tree</span>
<span class="p">(</span><span class="s1">'&lt;start&gt;'</span><span class="p">,</span>
 <span class="p">[(</span><span class="s1">'&lt;phone-number&gt;'</span><span class="p">,</span>
   <span class="p">[(</span><span class="s1">'('</span><span class="p">,</span> <span class="p">[]),</span>
    <span class="p">(</span><span class="s1">'&lt;area&gt;'</span><span class="p">,</span>
     <span class="p">[(</span><span class="s1">'&lt;lead-digit&gt;'</span><span class="p">,</span> <span class="p">[(</span><span class="s1">'7'</span><span class="p">,</span> <span class="p">[])]),</span>
      <span class="p">(</span><span class="s1">'&lt;digit&gt;'</span><span class="p">,</span> <span class="p">[(</span><span class="s1">'7'</span><span class="p">,</span> <span class="p">[])]),</span>
      <span class="p">(</span><span class="s1">'&lt;digit&gt;'</span><span class="p">,</span> <span class="p">[(</span><span class="s1">'1'</span><span class="p">,</span> <span class="p">[])])]),</span>
    <span class="p">(</span><span class="s1">')'</span><span class="p">,</span> <span class="p">[]),</span>
    <span class="p">(</span><span class="s1">'&lt;exchange&gt;'</span><span class="p">,</span>
     <span class="p">[(</span><span class="s1">'&lt;lead-digit&gt;'</span><span class="p">,</span> <span class="p">[(</span><span class="s1">'3'</span><span class="p">,</span> <span class="p">[])]),</span>
      <span class="p">(</span><span class="s1">'&lt;digit&gt;'</span><span class="p">,</span> <span class="p">[(</span><span class="s1">'0'</span><span class="p">,</span> <span class="p">[])]),</span>
      <span class="p">(</span><span class="s1">'&lt;digit&gt;'</span><span class="p">,</span> <span class="p">[(</span><span class="s1">'6'</span><span class="p">,</span> <span class="p">[])])]),</span>
    <span class="p">(</span><span class="s1">'-'</span><span class="p">,</span> <span class="p">[]),</span>
    <span class="p">(</span><span class="s1">'&lt;line&gt;'</span><span class="p">,</span>
     <span class="p">[(</span><span class="s1">'&lt;digit&gt;'</span><span class="p">,</span> <span class="p">[(</span><span class="s1">'0'</span><span class="p">,</span> <span class="p">[])]),</span>
      <span class="p">(</span><span class="s1">'&lt;digit&gt;'</span><span class="p">,</span> <span class="p">[(</span><span class="s1">'6'</span><span class="p">,</span> <span class="p">[])]),</span>
      <span class="p">(</span><span class="s1">'&lt;digit&gt;'</span><span class="p">,</span> <span class="p">[(</span><span class="s1">'5'</span><span class="p">,</span> <span class="p">[])]),</span>
      <span class="p">(</span><span class="s1">'&lt;digit&gt;'</span><span class="p">,</span> <span class="p">[(</span><span class="s1">'9'</span><span class="p">,</span> <span class="p">[])])])])])</span>
</pre></div>
<p>The chapter contains various helpers to work with derivation trees, including visualization tools – notably, <code>display_tree()</code>, above.</p>
</div>
</div>
</div>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="An-Insufficient-Algorithm">An Insufficient Algorithm</h2><p>In the <a href="Grammars.html">previous chapter</a>, we have introduced the <code>simple_grammar_fuzzer()</code> function which takes a grammar and automatically produces a syntactically valid string from it.  However, <code>simple_grammar_fuzzer()</code> is just what its name suggests – simple.  To illustrate the problem, let us get back to the <code>expr_grammar</code> we created from <code>EXPR_GRAMMAR_BNF</code> in the <a href="Grammars.html">chapter on grammars</a>:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="kn">import</span> <span class="nn"><a href="https://github.com/uds-se/fuzzingbook//tree/master/notebooks/shared/bookutils" class="import" target="_blank">bookutils.setup</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="kn">from</span> <span class="nn"><a href="https://github.com/uds-se/fuzzingbook//tree/master/notebooks/shared/bookutils" class="import" target="_blank">bookutils</a></span> <span class="kn">import</span> <span class="n">quiz</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="kn">from</span> <span class="nn"><a href="https://docs.python.org/3/library/typing.html" class="import" target="_blank">typing</a></span> <span class="kn">import</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Set</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Dict</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="kn">from</span> <span class="nn"><a href="https://github.com/uds-se/fuzzingbook//tree/master/notebooks/shared/bookutils" class="import" target="_blank">bookutils</a></span> <span class="kn">import</span> <span class="n">unicode_escape</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="kn">from</span> <span class="nn"><a href="Grammars.html" class="import" target="_blank">Grammars</a></span> <span class="kn">import</span> <span class="n">EXPR_EBNF_GRAMMAR</span><span class="p">,</span> <span class="n">convert_ebnf_grammar</span><span class="p">,</span> <span class="n">Grammar</span><span class="p">,</span> <span class="n">Expansion</span>
<span class="kn">from</span> <span class="nn"><a href="Grammars.html" class="import" target="_blank">Grammars</a></span> <span class="kn">import</span> <span class="n">simple_grammar_fuzzer</span><span class="p">,</span> <span class="n">is_valid_grammar</span><span class="p">,</span> <span class="n">exp_string</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">expr_grammar</span> <span class="o">=</span> <span class="n">convert_ebnf_grammar</span><span class="p">(</span><span class="n">EXPR_EBNF_GRAMMAR</span><span class="p">)</span>
<span class="n">expr_grammar</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>{'&lt;start&gt;': ['&lt;expr&gt;'],
 '&lt;expr&gt;': ['&lt;term&gt; + &lt;expr&gt;', '&lt;term&gt; - &lt;expr&gt;', '&lt;term&gt;'],
 '&lt;term&gt;': ['&lt;factor&gt; * &lt;term&gt;', '&lt;factor&gt; / &lt;term&gt;', '&lt;factor&gt;'],
 '&lt;factor&gt;': ['&lt;sign-1&gt;&lt;factor&gt;', '(&lt;expr&gt;)', '&lt;integer&gt;&lt;symbol-1&gt;'],
 '&lt;sign&gt;': ['+', '-'],
 '&lt;integer&gt;': ['&lt;digit-1&gt;'],
 '&lt;digit&gt;': ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9'],
 '&lt;symbol&gt;': ['.&lt;integer&gt;'],
 '&lt;sign-1&gt;': ['', '&lt;sign&gt;'],
 '&lt;symbol-1&gt;': ['', '&lt;symbol&gt;'],
 '&lt;digit-1&gt;': ['&lt;digit&gt;', '&lt;digit&gt;&lt;digit-1&gt;']}
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p><code>expr_grammar</code> has an interesting property.  If we feed it into <code>simple_grammar_fuzzer()</code>, the function gets stuck:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="kn">from</span> <span class="nn"><a href="ExpectError.html" class="import" target="_blank">ExpectError</a></span> <span class="kn">import</span> <span class="n">ExpectTimeout</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">with</span> <span class="n">ExpectTimeout</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">simple_grammar_fuzzer</span><span class="p">(</span><span class="n">grammar</span><span class="o">=</span><span class="n">expr_grammar</span><span class="p">,</span> <span class="n">max_nonterminals</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>Traceback (most recent call last):
  File "/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_9136/3259437052.py", line 2, in &lt;module&gt;
    simple_grammar_fuzzer(grammar=expr_grammar, max_nonterminals=3)
  File "Grammars.ipynb", line 87, in simple_grammar_fuzzer
    symbol_to_expand = random.choice(nonterminals(term))
                                     ^^^^^^^^^^^^^^^^^^
  File "Grammars.ipynb", line 61, in nonterminals
    return RE_NONTERMINAL.findall(expansion)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "Timeout.ipynb", line 43, in timeout_handler
    raise TimeoutError()
TimeoutError (expected)
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Why is that so?  Have a look at the grammar; remember what you know about <code>simple_grammar_fuzzer()</code>; and run <code>simple_grammar_fuzzer()</code> with <code>log=true</code> argument to see the expansions.</p>
</div>
</div>
</div>
</div>

<div class="output_area">

<div class="output_html rendered_html output_subarea output_execute_result">

    

    <div class="quiz">
    <h3 class="quiz_title">Quiz</h3>
    <p>
    </p><div class="quiz_question">Why does <code>simple_grammar_fuzzer()</code> hang?</div>
    
    <p>
    </p><div class="quiz_options" title="Pick a choice.">

        <input type="radio" name="e6bd93ec-d3ed-11ef-8343-6298cf1a5790" id="e6bd93ec-d3ed-11ef-8343-6298cf1a5790-1" onclick="clear_selection('e6bd93ec-d3ed-11ef-8343-6298cf1a5790')"/>
        <label id="e6bd93ec-d3ed-11ef-8343-6298cf1a5790-1-label" for="e6bd93ec-d3ed-11ef-8343-6298cf1a5790-1">It produces an infinite number of additions</label><br/>

        <input type="radio" name="e6bd93ec-d3ed-11ef-8343-6298cf1a5790" id="e6bd93ec-d3ed-11ef-8343-6298cf1a5790-2" onclick="clear_selection('e6bd93ec-d3ed-11ef-8343-6298cf1a5790')"/>
        <label id="e6bd93ec-d3ed-11ef-8343-6298cf1a5790-2-label" for="e6bd93ec-d3ed-11ef-8343-6298cf1a5790-2">It produces an infinite number of digits</label><br/>

        <input type="radio" name="e6bd93ec-d3ed-11ef-8343-6298cf1a5790" id="e6bd93ec-d3ed-11ef-8343-6298cf1a5790-3" onclick="clear_selection('e6bd93ec-d3ed-11ef-8343-6298cf1a5790')"/>
        <label id="e6bd93ec-d3ed-11ef-8343-6298cf1a5790-3-label" for="e6bd93ec-d3ed-11ef-8343-6298cf1a5790-3">It produces an infinite number of parentheses</label><br/>

        <input type="radio" name="e6bd93ec-d3ed-11ef-8343-6298cf1a5790" id="e6bd93ec-d3ed-11ef-8343-6298cf1a5790-4" onclick="clear_selection('e6bd93ec-d3ed-11ef-8343-6298cf1a5790')"/>
        <label id="e6bd93ec-d3ed-11ef-8343-6298cf1a5790-4-label" for="e6bd93ec-d3ed-11ef-8343-6298cf1a5790-4">It produces an infinite number of signs</label><br/>

    </div>
    
    <input id="e6bd93ec-d3ed-11ef-8343-6298cf1a5790-submit" type="submit" value="Submit" onclick="check_selection('e6bd93ec-d3ed-11ef-8343-6298cf1a5790', 8, 0, '(3 * 3 * 3) ** (3 / (3 * 3))')"/>
    <span class="quiz_hint" id="e6bd93ec-d3ed-11ef-8343-6298cf1a5790-hint"/>
    </div>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Indeed! The problem is in this rule:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">expr_grammar</span><span class="p">[</span><span class="s1">'&lt;factor&gt;'</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>['&lt;sign-1&gt;&lt;factor&gt;', '(&lt;expr&gt;)', '&lt;integer&gt;&lt;symbol-1&gt;']
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Here, any choice except for <code>(expr)</code> increases the number of symbols, even if only temporary.  Since we place a hard limit on the number of symbols to expand, the only choice left for expanding <code>&lt;factor&gt;</code> is <code>(&lt;expr&gt;)</code>, which leads to an <em>infinite addition of parentheses.</em></p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The problem of potentially infinite expansion is only one of the problems with <code>simple_grammar_fuzzer()</code>.  More problems include:</p>
<ol>
<li><p><em>It is inefficient</em>.  With each iteration, this fuzzer would go search the string produced so far for symbols to expand.  This becomes inefficient as the production string grows.</p>
</li>
<li><p><em>It is hard to control.</em>  Even while limiting the number of symbols, it is still possible to obtain very long strings – and even infinitely long ones, as discussed above.</p>
</li>
</ol>
<p>Let us illustrate both problems by plotting the time required for strings of different lengths.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="kn">from</span> <span class="nn"><a href="Grammars.html" class="import" target="_blank">Grammars</a></span> <span class="kn">import</span> <span class="n">simple_grammar_fuzzer</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="kn">from</span> <span class="nn"><a href="Grammars.html" class="import" target="_blank">Grammars</a></span> <span class="kn">import</span> <span class="n">START_SYMBOL</span><span class="p">,</span> <span class="n">EXPR_GRAMMAR</span><span class="p">,</span> <span class="n">URL_GRAMMAR</span><span class="p">,</span> <span class="n">CGI_GRAMMAR</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="kn">from</span> <span class="nn"><a href="Grammars.html" class="import" target="_blank">Grammars</a></span> <span class="kn">import</span> <span class="n">RE_NONTERMINAL</span><span class="p">,</span> <span class="n">nonterminals</span><span class="p">,</span> <span class="n">is_nonterminal</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="kn">from</span> <span class="nn"><a href="Timer.html" class="import" target="_blank">Timer</a></span> <span class="kn">import</span> <span class="n">Timer</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">trials</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">xs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">ys</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">trials</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">Timer</span><span class="p">()</span> <span class="k">as</span> <span class="n">t</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">simple_grammar_fuzzer</span><span class="p">(</span><span class="n">EXPR_GRAMMAR</span><span class="p">,</span> <span class="n">max_nonterminals</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">xs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
    <span class="n">ys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">elapsed_time</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">" "</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">average_time</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ys</span><span class="p">)</span> <span class="o">/</span> <span class="n">trials</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Average time:"</span><span class="p">,</span> <span class="n">average_time</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Average time: 0.10001757324207575
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="o">%</span><span class="k">matplotlib</span> inline

<span class="kn">import</span> <span class="nn"><a href="https://matplotlib.org/" class="import" target="_blank">matplotlib.pyplot</a></span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Time required for generating an output'</span><span class="p">);</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_png output_subarea ">
<img src="../Images/2584c049202651a68ebeb102d6b4f1c4.png"/>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We see that (1) the time needed to generate an output increases quadratically with the length of that output, and that (2) a large portion of the produced outputs are tens of thousands of characters long.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>To address these problems, we need a <em>smarter algorithm</em> – one that is more efficient, that gets us better control over expansions, and that is able to foresee in <code>expr_grammar</code> that the <code>(expr)</code> alternative yields a potentially infinite expansion, in contrast to the other two.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Derivation-Trees">Derivation Trees</h2><p>To both obtain a more efficient algorithm <em>and</em> exercise better control over expansions, we will use a special representation for the strings that our grammar produces.  The general idea is to use a <em>tree</em> structure that will be subsequently expanded – a so-called <em>derivation tree</em>.  This representation allows us to always keep track of our expansion status – answering questions such as which elements have been expanded into which others, and which symbols still need to be expanded.  Furthermore, adding new elements to a tree is far more efficient than replacing strings again and again.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Like other trees used in programming, a derivation tree (also known as <em>parse tree</em> or <em>concrete syntax tree</em>) consists of <em>nodes</em> which have other nodes (called <em>child nodes</em>) as their <em>children</em>.  The tree starts with one node that has no parent; this is called the <em>root node</em>; a node without children is called a <em>leaf</em>.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The grammar expansion process with derivation trees is illustrated in the following steps, using the arithmetic grammar <a href="Grammars.html">from
the chapter on grammars</a>.  We start with a single node as root of the tree, representing the <em>start symbol</em> – in our case <code>&lt;start&gt;</code>.</p>
</div>
</div>
</div>
</div>

<div class="output_area">

<div class="output_image output_svg output_subarea output_execute_result">


<!-- Generated by graphviz version 12.2.1 (20241206.2353)
 -->
<!-- Title: root Pages: 1 -->
<svg width="48pt" height="22pt" viewbox="0.00 0.00 47.75 22.25" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 18.25)">
<title>root</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-18.25 43.75,-18.25 43.75,4 -4,4"/>
<!-- \&lt;start\&gt; -->
<g id="node1" class="node">
<title>\&lt;start\&gt;</title>
<text text-anchor="middle" x="19.88" y="-0.95" font-family="Times,serif" font-size="14.00">&lt;start&gt;</text>
</g>
</g>
</svg>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>To expand the tree, we traverse it, searching for a nonterminal symbol $S$ without children.  $S$ thus is a symbol that still has to be expanded.  We then chose an expansion for $S$ from the grammar.  Then, we add the expansion as a new child of $S$.  For our start symbol <code>&lt;start&gt;</code>, the only expansion is <code>&lt;expr&gt;</code>, so we add it as a child.</p>
</div>
</div>
</div>
</div>

<div class="output_area">

<div class="output_image output_svg output_subarea output_execute_result">


<!-- Generated by graphviz version 12.2.1 (20241206.2353)
 -->
<!-- Title: root Pages: 1 -->
<svg width="49pt" height="73pt" viewbox="0.00 0.00 48.50 72.50" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 68.5)">
<title>root</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-68.5 44.5,-68.5 44.5,4 -4,4"/>
<!-- \&lt;start\&gt; -->
<g id="node1" class="node">
<title>\&lt;start\&gt;</title>
<text text-anchor="middle" x="20.25" y="-51.2" font-family="Times,serif" font-size="14.00">&lt;start&gt;</text>
</g>
<!-- \&lt;expr\&gt; -->
<g id="node2" class="node">
<title>\&lt;expr\&gt;</title>
<text text-anchor="middle" x="20.25" y="-0.95" font-family="Times,serif" font-size="14.00">&lt;expr&gt;</text>
</g>
<!-- \&lt;start\&gt;&#45;&gt;\&lt;expr\&gt; -->
<g id="edge1" class="edge">
<title>\&lt;start\&gt;-&gt;\&lt;expr\&gt;</title>
<path fill="none" stroke="black" d="M20.25,-50.46C20.25,-44.24 20.25,-34.15 20.25,-25.39"/>
<polygon fill="black" stroke="black" points="23.75,-25.6 20.25,-15.6 16.75,-25.6 23.75,-25.6"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>To construct the produced string from a derivation tree, we traverse the tree in order and collect the symbols at the leaves of the tree.  In the case above, we obtain the string <code>"&lt;expr&gt;"</code>.</p>
<p>To further expand the tree, we choose another symbol to expand, and add its expansion as new children.  This would get us the <code>&lt;expr&gt;</code> symbol, which gets expanded into <code>&lt;expr&gt; + &lt;term&gt;</code>, adding three children.</p>
</div>
</div>
</div>
</div>

<div class="output_area">

<div class="output_image output_svg output_subarea output_execute_result">


<!-- Generated by graphviz version 12.2.1 (20241206.2353)
 -->
<!-- Title: root Pages: 1 -->
<svg width="138pt" height="123pt" viewbox="0.00 0.00 138.12 122.75" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 118.75)">
<title>root</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-118.75 134.12,-118.75 134.12,4 -4,4"/>
<!-- \&lt;start\&gt; -->
<g id="node1" class="node">
<title>\&lt;start\&gt;</title>
<text text-anchor="middle" x="66.12" y="-101.45" font-family="Times,serif" font-size="14.00">&lt;start&gt;</text>
</g>
<!-- \&lt;expr\&gt; -->
<g id="node2" class="node">
<title>\&lt;expr\&gt;</title>
<text text-anchor="middle" x="66.12" y="-51.2" font-family="Times,serif" font-size="14.00">&lt;expr&gt;</text>
</g>
<!-- \&lt;start\&gt;&#45;&gt;\&lt;expr\&gt; -->
<g id="edge1" class="edge">
<title>\&lt;start\&gt;-&gt;\&lt;expr\&gt;</title>
<path fill="none" stroke="black" d="M66.12,-100.71C66.12,-94.49 66.12,-84.4 66.12,-75.64"/>
<polygon fill="black" stroke="black" points="69.63,-75.85 66.13,-65.85 62.63,-75.85 69.63,-75.85"/>
</g>
<!-- \&lt;expr\&gt;  -->
<g id="node3" class="node">
<title>\&lt;expr\&gt; </title>
<text text-anchor="middle" x="22.12" y="-0.95" font-family="Times,serif" font-size="14.00">&lt;expr&gt; </text>
</g>
<!-- \&lt;expr\&gt;&#45;&gt;\&lt;expr\&gt;  -->
<g id="edge2" class="edge">
<title>\&lt;expr\&gt;-&gt;\&lt;expr\&gt; </title>
<path fill="none" stroke="black" d="M60.73,-50.46C54.4,-43.51 43.67,-31.75 35.13,-22.39"/>
<polygon fill="black" stroke="black" points="37.91,-20.24 28.58,-15.21 32.74,-24.96 37.91,-20.24"/>
</g>
<!-- + -->
<g id="node4" class="node">
<title>+</title>
<text text-anchor="middle" x="66.12" y="-0.95" font-family="Times,serif" font-size="14.00">+</text>
</g>
<!-- \&lt;expr\&gt;&#45;&gt;+ -->
<g id="edge3" class="edge">
<title>\&lt;expr\&gt;-&gt;+</title>
<path fill="none" stroke="black" d="M66.12,-50.46C66.12,-44.24 66.12,-34.15 66.12,-25.39"/>
<polygon fill="black" stroke="black" points="69.63,-25.6 66.13,-15.6 62.63,-25.6 69.63,-25.6"/>
</g>
<!-- \&lt;term\&gt; -->
<g id="node5" class="node">
<title>\&lt;term\&gt;</title>
<text text-anchor="middle" x="109.12" y="-0.95" font-family="Times,serif" font-size="14.00">&lt;term&gt;</text>
</g>
<!-- \&lt;expr\&gt;&#45;&gt;\&lt;term\&gt; -->
<g id="edge4" class="edge">
<title>\&lt;expr\&gt;-&gt;\&lt;term\&gt;</title>
<path fill="none" stroke="black" d="M71.4,-50.46C77.52,-43.59 87.85,-32 96.15,-22.68"/>
<polygon fill="black" stroke="black" points="98.76,-25.01 102.8,-15.22 93.54,-20.36 98.76,-25.01"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We repeat the expansion until there are no symbols left to expand:</p>
</div>
</div>
</div>
</div>

<div class="output_area">

<div class="output_image output_svg output_subarea output_execute_result">


<!-- Generated by graphviz version 12.2.1 (20241206.2353)
 -->
<!-- Title: root Pages: 1 -->
<svg width="151pt" height="374pt" viewbox="0.00 0.00 150.88 374.00" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 370)">
<title>root</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-370 146.88,-370 146.88,4 -4,4"/>
<!-- \&lt;start\&gt; -->
<g id="node1" class="node">
<title>\&lt;start\&gt;</title>
<text text-anchor="middle" x="72.88" y="-352.7" font-family="Times,serif" font-size="14.00">&lt;start&gt;</text>
</g>
<!-- \&lt;expr\&gt; -->
<g id="node2" class="node">
<title>\&lt;expr\&gt;</title>
<text text-anchor="middle" x="72.88" y="-302.45" font-family="Times,serif" font-size="14.00">&lt;expr&gt;</text>
</g>
<!-- \&lt;start\&gt;&#45;&gt;\&lt;expr\&gt; -->
<g id="edge1" class="edge">
<title>\&lt;start\&gt;-&gt;\&lt;expr\&gt;</title>
<path fill="none" stroke="black" d="M72.88,-351.96C72.88,-345.74 72.88,-335.65 72.88,-326.89"/>
<polygon fill="black" stroke="black" points="76.38,-327.1 72.88,-317.1 69.38,-327.1 76.38,-327.1"/>
</g>
<!-- \&lt;expr\&gt;  -->
<g id="node3" class="node">
<title>\&lt;expr\&gt; </title>
<text text-anchor="middle" x="28.88" y="-252.2" font-family="Times,serif" font-size="14.00">&lt;expr&gt; </text>
</g>
<!-- \&lt;expr\&gt;&#45;&gt;\&lt;expr\&gt;  -->
<g id="edge2" class="edge">
<title>\&lt;expr\&gt;-&gt;\&lt;expr\&gt; </title>
<path fill="none" stroke="black" d="M67.48,-301.71C61.15,-294.76 50.42,-283 41.88,-273.64"/>
<polygon fill="black" stroke="black" points="44.66,-271.49 35.33,-266.46 39.49,-276.21 44.66,-271.49"/>
</g>
<!-- + -->
<g id="node4" class="node">
<title>+</title>
<text text-anchor="middle" x="72.88" y="-252.2" font-family="Times,serif" font-size="14.00">+</text>
</g>
<!-- \&lt;expr\&gt;&#45;&gt;+ -->
<g id="edge3" class="edge">
<title>\&lt;expr\&gt;-&gt;+</title>
<path fill="none" stroke="black" d="M72.88,-301.71C72.88,-295.49 72.88,-285.4 72.88,-276.64"/>
<polygon fill="black" stroke="black" points="76.38,-276.85 72.88,-266.85 69.38,-276.85 76.38,-276.85"/>
</g>
<!-- \&lt;term\&gt; -->
<g id="node5" class="node">
<title>\&lt;term\&gt;</title>
<text text-anchor="middle" x="115.88" y="-252.2" font-family="Times,serif" font-size="14.00">&lt;term&gt;</text>
</g>
<!-- \&lt;expr\&gt;&#45;&gt;\&lt;term\&gt; -->
<g id="edge4" class="edge">
<title>\&lt;expr\&gt;-&gt;\&lt;term\&gt;</title>
<path fill="none" stroke="black" d="M78.15,-301.71C84.27,-294.84 94.6,-283.25 102.9,-273.93"/>
<polygon fill="black" stroke="black" points="105.51,-276.26 109.55,-266.47 100.29,-271.61 105.51,-276.26"/>
</g>
<!-- \&lt;term\&gt;  -->
<g id="node6" class="node">
<title>\&lt;term\&gt; </title>
<text text-anchor="middle" x="28.88" y="-201.95" font-family="Times,serif" font-size="14.00">&lt;term&gt; </text>
</g>
<!-- \&lt;expr\&gt; &#45;&gt;\&lt;term\&gt;  -->
<g id="edge5" class="edge">
<title>\&lt;expr\&gt; -&gt;\&lt;term\&gt; </title>
<path fill="none" stroke="black" d="M28.88,-251.46C28.88,-245.24 28.88,-235.15 28.88,-226.39"/>
<polygon fill="black" stroke="black" points="32.38,-226.6 28.88,-216.6 25.38,-226.6 32.38,-226.6"/>
</g>
<!-- \&lt;factor\&gt; -->
<g id="node11" class="node">
<title>\&lt;factor\&gt;</title>
<text text-anchor="middle" x="115.88" y="-201.95" font-family="Times,serif" font-size="14.00">&lt;factor&gt;</text>
</g>
<!-- \&lt;term\&gt;&#45;&gt;\&lt;factor\&gt; -->
<g id="edge10" class="edge">
<title>\&lt;term\&gt;-&gt;\&lt;factor\&gt;</title>
<path fill="none" stroke="black" d="M115.88,-251.46C115.88,-245.24 115.88,-235.15 115.88,-226.39"/>
<polygon fill="black" stroke="black" points="119.38,-226.6 115.88,-216.6 112.38,-226.6 119.38,-226.6"/>
</g>
<!-- \&lt;factor\&gt;  -->
<g id="node7" class="node">
<title>\&lt;factor\&gt; </title>
<text text-anchor="middle" x="28.88" y="-151.7" font-family="Times,serif" font-size="14.00">&lt;factor&gt; </text>
</g>
<!-- \&lt;term\&gt; &#45;&gt;\&lt;factor\&gt;  -->
<g id="edge6" class="edge">
<title>\&lt;term\&gt; -&gt;\&lt;factor\&gt; </title>
<path fill="none" stroke="black" d="M28.88,-201.21C28.88,-194.99 28.88,-184.9 28.88,-176.14"/>
<polygon fill="black" stroke="black" points="32.38,-176.35 28.88,-166.35 25.38,-176.35 32.38,-176.35"/>
</g>
<!-- \&lt;integer\&gt;  -->
<g id="node8" class="node">
<title>\&lt;integer\&gt; </title>
<text text-anchor="middle" x="28.88" y="-101.45" font-family="Times,serif" font-size="14.00">&lt;integer&gt; </text>
</g>
<!-- \&lt;factor\&gt; &#45;&gt;\&lt;integer\&gt;  -->
<g id="edge7" class="edge">
<title>\&lt;factor\&gt; -&gt;\&lt;integer\&gt; </title>
<path fill="none" stroke="black" d="M28.88,-150.96C28.88,-144.74 28.88,-134.65 28.88,-125.89"/>
<polygon fill="black" stroke="black" points="32.38,-126.1 28.88,-116.1 25.38,-126.1 32.38,-126.1"/>
</g>
<!-- \&lt;digit\&gt;  -->
<g id="node9" class="node">
<title>\&lt;digit\&gt; </title>
<text text-anchor="middle" x="28.88" y="-51.2" font-family="Times,serif" font-size="14.00">&lt;digit&gt; </text>
</g>
<!-- \&lt;integer\&gt; &#45;&gt;\&lt;digit\&gt;  -->
<g id="edge8" class="edge">
<title>\&lt;integer\&gt; -&gt;\&lt;digit\&gt; </title>
<path fill="none" stroke="black" d="M28.88,-100.71C28.88,-94.49 28.88,-84.4 28.88,-75.64"/>
<polygon fill="black" stroke="black" points="32.38,-75.85 28.88,-65.85 25.38,-75.85 32.38,-75.85"/>
</g>
<!-- 2  -->
<g id="node10" class="node">
<title>2 </title>
<text text-anchor="middle" x="28.88" y="-0.95" font-family="Times,serif" font-size="14.00">2 </text>
</g>
<!-- \&lt;digit\&gt; &#45;&gt;2  -->
<g id="edge9" class="edge">
<title>\&lt;digit\&gt; -&gt;2 </title>
<path fill="none" stroke="black" d="M28.88,-50.46C28.88,-44.24 28.88,-34.15 28.88,-25.39"/>
<polygon fill="black" stroke="black" points="32.38,-25.6 28.88,-15.6 25.38,-25.6 32.38,-25.6"/>
</g>
<!-- \&lt;integer\&gt; -->
<g id="node12" class="node">
<title>\&lt;integer\&gt;</title>
<text text-anchor="middle" x="115.88" y="-151.7" font-family="Times,serif" font-size="14.00">&lt;integer&gt;</text>
</g>
<!-- \&lt;factor\&gt;&#45;&gt;\&lt;integer\&gt; -->
<g id="edge11" class="edge">
<title>\&lt;factor\&gt;-&gt;\&lt;integer\&gt;</title>
<path fill="none" stroke="black" d="M115.88,-201.21C115.88,-194.99 115.88,-184.9 115.88,-176.14"/>
<polygon fill="black" stroke="black" points="119.38,-176.35 115.88,-166.35 112.38,-176.35 119.38,-176.35"/>
</g>
<!-- \&lt;digit\&gt; -->
<g id="node13" class="node">
<title>\&lt;digit\&gt;</title>
<text text-anchor="middle" x="115.88" y="-101.45" font-family="Times,serif" font-size="14.00">&lt;digit&gt;</text>
</g>
<!-- \&lt;integer\&gt;&#45;&gt;\&lt;digit\&gt; -->
<g id="edge12" class="edge">
<title>\&lt;integer\&gt;-&gt;\&lt;digit\&gt;</title>
<path fill="none" stroke="black" d="M115.88,-150.96C115.88,-144.74 115.88,-134.65 115.88,-125.89"/>
<polygon fill="black" stroke="black" points="119.38,-126.1 115.88,-116.1 112.38,-126.1 119.38,-126.1"/>
</g>
<!-- 2 -->
<g id="node14" class="node">
<title>2</title>
<text text-anchor="middle" x="115.88" y="-51.2" font-family="Times,serif" font-size="14.00">2</text>
</g>
<!-- \&lt;digit\&gt;&#45;&gt;2 -->
<g id="edge13" class="edge">
<title>\&lt;digit\&gt;-&gt;2</title>
<path fill="none" stroke="black" d="M115.88,-100.71C115.88,-94.49 115.88,-84.4 115.88,-75.64"/>
<polygon fill="black" stroke="black" points="119.38,-75.85 115.88,-65.85 112.38,-75.85 119.38,-75.85"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We now have a representation for the string <code>2 + 2</code>.  In contrast to the string alone, though, the derivation tree records <em>the entire structure</em> (and production history, or <em>derivation</em> history) of the produced string.  It also allows for simple comparison and manipulation – say, replacing one subtree (substructure) against another.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Representing-Derivation-Trees">Representing Derivation Trees</h2><p>To represent a derivation tree in Python, we use the following format.  A node is a pair</p>
<div class="highlight"><pre><span/><span class="p">(</span><span class="n">SYMBOL_NAME</span><span class="p">,</span> <span class="n">CHILDREN</span><span class="p">)</span>
</pre></div>
<p>where <code>SYMBOL_NAME</code> is a string representing the node (i.e. <code>"&lt;start&gt;"</code> or <code>"+"</code>) and <code>CHILDREN</code> is a list of children nodes.</p>
<p><code>CHILDREN</code> can take some special values:</p>
<ol>
<li><code>None</code> as a placeholder for future expansion.  This means that the node is a <em>nonterminal symbol</em> that should be expanded further.</li>
<li><code>[]</code> (i.e., the empty list) to indicate <em>no</em> children.  This means that the node is a <em>terminal symbol</em> that can no longer be expanded.</li>
</ol>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The type <code>DerivationTree</code> captures this very structure. (<code>Any</code> should actually read <code>DerivationTree</code>, but the Python static type checker cannot handle recursive types well.)</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">DerivationTree</span> <span class="o">=</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]]]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let us take a very simple derivation tree, representing the intermediate step <code>&lt;expr&gt; + &lt;term&gt;</code>, above.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">derivation_tree</span><span class="p">:</span> <span class="n">DerivationTree</span> <span class="o">=</span> <span class="p">(</span><span class="s2">"&lt;start&gt;"</span><span class="p">,</span>
                   <span class="p">[(</span><span class="s2">"&lt;expr&gt;"</span><span class="p">,</span>
                     <span class="p">[(</span><span class="s2">"&lt;expr&gt;"</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                      <span class="p">(</span><span class="s2">" + "</span><span class="p">,</span> <span class="p">[]),</span>
                         <span class="p">(</span><span class="s2">"&lt;term&gt;"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)]</span>
                     <span class="p">)])</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>To better understand the structure of this tree, let us introduce a function <code>display_tree()</code> that visualizes this tree.</p>
</div>
</div>
</div>
</div>

<details id="Excursion:-Implementing-display_tree()">
<summary>Implementing <code>display_tree()</code></summary>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We use the <code>dot</code> drawing program from the <code>graphviz</code> package algorithmically, traversing the above structure.  (Unless you're deeply interested in tree visualization, you can directly skip to the example below.)</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="kn">from</span> <span class="nn"><a href="https://graphviz.readthedocs.io/" class="import" target="_blank">graphviz</a></span> <span class="kn">import</span> <span class="n">Digraph</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="kn">from</span> <span class="nn"><a href="https://ipython.readthedocs.io/en/stable/api/generated/IPython.display.html" class="import" target="_blank">IPython.display</a></span> <span class="kn">import</span> <span class="n">display</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/re.html" class="import" target="_blank">re</a></span>
<span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/string.html" class="import" target="_blank">string</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">dot_escape</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">show_ascii</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Return s in a form suitable for dot.</span>
<span class="sd">    If `show_ascii` is True or length of `s` is 1, also append ascii value."""</span>
    <span class="n">escaped_s</span> <span class="o">=</span> <span class="s1">''</span>
    <span class="k">if</span> <span class="n">show_ascii</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">show_ascii</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># Default: Single chars only</span>

    <span class="k">if</span> <span class="n">show_ascii</span> <span class="ow">and</span> <span class="n">s</span> <span class="o">==</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">'</span><span class="se">\\\\</span><span class="s1">n (10)'</span>

    <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\\</span><span class="s1">n'</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">'[,&lt;&gt;</span><span class="se">\\\\</span><span class="s1">"]'</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
            <span class="n">escaped_s</span> <span class="o">+=</span> <span class="s1">'</span><span class="se">\\</span><span class="s1">'</span> <span class="o">+</span> <span class="n">c</span>
        <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">string</span><span class="o">.</span><span class="n">printable</span> <span class="ow">and</span> <span class="mi">31</span> <span class="o">&lt;</span> <span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">127</span><span class="p">:</span>
            <span class="n">escaped_s</span> <span class="o">+=</span> <span class="n">c</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">escaped_s</span> <span class="o">+=</span> <span class="s1">'</span><span class="se">\\\\</span><span class="s1">x'</span> <span class="o">+</span> <span class="nb">format</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="s1">'02x'</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">show_ascii</span><span class="p">:</span>
            <span class="n">escaped_s</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">' (</span><span class="si">{</span><span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="si">}</span><span class="s1">)'</span>

    <span class="k">return</span> <span class="n">escaped_s</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">assert</span> <span class="n">dot_escape</span><span class="p">(</span><span class="s2">"hello"</span><span class="p">)</span> <span class="o">==</span> <span class="s2">"hello"</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">assert</span> <span class="n">dot_escape</span><span class="p">(</span><span class="s2">"&lt;hello&gt;, world"</span><span class="p">)</span> <span class="o">==</span> <span class="s2">"</span><span class="se">\\</span><span class="s2">&lt;hello</span><span class="se">\\</span><span class="s2">&gt;</span><span class="se">\\</span><span class="s2">, world"</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">assert</span> <span class="n">dot_escape</span><span class="p">(</span><span class="s2">"</span><span class="se">\\</span><span class="s2">n"</span><span class="p">)</span> <span class="o">==</span> <span class="s2">"</span><span class="se">\\\\</span><span class="s2">n"</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">assert</span> <span class="n">dot_escape</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="n">show_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">==</span> <span class="s2">"</span><span class="se">\\\\</span><span class="s2">n"</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">assert</span> <span class="n">dot_escape</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="n">show_ascii</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">==</span> <span class="s2">"</span><span class="se">\\\\</span><span class="s2">n (10)"</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">assert</span> <span class="n">dot_escape</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="n">show_ascii</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">==</span> <span class="s2">"</span><span class="se">\\\\</span><span class="s2">n (10)"</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">assert</span> <span class="n">dot_escape</span><span class="p">(</span><span class="s1">'</span><span class="se">\x01</span><span class="s1">'</span><span class="p">,</span> <span class="n">show_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">==</span> <span class="s2">"</span><span class="se">\\\\</span><span class="s2">x01"</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">assert</span> <span class="n">dot_escape</span><span class="p">(</span><span class="s1">'</span><span class="se">\x01</span><span class="s1">'</span><span class="p">)</span> <span class="o">==</span> <span class="s2">"</span><span class="se">\\\\</span><span class="s2">x01 (1)"</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>While we are interested at present in visualizing a <code>derivation_tree</code>, it is in our interest to generalize the visualization procedure. In particular, it would be helpful if our method <code>display_tree()</code> can display <em>any</em> tree    like data structure. To enable this, we define a helper method <code>extract_node()</code> that extract the current symbol and  children from a given data structure. The default implementation simply extracts the symbol, children, and           annotation from any <code>derivation_tree</code> node.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">extract_node</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
    <span class="n">symbol</span><span class="p">,</span> <span class="n">children</span><span class="p">,</span> <span class="o">*</span><span class="n">annotation</span> <span class="o">=</span> <span class="n">node</span>
    <span class="k">return</span> <span class="n">symbol</span><span class="p">,</span> <span class="n">children</span><span class="p">,</span> <span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">annotation</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>While visualizing a tree, it is often useful to display certain nodes differently. For example, it is sometimes useful to distinguish between non-processed nodes and processed nodes. We define a helper procedure <code>default_node_attr()</code> that provides the basic display, which can be customized by the user.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">default_node_attr</span><span class="p">(</span><span class="n">dot</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="n">symbol</span><span class="p">,</span> <span class="n">ann</span><span class="p">):</span>
    <span class="n">dot</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">nid</span><span class="p">),</span> <span class="n">dot_escape</span><span class="p">(</span><span class="n">symbol</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Similar to nodes, the edges may also require modifications. We define <code>default_edge_attr()</code> as a helper        procedure that can be customized by the user.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">default_edge_attr</span><span class="p">(</span><span class="n">dot</span><span class="p">,</span> <span class="n">start_node</span><span class="p">,</span> <span class="n">stop_node</span><span class="p">):</span>
    <span class="n">dot</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">start_node</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">stop_node</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>While visualizing a tree, one may sometimes wish to change the appearance of the tree. For example, it is      sometimes easier to view the tree if it was laid out left to right rather than top to bottom. We define another      helper procedure <code>default_graph_attr()</code> for that.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">default_graph_attr</span><span class="p">(</span><span class="n">dot</span><span class="p">):</span>
    <span class="n">dot</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s1">'node'</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="s1">'plain'</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Finally, we define a method <code>display_tree()</code> that accepts these four functions <code>extract_node()</code>,               <code>default_edge_attr()</code>, <code>default_node_attr()</code> and <code>default_graph_attr()</code> and uses them to display the tree.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">display_tree</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">:</span> <span class="n">DerivationTree</span><span class="p">,</span>
                 <span class="n">log</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="n">extract_node</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="n">extract_node</span><span class="p">,</span>
                 <span class="n">node_attr</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="n">default_node_attr</span><span class="p">,</span>
                 <span class="n">edge_attr</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="n">default_edge_attr</span><span class="p">,</span>
                 <span class="n">graph_attr</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="n">default_graph_attr</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>

    <span class="c1"># If we import display_tree, we also have to import its functions</span>
    <span class="kn">from</span> <span class="nn"><a href="https://graphviz.readthedocs.io/" class="import" target="_blank">graphviz</a></span> <span class="kn">import</span> <span class="n">Digraph</span>

    <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">traverse_tree</span><span class="p">(</span><span class="n">dot</span><span class="p">,</span> <span class="n">tree</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">children</span><span class="p">,</span> <span class="n">annotation</span><span class="p">)</span> <span class="o">=</span> <span class="n">extract_node</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span>
        <span class="n">node_attr</span><span class="p">(</span><span class="n">dot</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">symbol</span><span class="p">,</span> <span class="n">annotation</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">children</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">children</span><span class="p">:</span>
                <span class="k">nonlocal</span> <span class="n">counter</span>
                <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">child_id</span> <span class="o">=</span> <span class="n">counter</span>
                <span class="n">edge_attr</span><span class="p">(</span><span class="n">dot</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">child_id</span><span class="p">)</span>
                <span class="n">traverse_tree</span><span class="p">(</span><span class="n">dot</span><span class="p">,</span> <span class="n">child</span><span class="p">,</span> <span class="n">child_id</span><span class="p">)</span>

    <span class="n">dot</span> <span class="o">=</span> <span class="n">Digraph</span><span class="p">(</span><span class="n">comment</span><span class="o">=</span><span class="s2">"Derivation Tree"</span><span class="p">)</span>
    <span class="n">graph_attr</span><span class="p">(</span><span class="n">dot</span><span class="p">)</span>
    <span class="n">traverse_tree</span><span class="p">(</span><span class="n">dot</span><span class="p">,</span> <span class="n">derivation_tree</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">dot</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dot</span>
</pre></div>

</div>
</div></div>
</div>
</div>

</details>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>This is what our tree visualizes into:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">display_tree</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_svg output_subarea output_execute_result">


<!-- Generated by graphviz version 12.2.1 (20241206.2353)
 -->
<!-- Pages: 1 -->
<svg width="142pt" height="123pt" viewbox="0.00 0.00 142.25 122.75" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 118.75)">
<polygon fill="white" stroke="none" points="-4,4 -4,-118.75 138.25,-118.75 138.25,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="66.25" y="-101.45" font-family="Times,serif" font-size="14.00">&lt;start&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="66.25" y="-51.2" font-family="Times,serif" font-size="14.00">&lt;expr&gt;</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0-&gt;1</title>
<path fill="none" stroke="black" d="M66.25,-100.71C66.25,-94.49 66.25,-84.4 66.25,-75.64"/>
<polygon fill="black" stroke="black" points="69.75,-75.85 66.25,-65.85 62.75,-75.85 69.75,-75.85"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="20.25" y="-0.95" font-family="Times,serif" font-size="14.00">&lt;expr&gt;</text>
</g>
<!-- 1&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>1-&gt;2</title>
<path fill="none" stroke="black" d="M60.61,-50.46C53.99,-43.51 42.78,-31.75 33.85,-22.39"/>
<polygon fill="black" stroke="black" points="36.41,-20.01 26.98,-15.19 31.35,-24.84 36.41,-20.01"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="66.25" y="-0.95" font-family="Times,serif" font-size="14.00"> + </text>
</g>
<!-- 1&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>1-&gt;3</title>
<path fill="none" stroke="black" d="M66.25,-50.46C66.25,-44.24 66.25,-34.15 66.25,-25.39"/>
<polygon fill="black" stroke="black" points="69.75,-25.6 66.25,-15.6 62.75,-25.6 69.75,-25.6"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="113.25" y="-0.95" font-family="Times,serif" font-size="14.00">&lt;term&gt;</text>
</g>
<!-- 1&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>1-&gt;4</title>
<path fill="none" stroke="black" d="M72.01,-50.46C78.85,-43.44 90.47,-31.51 99.64,-22.1"/>
<polygon fill="black" stroke="black" points="101.91,-24.78 106.38,-15.17 96.9,-19.9 101.91,-24.78"/>
</g>
</g>
</svg>

</div>

</div>

<div class="output_area">

<div class="output_html rendered_html output_subarea output_execute_result">

    

    <div class="quiz">
    <h3 class="quiz_title">Quiz</h3>
    <p>
    </p><div class="quiz_question">And which of these is the internal representation of <code>derivation_tree</code>?</div>
    
    <p>
    </p><div class="quiz_options" title="Pick a choice.">

        <input type="radio" name="eb319efa-d3ed-11ef-8343-6298cf1a5790" id="eb319efa-d3ed-11ef-8343-6298cf1a5790-1" onclick="clear_selection('eb319efa-d3ed-11ef-8343-6298cf1a5790')"/>
        <label id="eb319efa-d3ed-11ef-8343-6298cf1a5790-1-label" for="eb319efa-d3ed-11ef-8343-6298cf1a5790-1"><code>('&lt;start&gt;', [('&lt;expr&gt;', (['&lt;expr&gt; + &lt;term&gt;']))])</code></label><br/>

        <input type="radio" name="eb319efa-d3ed-11ef-8343-6298cf1a5790" id="eb319efa-d3ed-11ef-8343-6298cf1a5790-2" onclick="clear_selection('eb319efa-d3ed-11ef-8343-6298cf1a5790')"/>
        <label id="eb319efa-d3ed-11ef-8343-6298cf1a5790-2-label" for="eb319efa-d3ed-11ef-8343-6298cf1a5790-2"><code>('&lt;start&gt;', [('&lt;expr&gt;', (['&lt;expr&gt;', ' + ', &lt;term&gt;']))])</code></label><br/>

        <input type="radio" name="eb319efa-d3ed-11ef-8343-6298cf1a5790" id="eb319efa-d3ed-11ef-8343-6298cf1a5790-3" onclick="clear_selection('eb319efa-d3ed-11ef-8343-6298cf1a5790')"/>
        <label id="eb319efa-d3ed-11ef-8343-6298cf1a5790-3-label" for="eb319efa-d3ed-11ef-8343-6298cf1a5790-3"><code>('&lt;start&gt;', [('&lt;expr&gt;', [('&lt;expr&gt;', None), (' + ', []), ('&lt;term&gt;', None)])])</code></label><br/>

        <input type="radio" name="eb319efa-d3ed-11ef-8343-6298cf1a5790" id="eb319efa-d3ed-11ef-8343-6298cf1a5790-4" onclick="clear_selection('eb319efa-d3ed-11ef-8343-6298cf1a5790')"/>
        <label id="eb319efa-d3ed-11ef-8343-6298cf1a5790-4-label" for="eb319efa-d3ed-11ef-8343-6298cf1a5790-4"><code>(('&lt;start&gt;', [('&lt;expr&gt;', [('&lt;expr&gt;', None), (' + ', []), ('&lt;term&gt;', None)])]), None)</code></label><br/>

    </div>
    
    <input id="eb319efa-d3ed-11ef-8343-6298cf1a5790-submit" type="submit" value="Submit" onclick="check_selection('eb319efa-d3ed-11ef-8343-6298cf1a5790', 8, 0, '')"/>
    <span class="quiz_hint" id="eb319efa-d3ed-11ef-8343-6298cf1a5790-hint"/>
    </div>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>You can check it out yourself:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">derivation_tree</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>('&lt;start&gt;', [('&lt;expr&gt;', [('&lt;expr&gt;', None), (' + ', []), ('&lt;term&gt;', None)])])
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Within this book, we also occasionally use a function <code>display_annotated_tree()</code> which allows adding annotations to individual nodes.</p>
</div>
</div>
</div>
</div>

<details id="Excursion:-Source-code-and-example-for-display_annotated_tree()">
<summary>Source code and example for <code>display_annotated_tree()</code></summary>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p><code>display_annotated_tree()</code> displays an annotated tree structure, and lays out the graph left to right.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">display_annotated_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">:</span> <span class="n">DerivationTree</span><span class="p">,</span>
                           <span class="n">a_nodes</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
                           <span class="n">a_edges</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="nb">str</span><span class="p">],</span>
                           <span class="n">log</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">graph_attr</span><span class="p">(</span><span class="n">dot</span><span class="p">):</span>
        <span class="n">dot</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s1">'node'</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="s1">'plain'</span><span class="p">)</span>
        <span class="n">dot</span><span class="o">.</span><span class="n">graph_attr</span><span class="p">[</span><span class="s1">'rankdir'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'LR'</span>

    <span class="k">def</span> <span class="nf">annotate_node</span><span class="p">(</span><span class="n">dot</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="n">symbol</span><span class="p">,</span> <span class="n">ann</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">nid</span> <span class="ow">in</span> <span class="n">a_nodes</span><span class="p">:</span>
            <span class="n">dot</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">nid</span><span class="p">),</span> 
                     <span class="s2">"</span><span class="si">%s</span><span class="s2"> (</span><span class="si">%s</span><span class="s2">)"</span> <span class="o">%</span> <span class="p">(</span><span class="n">dot_escape</span><span class="p">(</span><span class="n">unicode_escape</span><span class="p">(</span><span class="n">symbol</span><span class="p">)),</span>
                                  <span class="n">a_nodes</span><span class="p">[</span><span class="n">nid</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dot</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">nid</span><span class="p">),</span> <span class="n">dot_escape</span><span class="p">(</span><span class="n">unicode_escape</span><span class="p">(</span><span class="n">symbol</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">annotate_edge</span><span class="p">(</span><span class="n">dot</span><span class="p">,</span> <span class="n">start_node</span><span class="p">,</span> <span class="n">stop_node</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">start_node</span><span class="p">,</span> <span class="n">stop_node</span><span class="p">)</span> <span class="ow">in</span> <span class="n">a_edges</span><span class="p">:</span>
            <span class="n">dot</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">start_node</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">stop_node</span><span class="p">),</span>
                     <span class="n">a_edges</span><span class="p">[(</span><span class="n">start_node</span><span class="p">,</span> <span class="n">stop_node</span><span class="p">)])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dot</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">start_node</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">stop_node</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">display_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="n">log</span><span class="p">,</span>
                        <span class="n">node_attr</span><span class="o">=</span><span class="n">annotate_node</span><span class="p">,</span>
                        <span class="n">edge_attr</span><span class="o">=</span><span class="n">annotate_edge</span><span class="p">,</span>
                        <span class="n">graph_attr</span><span class="o">=</span><span class="n">graph_attr</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">display_annotated_tree</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">,</span> <span class="p">{</span><span class="mi">3</span><span class="p">:</span> <span class="s1">'plus'</span><span class="p">},</span> <span class="p">{(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span> <span class="s1">'op'</span><span class="p">},</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_svg output_subarea output_execute_result">


<!-- Generated by graphviz version 12.2.1 (20241206.2353)
 -->
<!-- Pages: 1 -->
<svg width="226pt" height="87pt" viewbox="0.00 0.00 225.75 87.25" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 83.25)">
<polygon fill="white" stroke="none" points="-4,4 -4,-83.25 221.75,-83.25 221.75,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="19.88" y="-33.95" font-family="Times,serif" font-size="14.00">&lt;start&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="97" y="-33.95" font-family="Times,serif" font-size="14.00">&lt;expr&gt;</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0-&gt;1</title>
<path fill="none" stroke="black" d="M39.45,-40.12C47.27,-40.12 56.59,-40.12 65.38,-40.12"/>
<polygon fill="black" stroke="black" points="65.35,-43.63 75.35,-40.13 65.35,-36.63 65.35,-43.63"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="192.25" y="-65.95" font-family="Times,serif" font-size="14.00">&lt;expr&gt;</text>
</g>
<!-- 1&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>1-&gt;2</title>
<path fill="none" stroke="black" d="M110.82,-47.13C117.88,-50.77 126.88,-55.09 135.25,-58.12 143.48,-61.11 152.61,-63.68 161.07,-65.78"/>
<polygon fill="black" stroke="black" points="160.03,-69.13 170.56,-68 161.62,-62.32 160.03,-69.13"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="192.25" y="-33.95" font-family="Times,serif" font-size="14.00"> +  (plus)</text>
</g>
<!-- 1&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>1-&gt;3</title>
<path fill="none" stroke="black" d="M116.87,-40.12C128.07,-40.12 142.62,-40.12 155.88,-40.12"/>
<polygon fill="black" stroke="black" points="155.57,-43.63 165.57,-40.13 155.57,-36.63 155.57,-43.63"/>
<text text-anchor="middle" x="142" y="-41.08" font-family="Times,serif" font-size="14.00">op</text>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="192.25" y="-0.95" font-family="Times,serif" font-size="14.00">&lt;term&gt;</text>
</g>
<!-- 1&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>1-&gt;4</title>
<path fill="none" stroke="black" d="M116.87,-33.45C129.51,-28.97 146.42,-22.99 160.93,-17.86"/>
<polygon fill="black" stroke="black" points="161.76,-21.28 170.02,-14.64 159.42,-14.68 161.76,-21.28"/>
</g>
</g>
</svg>

</div>

</div>

</details>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>If we want to see all the leaf nodes in a tree as a string, the following <code>all_terminals()</code> function comes in handy:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">all_terminals</span><span class="p">(</span><span class="n">tree</span><span class="p">:</span> <span class="n">DerivationTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">children</span><span class="p">)</span> <span class="o">=</span> <span class="n">tree</span>
    <span class="k">if</span> <span class="n">children</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># This is a nonterminal symbol not expanded yet</span>
        <span class="k">return</span> <span class="n">symbol</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">children</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># This is a terminal symbol</span>
        <span class="k">return</span> <span class="n">symbol</span>

    <span class="c1"># This is an expanded symbol:</span>
    <span class="c1"># Concatenate all terminal symbols from all children</span>
    <span class="k">return</span> <span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">all_terminals</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">children</span><span class="p">])</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">all_terminals</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>'&lt;expr&gt; + &lt;term&gt;'
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The alternative <code>tree_to_string()</code> function also converts the tree to a string; however, it replaces nonterminal symbols by empty strings.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">tree_to_string</span><span class="p">(</span><span class="n">tree</span><span class="p">:</span> <span class="n">DerivationTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">symbol</span><span class="p">,</span> <span class="n">children</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">tree</span>
    <span class="k">if</span> <span class="n">children</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tree_to_string</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">children</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">''</span> <span class="k">if</span> <span class="n">is_nonterminal</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span> <span class="k">else</span> <span class="n">symbol</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">tree_to_string</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>' + '
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Expanding-a-Node">Expanding a Node</h2></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let us now develop an algorithm that takes a tree with non-expanded symbols (say, <code>derivation_tree</code>, above), and expands all these symbols one after the other.  As with earlier fuzzers, we create a special subclass of <code>Fuzzer</code> – in this case, <code>GrammarFuzzer</code>.  A <code>GrammarFuzzer</code> gets a grammar and a start symbol; the other parameters will be used later to further control creation and to support debugging.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="kn">from</span> <span class="nn"><a href="Fuzzer.html" class="import" target="_blank">Fuzzer</a></span> <span class="kn">import</span> <span class="n">Fuzzer</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">GrammarFuzzer</span><span class="p">(</span><span class="n">Fuzzer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Produce strings from grammars efficiently, using derivation trees."""</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">grammar</span><span class="p">:</span> <span class="n">Grammar</span><span class="p">,</span>
                 <span class="n">start_symbol</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">START_SYMBOL</span><span class="p">,</span>
                 <span class="n">min_nonterminals</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                 <span class="n">max_nonterminals</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
                 <span class="n">disp</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="n">log</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Produce strings from `grammar`, starting with `start_symbol`.</span>
<span class="sd">        If `min_nonterminals` or `max_nonterminals` is given, use them as limits </span>
<span class="sd">        for the number of nonterminals produced.  </span>
<span class="sd">        If `disp` is set, display the intermediate derivation trees.</span>
<span class="sd">        If `log` is set, show intermediate steps as text on standard output."""</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span> <span class="o">=</span> <span class="n">grammar</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_symbol</span> <span class="o">=</span> <span class="n">start_symbol</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_nonterminals</span> <span class="o">=</span> <span class="n">min_nonterminals</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_nonterminals</span> <span class="o">=</span> <span class="n">max_nonterminals</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disp</span> <span class="o">=</span> <span class="n">disp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">log</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_grammar</span><span class="p">()</span>  <span class="c1"># Invokes is_valid_grammar()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>To add further methods to <code>GrammarFuzzer</code>, we use the hack already introduced for <a href="MutationFuzzer.html">the <code>MutationFuzzer</code> class</a>.  The construct</p>
<div class="highlight"><pre><span/><span class="k">class</span> <span class="nc">GrammarFuzzer</span><span class="p">(</span><span class="n">GrammarFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">new_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>
<p>allows us to add a new method <code>new_method()</code> to the <code>GrammarFuzzer</code> class. (Actually, we get a new <code>GrammarFuzzer</code> class that extends the old one, but for all our purposes, this does not matter.)</p>
</div>
</div>
</div>
</div>

<details id="Excursion:-check_grammar()-implementation">
<summary><code>check_grammar()</code> implementation</summary>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We can use the above hack to define the helper method <code>check_grammar()</code>, which checks the given grammar for consistency:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">GrammarFuzzer</span><span class="p">(</span><span class="n">GrammarFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">check_grammar</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Check the grammar passed"""</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_symbol</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span>
        <span class="k">assert</span> <span class="n">is_valid_grammar</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span><span class="p">,</span>
            <span class="n">start_symbol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">start_symbol</span><span class="p">,</span>
            <span class="n">supported_opts</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">supported_opts</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">supported_opts</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""Set of supported options. To be overloaded in subclasses."""</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">()</span>  <span class="c1"># We don't support specific options</span>
</pre></div>

</div>
</div></div>
</div>
</div>

</details>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let us now define a helper method <code>init_tree()</code> that constructs a tree with just the start symbol:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">GrammarFuzzer</span><span class="p">(</span><span class="n">GrammarFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">init_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DerivationTree</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_symbol</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">f</span> <span class="o">=</span> <span class="n">GrammarFuzzer</span><span class="p">(</span><span class="n">EXPR_GRAMMAR</span><span class="p">)</span>
<span class="n">display_tree</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">init_tree</span><span class="p">())</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_svg output_subarea output_execute_result">


<!-- Generated by graphviz version 12.2.1 (20241206.2353)
 -->
<!-- Pages: 1 -->
<svg width="48pt" height="22pt" viewbox="0.00 0.00 47.75 22.25" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 18.25)">
<polygon fill="white" stroke="none" points="-4,4 -4,-18.25 43.75,-18.25 43.75,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="19.88" y="-0.95" font-family="Times,serif" font-size="14.00">&lt;start&gt;</text>
</g>
</g>
</svg>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>This is the tree we want to expand.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Picking-a-Children-Alternative-to-be-Expanded">Picking a Children Alternative to be Expanded</h3></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>One of the central methods in <code>GrammarFuzzer</code> is <code>choose_node_expansion()</code>. This method gets a node (say, the <code>&lt;start&gt;</code> node) and a list of possible lists of children to be expanded (one for every possible expansion from the grammar), chooses one of them, and returns its index in the possible children list.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>By overloading this method (notably in later chapters), we can implement different strategies – for now, it simply randomly picks one of the given lists of children (which in turn are lists of derivation trees).</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">GrammarFuzzer</span><span class="p">(</span><span class="n">GrammarFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">choose_node_expansion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">DerivationTree</span><span class="p">,</span>
                              <span class="n">children_alternatives</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">DerivationTree</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Return index of expansion in `children_alternatives` to be selected.</span>
<span class="sd">           'children_alternatives`: a list of possible children for `node`.</span>
<span class="sd">           Defaults to random. To be overloaded in subclasses."""</span>
        <span class="k">return</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">children_alternatives</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Getting-a-List-of-Possible-Expansions">Getting a List of Possible Expansions</h3></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>To actually obtain the list of possible children, we will need a helper function <code>expansion_to_children()</code> that takes an expansion string and decomposes it into a list of derivation trees – one for each symbol (terminal or nonterminal) in the string.</p>
</div>
</div>
</div>
</div>

<details id="Excursion:-Implementing-expansion_to_children()">
<summary>Implementing <code>expansion_to_children()</code></summary>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The function <code>expansion_to_children()</code> uses the <code>re.split()</code> method to split an expansion string into a list of children nodes:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">expansion_to_children</span><span class="p">(</span><span class="n">expansion</span><span class="p">:</span> <span class="n">Expansion</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">DerivationTree</span><span class="p">]:</span>
    <span class="c1"># print("Converting " + repr(expansion))</span>
    <span class="c1"># strings contains all substrings -- both terminals and nonterminals such</span>
    <span class="c1"># that ''.join(strings) == expansion</span>

    <span class="n">expansion</span> <span class="o">=</span> <span class="n">exp_string</span><span class="p">(</span><span class="n">expansion</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expansion</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">expansion</span> <span class="o">==</span> <span class="s2">""</span><span class="p">:</span>  <span class="c1"># Special case: epsilon expansion</span>
        <span class="k">return</span> <span class="p">[(</span><span class="s2">""</span><span class="p">,</span> <span class="p">[])]</span>

    <span class="n">strings</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">RE_NONTERMINAL</span><span class="p">,</span> <span class="n">expansion</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[(</span><span class="n">s</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">if</span> <span class="n">is_nonterminal</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">else</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="p">[])</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">strings</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

</details>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">expansion_to_children</span><span class="p">(</span><span class="s2">"&lt;term&gt; + &lt;expr&gt;"</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[('&lt;term&gt;', None), (' + ', []), ('&lt;expr&gt;', None)]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The case of an <em>epsilon expansion</em>, i.e. expanding into an empty string as in <code>&lt;symbol&gt; ::=</code> needs special treatment:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">expansion_to_children</span><span class="p">(</span><span class="s2">""</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[('', [])]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Just like <code>nonterminals()</code> in the <a href="Grammars.html">chapter on Grammars</a>, we provide for future extensions, allowing the expansion to be a tuple with extra data (which will be ignored).</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">expansion_to_children</span><span class="p">((</span><span class="s2">"+&lt;term&gt;"</span><span class="p">,</span> <span class="p">{</span><span class="s2">"extra_data"</span><span class="p">:</span> <span class="mi">1234</span><span class="p">}))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[('+', []), ('&lt;term&gt;', None)]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We realize this helper as a method in <code>GrammarFuzzer</code> such that it can be overloaded by subclasses:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">GrammarFuzzer</span><span class="p">(</span><span class="n">GrammarFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">expansion_to_children</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expansion</span><span class="p">:</span> <span class="n">Expansion</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">DerivationTree</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">expansion_to_children</span><span class="p">(</span><span class="n">expansion</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Putting-Things-Together">Putting Things Together</h3></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>With this, we can now take</p>
<ol>
<li>some non-expanded node in the tree, </li>
<li>choose a random expansion, and</li>
<li>return the new tree.</li>
</ol>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>This is what the method <code>expand_node_randomly()</code> does.</p>
</div>
</div>
</div>
</div>

<details id="Excursion:-expand_node_randomly()-implementation">
<summary><code>expand_node_randomly()</code> implementation</summary>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The function <code>expand_node_randomly()</code> uses a helper function <code>choose_node_expansion()</code> to randomly pick an index from an array of possible children.  (<code>choose_node_expansion()</code> can be overloaded in subclasses.)</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/random.html" class="import" target="_blank">random</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">GrammarFuzzer</span><span class="p">(</span><span class="n">GrammarFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">expand_node_randomly</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">DerivationTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DerivationTree</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Choose a random expansion for `node` and return it"""</span>
        <span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">children</span><span class="p">)</span> <span class="o">=</span> <span class="n">node</span>
        <span class="k">assert</span> <span class="n">children</span> <span class="ow">is</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">"Expanding"</span><span class="p">,</span> <span class="n">all_terminals</span><span class="p">(</span><span class="n">node</span><span class="p">),</span> <span class="s2">"randomly"</span><span class="p">)</span>

        <span class="c1"># Fetch the possible expansions from grammar...</span>
        <span class="n">expansions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span><span class="p">[</span><span class="n">symbol</span><span class="p">]</span>
        <span class="n">children_alternatives</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">DerivationTree</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">expansion_to_children</span><span class="p">(</span><span class="n">expansion</span><span class="p">)</span> <span class="k">for</span> <span class="n">expansion</span> <span class="ow">in</span> <span class="n">expansions</span>
        <span class="p">]</span>

        <span class="c1"># ... and select a random expansion</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">choose_node_expansion</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">children_alternatives</span><span class="p">)</span>
        <span class="n">chosen_children</span> <span class="o">=</span> <span class="n">children_alternatives</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

        <span class="c1"># Process children (for subclasses)</span>
        <span class="n">chosen_children</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_chosen_children</span><span class="p">(</span><span class="n">chosen_children</span><span class="p">,</span>
                                                       <span class="n">expansions</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>

        <span class="c1"># Return with new children</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">chosen_children</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The generic <code>expand_node()</code> method can later be used to select different expansion strategies; as of now, it only uses <code>expand_node_randomly()</code>.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">GrammarFuzzer</span><span class="p">(</span><span class="n">GrammarFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">expand_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">DerivationTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DerivationTree</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_node_randomly</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The helper function <code>process_chosen_children()</code> does nothing; it can be overloaded by subclasses to process the children once chosen.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">GrammarFuzzer</span><span class="p">(</span><span class="n">GrammarFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">process_chosen_children</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                <span class="n">chosen_children</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">DerivationTree</span><span class="p">],</span>
                                <span class="n">expansion</span><span class="p">:</span> <span class="n">Expansion</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">DerivationTree</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""Process children after selection.  By default, does nothing."""</span>
        <span class="k">return</span> <span class="n">chosen_children</span>
</pre></div>

</div>
</div></div>
</div>
</div>

</details>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>This is how <code>expand_node_randomly()</code> works:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">f</span> <span class="o">=</span> <span class="n">GrammarFuzzer</span><span class="p">(</span><span class="n">EXPR_GRAMMAR</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"Before expand_node_randomly():"</span><span class="p">)</span>
<span class="n">expr_tree</span> <span class="o">=</span> <span class="p">(</span><span class="s2">"&lt;integer&gt;"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="n">display_tree</span><span class="p">(</span><span class="n">expr_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Before expand_node_randomly():
</pre>
</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea output_execute_result">


<!-- Generated by graphviz version 12.2.1 (20241206.2353)
 -->
<!-- Pages: 1 -->
<svg width="62pt" height="22pt" viewbox="0.00 0.00 62.00 22.25" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 18.25)">
<polygon fill="white" stroke="none" points="-4,4 -4,-18.25 58,-18.25 58,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="27" y="-0.95" font-family="Times,serif" font-size="14.00">&lt;integer&gt;</text>
</g>
</g>
</svg>

</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="nb">print</span><span class="p">(</span><span class="s2">"After expand_node_randomly():"</span><span class="p">)</span>
<span class="n">expr_tree</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">expand_node_randomly</span><span class="p">(</span><span class="n">expr_tree</span><span class="p">)</span>
<span class="n">display_tree</span><span class="p">(</span><span class="n">expr_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>After expand_node_randomly():
Expanding &lt;integer&gt; randomly
</pre>
</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea output_execute_result">


<!-- Generated by graphviz version 12.2.1 (20241206.2353)
 -->
<!-- Pages: 1 -->
<svg width="62pt" height="73pt" viewbox="0.00 0.00 62.00 72.50" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 68.5)">
<polygon fill="white" stroke="none" points="-4,4 -4,-68.5 58,-68.5 58,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="27" y="-51.2" font-family="Times,serif" font-size="14.00">&lt;integer&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="27" y="-0.95" font-family="Times,serif" font-size="14.00">&lt;digit&gt;</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0-&gt;1</title>
<path fill="none" stroke="black" d="M27,-50.46C27,-44.24 27,-34.15 27,-25.39"/>
<polygon fill="black" stroke="black" points="30.5,-25.6 27,-15.6 23.5,-25.6 30.5,-25.6"/>
</g>
</g>
</svg>

</div>

</div>

<div class="output_area">

<div class="output_html rendered_html output_subarea output_execute_result">

    

    <div class="quiz">
    <h3 class="quiz_title">Quiz</h3>
    <p>
    </p><div class="quiz_question">What tree do we get if we expand the <code>&lt;digit&gt;</code> subtree?</div>
    
    <p>
    </p><div class="quiz_options" title="Pick a choice.">

        <input type="radio" name="ec4d5270-d3ed-11ef-8343-6298cf1a5790" id="ec4d5270-d3ed-11ef-8343-6298cf1a5790-1" onclick="clear_selection('ec4d5270-d3ed-11ef-8343-6298cf1a5790')"/>
        <label id="ec4d5270-d3ed-11ef-8343-6298cf1a5790-1-label" for="ec4d5270-d3ed-11ef-8343-6298cf1a5790-1">We get another <code>&lt;digit&gt;</code> as new child of <code>&lt;digit&gt;</code></label><br/>

        <input type="radio" name="ec4d5270-d3ed-11ef-8343-6298cf1a5790" id="ec4d5270-d3ed-11ef-8343-6298cf1a5790-2" onclick="clear_selection('ec4d5270-d3ed-11ef-8343-6298cf1a5790')"/>
        <label id="ec4d5270-d3ed-11ef-8343-6298cf1a5790-2-label" for="ec4d5270-d3ed-11ef-8343-6298cf1a5790-2">We get some digit as child of <code>&lt;digit&gt;</code></label><br/>

        <input type="radio" name="ec4d5270-d3ed-11ef-8343-6298cf1a5790" id="ec4d5270-d3ed-11ef-8343-6298cf1a5790-3" onclick="clear_selection('ec4d5270-d3ed-11ef-8343-6298cf1a5790')"/>
        <label id="ec4d5270-d3ed-11ef-8343-6298cf1a5790-3-label" for="ec4d5270-d3ed-11ef-8343-6298cf1a5790-3">We get another <code>&lt;digit&gt;</code> as second child of <code>&lt;integer&gt;</code></label><br/>

        <input type="radio" name="ec4d5270-d3ed-11ef-8343-6298cf1a5790" id="ec4d5270-d3ed-11ef-8343-6298cf1a5790-4" onclick="clear_selection('ec4d5270-d3ed-11ef-8343-6298cf1a5790')"/>
        <label id="ec4d5270-d3ed-11ef-8343-6298cf1a5790-4-label" for="ec4d5270-d3ed-11ef-8343-6298cf1a5790-4">The entire tree becomes a single node with a digit</label><br/>

    </div>
    
    <input id="ec4d5270-d3ed-11ef-8343-6298cf1a5790-submit" type="submit" value="Submit" onclick="check_selection('ec4d5270-d3ed-11ef-8343-6298cf1a5790', 4, 0, 'len(&quot;2&quot;) + len(&quot;2&quot;)')"/>
    <span class="quiz_hint" id="ec4d5270-d3ed-11ef-8343-6298cf1a5790-hint"/>
    </div>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We can surely put this to the test, right? Here we go:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">digit_subtree</span> <span class="o">=</span> <span class="n">expr_tree</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">display_tree</span><span class="p">(</span><span class="n">digit_subtree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_svg output_subarea output_execute_result">


<!-- Generated by graphviz version 12.2.1 (20241206.2353)
 -->
<!-- Pages: 1 -->
<svg width="49pt" height="22pt" viewbox="0.00 0.00 49.25 22.25" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 18.25)">
<polygon fill="white" stroke="none" points="-4,4 -4,-18.25 45.25,-18.25 45.25,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="20.62" y="-0.95" font-family="Times,serif" font-size="14.00">&lt;digit&gt;</text>
</g>
</g>
</svg>

</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="nb">print</span><span class="p">(</span><span class="s2">"After expanding the &lt;digit&gt; subtree:"</span><span class="p">)</span>
<span class="n">digit_subtree</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">expand_node_randomly</span><span class="p">(</span><span class="n">digit_subtree</span><span class="p">)</span>
<span class="n">display_tree</span><span class="p">(</span><span class="n">digit_subtree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>After expanding the &lt;digit&gt; subtree:
Expanding &lt;digit&gt; randomly
</pre>
</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea output_execute_result">


<!-- Generated by graphviz version 12.2.1 (20241206.2353)
 -->
<!-- Pages: 1 -->
<svg width="49pt" height="73pt" viewbox="0.00 0.00 49.25 72.50" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 68.5)">
<polygon fill="white" stroke="none" points="-4,4 -4,-68.5 45.25,-68.5 45.25,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="20.62" y="-51.2" font-family="Times,serif" font-size="14.00">&lt;digit&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="20.62" y="-0.95" font-family="Times,serif" font-size="14.00">7 (55)</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0-&gt;1</title>
<path fill="none" stroke="black" d="M20.62,-50.46C20.62,-44.24 20.62,-34.15 20.62,-25.39"/>
<polygon fill="black" stroke="black" points="24.13,-25.6 20.63,-15.6 17.13,-25.6 24.13,-25.6"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We see that <code>&lt;digit&gt;</code> gets expanded again according to the grammar rules – namely, into a single digit.</p>
</div>
</div>
</div>
</div>

<div class="output_area">

<div class="output_html rendered_html output_subarea output_execute_result">

    

    <div class="quiz">
    <h3 class="quiz_title">Quiz</h3>
    <p>
    </p><div class="quiz_question">Is the original <code>expr_tree</code> affected by this change?</div>
    
    <p>
    </p><div class="quiz_options" title="Pick a choice.">

        <input type="radio" name="ecd191ca-d3ed-11ef-8343-6298cf1a5790" id="ecd191ca-d3ed-11ef-8343-6298cf1a5790-1" onclick="clear_selection('ecd191ca-d3ed-11ef-8343-6298cf1a5790')"/>
        <label id="ecd191ca-d3ed-11ef-8343-6298cf1a5790-1-label" for="ecd191ca-d3ed-11ef-8343-6298cf1a5790-1">No, it is unchanged</label><br/>

        <input type="radio" name="ecd191ca-d3ed-11ef-8343-6298cf1a5790" id="ecd191ca-d3ed-11ef-8343-6298cf1a5790-2" onclick="clear_selection('ecd191ca-d3ed-11ef-8343-6298cf1a5790')"/>
        <label id="ecd191ca-d3ed-11ef-8343-6298cf1a5790-2-label" for="ecd191ca-d3ed-11ef-8343-6298cf1a5790-2">Yes, it has also gained a new child</label><br/>

    </div>
    
    <input id="ecd191ca-d3ed-11ef-8343-6298cf1a5790-submit" type="submit" value="Submit" onclick="check_selection('ecd191ca-d3ed-11ef-8343-6298cf1a5790', 2, 0, '1 ** (1 - 1)')"/>
    <span class="quiz_hint" id="ecd191ca-d3ed-11ef-8343-6298cf1a5790-hint"/>
    </div>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Although we have changed one of the subtrees, the original <code>expr_tree</code> is unaffected:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">display_tree</span><span class="p">(</span><span class="n">expr_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_svg output_subarea output_execute_result">


<!-- Generated by graphviz version 12.2.1 (20241206.2353)
 -->
<!-- Pages: 1 -->
<svg width="62pt" height="73pt" viewbox="0.00 0.00 62.00 72.50" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 68.5)">
<polygon fill="white" stroke="none" points="-4,4 -4,-68.5 58,-68.5 58,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="27" y="-51.2" font-family="Times,serif" font-size="14.00">&lt;integer&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="27" y="-0.95" font-family="Times,serif" font-size="14.00">&lt;digit&gt;</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0-&gt;1</title>
<path fill="none" stroke="black" d="M27,-50.46C27,-44.24 27,-34.15 27,-25.39"/>
<polygon fill="black" stroke="black" points="30.5,-25.6 27,-15.6 23.5,-25.6 30.5,-25.6"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>That is because <code>expand_node_randomly()</code> returns a new (expanded) tree and does not change the tree passed as argument.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Expanding-a-Tree">Expanding a Tree</h2><p>Let us now apply our functions for expanding a single node to some node in the tree.  To this end, we first need to <em>search the tree for non-expanded nodes</em>.  <code>possible_expansions()</code> counts how many unexpanded symbols there are in a tree:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">GrammarFuzzer</span><span class="p">(</span><span class="n">GrammarFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">possible_expansions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">DerivationTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">children</span><span class="p">)</span> <span class="o">=</span> <span class="n">node</span>
        <span class="k">if</span> <span class="n">children</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">possible_expansions</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">children</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">f</span> <span class="o">=</span> <span class="n">GrammarFuzzer</span><span class="p">(</span><span class="n">EXPR_GRAMMAR</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">possible_expansions</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>2
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The method <code>any_possible_expansions()</code> returns True if the tree has any non-expanded nodes.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">GrammarFuzzer</span><span class="p">(</span><span class="n">GrammarFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">any_possible_expansions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">DerivationTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">children</span><span class="p">)</span> <span class="o">=</span> <span class="n">node</span>
        <span class="k">if</span> <span class="n">children</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">any_possible_expansions</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">children</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">f</span> <span class="o">=</span> <span class="n">GrammarFuzzer</span><span class="p">(</span><span class="n">EXPR_GRAMMAR</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">any_possible_expansions</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>True
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Here comes <code>expand_tree_once()</code>, the core method of our tree expansion algorithm.  It first checks whether it is currently being applied on a nonterminal symbol without expansion; if so, it invokes <code>expand_node()</code> on it, as discussed above.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>If the node is already expanded (i.e. has children), it checks the subset of children which still have non-expanded symbols, randomly selects one of them, and applies itself recursively on that child.</p>
</div>
</div>
</div>
</div>

<details id="Excursion:-expand_tree_once()-implementation">
<summary><code>expand_tree_once()</code> implementation</summary>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The <code>expand_tree_once()</code> method replaces the child <em>in place</em>, meaning that it actually mutates the tree being passed as an argument rather than returning a new tree.  This in-place mutation is what makes this function particularly efficient.  Again, we use a helper method (<code>choose_tree_expansion()</code>) to return the chosen index from a list of children that can be expanded.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">GrammarFuzzer</span><span class="p">(</span><span class="n">GrammarFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">choose_tree_expansion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                              <span class="n">tree</span><span class="p">:</span> <span class="n">DerivationTree</span><span class="p">,</span>
                              <span class="n">children</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">DerivationTree</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Return index of subtree in `children` to be selected for expansion.</span>
<span class="sd">           Defaults to random."""</span>
        <span class="k">return</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">children</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">expand_tree_once</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">:</span> <span class="n">DerivationTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DerivationTree</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Choose an unexpanded symbol in tree; expand it.</span>
<span class="sd">           Can be overloaded in subclasses."""</span>
        <span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">children</span><span class="p">)</span> <span class="o">=</span> <span class="n">tree</span>
        <span class="k">if</span> <span class="n">children</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Expand this node</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_node</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>

        <span class="c1"># Find all children with possible expansions</span>
        <span class="n">expandable_children</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">children</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">any_possible_expansions</span><span class="p">(</span><span class="n">c</span><span class="p">)]</span>

        <span class="c1"># `index_map` translates an index in `expandable_children`</span>
        <span class="c1"># back into the original index in `children`</span>
        <span class="n">index_map</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">children</span><span class="p">)</span>
                     <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">expandable_children</span><span class="p">]</span>

        <span class="c1"># Select a random child</span>
        <span class="n">child_to_be_expanded</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">choose_tree_expansion</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">expandable_children</span><span class="p">)</span>

        <span class="c1"># Expand in place</span>
        <span class="n">children</span><span class="p">[</span><span class="n">index_map</span><span class="p">[</span><span class="n">child_to_be_expanded</span><span class="p">]]</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">expand_tree_once</span><span class="p">(</span><span class="n">expandable_children</span><span class="p">[</span><span class="n">child_to_be_expanded</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">tree</span>
</pre></div>

</div>
</div></div>
</div>
</div>

</details>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let us illustrate how <code>expand_tree_once()</code> works. We start with our derivation tree from above...</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">derivation_tree</span> <span class="o">=</span> <span class="p">(</span><span class="s2">"&lt;start&gt;"</span><span class="p">,</span>
                   <span class="p">[(</span><span class="s2">"&lt;expr&gt;"</span><span class="p">,</span>
                     <span class="p">[(</span><span class="s2">"&lt;expr&gt;"</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                      <span class="p">(</span><span class="s2">" + "</span><span class="p">,</span> <span class="p">[]),</span>
                         <span class="p">(</span><span class="s2">"&lt;term&gt;"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)]</span>
                     <span class="p">)])</span>
<span class="n">display_tree</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_svg output_subarea output_execute_result">


<!-- Generated by graphviz version 12.2.1 (20241206.2353)
 -->
<!-- Pages: 1 -->
<svg width="142pt" height="123pt" viewbox="0.00 0.00 142.25 122.75" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 118.75)">
<polygon fill="white" stroke="none" points="-4,4 -4,-118.75 138.25,-118.75 138.25,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="66.25" y="-101.45" font-family="Times,serif" font-size="14.00">&lt;start&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="66.25" y="-51.2" font-family="Times,serif" font-size="14.00">&lt;expr&gt;</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0-&gt;1</title>
<path fill="none" stroke="black" d="M66.25,-100.71C66.25,-94.49 66.25,-84.4 66.25,-75.64"/>
<polygon fill="black" stroke="black" points="69.75,-75.85 66.25,-65.85 62.75,-75.85 69.75,-75.85"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="20.25" y="-0.95" font-family="Times,serif" font-size="14.00">&lt;expr&gt;</text>
</g>
<!-- 1&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>1-&gt;2</title>
<path fill="none" stroke="black" d="M60.61,-50.46C53.99,-43.51 42.78,-31.75 33.85,-22.39"/>
<polygon fill="black" stroke="black" points="36.41,-20.01 26.98,-15.19 31.35,-24.84 36.41,-20.01"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="66.25" y="-0.95" font-family="Times,serif" font-size="14.00"> + </text>
</g>
<!-- 1&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>1-&gt;3</title>
<path fill="none" stroke="black" d="M66.25,-50.46C66.25,-44.24 66.25,-34.15 66.25,-25.39"/>
<polygon fill="black" stroke="black" points="69.75,-25.6 66.25,-15.6 62.75,-25.6 69.75,-25.6"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="113.25" y="-0.95" font-family="Times,serif" font-size="14.00">&lt;term&gt;</text>
</g>
<!-- 1&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>1-&gt;4</title>
<path fill="none" stroke="black" d="M72.01,-50.46C78.85,-43.44 90.47,-31.51 99.64,-22.1"/>
<polygon fill="black" stroke="black" points="101.91,-24.78 106.38,-15.17 96.9,-19.9 101.91,-24.78"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>... and now expand it twice:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">f</span> <span class="o">=</span> <span class="n">GrammarFuzzer</span><span class="p">(</span><span class="n">EXPR_GRAMMAR</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">derivation_tree</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">expand_tree_once</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
<span class="n">display_tree</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Expanding &lt;expr&gt; randomly
</pre>
</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea output_execute_result">


<!-- Generated by graphviz version 12.2.1 (20241206.2353)
 -->
<!-- Pages: 1 -->
<svg width="143pt" height="173pt" viewbox="0.00 0.00 143.00 173.00" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 169)">
<polygon fill="white" stroke="none" points="-4,4 -4,-169 139,-169 139,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="67" y="-151.7" font-family="Times,serif" font-size="14.00">&lt;start&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="67" y="-101.45" font-family="Times,serif" font-size="14.00">&lt;expr&gt;</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0-&gt;1</title>
<path fill="none" stroke="black" d="M67,-150.96C67,-144.74 67,-134.65 67,-125.89"/>
<polygon fill="black" stroke="black" points="70.5,-126.1 67,-116.1 63.5,-126.1 70.5,-126.1"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="21" y="-51.2" font-family="Times,serif" font-size="14.00">&lt;expr&gt;</text>
</g>
<!-- 1&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>1-&gt;2</title>
<path fill="none" stroke="black" d="M61.36,-100.71C54.74,-93.76 43.53,-82 34.6,-72.64"/>
<polygon fill="black" stroke="black" points="37.16,-70.26 27.73,-65.44 32.1,-75.09 37.16,-70.26"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="67" y="-51.2" font-family="Times,serif" font-size="14.00"> + </text>
</g>
<!-- 1&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>1-&gt;4</title>
<path fill="none" stroke="black" d="M67,-100.71C67,-94.49 67,-84.4 67,-75.64"/>
<polygon fill="black" stroke="black" points="70.5,-75.85 67,-65.85 63.5,-75.85 70.5,-75.85"/>
</g>
<!-- 5 -->
<g id="node6" class="node">
<title>5</title>
<text text-anchor="middle" x="114" y="-51.2" font-family="Times,serif" font-size="14.00">&lt;term&gt;</text>
</g>
<!-- 1&#45;&gt;5 -->
<g id="edge5" class="edge">
<title>1-&gt;5</title>
<path fill="none" stroke="black" d="M72.76,-100.71C79.6,-93.69 91.22,-81.76 100.39,-72.35"/>
<polygon fill="black" stroke="black" points="102.66,-75.03 107.13,-65.42 97.65,-70.15 102.66,-75.03"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="21" y="-0.95" font-family="Times,serif" font-size="14.00">&lt;term&gt;</text>
</g>
<!-- 2&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>2-&gt;3</title>
<path fill="none" stroke="black" d="M21,-50.46C21,-44.24 21,-34.15 21,-25.39"/>
<polygon fill="black" stroke="black" points="24.5,-25.6 21,-15.6 17.5,-25.6 24.5,-25.6"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">derivation_tree</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">expand_tree_once</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
<span class="n">display_tree</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Expanding &lt;term&gt; randomly
</pre>
</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea output_execute_result">


<!-- Generated by graphviz version 12.2.1 (20241206.2353)
 -->
<!-- Pages: 1 -->
<svg width="208pt" height="173pt" viewbox="0.00 0.00 208.00 173.00" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 169)">
<polygon fill="white" stroke="none" points="-4,4 -4,-169 204,-169 204,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="81" y="-151.7" font-family="Times,serif" font-size="14.00">&lt;start&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="81" y="-101.45" font-family="Times,serif" font-size="14.00">&lt;expr&gt;</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0-&gt;1</title>
<path fill="none" stroke="black" d="M81,-150.96C81,-144.74 81,-134.65 81,-125.89"/>
<polygon fill="black" stroke="black" points="84.5,-126.1 81,-116.1 77.5,-126.1 84.5,-126.1"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="30" y="-51.2" font-family="Times,serif" font-size="14.00">&lt;expr&gt;</text>
</g>
<!-- 1&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>1-&gt;2</title>
<path fill="none" stroke="black" d="M74.75,-100.71C67.25,-93.62 54.46,-81.51 44.46,-72.06"/>
<polygon fill="black" stroke="black" points="47.07,-69.71 37.4,-65.38 42.26,-74.79 47.07,-69.71"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="81" y="-51.2" font-family="Times,serif" font-size="14.00"> + </text>
</g>
<!-- 1&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>1-&gt;4</title>
<path fill="none" stroke="black" d="M81,-100.71C81,-94.49 81,-84.4 81,-75.64"/>
<polygon fill="black" stroke="black" points="84.5,-75.85 81,-65.85 77.5,-75.85 84.5,-75.85"/>
</g>
<!-- 5 -->
<g id="node6" class="node">
<title>5</title>
<text text-anchor="middle" x="130" y="-51.2" font-family="Times,serif" font-size="14.00">&lt;term&gt;</text>
</g>
<!-- 1&#45;&gt;5 -->
<g id="edge5" class="edge">
<title>1-&gt;5</title>
<path fill="none" stroke="black" d="M87.01,-100.71C94.14,-93.69 106.25,-81.76 115.81,-72.35"/>
<polygon fill="black" stroke="black" points="118.19,-74.91 122.86,-65.4 113.28,-69.92 118.19,-74.91"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="21" y="-0.95" font-family="Times,serif" font-size="14.00">&lt;term&gt;</text>
</g>
<!-- 2&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>2-&gt;3</title>
<path fill="none" stroke="black" d="M28.9,-50.46C27.74,-44.24 25.85,-34.15 24.22,-25.39"/>
<polygon fill="black" stroke="black" points="27.66,-24.77 22.39,-15.58 20.78,-26.05 27.66,-24.77"/>
</g>
<!-- 6 -->
<g id="node7" class="node">
<title>6</title>
<text text-anchor="middle" x="84" y="-0.95" font-family="Times,serif" font-size="14.00">&lt;factor&gt;</text>
</g>
<!-- 5&#45;&gt;6 -->
<g id="edge6" class="edge">
<title>5-&gt;6</title>
<path fill="none" stroke="black" d="M124.36,-50.46C117.74,-43.51 106.53,-31.75 97.6,-22.39"/>
<polygon fill="black" stroke="black" points="100.16,-20.01 90.73,-15.19 95.1,-24.84 100.16,-20.01"/>
</g>
<!-- 7 -->
<g id="node8" class="node">
<title>7</title>
<text text-anchor="middle" x="133" y="-0.95" font-family="Times,serif" font-size="14.00"> * </text>
</g>
<!-- 5&#45;&gt;7 -->
<g id="edge7" class="edge">
<title>5-&gt;7</title>
<path fill="none" stroke="black" d="M130.37,-50.46C130.75,-44.24 131.38,-34.15 131.93,-25.39"/>
<polygon fill="black" stroke="black" points="135.41,-25.8 132.54,-15.6 128.42,-25.36 135.41,-25.8"/>
</g>
<!-- 8 -->
<g id="node9" class="node">
<title>8</title>
<text text-anchor="middle" x="179" y="-0.95" font-family="Times,serif" font-size="14.00">&lt;term&gt;</text>
</g>
<!-- 5&#45;&gt;8 -->
<g id="edge8" class="edge">
<title>5-&gt;8</title>
<path fill="none" stroke="black" d="M136.01,-50.46C143.14,-43.44 155.25,-31.51 164.81,-22.1"/>
<polygon fill="black" stroke="black" points="167.19,-24.66 171.86,-15.15 162.28,-19.67 167.19,-24.66"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We see that with each step, one more symbol is expanded.  Now all it takes is to apply this again and again, expanding the tree further and further.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Closing-the-Expansion">Closing the Expansion</h2><p>With <code>expand_tree_once()</code>, we can keep on expanding the tree – but how do we actually stop?  The key idea here, introduced by Luke in [<a href="https://doi.org/10.1109/4235.873237">Luke <em>et al</em>, 2000</a>], is that after inflating the derivation tree to some maximum size, we <em>only want to apply expansions that increase the size of the tree by a minimum</em>.  For <code>&lt;factor&gt;</code>, for instance, we would prefer an expansion into <code>&lt;integer&gt;</code>, as this will not introduce further recursion (and potential size inflation); for <code>&lt;integer&gt;</code>, likewise, an expansion into <code>&lt;digit&gt;</code> is preferred, as it will less increase tree size than <code>&lt;digit&gt;&lt;integer&gt;</code>.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>To identify the <em>cost</em> of expanding a symbol, we introduce two functions that mutually rely on each other:</p>
<ul>
<li><code>symbol_cost()</code> returns the minimum cost of all expansions of a symbol, using <code>expansion_cost()</code> to compute the cost for each expansion.</li>
<li><code>expansion_cost()</code> returns the sum of all expansions in <code>expansions</code>. If a nonterminal is encountered again during traversal, the cost of the expansion is $\infty$, indicating (potentially infinite) recursion.</li>
</ul>
</div>
</div>
</div>
</div>

<details id="Excursion:-Implementing-Cost-Functions">
<summary>Implementing Cost Functions</summary>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">GrammarFuzzer</span><span class="p">(</span><span class="n">GrammarFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">symbol_cost</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">symbol</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">seen</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">())</span> \
            <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
        <span class="n">expansions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span><span class="p">[</span><span class="n">symbol</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expansion_cost</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">seen</span> <span class="o">|</span> <span class="p">{</span><span class="n">symbol</span><span class="p">})</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">expansions</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">expansion_cost</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expansion</span><span class="p">:</span> <span class="n">Expansion</span><span class="p">,</span>
                       <span class="n">seen</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">())</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
        <span class="n">symbols</span> <span class="o">=</span> <span class="n">nonterminals</span><span class="p">(</span><span class="n">expansion</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">symbols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span>  <span class="c1"># no symbol</span>

        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">s</span> <span class="ow">in</span> <span class="n">seen</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">symbols</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="s1">'inf'</span><span class="p">)</span>

        <span class="c1"># the value of a expansion is the sum of all expandable variables</span>
        <span class="c1"># inside + 1</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">symbol_cost</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">seen</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">symbols</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</pre></div>

</div>
</div></div>
</div>
</div>

</details>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Here are two examples: The minimum cost of expanding a digit is 1, since we have to choose from one of its expansions.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">f</span> <span class="o">=</span> <span class="n">GrammarFuzzer</span><span class="p">(</span><span class="n">EXPR_GRAMMAR</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">f</span><span class="o">.</span><span class="n">symbol_cost</span><span class="p">(</span><span class="s2">"&lt;digit&gt;"</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The minimum cost of expanding <code>&lt;expr&gt;</code>, though, is five, as this is the minimum number of expansions required.  (<code>&lt;expr&gt;</code> $\rightarrow$ <code>&lt;term&gt;</code> $\rightarrow$ <code>&lt;factor&gt;</code> $\rightarrow$ <code>&lt;integer&gt;</code> $\rightarrow$ <code>&lt;digit&gt;</code> $\rightarrow$ 1)</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">assert</span> <span class="n">f</span><span class="o">.</span><span class="n">symbol_cost</span><span class="p">(</span><span class="s2">"&lt;expr&gt;"</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We define <code>expand_node_by_cost(self, node, choose)</code>, a variant of <code>expand_node()</code> that takes the above cost into account.  It determines the minimum cost <code>cost</code> across all children and then chooses a child from the list using the <code>choose</code> function, which by default is the minimum cost.  If multiple children all have the same minimum cost, it chooses randomly between these.</p>
</div>
</div>
</div>
</div>

<details id="Excursion:-expand_node_by_cost()-implementation">
<summary><code>expand_node_by_cost()</code> implementation</summary>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">GrammarFuzzer</span><span class="p">(</span><span class="n">GrammarFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">expand_node_by_cost</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">DerivationTree</span><span class="p">,</span> 
                            <span class="n">choose</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="nb">min</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DerivationTree</span><span class="p">:</span>
        <span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">children</span><span class="p">)</span> <span class="o">=</span> <span class="n">node</span>
        <span class="k">assert</span> <span class="n">children</span> <span class="ow">is</span> <span class="kc">None</span>

        <span class="c1"># Fetch the possible expansions from grammar...</span>
        <span class="n">expansions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span><span class="p">[</span><span class="n">symbol</span><span class="p">]</span>

        <span class="n">children_alternatives_with_cost</span> <span class="o">=</span> <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">expansion_to_children</span><span class="p">(</span><span class="n">expansion</span><span class="p">),</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">expansion_cost</span><span class="p">(</span><span class="n">expansion</span><span class="p">,</span> <span class="p">{</span><span class="n">symbol</span><span class="p">}),</span>
                                            <span class="n">expansion</span><span class="p">)</span>
                                           <span class="k">for</span> <span class="n">expansion</span> <span class="ow">in</span> <span class="n">expansions</span><span class="p">]</span>

        <span class="n">costs</span> <span class="o">=</span> <span class="p">[</span><span class="n">cost</span> <span class="k">for</span> <span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">cost</span><span class="p">,</span> <span class="n">expansion</span><span class="p">)</span>
                 <span class="ow">in</span> <span class="n">children_alternatives_with_cost</span><span class="p">]</span>
        <span class="n">chosen_cost</span> <span class="o">=</span> <span class="n">choose</span><span class="p">(</span><span class="n">costs</span><span class="p">)</span>
        <span class="n">children_with_chosen_cost</span> <span class="o">=</span> <span class="p">[</span><span class="n">child</span> <span class="k">for</span> <span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">child_cost</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> 
                                     <span class="ow">in</span> <span class="n">children_alternatives_with_cost</span>
                                     <span class="k">if</span> <span class="n">child_cost</span> <span class="o">==</span> <span class="n">chosen_cost</span><span class="p">]</span>
        <span class="n">expansion_with_chosen_cost</span> <span class="o">=</span> <span class="p">[</span><span class="n">expansion</span> <span class="k">for</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">child_cost</span><span class="p">,</span> <span class="n">expansion</span><span class="p">)</span>
                                      <span class="ow">in</span> <span class="n">children_alternatives_with_cost</span>
                                      <span class="k">if</span> <span class="n">child_cost</span> <span class="o">==</span> <span class="n">chosen_cost</span><span class="p">]</span>

        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">choose_node_expansion</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">children_with_chosen_cost</span><span class="p">)</span>

        <span class="n">chosen_children</span> <span class="o">=</span> <span class="n">children_with_chosen_cost</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="n">chosen_expansion</span> <span class="o">=</span> <span class="n">expansion_with_chosen_cost</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="n">chosen_children</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_chosen_children</span><span class="p">(</span>
            <span class="n">chosen_children</span><span class="p">,</span> <span class="n">chosen_expansion</span><span class="p">)</span>

        <span class="c1"># Return with a new list</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">chosen_children</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

</details>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The shortcut <code>expand_node_min_cost()</code> passes <code>min()</code> as the <code>choose</code> function, which makes it expand nodes at minimum cost.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">GrammarFuzzer</span><span class="p">(</span><span class="n">GrammarFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">expand_node_min_cost</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">DerivationTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DerivationTree</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">"Expanding"</span><span class="p">,</span> <span class="n">all_terminals</span><span class="p">(</span><span class="n">node</span><span class="p">),</span> <span class="s2">"at minimum cost"</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_node_by_cost</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="nb">min</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We can now apply this function to close the expansion of our derivation tree, using <code>expand_tree_once()</code> with the above <code>expand_node_min_cost()</code> as expansion function.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">GrammarFuzzer</span><span class="p">(</span><span class="n">GrammarFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">expand_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">DerivationTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DerivationTree</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_node_min_cost</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">f</span> <span class="o">=</span> <span class="n">GrammarFuzzer</span><span class="p">(</span><span class="n">EXPR_GRAMMAR</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">display_tree</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_svg output_subarea output_execute_result">


<!-- Generated by graphviz version 12.2.1 (20241206.2353)
 -->
<!-- Pages: 1 -->
<svg width="208pt" height="173pt" viewbox="0.00 0.00 208.00 173.00" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 169)">
<polygon fill="white" stroke="none" points="-4,4 -4,-169 204,-169 204,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="81" y="-151.7" font-family="Times,serif" font-size="14.00">&lt;start&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="81" y="-101.45" font-family="Times,serif" font-size="14.00">&lt;expr&gt;</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0-&gt;1</title>
<path fill="none" stroke="black" d="M81,-150.96C81,-144.74 81,-134.65 81,-125.89"/>
<polygon fill="black" stroke="black" points="84.5,-126.1 81,-116.1 77.5,-126.1 84.5,-126.1"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="30" y="-51.2" font-family="Times,serif" font-size="14.00">&lt;expr&gt;</text>
</g>
<!-- 1&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>1-&gt;2</title>
<path fill="none" stroke="black" d="M74.75,-100.71C67.25,-93.62 54.46,-81.51 44.46,-72.06"/>
<polygon fill="black" stroke="black" points="47.07,-69.71 37.4,-65.38 42.26,-74.79 47.07,-69.71"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="81" y="-51.2" font-family="Times,serif" font-size="14.00"> + </text>
</g>
<!-- 1&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>1-&gt;4</title>
<path fill="none" stroke="black" d="M81,-100.71C81,-94.49 81,-84.4 81,-75.64"/>
<polygon fill="black" stroke="black" points="84.5,-75.85 81,-65.85 77.5,-75.85 84.5,-75.85"/>
</g>
<!-- 5 -->
<g id="node6" class="node">
<title>5</title>
<text text-anchor="middle" x="130" y="-51.2" font-family="Times,serif" font-size="14.00">&lt;term&gt;</text>
</g>
<!-- 1&#45;&gt;5 -->
<g id="edge5" class="edge">
<title>1-&gt;5</title>
<path fill="none" stroke="black" d="M87.01,-100.71C94.14,-93.69 106.25,-81.76 115.81,-72.35"/>
<polygon fill="black" stroke="black" points="118.19,-74.91 122.86,-65.4 113.28,-69.92 118.19,-74.91"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="21" y="-0.95" font-family="Times,serif" font-size="14.00">&lt;term&gt;</text>
</g>
<!-- 2&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>2-&gt;3</title>
<path fill="none" stroke="black" d="M28.9,-50.46C27.74,-44.24 25.85,-34.15 24.22,-25.39"/>
<polygon fill="black" stroke="black" points="27.66,-24.77 22.39,-15.58 20.78,-26.05 27.66,-24.77"/>
</g>
<!-- 6 -->
<g id="node7" class="node">
<title>6</title>
<text text-anchor="middle" x="84" y="-0.95" font-family="Times,serif" font-size="14.00">&lt;factor&gt;</text>
</g>
<!-- 5&#45;&gt;6 -->
<g id="edge6" class="edge">
<title>5-&gt;6</title>
<path fill="none" stroke="black" d="M124.36,-50.46C117.74,-43.51 106.53,-31.75 97.6,-22.39"/>
<polygon fill="black" stroke="black" points="100.16,-20.01 90.73,-15.19 95.1,-24.84 100.16,-20.01"/>
</g>
<!-- 7 -->
<g id="node8" class="node">
<title>7</title>
<text text-anchor="middle" x="133" y="-0.95" font-family="Times,serif" font-size="14.00"> * </text>
</g>
<!-- 5&#45;&gt;7 -->
<g id="edge7" class="edge">
<title>5-&gt;7</title>
<path fill="none" stroke="black" d="M130.37,-50.46C130.75,-44.24 131.38,-34.15 131.93,-25.39"/>
<polygon fill="black" stroke="black" points="135.41,-25.8 132.54,-15.6 128.42,-25.36 135.41,-25.8"/>
</g>
<!-- 8 -->
<g id="node9" class="node">
<title>8</title>
<text text-anchor="middle" x="179" y="-0.95" font-family="Times,serif" font-size="14.00">&lt;term&gt;</text>
</g>
<!-- 5&#45;&gt;8 -->
<g id="edge8" class="edge">
<title>5-&gt;8</title>
<path fill="none" stroke="black" d="M136.01,-50.46C143.14,-43.44 155.25,-31.51 164.81,-22.1"/>
<polygon fill="black" stroke="black" points="167.19,-24.66 171.86,-15.15 162.28,-19.67 167.19,-24.66"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">any_possible_expansions</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">):</span>
    <span class="n">derivation_tree</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">expand_tree_once</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
<span class="n">display_tree</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Expanding &lt;term&gt; at minimum cost
</pre>
</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea output_execute_result">


<!-- Generated by graphviz version 12.2.1 (20241206.2353)
 -->
<!-- Pages: 1 -->
<svg width="211pt" height="223pt" viewbox="0.00 0.00 211.00 223.25" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 219.25)">
<polygon fill="white" stroke="none" points="-4,4 -4,-219.25 207,-219.25 207,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="84" y="-201.95" font-family="Times,serif" font-size="14.00">&lt;start&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="84" y="-151.7" font-family="Times,serif" font-size="14.00">&lt;expr&gt;</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0-&gt;1</title>
<path fill="none" stroke="black" d="M84,-201.21C84,-194.99 84,-184.9 84,-176.14"/>
<polygon fill="black" stroke="black" points="87.5,-176.35 84,-166.35 80.5,-176.35 87.5,-176.35"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="33" y="-101.45" font-family="Times,serif" font-size="14.00">&lt;expr&gt;</text>
</g>
<!-- 1&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>1-&gt;2</title>
<path fill="none" stroke="black" d="M77.75,-150.96C70.25,-143.87 57.46,-131.76 47.46,-122.31"/>
<polygon fill="black" stroke="black" points="50.07,-119.96 40.4,-115.63 45.26,-125.04 50.07,-119.96"/>
</g>
<!-- 5 -->
<g id="node6" class="node">
<title>5</title>
<text text-anchor="middle" x="84" y="-101.45" font-family="Times,serif" font-size="14.00"> + </text>
</g>
<!-- 1&#45;&gt;5 -->
<g id="edge5" class="edge">
<title>1-&gt;5</title>
<path fill="none" stroke="black" d="M84,-150.96C84,-144.74 84,-134.65 84,-125.89"/>
<polygon fill="black" stroke="black" points="87.5,-126.1 84,-116.1 80.5,-126.1 87.5,-126.1"/>
</g>
<!-- 6 -->
<g id="node7" class="node">
<title>6</title>
<text text-anchor="middle" x="133" y="-101.45" font-family="Times,serif" font-size="14.00">&lt;term&gt;</text>
</g>
<!-- 1&#45;&gt;6 -->
<g id="edge6" class="edge">
<title>1-&gt;6</title>
<path fill="none" stroke="black" d="M90.01,-150.96C97.14,-143.94 109.25,-132.01 118.81,-122.6"/>
<polygon fill="black" stroke="black" points="121.19,-125.16 125.86,-115.65 116.28,-120.17 121.19,-125.16"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="24" y="-51.2" font-family="Times,serif" font-size="14.00">&lt;term&gt;</text>
</g>
<!-- 2&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>2-&gt;3</title>
<path fill="none" stroke="black" d="M31.9,-100.71C30.74,-94.49 28.85,-84.4 27.22,-75.64"/>
<polygon fill="black" stroke="black" points="30.66,-75.02 25.39,-65.83 23.78,-76.3 30.66,-75.02"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="24" y="-0.95" font-family="Times,serif" font-size="14.00">&lt;factor&gt;</text>
</g>
<!-- 3&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>3-&gt;4</title>
<path fill="none" stroke="black" d="M24,-50.46C24,-44.24 24,-34.15 24,-25.39"/>
<polygon fill="black" stroke="black" points="27.5,-25.6 24,-15.6 20.5,-25.6 27.5,-25.6"/>
</g>
<!-- 7 -->
<g id="node8" class="node">
<title>7</title>
<text text-anchor="middle" x="87" y="-51.2" font-family="Times,serif" font-size="14.00">&lt;factor&gt;</text>
</g>
<!-- 6&#45;&gt;7 -->
<g id="edge7" class="edge">
<title>6-&gt;7</title>
<path fill="none" stroke="black" d="M127.36,-100.71C120.74,-93.76 109.53,-82 100.6,-72.64"/>
<polygon fill="black" stroke="black" points="103.16,-70.26 93.73,-65.44 98.1,-75.09 103.16,-70.26"/>
</g>
<!-- 8 -->
<g id="node9" class="node">
<title>8</title>
<text text-anchor="middle" x="136" y="-51.2" font-family="Times,serif" font-size="14.00"> * </text>
</g>
<!-- 6&#45;&gt;8 -->
<g id="edge8" class="edge">
<title>6-&gt;8</title>
<path fill="none" stroke="black" d="M133.37,-100.71C133.75,-94.49 134.38,-84.4 134.93,-75.64"/>
<polygon fill="black" stroke="black" points="138.41,-76.05 135.54,-65.85 131.42,-75.61 138.41,-76.05"/>
</g>
<!-- 9 -->
<g id="node10" class="node">
<title>9</title>
<text text-anchor="middle" x="182" y="-51.2" font-family="Times,serif" font-size="14.00">&lt;term&gt;</text>
</g>
<!-- 6&#45;&gt;9 -->
<g id="edge9" class="edge">
<title>6-&gt;9</title>
<path fill="none" stroke="black" d="M139.01,-100.71C146.14,-93.69 158.25,-81.76 167.81,-72.35"/>
<polygon fill="black" stroke="black" points="170.19,-74.91 174.86,-65.4 165.28,-69.92 170.19,-74.91"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">any_possible_expansions</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">):</span>
    <span class="n">derivation_tree</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">expand_tree_once</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
<span class="n">display_tree</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Expanding &lt;factor&gt; at minimum cost
</pre>
</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea output_execute_result">


<!-- Generated by graphviz version 12.2.1 (20241206.2353)
 -->
<!-- Pages: 1 -->
<svg width="215pt" height="223pt" viewbox="0.00 0.00 215.00 223.25" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 219.25)">
<polygon fill="white" stroke="none" points="-4,4 -4,-219.25 211,-219.25 211,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="87" y="-201.95" font-family="Times,serif" font-size="14.00">&lt;start&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="87" y="-151.7" font-family="Times,serif" font-size="14.00">&lt;expr&gt;</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0-&gt;1</title>
<path fill="none" stroke="black" d="M87,-201.21C87,-194.99 87,-184.9 87,-176.14"/>
<polygon fill="black" stroke="black" points="90.5,-176.35 87,-166.35 83.5,-176.35 90.5,-176.35"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="36" y="-101.45" font-family="Times,serif" font-size="14.00">&lt;expr&gt;</text>
</g>
<!-- 1&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>1-&gt;2</title>
<path fill="none" stroke="black" d="M80.75,-150.96C73.25,-143.87 60.46,-131.76 50.46,-122.31"/>
<polygon fill="black" stroke="black" points="53.07,-119.96 43.4,-115.63 48.26,-125.04 53.07,-119.96"/>
</g>
<!-- 5 -->
<g id="node6" class="node">
<title>5</title>
<text text-anchor="middle" x="87" y="-101.45" font-family="Times,serif" font-size="14.00"> + </text>
</g>
<!-- 1&#45;&gt;5 -->
<g id="edge5" class="edge">
<title>1-&gt;5</title>
<path fill="none" stroke="black" d="M87,-150.96C87,-144.74 87,-134.65 87,-125.89"/>
<polygon fill="black" stroke="black" points="90.5,-126.1 87,-116.1 83.5,-126.1 90.5,-126.1"/>
</g>
<!-- 6 -->
<g id="node7" class="node">
<title>6</title>
<text text-anchor="middle" x="136" y="-101.45" font-family="Times,serif" font-size="14.00">&lt;term&gt;</text>
</g>
<!-- 1&#45;&gt;6 -->
<g id="edge6" class="edge">
<title>1-&gt;6</title>
<path fill="none" stroke="black" d="M93.01,-150.96C100.14,-143.94 112.25,-132.01 121.81,-122.6"/>
<polygon fill="black" stroke="black" points="124.19,-125.16 128.86,-115.65 119.28,-120.17 124.19,-125.16"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="27" y="-51.2" font-family="Times,serif" font-size="14.00">&lt;term&gt;</text>
</g>
<!-- 2&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>2-&gt;3</title>
<path fill="none" stroke="black" d="M34.9,-100.71C33.74,-94.49 31.85,-84.4 30.22,-75.64"/>
<polygon fill="black" stroke="black" points="33.66,-75.02 28.39,-65.83 26.78,-76.3 33.66,-75.02"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="24" y="-0.95" font-family="Times,serif" font-size="14.00">&lt;factor&gt;</text>
</g>
<!-- 3&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>3-&gt;4</title>
<path fill="none" stroke="black" d="M26.63,-50.46C26.25,-44.24 25.62,-34.15 25.07,-25.39"/>
<polygon fill="black" stroke="black" points="28.58,-25.36 24.46,-15.6 21.59,-25.8 28.58,-25.36"/>
</g>
<!-- 7 -->
<g id="node8" class="node">
<title>7</title>
<text text-anchor="middle" x="91" y="-51.2" font-family="Times,serif" font-size="14.00">&lt;factor&gt;</text>
</g>
<!-- 6&#45;&gt;7 -->
<g id="edge7" class="edge">
<title>6-&gt;7</title>
<path fill="none" stroke="black" d="M130.48,-100.71C124,-93.76 113.04,-82 104.3,-72.64"/>
<polygon fill="black" stroke="black" points="106.98,-70.37 97.6,-65.45 101.86,-75.15 106.98,-70.37"/>
</g>
<!-- 9 -->
<g id="node10" class="node">
<title>9</title>
<text text-anchor="middle" x="140" y="-51.2" font-family="Times,serif" font-size="14.00"> * </text>
</g>
<!-- 6&#45;&gt;9 -->
<g id="edge9" class="edge">
<title>6-&gt;9</title>
<path fill="none" stroke="black" d="M136.49,-100.71C137.01,-94.49 137.84,-84.4 138.57,-75.64"/>
<polygon fill="black" stroke="black" points="142.04,-76.1 139.38,-65.85 135.07,-75.52 142.04,-76.1"/>
</g>
<!-- 10 -->
<g id="node11" class="node">
<title>10</title>
<text text-anchor="middle" x="186" y="-51.2" font-family="Times,serif" font-size="14.00">&lt;term&gt;</text>
</g>
<!-- 6&#45;&gt;10 -->
<g id="edge10" class="edge">
<title>6-&gt;10</title>
<path fill="none" stroke="black" d="M142.13,-100.71C149.48,-93.62 162.02,-81.51 171.82,-72.06"/>
<polygon fill="black" stroke="black" points="173.96,-74.85 178.73,-65.39 169.1,-69.82 173.96,-74.85"/>
</g>
<!-- 8 -->
<g id="node9" class="node">
<title>8</title>
<text text-anchor="middle" x="93" y="-0.95" font-family="Times,serif" font-size="14.00">&lt;integer&gt;</text>
</g>
<!-- 7&#45;&gt;8 -->
<g id="edge8" class="edge">
<title>7-&gt;8</title>
<path fill="none" stroke="black" d="M91.25,-50.46C91.5,-44.24 91.92,-34.15 92.28,-25.39"/>
<polygon fill="black" stroke="black" points="95.77,-25.74 92.69,-15.6 88.78,-25.45 95.77,-25.74"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">any_possible_expansions</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">):</span>
    <span class="n">derivation_tree</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">expand_tree_once</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
<span class="n">display_tree</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Expanding &lt;term&gt; at minimum cost
</pre>
</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea output_execute_result">


<!-- Generated by graphviz version 12.2.1 (20241206.2353)
 -->
<!-- Pages: 1 -->
<svg width="218pt" height="223pt" viewbox="0.00 0.00 218.00 223.25" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 219.25)">
<polygon fill="white" stroke="none" points="-4,4 -4,-219.25 214,-219.25 214,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="87" y="-201.95" font-family="Times,serif" font-size="14.00">&lt;start&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="87" y="-151.7" font-family="Times,serif" font-size="14.00">&lt;expr&gt;</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0-&gt;1</title>
<path fill="none" stroke="black" d="M87,-201.21C87,-194.99 87,-184.9 87,-176.14"/>
<polygon fill="black" stroke="black" points="90.5,-176.35 87,-166.35 83.5,-176.35 90.5,-176.35"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="36" y="-101.45" font-family="Times,serif" font-size="14.00">&lt;expr&gt;</text>
</g>
<!-- 1&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>1-&gt;2</title>
<path fill="none" stroke="black" d="M80.75,-150.96C73.25,-143.87 60.46,-131.76 50.46,-122.31"/>
<polygon fill="black" stroke="black" points="53.07,-119.96 43.4,-115.63 48.26,-125.04 53.07,-119.96"/>
</g>
<!-- 5 -->
<g id="node6" class="node">
<title>5</title>
<text text-anchor="middle" x="87" y="-101.45" font-family="Times,serif" font-size="14.00"> + </text>
</g>
<!-- 1&#45;&gt;5 -->
<g id="edge5" class="edge">
<title>1-&gt;5</title>
<path fill="none" stroke="black" d="M87,-150.96C87,-144.74 87,-134.65 87,-125.89"/>
<polygon fill="black" stroke="black" points="90.5,-126.1 87,-116.1 83.5,-126.1 90.5,-126.1"/>
</g>
<!-- 6 -->
<g id="node7" class="node">
<title>6</title>
<text text-anchor="middle" x="136" y="-101.45" font-family="Times,serif" font-size="14.00">&lt;term&gt;</text>
</g>
<!-- 1&#45;&gt;6 -->
<g id="edge6" class="edge">
<title>1-&gt;6</title>
<path fill="none" stroke="black" d="M93.01,-150.96C100.14,-143.94 112.25,-132.01 121.81,-122.6"/>
<polygon fill="black" stroke="black" points="124.19,-125.16 128.86,-115.65 119.28,-120.17 124.19,-125.16"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="27" y="-51.2" font-family="Times,serif" font-size="14.00">&lt;term&gt;</text>
</g>
<!-- 2&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>2-&gt;3</title>
<path fill="none" stroke="black" d="M34.9,-100.71C33.74,-94.49 31.85,-84.4 30.22,-75.64"/>
<polygon fill="black" stroke="black" points="33.66,-75.02 28.39,-65.83 26.78,-76.3 33.66,-75.02"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="24" y="-0.95" font-family="Times,serif" font-size="14.00">&lt;factor&gt;</text>
</g>
<!-- 3&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>3-&gt;4</title>
<path fill="none" stroke="black" d="M26.63,-50.46C26.25,-44.24 25.62,-34.15 25.07,-25.39"/>
<polygon fill="black" stroke="black" points="28.58,-25.36 24.46,-15.6 21.59,-25.8 28.58,-25.36"/>
</g>
<!-- 7 -->
<g id="node8" class="node">
<title>7</title>
<text text-anchor="middle" x="91" y="-51.2" font-family="Times,serif" font-size="14.00">&lt;factor&gt;</text>
</g>
<!-- 6&#45;&gt;7 -->
<g id="edge7" class="edge">
<title>6-&gt;7</title>
<path fill="none" stroke="black" d="M130.48,-100.71C124,-93.76 113.04,-82 104.3,-72.64"/>
<polygon fill="black" stroke="black" points="106.98,-70.37 97.6,-65.45 101.86,-75.15 106.98,-70.37"/>
</g>
<!-- 9 -->
<g id="node10" class="node">
<title>9</title>
<text text-anchor="middle" x="140" y="-51.2" font-family="Times,serif" font-size="14.00"> * </text>
</g>
<!-- 6&#45;&gt;9 -->
<g id="edge9" class="edge">
<title>6-&gt;9</title>
<path fill="none" stroke="black" d="M136.49,-100.71C137.01,-94.49 137.84,-84.4 138.57,-75.64"/>
<polygon fill="black" stroke="black" points="142.04,-76.1 139.38,-65.85 135.07,-75.52 142.04,-76.1"/>
</g>
<!-- 10 -->
<g id="node11" class="node">
<title>10</title>
<text text-anchor="middle" x="186" y="-51.2" font-family="Times,serif" font-size="14.00">&lt;term&gt;</text>
</g>
<!-- 6&#45;&gt;10 -->
<g id="edge10" class="edge">
<title>6-&gt;10</title>
<path fill="none" stroke="black" d="M142.13,-100.71C149.48,-93.62 162.02,-81.51 171.82,-72.06"/>
<polygon fill="black" stroke="black" points="173.96,-74.85 178.73,-65.39 169.1,-69.82 173.96,-74.85"/>
</g>
<!-- 8 -->
<g id="node9" class="node">
<title>8</title>
<text text-anchor="middle" x="93" y="-0.95" font-family="Times,serif" font-size="14.00">&lt;integer&gt;</text>
</g>
<!-- 7&#45;&gt;8 -->
<g id="edge8" class="edge">
<title>7-&gt;8</title>
<path fill="none" stroke="black" d="M91.25,-50.46C91.5,-44.24 91.92,-34.15 92.28,-25.39"/>
<polygon fill="black" stroke="black" points="95.77,-25.74 92.69,-15.6 88.78,-25.45 95.77,-25.74"/>
</g>
<!-- 11 -->
<g id="node12" class="node">
<title>11</title>
<text text-anchor="middle" x="186" y="-0.95" font-family="Times,serif" font-size="14.00">&lt;factor&gt;</text>
</g>
<!-- 10&#45;&gt;11 -->
<g id="edge11" class="edge">
<title>10-&gt;11</title>
<path fill="none" stroke="black" d="M186,-50.46C186,-44.24 186,-34.15 186,-25.39"/>
<polygon fill="black" stroke="black" points="189.5,-25.6 186,-15.6 182.5,-25.6 189.5,-25.6"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We keep on expanding until all nonterminals are expanded.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">while</span> <span class="n">f</span><span class="o">.</span><span class="n">any_possible_expansions</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">):</span>
    <span class="n">derivation_tree</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">expand_tree_once</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>    
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Expanding &lt;integer&gt; at minimum cost
Expanding &lt;digit&gt; at minimum cost
Expanding &lt;factor&gt; at minimum cost
Expanding &lt;integer&gt; at minimum cost
Expanding &lt;factor&gt; at minimum cost
Expanding &lt;integer&gt; at minimum cost
Expanding &lt;digit&gt; at minimum cost
Expanding &lt;digit&gt; at minimum cost
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Here is the final tree:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">display_tree</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_svg output_subarea output_execute_result">


<!-- Generated by graphviz version 12.2.1 (20241206.2353)
 -->
<!-- Pages: 1 -->
<svg width="224pt" height="374pt" viewbox="0.00 0.00 224.00 374.00" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 370)">
<polygon fill="white" stroke="none" points="-4,4 -4,-370 220,-370 220,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="90" y="-352.7" font-family="Times,serif" font-size="14.00">&lt;start&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="90" y="-302.45" font-family="Times,serif" font-size="14.00">&lt;expr&gt;</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0-&gt;1</title>
<path fill="none" stroke="black" d="M90,-351.96C90,-345.74 90,-335.65 90,-326.89"/>
<polygon fill="black" stroke="black" points="93.5,-327.1 90,-317.1 86.5,-327.1 93.5,-327.1"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="39" y="-252.2" font-family="Times,serif" font-size="14.00">&lt;expr&gt;</text>
</g>
<!-- 1&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>1-&gt;2</title>
<path fill="none" stroke="black" d="M83.75,-301.71C76.25,-294.62 63.46,-282.51 53.46,-273.06"/>
<polygon fill="black" stroke="black" points="56.07,-270.71 46.4,-266.38 51.26,-275.79 56.07,-270.71"/>
</g>
<!-- 8 -->
<g id="node9" class="node">
<title>8</title>
<text text-anchor="middle" x="90" y="-252.2" font-family="Times,serif" font-size="14.00"> + </text>
</g>
<!-- 1&#45;&gt;8 -->
<g id="edge8" class="edge">
<title>1-&gt;8</title>
<path fill="none" stroke="black" d="M90,-301.71C90,-295.49 90,-285.4 90,-276.64"/>
<polygon fill="black" stroke="black" points="93.5,-276.85 90,-266.85 86.5,-276.85 93.5,-276.85"/>
</g>
<!-- 9 -->
<g id="node10" class="node">
<title>9</title>
<text text-anchor="middle" x="139" y="-252.2" font-family="Times,serif" font-size="14.00">&lt;term&gt;</text>
</g>
<!-- 1&#45;&gt;9 -->
<g id="edge9" class="edge">
<title>1-&gt;9</title>
<path fill="none" stroke="black" d="M96.01,-301.71C103.14,-294.69 115.25,-282.76 124.81,-273.35"/>
<polygon fill="black" stroke="black" points="127.19,-275.91 131.86,-266.4 122.28,-270.92 127.19,-275.91"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="30" y="-201.95" font-family="Times,serif" font-size="14.00">&lt;term&gt;</text>
</g>
<!-- 2&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>2-&gt;3</title>
<path fill="none" stroke="black" d="M37.9,-251.46C36.74,-245.24 34.85,-235.15 33.22,-226.39"/>
<polygon fill="black" stroke="black" points="36.66,-225.77 31.39,-216.58 29.78,-227.05 36.66,-225.77"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="27" y="-151.7" font-family="Times,serif" font-size="14.00">&lt;factor&gt;</text>
</g>
<!-- 3&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>3-&gt;4</title>
<path fill="none" stroke="black" d="M29.63,-201.21C29.25,-194.99 28.62,-184.9 28.07,-176.14"/>
<polygon fill="black" stroke="black" points="31.58,-176.11 27.46,-166.35 24.59,-176.55 31.58,-176.11"/>
</g>
<!-- 5 -->
<g id="node6" class="node">
<title>5</title>
<text text-anchor="middle" x="27" y="-101.45" font-family="Times,serif" font-size="14.00">&lt;integer&gt;</text>
</g>
<!-- 4&#45;&gt;5 -->
<g id="edge5" class="edge">
<title>4-&gt;5</title>
<path fill="none" stroke="black" d="M27,-150.96C27,-144.74 27,-134.65 27,-125.89"/>
<polygon fill="black" stroke="black" points="30.5,-126.1 27,-116.1 23.5,-126.1 30.5,-126.1"/>
</g>
<!-- 6 -->
<g id="node7" class="node">
<title>6</title>
<text text-anchor="middle" x="27" y="-51.2" font-family="Times,serif" font-size="14.00">&lt;digit&gt;</text>
</g>
<!-- 5&#45;&gt;6 -->
<g id="edge6" class="edge">
<title>5-&gt;6</title>
<path fill="none" stroke="black" d="M27,-100.71C27,-94.49 27,-84.4 27,-75.64"/>
<polygon fill="black" stroke="black" points="30.5,-75.85 27,-65.85 23.5,-75.85 30.5,-75.85"/>
</g>
<!-- 7 -->
<g id="node8" class="node">
<title>7</title>
<text text-anchor="middle" x="27" y="-0.95" font-family="Times,serif" font-size="14.00">7 (55)</text>
</g>
<!-- 6&#45;&gt;7 -->
<g id="edge7" class="edge">
<title>6-&gt;7</title>
<path fill="none" stroke="black" d="M27,-50.46C27,-44.24 27,-34.15 27,-25.39"/>
<polygon fill="black" stroke="black" points="30.5,-25.6 27,-15.6 23.5,-25.6 30.5,-25.6"/>
</g>
<!-- 10 -->
<g id="node11" class="node">
<title>10</title>
<text text-anchor="middle" x="94" y="-201.95" font-family="Times,serif" font-size="14.00">&lt;factor&gt;</text>
</g>
<!-- 9&#45;&gt;10 -->
<g id="edge10" class="edge">
<title>9-&gt;10</title>
<path fill="none" stroke="black" d="M133.48,-251.46C127,-244.51 116.04,-232.75 107.3,-223.39"/>
<polygon fill="black" stroke="black" points="109.98,-221.12 100.6,-216.2 104.86,-225.9 109.98,-221.12"/>
</g>
<!-- 14 -->
<g id="node15" class="node">
<title>14</title>
<text text-anchor="middle" x="143" y="-201.95" font-family="Times,serif" font-size="14.00"> * </text>
</g>
<!-- 9&#45;&gt;14 -->
<g id="edge14" class="edge">
<title>9-&gt;14</title>
<path fill="none" stroke="black" d="M139.49,-251.46C140.01,-245.24 140.84,-235.15 141.57,-226.39"/>
<polygon fill="black" stroke="black" points="145.04,-226.85 142.38,-216.6 138.07,-226.27 145.04,-226.85"/>
</g>
<!-- 15 -->
<g id="node16" class="node">
<title>15</title>
<text text-anchor="middle" x="189" y="-201.95" font-family="Times,serif" font-size="14.00">&lt;term&gt;</text>
</g>
<!-- 9&#45;&gt;15 -->
<g id="edge15" class="edge">
<title>9-&gt;15</title>
<path fill="none" stroke="black" d="M145.13,-251.46C152.48,-244.37 165.02,-232.26 174.82,-222.81"/>
<polygon fill="black" stroke="black" points="176.96,-225.6 181.73,-216.14 172.1,-220.57 176.96,-225.6"/>
</g>
<!-- 11 -->
<g id="node12" class="node">
<title>11</title>
<text text-anchor="middle" x="96" y="-151.7" font-family="Times,serif" font-size="14.00">&lt;integer&gt;</text>
</g>
<!-- 10&#45;&gt;11 -->
<g id="edge11" class="edge">
<title>10-&gt;11</title>
<path fill="none" stroke="black" d="M94.25,-201.21C94.5,-194.99 94.92,-184.9 95.28,-176.14"/>
<polygon fill="black" stroke="black" points="98.77,-176.49 95.69,-166.35 91.78,-176.2 98.77,-176.49"/>
</g>
<!-- 12 -->
<g id="node13" class="node">
<title>12</title>
<text text-anchor="middle" x="96" y="-101.45" font-family="Times,serif" font-size="14.00">&lt;digit&gt;</text>
</g>
<!-- 11&#45;&gt;12 -->
<g id="edge12" class="edge">
<title>11-&gt;12</title>
<path fill="none" stroke="black" d="M96,-150.96C96,-144.74 96,-134.65 96,-125.89"/>
<polygon fill="black" stroke="black" points="99.5,-126.1 96,-116.1 92.5,-126.1 99.5,-126.1"/>
</g>
<!-- 13 -->
<g id="node14" class="node">
<title>13</title>
<text text-anchor="middle" x="96" y="-51.2" font-family="Times,serif" font-size="14.00">5 (53)</text>
</g>
<!-- 12&#45;&gt;13 -->
<g id="edge13" class="edge">
<title>12-&gt;13</title>
<path fill="none" stroke="black" d="M96,-100.71C96,-94.49 96,-84.4 96,-75.64"/>
<polygon fill="black" stroke="black" points="99.5,-75.85 96,-65.85 92.5,-75.85 99.5,-75.85"/>
</g>
<!-- 16 -->
<g id="node17" class="node">
<title>16</title>
<text text-anchor="middle" x="189" y="-151.7" font-family="Times,serif" font-size="14.00">&lt;factor&gt;</text>
</g>
<!-- 15&#45;&gt;16 -->
<g id="edge16" class="edge">
<title>15-&gt;16</title>
<path fill="none" stroke="black" d="M189,-201.21C189,-194.99 189,-184.9 189,-176.14"/>
<polygon fill="black" stroke="black" points="192.5,-176.35 189,-166.35 185.5,-176.35 192.5,-176.35"/>
</g>
<!-- 17 -->
<g id="node18" class="node">
<title>17</title>
<text text-anchor="middle" x="189" y="-101.45" font-family="Times,serif" font-size="14.00">&lt;integer&gt;</text>
</g>
<!-- 16&#45;&gt;17 -->
<g id="edge17" class="edge">
<title>16-&gt;17</title>
<path fill="none" stroke="black" d="M189,-150.96C189,-144.74 189,-134.65 189,-125.89"/>
<polygon fill="black" stroke="black" points="192.5,-126.1 189,-116.1 185.5,-126.1 192.5,-126.1"/>
</g>
<!-- 18 -->
<g id="node19" class="node">
<title>18</title>
<text text-anchor="middle" x="189" y="-51.2" font-family="Times,serif" font-size="14.00">&lt;digit&gt;</text>
</g>
<!-- 17&#45;&gt;18 -->
<g id="edge18" class="edge">
<title>17-&gt;18</title>
<path fill="none" stroke="black" d="M189,-100.71C189,-94.49 189,-84.4 189,-75.64"/>
<polygon fill="black" stroke="black" points="192.5,-75.85 189,-65.85 185.5,-75.85 192.5,-75.85"/>
</g>
<!-- 19 -->
<g id="node20" class="node">
<title>19</title>
<text text-anchor="middle" x="189" y="-0.95" font-family="Times,serif" font-size="14.00">8 (56)</text>
</g>
<!-- 18&#45;&gt;19 -->
<g id="edge19" class="edge">
<title>18-&gt;19</title>
<path fill="none" stroke="black" d="M189,-50.46C189,-44.24 189,-34.15 189,-25.39"/>
<polygon fill="black" stroke="black" points="192.5,-25.6 189,-15.6 185.5,-25.6 192.5,-25.6"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We see that in each step, <code>expand_node_min_cost()</code> chooses an expansion that does not increase the number of symbols, eventually closing all open expansions.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Node-Inflation">Node Inflation</h2><p>Especially at the beginning of an expansion, we may be interested in getting <em>as many nodes as possible</em> – that is, we'd like to prefer expansions that give us <em>more</em> nonterminals to expand.  This is actually the exact opposite of what <code>expand_node_min_cost()</code> gives us, and we can implement a method <code>expand_node_max_cost()</code> that will always choose among the nodes with the <em>highest</em> cost:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">GrammarFuzzer</span><span class="p">(</span><span class="n">GrammarFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">expand_node_max_cost</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">DerivationTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DerivationTree</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">"Expanding"</span><span class="p">,</span> <span class="n">all_terminals</span><span class="p">(</span><span class="n">node</span><span class="p">),</span> <span class="s2">"at maximum cost"</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_node_by_cost</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="nb">max</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>To illustrate <code>expand_node_max_cost()</code>, we can again redefine <code>expand_node()</code> to use it, and then use <code>expand_tree_once()</code> to show a few expansion steps:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">GrammarFuzzer</span><span class="p">(</span><span class="n">GrammarFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">expand_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">DerivationTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DerivationTree</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_node_max_cost</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">derivation_tree</span> <span class="o">=</span> <span class="p">(</span><span class="s2">"&lt;start&gt;"</span><span class="p">,</span>
                   <span class="p">[(</span><span class="s2">"&lt;expr&gt;"</span><span class="p">,</span>
                     <span class="p">[(</span><span class="s2">"&lt;expr&gt;"</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                      <span class="p">(</span><span class="s2">" + "</span><span class="p">,</span> <span class="p">[]),</span>
                         <span class="p">(</span><span class="s2">"&lt;term&gt;"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)]</span>
                     <span class="p">)])</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">f</span> <span class="o">=</span> <span class="n">GrammarFuzzer</span><span class="p">(</span><span class="n">EXPR_GRAMMAR</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">display_tree</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_svg output_subarea output_execute_result">


<!-- Generated by graphviz version 12.2.1 (20241206.2353)
 -->
<!-- Pages: 1 -->
<svg width="142pt" height="123pt" viewbox="0.00 0.00 142.25 122.75" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 118.75)">
<polygon fill="white" stroke="none" points="-4,4 -4,-118.75 138.25,-118.75 138.25,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="66.25" y="-101.45" font-family="Times,serif" font-size="14.00">&lt;start&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="66.25" y="-51.2" font-family="Times,serif" font-size="14.00">&lt;expr&gt;</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0-&gt;1</title>
<path fill="none" stroke="black" d="M66.25,-100.71C66.25,-94.49 66.25,-84.4 66.25,-75.64"/>
<polygon fill="black" stroke="black" points="69.75,-75.85 66.25,-65.85 62.75,-75.85 69.75,-75.85"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="20.25" y="-0.95" font-family="Times,serif" font-size="14.00">&lt;expr&gt;</text>
</g>
<!-- 1&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>1-&gt;2</title>
<path fill="none" stroke="black" d="M60.61,-50.46C53.99,-43.51 42.78,-31.75 33.85,-22.39"/>
<polygon fill="black" stroke="black" points="36.41,-20.01 26.98,-15.19 31.35,-24.84 36.41,-20.01"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="66.25" y="-0.95" font-family="Times,serif" font-size="14.00"> + </text>
</g>
<!-- 1&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>1-&gt;3</title>
<path fill="none" stroke="black" d="M66.25,-50.46C66.25,-44.24 66.25,-34.15 66.25,-25.39"/>
<polygon fill="black" stroke="black" points="69.75,-25.6 66.25,-15.6 62.75,-25.6 69.75,-25.6"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="113.25" y="-0.95" font-family="Times,serif" font-size="14.00">&lt;term&gt;</text>
</g>
<!-- 1&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>1-&gt;4</title>
<path fill="none" stroke="black" d="M72.01,-50.46C78.85,-43.44 90.47,-31.51 99.64,-22.1"/>
<polygon fill="black" stroke="black" points="101.91,-24.78 106.38,-15.17 96.9,-19.9 101.91,-24.78"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">any_possible_expansions</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">):</span>
    <span class="n">derivation_tree</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">expand_tree_once</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
<span class="n">display_tree</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Expanding &lt;term&gt; at maximum cost
</pre>
</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea output_execute_result">


<!-- Generated by graphviz version 12.2.1 (20241206.2353)
 -->
<!-- Pages: 1 -->
<svg width="188pt" height="173pt" viewbox="0.00 0.00 188.25 173.00" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 169)">
<polygon fill="white" stroke="none" points="-4,4 -4,-169 184.25,-169 184.25,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="66.25" y="-151.7" font-family="Times,serif" font-size="14.00">&lt;start&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="66.25" y="-101.45" font-family="Times,serif" font-size="14.00">&lt;expr&gt;</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0-&gt;1</title>
<path fill="none" stroke="black" d="M66.25,-150.96C66.25,-144.74 66.25,-134.65 66.25,-125.89"/>
<polygon fill="black" stroke="black" points="69.75,-126.1 66.25,-116.1 62.75,-126.1 69.75,-126.1"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="20.25" y="-51.2" font-family="Times,serif" font-size="14.00">&lt;expr&gt;</text>
</g>
<!-- 1&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>1-&gt;2</title>
<path fill="none" stroke="black" d="M60.61,-100.71C53.99,-93.76 42.78,-82 33.85,-72.64"/>
<polygon fill="black" stroke="black" points="36.41,-70.26 26.98,-65.44 31.35,-75.09 36.41,-70.26"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="66.25" y="-51.2" font-family="Times,serif" font-size="14.00"> + </text>
</g>
<!-- 1&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>1-&gt;3</title>
<path fill="none" stroke="black" d="M66.25,-100.71C66.25,-94.49 66.25,-84.4 66.25,-75.64"/>
<polygon fill="black" stroke="black" points="69.75,-75.85 66.25,-65.85 62.75,-75.85 69.75,-75.85"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="113.25" y="-51.2" font-family="Times,serif" font-size="14.00">&lt;term&gt;</text>
</g>
<!-- 1&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>1-&gt;4</title>
<path fill="none" stroke="black" d="M72.01,-100.71C78.85,-93.69 90.47,-81.76 99.64,-72.35"/>
<polygon fill="black" stroke="black" points="101.91,-75.03 106.38,-65.42 96.9,-70.15 101.91,-75.03"/>
</g>
<!-- 5 -->
<g id="node6" class="node">
<title>5</title>
<text text-anchor="middle" x="64.25" y="-0.95" font-family="Times,serif" font-size="14.00">&lt;factor&gt;</text>
</g>
<!-- 4&#45;&gt;5 -->
<g id="edge5" class="edge">
<title>4-&gt;5</title>
<path fill="none" stroke="black" d="M107.24,-50.46C100.11,-43.44 88,-31.51 78.44,-22.1"/>
<polygon fill="black" stroke="black" points="80.97,-19.67 71.39,-15.15 76.06,-24.66 80.97,-19.67"/>
</g>
<!-- 6 -->
<g id="node7" class="node">
<title>6</title>
<text text-anchor="middle" x="113.25" y="-0.95" font-family="Times,serif" font-size="14.00"> * </text>
</g>
<!-- 4&#45;&gt;6 -->
<g id="edge6" class="edge">
<title>4-&gt;6</title>
<path fill="none" stroke="black" d="M113.25,-50.46C113.25,-44.24 113.25,-34.15 113.25,-25.39"/>
<polygon fill="black" stroke="black" points="116.75,-25.6 113.25,-15.6 109.75,-25.6 116.75,-25.6"/>
</g>
<!-- 7 -->
<g id="node8" class="node">
<title>7</title>
<text text-anchor="middle" x="159.25" y="-0.95" font-family="Times,serif" font-size="14.00">&lt;term&gt;</text>
</g>
<!-- 4&#45;&gt;7 -->
<g id="edge7" class="edge">
<title>4-&gt;7</title>
<path fill="none" stroke="black" d="M118.89,-50.46C125.51,-43.51 136.72,-31.75 145.65,-22.39"/>
<polygon fill="black" stroke="black" points="148.15,-24.84 152.52,-15.19 143.09,-20.01 148.15,-24.84"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">any_possible_expansions</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">):</span>
    <span class="n">derivation_tree</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">expand_tree_once</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
<span class="n">display_tree</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Expanding &lt;factor&gt; at maximum cost
</pre>
</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea output_execute_result">


<!-- Generated by graphviz version 12.2.1 (20241206.2353)
 -->
<!-- Pages: 1 -->
<svg width="188pt" height="223pt" viewbox="0.00 0.00 188.25 223.25" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 219.25)">
<polygon fill="white" stroke="none" points="-4,4 -4,-219.25 184.25,-219.25 184.25,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="66.25" y="-201.95" font-family="Times,serif" font-size="14.00">&lt;start&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="66.25" y="-151.7" font-family="Times,serif" font-size="14.00">&lt;expr&gt;</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0-&gt;1</title>
<path fill="none" stroke="black" d="M66.25,-201.21C66.25,-194.99 66.25,-184.9 66.25,-176.14"/>
<polygon fill="black" stroke="black" points="69.75,-176.35 66.25,-166.35 62.75,-176.35 69.75,-176.35"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="20.25" y="-101.45" font-family="Times,serif" font-size="14.00">&lt;expr&gt;</text>
</g>
<!-- 1&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>1-&gt;2</title>
<path fill="none" stroke="black" d="M60.61,-150.96C53.99,-144.01 42.78,-132.25 33.85,-122.89"/>
<polygon fill="black" stroke="black" points="36.41,-120.51 26.98,-115.69 31.35,-125.34 36.41,-120.51"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="66.25" y="-101.45" font-family="Times,serif" font-size="14.00"> + </text>
</g>
<!-- 1&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>1-&gt;3</title>
<path fill="none" stroke="black" d="M66.25,-150.96C66.25,-144.74 66.25,-134.65 66.25,-125.89"/>
<polygon fill="black" stroke="black" points="69.75,-126.1 66.25,-116.1 62.75,-126.1 69.75,-126.1"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="113.25" y="-101.45" font-family="Times,serif" font-size="14.00">&lt;term&gt;</text>
</g>
<!-- 1&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>1-&gt;4</title>
<path fill="none" stroke="black" d="M72.01,-150.96C78.85,-143.94 90.47,-132.01 99.64,-122.6"/>
<polygon fill="black" stroke="black" points="101.91,-125.28 106.38,-115.67 96.9,-120.4 101.91,-125.28"/>
</g>
<!-- 5 -->
<g id="node6" class="node">
<title>5</title>
<text text-anchor="middle" x="64.25" y="-51.2" font-family="Times,serif" font-size="14.00">&lt;factor&gt;</text>
</g>
<!-- 4&#45;&gt;5 -->
<g id="edge5" class="edge">
<title>4-&gt;5</title>
<path fill="none" stroke="black" d="M107.24,-100.71C100.11,-93.69 88,-81.76 78.44,-72.35"/>
<polygon fill="black" stroke="black" points="80.97,-69.92 71.39,-65.4 76.06,-74.91 80.97,-69.92"/>
</g>
<!-- 8 -->
<g id="node9" class="node">
<title>8</title>
<text text-anchor="middle" x="113.25" y="-51.2" font-family="Times,serif" font-size="14.00"> * </text>
</g>
<!-- 4&#45;&gt;8 -->
<g id="edge8" class="edge">
<title>4-&gt;8</title>
<path fill="none" stroke="black" d="M113.25,-100.71C113.25,-94.49 113.25,-84.4 113.25,-75.64"/>
<polygon fill="black" stroke="black" points="116.75,-75.85 113.25,-65.85 109.75,-75.85 116.75,-75.85"/>
</g>
<!-- 9 -->
<g id="node10" class="node">
<title>9</title>
<text text-anchor="middle" x="159.25" y="-51.2" font-family="Times,serif" font-size="14.00">&lt;term&gt;</text>
</g>
<!-- 4&#45;&gt;9 -->
<g id="edge9" class="edge">
<title>4-&gt;9</title>
<path fill="none" stroke="black" d="M118.89,-100.71C125.51,-93.76 136.72,-82 145.65,-72.64"/>
<polygon fill="black" stroke="black" points="148.15,-75.09 152.52,-65.44 143.09,-70.26 148.15,-75.09"/>
</g>
<!-- 6 -->
<g id="node7" class="node">
<title>6</title>
<text text-anchor="middle" x="36.25" y="-0.95" font-family="Times,serif" font-size="14.00">- (45)</text>
</g>
<!-- 5&#45;&gt;6 -->
<g id="edge6" class="edge">
<title>5-&gt;6</title>
<path fill="none" stroke="black" d="M60.82,-50.46C57,-43.87 50.67,-32.97 45.39,-23.87"/>
<polygon fill="black" stroke="black" points="48.52,-22.29 40.47,-15.4 42.46,-25.8 48.52,-22.29"/>
</g>
<!-- 7 -->
<g id="node8" class="node">
<title>7</title>
<text text-anchor="middle" x="93.25" y="-0.95" font-family="Times,serif" font-size="14.00">&lt;factor&gt;</text>
</g>
<!-- 5&#45;&gt;7 -->
<g id="edge7" class="edge">
<title>5-&gt;7</title>
<path fill="none" stroke="black" d="M67.81,-50.46C71.76,-43.87 78.32,-32.97 83.79,-23.87"/>
<polygon fill="black" stroke="black" points="86.73,-25.76 88.89,-15.39 80.73,-22.16 86.73,-25.76"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">any_possible_expansions</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">):</span>
    <span class="n">derivation_tree</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">expand_tree_once</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
<span class="n">display_tree</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Expanding &lt;expr&gt; at maximum cost
</pre>
</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea output_execute_result">


<!-- Generated by graphviz version 12.2.1 (20241206.2353)
 -->
<!-- Pages: 1 -->
<svg width="300pt" height="223pt" viewbox="0.00 0.00 300.00 223.25" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 219.25)">
<polygon fill="white" stroke="none" points="-4,4 -4,-219.25 296,-219.25 296,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="146" y="-201.95" font-family="Times,serif" font-size="14.00">&lt;start&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="146" y="-151.7" font-family="Times,serif" font-size="14.00">&lt;expr&gt;</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0-&gt;1</title>
<path fill="none" stroke="black" d="M146,-201.21C146,-194.99 146,-184.9 146,-176.14"/>
<polygon fill="black" stroke="black" points="149.5,-176.35 146,-166.35 142.5,-176.35 149.5,-176.35"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="93" y="-101.45" font-family="Times,serif" font-size="14.00">&lt;expr&gt;</text>
</g>
<!-- 1&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>1-&gt;2</title>
<path fill="none" stroke="black" d="M139.5,-150.96C131.71,-143.87 118.41,-131.76 108.03,-122.31"/>
<polygon fill="black" stroke="black" points="110.42,-119.75 100.67,-115.61 105.71,-124.93 110.42,-119.75"/>
</g>
<!-- 6 -->
<g id="node7" class="node">
<title>6</title>
<text text-anchor="middle" x="146" y="-101.45" font-family="Times,serif" font-size="14.00"> + </text>
</g>
<!-- 1&#45;&gt;6 -->
<g id="edge6" class="edge">
<title>1-&gt;6</title>
<path fill="none" stroke="black" d="M146,-150.96C146,-144.74 146,-134.65 146,-125.89"/>
<polygon fill="black" stroke="black" points="149.5,-126.1 146,-116.1 142.5,-126.1 149.5,-126.1"/>
</g>
<!-- 7 -->
<g id="node8" class="node">
<title>7</title>
<text text-anchor="middle" x="197" y="-101.45" font-family="Times,serif" font-size="14.00">&lt;term&gt;</text>
</g>
<!-- 1&#45;&gt;7 -->
<g id="edge7" class="edge">
<title>1-&gt;7</title>
<path fill="none" stroke="black" d="M152.25,-150.96C159.75,-143.87 172.54,-131.76 182.54,-122.31"/>
<polygon fill="black" stroke="black" points="184.74,-125.04 189.6,-115.63 179.93,-119.96 184.74,-125.04"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="21" y="-51.2" font-family="Times,serif" font-size="14.00">&lt;term&gt;</text>
</g>
<!-- 2&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>2-&gt;3</title>
<path fill="none" stroke="black" d="M83.88,-100.51C72.68,-93 53.4,-80.09 39.13,-70.53"/>
<polygon fill="black" stroke="black" points="41.33,-67.79 31.08,-65.13 37.44,-73.6 41.33,-67.79"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="68" y="-51.2" font-family="Times,serif" font-size="14.00"> + </text>
</g>
<!-- 2&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>2-&gt;4</title>
<path fill="none" stroke="black" d="M89.93,-100.71C86.56,-94.2 80.99,-83.46 76.31,-74.42"/>
<polygon fill="black" stroke="black" points="79.5,-72.95 71.79,-65.68 73.28,-76.17 79.5,-72.95"/>
</g>
<!-- 5 -->
<g id="node6" class="node">
<title>5</title>
<text text-anchor="middle" x="114" y="-51.2" font-family="Times,serif" font-size="14.00">&lt;expr&gt;</text>
</g>
<!-- 2&#45;&gt;5 -->
<g id="edge5" class="edge">
<title>2-&gt;5</title>
<path fill="none" stroke="black" d="M95.58,-100.71C98.38,-94.27 102.98,-83.69 106.88,-74.72"/>
<polygon fill="black" stroke="black" points="110.02,-76.29 110.8,-65.73 103.6,-73.5 110.02,-76.29"/>
</g>
<!-- 8 -->
<g id="node9" class="node">
<title>8</title>
<text text-anchor="middle" x="176" y="-51.2" font-family="Times,serif" font-size="14.00">&lt;factor&gt;</text>
</g>
<!-- 7&#45;&gt;8 -->
<g id="edge8" class="edge">
<title>7-&gt;8</title>
<path fill="none" stroke="black" d="M194.42,-100.71C191.62,-94.27 187.02,-83.69 183.12,-74.72"/>
<polygon fill="black" stroke="black" points="186.4,-73.5 179.2,-65.73 179.98,-76.29 186.4,-73.5"/>
</g>
<!-- 11 -->
<g id="node12" class="node">
<title>11</title>
<text text-anchor="middle" x="225" y="-51.2" font-family="Times,serif" font-size="14.00"> * </text>
</g>
<!-- 7&#45;&gt;11 -->
<g id="edge11" class="edge">
<title>7-&gt;11</title>
<path fill="none" stroke="black" d="M200.43,-100.71C204.25,-94.12 210.58,-83.22 215.86,-74.12"/>
<polygon fill="black" stroke="black" points="218.79,-76.05 220.78,-65.65 212.73,-72.54 218.79,-76.05"/>
</g>
<!-- 12 -->
<g id="node13" class="node">
<title>12</title>
<text text-anchor="middle" x="271" y="-51.2" font-family="Times,serif" font-size="14.00">&lt;term&gt;</text>
</g>
<!-- 7&#45;&gt;12 -->
<g id="edge12" class="edge">
<title>7-&gt;12</title>
<path fill="none" stroke="black" d="M206.37,-100.51C217.89,-93 237.7,-80.09 252.36,-70.53"/>
<polygon fill="black" stroke="black" points="254.2,-73.51 260.67,-65.11 250.38,-67.64 254.2,-73.51"/>
</g>
<!-- 9 -->
<g id="node10" class="node">
<title>9</title>
<text text-anchor="middle" x="147" y="-0.95" font-family="Times,serif" font-size="14.00">- (45)</text>
</g>
<!-- 8&#45;&gt;9 -->
<g id="edge9" class="edge">
<title>8-&gt;9</title>
<path fill="none" stroke="black" d="M172.44,-50.46C168.49,-43.87 161.93,-32.97 156.46,-23.87"/>
<polygon fill="black" stroke="black" points="159.52,-22.16 151.36,-15.39 153.52,-25.76 159.52,-22.16"/>
</g>
<!-- 10 -->
<g id="node11" class="node">
<title>10</title>
<text text-anchor="middle" x="204" y="-0.95" font-family="Times,serif" font-size="14.00">&lt;factor&gt;</text>
</g>
<!-- 8&#45;&gt;10 -->
<g id="edge10" class="edge">
<title>8-&gt;10</title>
<path fill="none" stroke="black" d="M179.43,-50.46C183.25,-43.87 189.58,-32.97 194.86,-23.87"/>
<polygon fill="black" stroke="black" points="197.79,-25.8 199.78,-15.4 191.73,-22.29 197.79,-25.8"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We see that with each step, the number of nonterminals increases.  Obviously, we have to put a limit on this number.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Three-Expansion-Phases">Three Expansion Phases</h2><p>We can now put all three phases together in a single function <code>expand_tree()</code> which will work as follows:</p>
<ol>
<li><strong>Max cost expansion.</strong> Expand the tree using expansions with maximum cost until we have at least <code>min_nonterminals</code> nonterminals.  This phase can be easily skipped by setting <code>min_nonterminals</code> to zero.</li>
<li><strong>Random expansion.</strong>  Keep on expanding the tree randomly until we reach <code>max_nonterminals</code> nonterminals.</li>
<li><strong>Min cost expansion.</strong> Close the expansion with minimum cost.</li>
</ol>
<p>We implement these three phases by having <code>expand_node</code> reference the expansion method to apply.  This is controlled by setting <code>expand_node</code> (the method reference) to first <code>expand_node_max_cost</code> (i.e., calling <code>expand_node()</code> invokes <code>expand_node_max_cost()</code>), then <code>expand_node_randomly</code>, and finally <code>expand_node_min_cost</code>.  In the first two phases, we also set a maximum limit of <code>min_nonterminals</code> and <code>max_nonterminals</code>, respectively.</p>
</div>
</div>
</div>
</div>

<details id="Excursion:-Implementation-of-three-phase-expand_tree()">
<summary>Implementation of three-phase <code>expand_tree()</code></summary>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">GrammarFuzzer</span><span class="p">(</span><span class="n">GrammarFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">log_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">:</span> <span class="n">DerivationTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Output a tree if self.log is set; if self.display is also set, show the tree structure"""</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">"Tree:"</span><span class="p">,</span> <span class="n">all_terminals</span><span class="p">(</span><span class="n">tree</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">disp</span><span class="p">:</span>
                <span class="n">display</span><span class="p">(</span><span class="n">display_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">))</span>
            <span class="c1"># print(self.possible_expansions(tree), "possible expansion(s) left")</span>

    <span class="k">def</span> <span class="nf">expand_tree_with_strategy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">:</span> <span class="n">DerivationTree</span><span class="p">,</span>
                                  <span class="n">expand_node_method</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
                                  <span class="n">limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Expand tree using `expand_node_method` as node expansion function</span>
<span class="sd">        until the number of possible expansions reaches `limit`."""</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expand_node</span> <span class="o">=</span> <span class="n">expand_node_method</span>
        <span class="k">while</span> <span class="p">((</span><span class="n">limit</span> <span class="ow">is</span> <span class="kc">None</span>
                <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">possible_expansions</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">limit</span><span class="p">)</span>
               <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">any_possible_expansions</span><span class="p">(</span><span class="n">tree</span><span class="p">)):</span>
            <span class="n">tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_tree_once</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tree</span>

    <span class="k">def</span> <span class="nf">expand_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">:</span> <span class="n">DerivationTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DerivationTree</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Expand `tree` in a three-phase strategy until all expansions are complete."""</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_tree_with_strategy</span><span class="p">(</span>
            <span class="n">tree</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_node_max_cost</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_nonterminals</span><span class="p">)</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_tree_with_strategy</span><span class="p">(</span>
            <span class="n">tree</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_node_randomly</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_nonterminals</span><span class="p">)</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_tree_with_strategy</span><span class="p">(</span>
            <span class="n">tree</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_node_min_cost</span><span class="p">)</span>

        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">possible_expansions</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>

        <span class="k">return</span> <span class="n">tree</span>
</pre></div>

</div>
</div></div>
</div>
</div>

</details>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let us try this out on our example. We start with a half-expanded derivation tree:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">initial_derivation_tree</span><span class="p">:</span> <span class="n">DerivationTree</span> <span class="o">=</span> <span class="p">(</span><span class="s2">"&lt;start&gt;"</span><span class="p">,</span>
                   <span class="p">[(</span><span class="s2">"&lt;expr&gt;"</span><span class="p">,</span>
                     <span class="p">[(</span><span class="s2">"&lt;expr&gt;"</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                      <span class="p">(</span><span class="s2">" + "</span><span class="p">,</span> <span class="p">[]),</span>
                         <span class="p">(</span><span class="s2">"&lt;term&gt;"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)]</span>
                     <span class="p">)])</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">display_tree</span><span class="p">(</span><span class="n">initial_derivation_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_svg output_subarea output_execute_result">


<!-- Generated by graphviz version 12.2.1 (20241206.2353)
 -->
<!-- Pages: 1 -->
<svg width="142pt" height="123pt" viewbox="0.00 0.00 142.25 122.75" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 118.75)">
<polygon fill="white" stroke="none" points="-4,4 -4,-118.75 138.25,-118.75 138.25,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="66.25" y="-101.45" font-family="Times,serif" font-size="14.00">&lt;start&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="66.25" y="-51.2" font-family="Times,serif" font-size="14.00">&lt;expr&gt;</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0-&gt;1</title>
<path fill="none" stroke="black" d="M66.25,-100.71C66.25,-94.49 66.25,-84.4 66.25,-75.64"/>
<polygon fill="black" stroke="black" points="69.75,-75.85 66.25,-65.85 62.75,-75.85 69.75,-75.85"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="20.25" y="-0.95" font-family="Times,serif" font-size="14.00">&lt;expr&gt;</text>
</g>
<!-- 1&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>1-&gt;2</title>
<path fill="none" stroke="black" d="M60.61,-50.46C53.99,-43.51 42.78,-31.75 33.85,-22.39"/>
<polygon fill="black" stroke="black" points="36.41,-20.01 26.98,-15.19 31.35,-24.84 36.41,-20.01"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="66.25" y="-0.95" font-family="Times,serif" font-size="14.00"> + </text>
</g>
<!-- 1&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>1-&gt;3</title>
<path fill="none" stroke="black" d="M66.25,-50.46C66.25,-44.24 66.25,-34.15 66.25,-25.39"/>
<polygon fill="black" stroke="black" points="69.75,-25.6 66.25,-15.6 62.75,-25.6 69.75,-25.6"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="113.25" y="-0.95" font-family="Times,serif" font-size="14.00">&lt;term&gt;</text>
</g>
<!-- 1&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>1-&gt;4</title>
<path fill="none" stroke="black" d="M72.01,-50.46C78.85,-43.44 90.47,-31.51 99.64,-22.1"/>
<polygon fill="black" stroke="black" points="101.91,-24.78 106.38,-15.17 96.9,-19.9 101.91,-24.78"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We now apply our expansion strategy on this tree.  We see that initially, nodes are expanded at maximum cost, then randomly, and then closing the expansion at minimum cost.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">f</span> <span class="o">=</span> <span class="n">GrammarFuzzer</span><span class="p">(</span>
    <span class="n">EXPR_GRAMMAR</span><span class="p">,</span>
    <span class="n">min_nonterminals</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">max_nonterminals</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">derivation_tree</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">expand_tree</span><span class="p">(</span><span class="n">initial_derivation_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Tree: &lt;expr&gt; + &lt;term&gt;
Expanding &lt;expr&gt; at maximum cost
Tree: &lt;term&gt; + &lt;expr&gt; + &lt;term&gt;
Expanding &lt;expr&gt; randomly
Tree: &lt;term&gt; + &lt;term&gt; + &lt;term&gt;
Expanding &lt;term&gt; randomly
Tree: &lt;factor&gt; / &lt;term&gt; + &lt;term&gt; + &lt;term&gt;
Expanding &lt;term&gt; randomly
Tree: &lt;factor&gt; / &lt;factor&gt; + &lt;term&gt; + &lt;term&gt;
Expanding &lt;factor&gt; randomly
Tree: &lt;integer&gt; / &lt;factor&gt; + &lt;term&gt; + &lt;term&gt;
Expanding &lt;term&gt; randomly
Tree: &lt;integer&gt; / &lt;factor&gt; + &lt;factor&gt; * &lt;term&gt; + &lt;term&gt;
Expanding &lt;factor&gt; at minimum cost
Tree: &lt;integer&gt; / &lt;integer&gt; + &lt;factor&gt; * &lt;term&gt; + &lt;term&gt;
Expanding &lt;integer&gt; at minimum cost
Tree: &lt;integer&gt; / &lt;digit&gt; + &lt;factor&gt; * &lt;term&gt; + &lt;term&gt;
Expanding &lt;factor&gt; at minimum cost
Tree: &lt;integer&gt; / &lt;digit&gt; + &lt;integer&gt; * &lt;term&gt; + &lt;term&gt;
Expanding &lt;integer&gt; at minimum cost
Tree: &lt;digit&gt; / &lt;digit&gt; + &lt;integer&gt; * &lt;term&gt; + &lt;term&gt;
Expanding &lt;term&gt; at minimum cost
Tree: &lt;digit&gt; / &lt;digit&gt; + &lt;integer&gt; * &lt;term&gt; + &lt;factor&gt;
Expanding &lt;digit&gt; at minimum cost
Tree: &lt;digit&gt; / 5 + &lt;integer&gt; * &lt;term&gt; + &lt;factor&gt;
Expanding &lt;factor&gt; at minimum cost
Tree: &lt;digit&gt; / 5 + &lt;integer&gt; * &lt;term&gt; + &lt;integer&gt;
Expanding &lt;integer&gt; at minimum cost
Tree: &lt;digit&gt; / 5 + &lt;integer&gt; * &lt;term&gt; + &lt;digit&gt;
Expanding &lt;integer&gt; at minimum cost
Tree: &lt;digit&gt; / 5 + &lt;digit&gt; * &lt;term&gt; + &lt;digit&gt;
Expanding &lt;digit&gt; at minimum cost
Tree: 7 / 5 + &lt;digit&gt; * &lt;term&gt; + &lt;digit&gt;
Expanding &lt;digit&gt; at minimum cost
Tree: 7 / 5 + &lt;digit&gt; * &lt;term&gt; + 0
Expanding &lt;term&gt; at minimum cost
Tree: 7 / 5 + &lt;digit&gt; * &lt;factor&gt; + 0
Expanding &lt;factor&gt; at minimum cost
Tree: 7 / 5 + &lt;digit&gt; * &lt;integer&gt; + 0
Expanding &lt;integer&gt; at minimum cost
Tree: 7 / 5 + &lt;digit&gt; * &lt;digit&gt; + 0
Expanding &lt;digit&gt; at minimum cost
Tree: 7 / 5 + 4 * &lt;digit&gt; + 0
Expanding &lt;digit&gt; at minimum cost
Tree: 7 / 5 + 4 * 2 + 0
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>This is the final derivation tree:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">display_tree</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_svg output_subarea output_execute_result">


<!-- Generated by graphviz version 12.2.1 (20241206.2353)
 -->
<!-- Pages: 1 -->
<svg width="360pt" height="475pt" viewbox="0.00 0.00 359.62 474.50" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 470.5)">
<polygon fill="white" stroke="none" points="-4,4 -4,-470.5 355.62,-470.5 355.62,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="236" y="-453.2" font-family="Times,serif" font-size="14.00">&lt;start&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="236" y="-402.95" font-family="Times,serif" font-size="14.00">&lt;expr&gt;</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0-&gt;1</title>
<path fill="none" stroke="black" d="M236,-452.46C236,-446.24 236,-436.15 236,-427.39"/>
<polygon fill="black" stroke="black" points="239.5,-427.6 236,-417.6 232.5,-427.6 239.5,-427.6"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="186" y="-352.7" font-family="Times,serif" font-size="14.00">&lt;expr&gt;</text>
</g>
<!-- 1&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>1-&gt;2</title>
<path fill="none" stroke="black" d="M229.87,-402.21C222.52,-395.12 209.98,-383.01 200.18,-373.56"/>
<polygon fill="black" stroke="black" points="202.9,-371.32 193.27,-366.89 198.04,-376.35 202.9,-371.32"/>
</g>
<!-- 27 -->
<g id="node28" class="node">
<title>27</title>
<text text-anchor="middle" x="236" y="-352.7" font-family="Times,serif" font-size="14.00"> + </text>
</g>
<!-- 1&#45;&gt;27 -->
<g id="edge27" class="edge">
<title>1-&gt;27</title>
<path fill="none" stroke="black" d="M236,-402.21C236,-395.99 236,-385.9 236,-377.14"/>
<polygon fill="black" stroke="black" points="239.5,-377.35 236,-367.35 232.5,-377.35 239.5,-377.35"/>
</g>
<!-- 28 -->
<g id="node29" class="node">
<title>28</title>
<text text-anchor="middle" x="285" y="-352.7" font-family="Times,serif" font-size="14.00">&lt;term&gt;</text>
</g>
<!-- 1&#45;&gt;28 -->
<g id="edge28" class="edge">
<title>1-&gt;28</title>
<path fill="none" stroke="black" d="M242.01,-402.21C249.14,-395.19 261.25,-383.26 270.81,-373.85"/>
<polygon fill="black" stroke="black" points="273.19,-376.41 277.86,-366.9 268.28,-371.42 273.19,-376.41"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="111" y="-302.45" font-family="Times,serif" font-size="14.00">&lt;term&gt;</text>
</g>
<!-- 2&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>2-&gt;3</title>
<path fill="none" stroke="black" d="M176.5,-351.76C164.72,-344.18 144.36,-331.08 129.46,-321.5"/>
<polygon fill="black" stroke="black" points="131.76,-318.82 121.46,-316.35 127.98,-324.71 131.76,-318.82"/>
</g>
<!-- 14 -->
<g id="node15" class="node">
<title>14</title>
<text text-anchor="middle" x="179" y="-302.45" font-family="Times,serif" font-size="14.00"> + </text>
</g>
<!-- 2&#45;&gt;14 -->
<g id="edge14" class="edge">
<title>2-&gt;14</title>
<path fill="none" stroke="black" d="M185.14,-351.96C184.24,-345.74 182.78,-335.65 181.5,-326.89"/>
<polygon fill="black" stroke="black" points="184.98,-326.48 180.08,-317.09 178.05,-327.49 184.98,-326.48"/>
</g>
<!-- 15 -->
<g id="node16" class="node">
<title>15</title>
<text text-anchor="middle" x="225" y="-302.45" font-family="Times,serif" font-size="14.00">&lt;expr&gt;</text>
</g>
<!-- 2&#45;&gt;15 -->
<g id="edge15" class="edge">
<title>2-&gt;15</title>
<path fill="none" stroke="black" d="M190.78,-351.96C196.28,-345.16 205.51,-333.74 212.99,-324.48"/>
<polygon fill="black" stroke="black" points="215.66,-326.74 219.23,-316.77 210.22,-322.34 215.66,-326.74"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="27" y="-252.2" font-family="Times,serif" font-size="14.00">&lt;factor&gt;</text>
</g>
<!-- 3&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>3-&gt;4</title>
<path fill="none" stroke="black" d="M100.36,-301.51C87.11,-293.9 64.17,-280.73 47.47,-271.13"/>
<polygon fill="black" stroke="black" points="49.28,-268.14 38.86,-266.19 45.79,-274.21 49.28,-268.14"/>
</g>
<!-- 8 -->
<g id="node9" class="node">
<title>8</title>
<text text-anchor="middle" x="75" y="-252.2" font-family="Times,serif" font-size="14.00"> / </text>
</g>
<!-- 3&#45;&gt;8 -->
<g id="edge8" class="edge">
<title>3-&gt;8</title>
<path fill="none" stroke="black" d="M106.59,-301.71C101.57,-294.98 93.17,-283.73 86.3,-274.52"/>
<polygon fill="black" stroke="black" points="89.14,-272.47 80.36,-266.55 83.53,-276.66 89.14,-272.47"/>
</g>
<!-- 9 -->
<g id="node10" class="node">
<title>9</title>
<text text-anchor="middle" x="120" y="-252.2" font-family="Times,serif" font-size="14.00">&lt;term&gt;</text>
</g>
<!-- 3&#45;&gt;9 -->
<g id="edge9" class="edge">
<title>3-&gt;9</title>
<path fill="none" stroke="black" d="M112.1,-301.71C113.26,-295.49 115.15,-285.4 116.78,-276.64"/>
<polygon fill="black" stroke="black" points="120.22,-277.3 118.61,-266.83 113.34,-276.02 120.22,-277.3"/>
</g>
<!-- 5 -->
<g id="node6" class="node">
<title>5</title>
<text text-anchor="middle" x="27" y="-201.95" font-family="Times,serif" font-size="14.00">&lt;integer&gt;</text>
</g>
<!-- 4&#45;&gt;5 -->
<g id="edge5" class="edge">
<title>4-&gt;5</title>
<path fill="none" stroke="black" d="M27,-251.46C27,-245.24 27,-235.15 27,-226.39"/>
<polygon fill="black" stroke="black" points="30.5,-226.6 27,-216.6 23.5,-226.6 30.5,-226.6"/>
</g>
<!-- 6 -->
<g id="node7" class="node">
<title>6</title>
<text text-anchor="middle" x="27" y="-151.7" font-family="Times,serif" font-size="14.00">&lt;digit&gt;</text>
</g>
<!-- 5&#45;&gt;6 -->
<g id="edge6" class="edge">
<title>5-&gt;6</title>
<path fill="none" stroke="black" d="M27,-201.21C27,-194.99 27,-184.9 27,-176.14"/>
<polygon fill="black" stroke="black" points="30.5,-176.35 27,-166.35 23.5,-176.35 30.5,-176.35"/>
</g>
<!-- 7 -->
<g id="node8" class="node">
<title>7</title>
<text text-anchor="middle" x="27" y="-101.45" font-family="Times,serif" font-size="14.00">7 (55)</text>
</g>
<!-- 6&#45;&gt;7 -->
<g id="edge7" class="edge">
<title>6-&gt;7</title>
<path fill="none" stroke="black" d="M27,-150.96C27,-144.74 27,-134.65 27,-125.89"/>
<polygon fill="black" stroke="black" points="30.5,-126.1 27,-116.1 23.5,-126.1 30.5,-126.1"/>
</g>
<!-- 10 -->
<g id="node11" class="node">
<title>10</title>
<text text-anchor="middle" x="107" y="-201.95" font-family="Times,serif" font-size="14.00">&lt;factor&gt;</text>
</g>
<!-- 9&#45;&gt;10 -->
<g id="edge10" class="edge">
<title>9-&gt;10</title>
<path fill="none" stroke="black" d="M118.41,-251.46C116.71,-245.16 113.95,-234.92 111.57,-226.08"/>
<polygon fill="black" stroke="black" points="114.98,-225.3 109,-216.55 108.22,-227.12 114.98,-225.3"/>
</g>
<!-- 11 -->
<g id="node12" class="node">
<title>11</title>
<text text-anchor="middle" x="106" y="-151.7" font-family="Times,serif" font-size="14.00">&lt;integer&gt;</text>
</g>
<!-- 10&#45;&gt;11 -->
<g id="edge11" class="edge">
<title>10-&gt;11</title>
<path fill="none" stroke="black" d="M106.88,-201.21C106.75,-194.99 106.54,-184.9 106.36,-176.14"/>
<polygon fill="black" stroke="black" points="109.86,-176.28 106.15,-166.35 102.86,-176.42 109.86,-176.28"/>
</g>
<!-- 12 -->
<g id="node13" class="node">
<title>12</title>
<text text-anchor="middle" x="106" y="-101.45" font-family="Times,serif" font-size="14.00">&lt;digit&gt;</text>
</g>
<!-- 11&#45;&gt;12 -->
<g id="edge12" class="edge">
<title>11-&gt;12</title>
<path fill="none" stroke="black" d="M106,-150.96C106,-144.74 106,-134.65 106,-125.89"/>
<polygon fill="black" stroke="black" points="109.5,-126.1 106,-116.1 102.5,-126.1 109.5,-126.1"/>
</g>
<!-- 13 -->
<g id="node14" class="node">
<title>13</title>
<text text-anchor="middle" x="106" y="-51.2" font-family="Times,serif" font-size="14.00">5 (53)</text>
</g>
<!-- 12&#45;&gt;13 -->
<g id="edge13" class="edge">
<title>12-&gt;13</title>
<path fill="none" stroke="black" d="M106,-100.71C106,-94.49 106,-84.4 106,-75.64"/>
<polygon fill="black" stroke="black" points="109.5,-75.85 106,-65.85 102.5,-75.85 109.5,-75.85"/>
</g>
<!-- 16 -->
<g id="node17" class="node">
<title>16</title>
<text text-anchor="middle" x="225" y="-252.2" font-family="Times,serif" font-size="14.00">&lt;term&gt;</text>
</g>
<!-- 15&#45;&gt;16 -->
<g id="edge16" class="edge">
<title>15-&gt;16</title>
<path fill="none" stroke="black" d="M225,-301.71C225,-295.49 225,-285.4 225,-276.64"/>
<polygon fill="black" stroke="black" points="228.5,-276.85 225,-266.85 221.5,-276.85 228.5,-276.85"/>
</g>
<!-- 17 -->
<g id="node18" class="node">
<title>17</title>
<text text-anchor="middle" x="176" y="-201.95" font-family="Times,serif" font-size="14.00">&lt;factor&gt;</text>
</g>
<!-- 16&#45;&gt;17 -->
<g id="edge17" class="edge">
<title>16-&gt;17</title>
<path fill="none" stroke="black" d="M218.99,-251.46C211.86,-244.44 199.75,-232.51 190.19,-223.1"/>
<polygon fill="black" stroke="black" points="192.72,-220.67 183.14,-216.15 187.81,-225.66 192.72,-220.67"/>
</g>
<!-- 21 -->
<g id="node22" class="node">
<title>21</title>
<text text-anchor="middle" x="225" y="-201.95" font-family="Times,serif" font-size="14.00"> * </text>
</g>
<!-- 16&#45;&gt;21 -->
<g id="edge21" class="edge">
<title>16-&gt;21</title>
<path fill="none" stroke="black" d="M225,-251.46C225,-245.24 225,-235.15 225,-226.39"/>
<polygon fill="black" stroke="black" points="228.5,-226.6 225,-216.6 221.5,-226.6 228.5,-226.6"/>
</g>
<!-- 22 -->
<g id="node23" class="node">
<title>22</title>
<text text-anchor="middle" x="271" y="-201.95" font-family="Times,serif" font-size="14.00">&lt;term&gt;</text>
</g>
<!-- 16&#45;&gt;22 -->
<g id="edge22" class="edge">
<title>16-&gt;22</title>
<path fill="none" stroke="black" d="M230.64,-251.46C237.26,-244.51 248.47,-232.75 257.4,-223.39"/>
<polygon fill="black" stroke="black" points="259.9,-225.84 264.27,-216.19 254.84,-221.01 259.9,-225.84"/>
</g>
<!-- 18 -->
<g id="node19" class="node">
<title>18</title>
<text text-anchor="middle" x="178" y="-151.7" font-family="Times,serif" font-size="14.00">&lt;integer&gt;</text>
</g>
<!-- 17&#45;&gt;18 -->
<g id="edge18" class="edge">
<title>17-&gt;18</title>
<path fill="none" stroke="black" d="M176.25,-201.21C176.5,-194.99 176.92,-184.9 177.28,-176.14"/>
<polygon fill="black" stroke="black" points="180.77,-176.49 177.69,-166.35 173.78,-176.2 180.77,-176.49"/>
</g>
<!-- 19 -->
<g id="node20" class="node">
<title>19</title>
<text text-anchor="middle" x="178" y="-101.45" font-family="Times,serif" font-size="14.00">&lt;digit&gt;</text>
</g>
<!-- 18&#45;&gt;19 -->
<g id="edge19" class="edge">
<title>18-&gt;19</title>
<path fill="none" stroke="black" d="M178,-150.96C178,-144.74 178,-134.65 178,-125.89"/>
<polygon fill="black" stroke="black" points="181.5,-126.1 178,-116.1 174.5,-126.1 181.5,-126.1"/>
</g>
<!-- 20 -->
<g id="node21" class="node">
<title>20</title>
<text text-anchor="middle" x="178" y="-51.2" font-family="Times,serif" font-size="14.00">4 (52)</text>
</g>
<!-- 19&#45;&gt;20 -->
<g id="edge20" class="edge">
<title>19-&gt;20</title>
<path fill="none" stroke="black" d="M178,-100.71C178,-94.49 178,-84.4 178,-75.64"/>
<polygon fill="black" stroke="black" points="181.5,-75.85 178,-65.85 174.5,-75.85 181.5,-75.85"/>
</g>
<!-- 23 -->
<g id="node24" class="node">
<title>23</title>
<text text-anchor="middle" x="271" y="-151.7" font-family="Times,serif" font-size="14.00">&lt;factor&gt;</text>
</g>
<!-- 22&#45;&gt;23 -->
<g id="edge23" class="edge">
<title>22-&gt;23</title>
<path fill="none" stroke="black" d="M271,-201.21C271,-194.99 271,-184.9 271,-176.14"/>
<polygon fill="black" stroke="black" points="274.5,-176.35 271,-166.35 267.5,-176.35 274.5,-176.35"/>
</g>
<!-- 24 -->
<g id="node25" class="node">
<title>24</title>
<text text-anchor="middle" x="271" y="-101.45" font-family="Times,serif" font-size="14.00">&lt;integer&gt;</text>
</g>
<!-- 23&#45;&gt;24 -->
<g id="edge24" class="edge">
<title>23-&gt;24</title>
<path fill="none" stroke="black" d="M271,-150.96C271,-144.74 271,-134.65 271,-125.89"/>
<polygon fill="black" stroke="black" points="274.5,-126.1 271,-116.1 267.5,-126.1 274.5,-126.1"/>
</g>
<!-- 25 -->
<g id="node26" class="node">
<title>25</title>
<text text-anchor="middle" x="271" y="-51.2" font-family="Times,serif" font-size="14.00">&lt;digit&gt;</text>
</g>
<!-- 24&#45;&gt;25 -->
<g id="edge25" class="edge">
<title>24-&gt;25</title>
<path fill="none" stroke="black" d="M271,-100.71C271,-94.49 271,-84.4 271,-75.64"/>
<polygon fill="black" stroke="black" points="274.5,-75.85 271,-65.85 267.5,-75.85 274.5,-75.85"/>
</g>
<!-- 26 -->
<g id="node27" class="node">
<title>26</title>
<text text-anchor="middle" x="271" y="-0.95" font-family="Times,serif" font-size="14.00">2 (50)</text>
</g>
<!-- 25&#45;&gt;26 -->
<g id="edge26" class="edge">
<title>25-&gt;26</title>
<path fill="none" stroke="black" d="M271,-50.46C271,-44.24 271,-34.15 271,-25.39"/>
<polygon fill="black" stroke="black" points="274.5,-25.6 271,-15.6 267.5,-25.6 274.5,-25.6"/>
</g>
<!-- 29 -->
<g id="node30" class="node">
<title>29</title>
<text text-anchor="middle" x="289" y="-302.45" font-family="Times,serif" font-size="14.00">&lt;factor&gt;</text>
</g>
<!-- 28&#45;&gt;29 -->
<g id="edge29" class="edge">
<title>28-&gt;29</title>
<path fill="none" stroke="black" d="M285.49,-351.96C286.01,-345.74 286.84,-335.65 287.57,-326.89"/>
<polygon fill="black" stroke="black" points="291.04,-327.35 288.38,-317.1 284.07,-326.77 291.04,-327.35"/>
</g>
<!-- 30 -->
<g id="node31" class="node">
<title>30</title>
<text text-anchor="middle" x="311" y="-252.2" font-family="Times,serif" font-size="14.00">&lt;integer&gt;</text>
</g>
<!-- 29&#45;&gt;30 -->
<g id="edge30" class="edge">
<title>29-&gt;30</title>
<path fill="none" stroke="black" d="M291.7,-301.71C294.63,-295.27 299.46,-284.69 303.55,-275.72"/>
<polygon fill="black" stroke="black" points="306.69,-277.27 307.65,-266.72 300.32,-274.36 306.69,-277.27"/>
</g>
<!-- 31 -->
<g id="node32" class="node">
<title>31</title>
<text text-anchor="middle" x="331" y="-201.95" font-family="Times,serif" font-size="14.00">&lt;digit&gt;</text>
</g>
<!-- 30&#45;&gt;31 -->
<g id="edge31" class="edge">
<title>30-&gt;31</title>
<path fill="none" stroke="black" d="M313.45,-251.46C316.12,-245.02 320.51,-234.44 324.22,-225.47"/>
<polygon fill="black" stroke="black" points="327.35,-227.07 327.95,-216.49 320.89,-224.39 327.35,-227.07"/>
</g>
<!-- 32 -->
<g id="node33" class="node">
<title>32</title>
<text text-anchor="middle" x="331" y="-151.7" font-family="Times,serif" font-size="14.00">0 (48)</text>
</g>
<!-- 31&#45;&gt;32 -->
<g id="edge32" class="edge">
<title>31-&gt;32</title>
<path fill="none" stroke="black" d="M331,-201.21C331,-194.99 331,-184.9 331,-176.14"/>
<polygon fill="black" stroke="black" points="334.5,-176.35 331,-166.35 327.5,-176.35 334.5,-176.35"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>And this is the resulting string:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">all_terminals</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>'7 / 5 + 4 * 2 + 0'
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Putting-it-all-Together">Putting it all Together</h2></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Based on this, we can now define a function <code>fuzz()</code> that – like <code>simple_grammar_fuzzer()</code> – simply takes a grammar and produces a string from it.  It thus no longer exposes the complexity of derivation trees.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">GrammarFuzzer</span><span class="p">(</span><span class="n">GrammarFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">fuzz_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DerivationTree</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Produce a derivation tree from the grammar."""</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_tree</span><span class="p">()</span>
        <span class="c1"># print(tree)</span>

        <span class="c1"># Expand all nonterminals</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">all_terminals</span><span class="p">(</span><span class="n">tree</span><span class="p">)))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">disp</span><span class="p">:</span>
            <span class="n">display</span><span class="p">(</span><span class="n">display_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">tree</span>

    <span class="k">def</span> <span class="nf">fuzz</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Produce a string from the grammar."""</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">derivation_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fuzz_tree</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">all_terminals</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">derivation_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We can now apply this on all our defined grammars (and visualize the derivation tree along)</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">f</span> <span class="o">=</span> <span class="n">GrammarFuzzer</span><span class="p">(</span><span class="n">EXPR_GRAMMAR</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>'18.3 * 21.95 / 0'
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>After calling <code>fuzz()</code>, the produced derivation tree is accessible in the <code>derivation_tree</code> attribute:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">display_tree</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">derivation_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_svg output_subarea output_execute_result">


<!-- Generated by graphviz version 12.2.1 (20241206.2353)
 -->
<!-- Pages: 1 -->
<svg width="518pt" height="424pt" viewbox="0.00 0.00 517.62 424.25" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 420.25)">
<polygon fill="white" stroke="none" points="-4,4 -4,-420.25 513.62,-420.25 513.62,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="274.62" y="-402.95" font-family="Times,serif" font-size="14.00">&lt;start&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="274.62" y="-352.7" font-family="Times,serif" font-size="14.00">&lt;expr&gt;</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0-&gt;1</title>
<path fill="none" stroke="black" d="M274.62,-402.21C274.62,-395.99 274.62,-385.9 274.62,-377.14"/>
<polygon fill="black" stroke="black" points="278.13,-377.35 274.63,-367.35 271.13,-377.35 278.13,-377.35"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="274.62" y="-302.45" font-family="Times,serif" font-size="14.00">&lt;term&gt;</text>
</g>
<!-- 1&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>1-&gt;2</title>
<path fill="none" stroke="black" d="M274.62,-351.96C274.62,-345.74 274.62,-335.65 274.62,-326.89"/>
<polygon fill="black" stroke="black" points="278.13,-327.1 274.63,-317.1 271.13,-327.1 278.13,-327.1"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="160.62" y="-252.2" font-family="Times,serif" font-size="14.00">&lt;factor&gt;</text>
</g>
<!-- 2&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>2-&gt;3</title>
<path fill="none" stroke="black" d="M260.19,-301.51C241.43,-293.57 208.38,-279.59 185.53,-269.92"/>
<polygon fill="black" stroke="black" points="186.91,-266.7 176.34,-266.03 184.18,-273.15 186.91,-266.7"/>
</g>
<!-- 14 -->
<g id="node15" class="node">
<title>14</title>
<text text-anchor="middle" x="274.62" y="-252.2" font-family="Times,serif" font-size="14.00"> * </text>
</g>
<!-- 2&#45;&gt;14 -->
<g id="edge14" class="edge">
<title>2-&gt;14</title>
<path fill="none" stroke="black" d="M274.62,-301.71C274.62,-295.49 274.62,-285.4 274.62,-276.64"/>
<polygon fill="black" stroke="black" points="278.13,-276.85 274.63,-266.85 271.13,-276.85 278.13,-276.85"/>
</g>
<!-- 15 -->
<g id="node16" class="node">
<title>15</title>
<text text-anchor="middle" x="335.62" y="-252.2" font-family="Times,serif" font-size="14.00">&lt;term&gt;</text>
</g>
<!-- 2&#45;&gt;15 -->
<g id="edge15" class="edge">
<title>2-&gt;15</title>
<path fill="none" stroke="black" d="M282.35,-301.51C291.57,-294.22 307.23,-281.83 319.2,-272.37"/>
<polygon fill="black" stroke="black" points="321.29,-275.17 326.97,-266.22 316.95,-269.68 321.29,-275.17"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="70.62" y="-201.95" font-family="Times,serif" font-size="14.00">&lt;integer&gt;</text>
</g>
<!-- 3&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>3-&gt;4</title>
<path fill="none" stroke="black" d="M149.23,-251.26C134.89,-243.58 109.98,-230.22 92.04,-220.61"/>
<polygon fill="black" stroke="black" points="93.73,-217.54 83.26,-215.9 90.42,-223.71 93.73,-217.54"/>
</g>
<!-- 10 -->
<g id="node11" class="node">
<title>10</title>
<text text-anchor="middle" x="130.62" y="-201.95" font-family="Times,serif" font-size="14.00">. (46)</text>
</g>
<!-- 3&#45;&gt;10 -->
<g id="edge10" class="edge">
<title>3-&gt;10</title>
<path fill="none" stroke="black" d="M156.95,-251.46C152.81,-244.8 145.92,-233.73 140.23,-224.57"/>
<polygon fill="black" stroke="black" points="143.39,-223.02 135.13,-216.38 137.44,-226.72 143.39,-223.02"/>
</g>
<!-- 11 -->
<g id="node12" class="node">
<title>11</title>
<text text-anchor="middle" x="190.62" y="-201.95" font-family="Times,serif" font-size="14.00">&lt;integer&gt;</text>
</g>
<!-- 3&#45;&gt;11 -->
<g id="edge11" class="edge">
<title>3-&gt;11</title>
<path fill="none" stroke="black" d="M164.3,-251.46C168.44,-244.8 175.33,-233.73 181.02,-224.57"/>
<polygon fill="black" stroke="black" points="183.81,-226.72 186.12,-216.38 177.86,-223.02 183.81,-226.72"/>
</g>
<!-- 5 -->
<g id="node6" class="node">
<title>5</title>
<text text-anchor="middle" x="20.62" y="-151.7" font-family="Times,serif" font-size="14.00">&lt;digit&gt;</text>
</g>
<!-- 4&#45;&gt;5 -->
<g id="edge5" class="edge">
<title>4-&gt;5</title>
<path fill="none" stroke="black" d="M64.49,-201.21C57.15,-194.12 44.6,-182.01 34.8,-172.56"/>
<polygon fill="black" stroke="black" points="37.52,-170.32 27.9,-165.89 32.66,-175.35 37.52,-170.32"/>
</g>
<!-- 7 -->
<g id="node8" class="node">
<title>7</title>
<text text-anchor="middle" x="86.62" y="-151.7" font-family="Times,serif" font-size="14.00">&lt;integer&gt;</text>
</g>
<!-- 4&#45;&gt;7 -->
<g id="edge7" class="edge">
<title>4-&gt;7</title>
<path fill="none" stroke="black" d="M72.59,-201.21C74.7,-194.84 78.15,-184.43 81.1,-175.53"/>
<polygon fill="black" stroke="black" points="84.35,-176.87 84.17,-166.28 77.7,-174.67 84.35,-176.87"/>
</g>
<!-- 6 -->
<g id="node7" class="node">
<title>6</title>
<text text-anchor="middle" x="20.62" y="-101.45" font-family="Times,serif" font-size="14.00">1 (49)</text>
</g>
<!-- 5&#45;&gt;6 -->
<g id="edge6" class="edge">
<title>5-&gt;6</title>
<path fill="none" stroke="black" d="M20.62,-150.96C20.62,-144.74 20.62,-134.65 20.62,-125.89"/>
<polygon fill="black" stroke="black" points="24.13,-126.1 20.63,-116.1 17.13,-126.1 24.13,-126.1"/>
</g>
<!-- 8 -->
<g id="node9" class="node">
<title>8</title>
<text text-anchor="middle" x="86.62" y="-101.45" font-family="Times,serif" font-size="14.00">&lt;digit&gt;</text>
</g>
<!-- 7&#45;&gt;8 -->
<g id="edge8" class="edge">
<title>7-&gt;8</title>
<path fill="none" stroke="black" d="M86.62,-150.96C86.62,-144.74 86.62,-134.65 86.62,-125.89"/>
<polygon fill="black" stroke="black" points="90.13,-126.1 86.63,-116.1 83.13,-126.1 90.13,-126.1"/>
</g>
<!-- 9 -->
<g id="node10" class="node">
<title>9</title>
<text text-anchor="middle" x="86.62" y="-51.2" font-family="Times,serif" font-size="14.00">8 (56)</text>
</g>
<!-- 8&#45;&gt;9 -->
<g id="edge9" class="edge">
<title>8-&gt;9</title>
<path fill="none" stroke="black" d="M86.62,-100.71C86.62,-94.49 86.62,-84.4 86.62,-75.64"/>
<polygon fill="black" stroke="black" points="90.13,-75.85 86.63,-65.85 83.13,-75.85 90.13,-75.85"/>
</g>
<!-- 12 -->
<g id="node13" class="node">
<title>12</title>
<text text-anchor="middle" x="174.62" y="-151.7" font-family="Times,serif" font-size="14.00">&lt;digit&gt;</text>
</g>
<!-- 11&#45;&gt;12 -->
<g id="edge12" class="edge">
<title>11-&gt;12</title>
<path fill="none" stroke="black" d="M188.66,-201.21C186.55,-194.84 183.1,-184.43 180.15,-175.53"/>
<polygon fill="black" stroke="black" points="183.55,-174.67 177.08,-166.28 176.9,-176.87 183.55,-174.67"/>
</g>
<!-- 13 -->
<g id="node14" class="node">
<title>13</title>
<text text-anchor="middle" x="157.62" y="-101.45" font-family="Times,serif" font-size="14.00">3 (51)</text>
</g>
<!-- 12&#45;&gt;13 -->
<g id="edge13" class="edge">
<title>12-&gt;13</title>
<path fill="none" stroke="black" d="M172.54,-150.96C170.3,-144.59 166.63,-134.18 163.49,-125.28"/>
<polygon fill="black" stroke="black" points="166.85,-124.29 160.23,-116.02 160.25,-126.61 166.85,-124.29"/>
</g>
<!-- 16 -->
<g id="node17" class="node">
<title>16</title>
<text text-anchor="middle" x="311.62" y="-201.95" font-family="Times,serif" font-size="14.00">&lt;factor&gt;</text>
</g>
<!-- 15&#45;&gt;16 -->
<g id="edge16" class="edge">
<title>15-&gt;16</title>
<path fill="none" stroke="black" d="M332.68,-251.46C329.44,-244.95 324.1,-234.21 319.61,-225.17"/>
<polygon fill="black" stroke="black" points="322.85,-223.84 315.27,-216.44 316.59,-226.96 322.85,-223.84"/>
</g>
<!-- 30 -->
<g id="node31" class="node">
<title>30</title>
<text text-anchor="middle" x="359.62" y="-201.95" font-family="Times,serif" font-size="14.00"> / </text>
</g>
<!-- 15&#45;&gt;30 -->
<g id="edge30" class="edge">
<title>15-&gt;30</title>
<path fill="none" stroke="black" d="M338.57,-251.46C341.81,-244.95 347.15,-234.21 351.64,-225.17"/>
<polygon fill="black" stroke="black" points="354.66,-226.96 355.98,-216.44 348.4,-223.84 354.66,-226.96"/>
</g>
<!-- 31 -->
<g id="node32" class="node">
<title>31</title>
<text text-anchor="middle" x="422.62" y="-201.95" font-family="Times,serif" font-size="14.00">&lt;term&gt;</text>
</g>
<!-- 15&#45;&gt;31 -->
<g id="edge31" class="edge">
<title>15-&gt;31</title>
<path fill="none" stroke="black" d="M346.64,-251.26C360.5,-243.58 384.58,-230.22 401.92,-220.61"/>
<polygon fill="black" stroke="black" points="403.32,-223.83 410.37,-215.92 399.93,-217.71 403.32,-223.83"/>
</g>
<!-- 17 -->
<g id="node18" class="node">
<title>17</title>
<text text-anchor="middle" x="251.62" y="-151.7" font-family="Times,serif" font-size="14.00">&lt;integer&gt;</text>
</g>
<!-- 16&#45;&gt;17 -->
<g id="edge17" class="edge">
<title>16-&gt;17</title>
<path fill="none" stroke="black" d="M304.27,-201.21C295.27,-193.97 279.78,-181.52 267.92,-171.98"/>
<polygon fill="black" stroke="black" points="270.21,-169.33 260.22,-165.79 265.82,-174.78 270.21,-169.33"/>
</g>
<!-- 23 -->
<g id="node24" class="node">
<title>23</title>
<text text-anchor="middle" x="311.62" y="-151.7" font-family="Times,serif" font-size="14.00">. (46)</text>
</g>
<!-- 16&#45;&gt;23 -->
<g id="edge23" class="edge">
<title>16-&gt;23</title>
<path fill="none" stroke="black" d="M311.62,-201.21C311.62,-194.99 311.62,-184.9 311.62,-176.14"/>
<polygon fill="black" stroke="black" points="315.13,-176.35 311.63,-166.35 308.13,-176.35 315.13,-176.35"/>
</g>
<!-- 24 -->
<g id="node25" class="node">
<title>24</title>
<text text-anchor="middle" x="371.62" y="-151.7" font-family="Times,serif" font-size="14.00">&lt;integer&gt;</text>
</g>
<!-- 16&#45;&gt;24 -->
<g id="edge24" class="edge">
<title>16-&gt;24</title>
<path fill="none" stroke="black" d="M318.98,-201.21C327.98,-193.97 343.47,-181.52 355.33,-171.98"/>
<polygon fill="black" stroke="black" points="357.43,-174.78 363.03,-165.79 353.04,-169.33 357.43,-174.78"/>
</g>
<!-- 18 -->
<g id="node19" class="node">
<title>18</title>
<text text-anchor="middle" x="212.62" y="-101.45" font-family="Times,serif" font-size="14.00">&lt;digit&gt;</text>
</g>
<!-- 17&#45;&gt;18 -->
<g id="edge18" class="edge">
<title>17-&gt;18</title>
<path fill="none" stroke="black" d="M246.84,-150.96C241.35,-144.16 232.12,-132.74 224.63,-123.48"/>
<polygon fill="black" stroke="black" points="227.41,-121.34 218.4,-115.77 221.96,-125.74 227.41,-121.34"/>
</g>
<!-- 20 -->
<g id="node21" class="node">
<title>20</title>
<text text-anchor="middle" x="278.62" y="-101.45" font-family="Times,serif" font-size="14.00">&lt;integer&gt;</text>
</g>
<!-- 17&#45;&gt;20 -->
<g id="edge20" class="edge">
<title>17-&gt;20</title>
<path fill="none" stroke="black" d="M254.94,-150.96C258.62,-144.37 264.72,-133.47 269.81,-124.37"/>
<polygon fill="black" stroke="black" points="272.72,-126.35 274.55,-115.91 266.61,-122.93 272.72,-126.35"/>
</g>
<!-- 19 -->
<g id="node20" class="node">
<title>19</title>
<text text-anchor="middle" x="212.62" y="-51.2" font-family="Times,serif" font-size="14.00">2 (50)</text>
</g>
<!-- 18&#45;&gt;19 -->
<g id="edge19" class="edge">
<title>18-&gt;19</title>
<path fill="none" stroke="black" d="M212.62,-100.71C212.62,-94.49 212.62,-84.4 212.62,-75.64"/>
<polygon fill="black" stroke="black" points="216.13,-75.85 212.63,-65.85 209.13,-75.85 216.13,-75.85"/>
</g>
<!-- 21 -->
<g id="node22" class="node">
<title>21</title>
<text text-anchor="middle" x="278.62" y="-51.2" font-family="Times,serif" font-size="14.00">&lt;digit&gt;</text>
</g>
<!-- 20&#45;&gt;21 -->
<g id="edge21" class="edge">
<title>20-&gt;21</title>
<path fill="none" stroke="black" d="M278.62,-100.71C278.62,-94.49 278.62,-84.4 278.62,-75.64"/>
<polygon fill="black" stroke="black" points="282.13,-75.85 278.63,-65.85 275.13,-75.85 282.13,-75.85"/>
</g>
<!-- 22 -->
<g id="node23" class="node">
<title>22</title>
<text text-anchor="middle" x="278.62" y="-0.95" font-family="Times,serif" font-size="14.00">1 (49)</text>
</g>
<!-- 21&#45;&gt;22 -->
<g id="edge22" class="edge">
<title>21-&gt;22</title>
<path fill="none" stroke="black" d="M278.62,-50.46C278.62,-44.24 278.62,-34.15 278.62,-25.39"/>
<polygon fill="black" stroke="black" points="282.13,-25.6 278.63,-15.6 275.13,-25.6 282.13,-25.6"/>
</g>
<!-- 25 -->
<g id="node26" class="node">
<title>25</title>
<text text-anchor="middle" x="344.62" y="-101.45" font-family="Times,serif" font-size="14.00">&lt;digit&gt;</text>
</g>
<!-- 24&#45;&gt;25 -->
<g id="edge25" class="edge">
<title>24-&gt;25</title>
<path fill="none" stroke="black" d="M368.31,-150.96C364.63,-144.37 358.53,-133.47 353.44,-124.37"/>
<polygon fill="black" stroke="black" points="356.64,-122.93 348.7,-115.91 350.53,-126.35 356.64,-122.93"/>
</g>
<!-- 27 -->
<g id="node28" class="node">
<title>27</title>
<text text-anchor="middle" x="410.62" y="-101.45" font-family="Times,serif" font-size="14.00">&lt;integer&gt;</text>
</g>
<!-- 24&#45;&gt;27 -->
<g id="edge27" class="edge">
<title>24-&gt;27</title>
<path fill="none" stroke="black" d="M376.41,-150.96C381.9,-144.16 391.13,-132.74 398.62,-123.48"/>
<polygon fill="black" stroke="black" points="401.29,-125.74 404.85,-115.77 395.84,-121.34 401.29,-125.74"/>
</g>
<!-- 26 -->
<g id="node27" class="node">
<title>26</title>
<text text-anchor="middle" x="344.62" y="-51.2" font-family="Times,serif" font-size="14.00">9 (57)</text>
</g>
<!-- 25&#45;&gt;26 -->
<g id="edge26" class="edge">
<title>25-&gt;26</title>
<path fill="none" stroke="black" d="M344.62,-100.71C344.62,-94.49 344.62,-84.4 344.62,-75.64"/>
<polygon fill="black" stroke="black" points="348.13,-75.85 344.63,-65.85 341.13,-75.85 348.13,-75.85"/>
</g>
<!-- 28 -->
<g id="node29" class="node">
<title>28</title>
<text text-anchor="middle" x="410.62" y="-51.2" font-family="Times,serif" font-size="14.00">&lt;digit&gt;</text>
</g>
<!-- 27&#45;&gt;28 -->
<g id="edge28" class="edge">
<title>27-&gt;28</title>
<path fill="none" stroke="black" d="M410.62,-100.71C410.62,-94.49 410.62,-84.4 410.62,-75.64"/>
<polygon fill="black" stroke="black" points="414.13,-75.85 410.63,-65.85 407.13,-75.85 414.13,-75.85"/>
</g>
<!-- 29 -->
<g id="node30" class="node">
<title>29</title>
<text text-anchor="middle" x="410.62" y="-0.95" font-family="Times,serif" font-size="14.00">5 (53)</text>
</g>
<!-- 28&#45;&gt;29 -->
<g id="edge29" class="edge">
<title>28-&gt;29</title>
<path fill="none" stroke="black" d="M410.62,-50.46C410.62,-44.24 410.62,-34.15 410.62,-25.39"/>
<polygon fill="black" stroke="black" points="414.13,-25.6 410.63,-15.6 407.13,-25.6 414.13,-25.6"/>
</g>
<!-- 32 -->
<g id="node33" class="node">
<title>32</title>
<text text-anchor="middle" x="453.62" y="-151.7" font-family="Times,serif" font-size="14.00">&lt;factor&gt;</text>
</g>
<!-- 31&#45;&gt;32 -->
<g id="edge32" class="edge">
<title>31-&gt;32</title>
<path fill="none" stroke="black" d="M426.43,-201.21C430.7,-194.55 437.82,-183.48 443.7,-174.32"/>
<polygon fill="black" stroke="black" points="446.51,-176.42 448.97,-166.11 440.62,-172.63 446.51,-176.42"/>
</g>
<!-- 33 -->
<g id="node34" class="node">
<title>33</title>
<text text-anchor="middle" x="482.62" y="-101.45" font-family="Times,serif" font-size="14.00">&lt;integer&gt;</text>
</g>
<!-- 32&#45;&gt;33 -->
<g id="edge33" class="edge">
<title>32-&gt;33</title>
<path fill="none" stroke="black" d="M457.18,-150.96C461.14,-144.37 467.69,-133.47 473.16,-124.37"/>
<polygon fill="black" stroke="black" points="476.11,-126.26 478.26,-115.89 470.11,-122.66 476.11,-126.26"/>
</g>
<!-- 34 -->
<g id="node35" class="node">
<title>34</title>
<text text-anchor="middle" x="482.62" y="-51.2" font-family="Times,serif" font-size="14.00">&lt;digit&gt;</text>
</g>
<!-- 33&#45;&gt;34 -->
<g id="edge34" class="edge">
<title>33-&gt;34</title>
<path fill="none" stroke="black" d="M482.62,-100.71C482.62,-94.49 482.62,-84.4 482.62,-75.64"/>
<polygon fill="black" stroke="black" points="486.13,-75.85 482.63,-65.85 479.13,-75.85 486.13,-75.85"/>
</g>
<!-- 35 -->
<g id="node36" class="node">
<title>35</title>
<text text-anchor="middle" x="482.62" y="-0.95" font-family="Times,serif" font-size="14.00">0 (48)</text>
</g>
<!-- 34&#45;&gt;35 -->
<g id="edge35" class="edge">
<title>34-&gt;35</title>
<path fill="none" stroke="black" d="M482.62,-50.46C482.62,-44.24 482.62,-34.15 482.62,-25.39"/>
<polygon fill="black" stroke="black" points="486.13,-25.6 482.63,-15.6 479.13,-25.6 486.13,-25.6"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let us try out the grammar fuzzer (and its trees) on other grammar formats.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">f</span> <span class="o">=</span> <span class="n">GrammarFuzzer</span><span class="p">(</span><span class="n">URL_GRAMMAR</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>'ftp://user:password@www.google.com:53/def?abc=def'
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">display_tree</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">derivation_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_svg output_subarea output_execute_result">


<!-- Generated by graphviz version 12.2.1 (20241206.2353)
 -->
<!-- Pages: 1 -->
<svg width="573pt" height="324pt" viewbox="0.00 0.00 573.00 323.75" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 319.75)">
<polygon fill="white" stroke="none" points="-4,4 -4,-319.75 569,-319.75 569,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="214.5" y="-302.45" font-family="Times,serif" font-size="14.00">&lt;start&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="214.5" y="-252.2" font-family="Times,serif" font-size="14.00">&lt;url&gt;</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0-&gt;1</title>
<path fill="none" stroke="black" d="M214.5,-301.71C214.5,-295.49 214.5,-285.4 214.5,-276.64"/>
<polygon fill="black" stroke="black" points="218,-276.85 214.5,-266.85 211,-276.85 218,-276.85"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="69.5" y="-201.95" font-family="Times,serif" font-size="14.00">&lt;scheme&gt;</text>
</g>
<!-- 1&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>1-&gt;2</title>
<path fill="none" stroke="black" d="M198.98,-252.21C175.01,-244.24 128.59,-228.79 98.34,-218.72"/>
<polygon fill="black" stroke="black" points="99.65,-215.47 89.05,-215.63 97.44,-222.11 99.65,-215.47"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="158.5" y="-201.95" font-family="Times,serif" font-size="14.00">://</text>
</g>
<!-- 1&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>1-&gt;4</title>
<path fill="none" stroke="black" d="M207.63,-251.46C198.96,-243.98 183.82,-230.94 172.63,-221.3"/>
<polygon fill="black" stroke="black" points="175.08,-218.79 165.22,-214.92 170.51,-224.09 175.08,-218.79"/>
</g>
<!-- 5 -->
<g id="node6" class="node">
<title>5</title>
<text text-anchor="middle" x="214.5" y="-201.95" font-family="Times,serif" font-size="14.00">&lt;authority&gt;</text>
</g>
<!-- 1&#45;&gt;5 -->
<g id="edge5" class="edge">
<title>1-&gt;5</title>
<path fill="none" stroke="black" d="M214.5,-251.46C214.5,-245.24 214.5,-235.15 214.5,-226.39"/>
<polygon fill="black" stroke="black" points="218,-226.6 214.5,-216.6 211,-226.6 218,-226.6"/>
</g>
<!-- 18 -->
<g id="node19" class="node">
<title>18</title>
<text text-anchor="middle" x="345.5" y="-201.95" font-family="Times,serif" font-size="14.00">&lt;path&gt;</text>
</g>
<!-- 1&#45;&gt;18 -->
<g id="edge18" class="edge">
<title>1-&gt;18</title>
<path fill="none" stroke="black" d="M230.04,-251.65C251.87,-243.61 291.91,-228.87 318.62,-219.03"/>
<polygon fill="black" stroke="black" points="319.56,-222.41 327.74,-215.67 317.14,-215.84 319.56,-222.41"/>
</g>
<!-- 22 -->
<g id="node23" class="node">
<title>22</title>
<text text-anchor="middle" x="440.5" y="-201.95" font-family="Times,serif" font-size="14.00">&lt;query&gt;</text>
</g>
<!-- 1&#45;&gt;22 -->
<g id="edge22" class="edge">
<title>1-&gt;22</title>
<path fill="none" stroke="black" d="M230.03,-254.06C266.04,-246.37 355.93,-227.18 405.8,-216.53"/>
<polygon fill="black" stroke="black" points="406.44,-219.98 415.49,-214.46 404.98,-213.13 406.44,-219.98"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="7.5" y="-151.7" font-family="Times,serif" font-size="14.00">ftp</text>
</g>
<!-- 2&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>2-&gt;3</title>
<path fill="none" stroke="black" d="M61.65,-201.01C52.08,-193.57 35.69,-180.81 23.44,-171.28"/>
<polygon fill="black" stroke="black" points="25.95,-168.8 15.91,-165.42 21.65,-174.32 25.95,-168.8"/>
</g>
<!-- 6 -->
<g id="node7" class="node">
<title>6</title>
<text text-anchor="middle" x="63.5" y="-151.7" font-family="Times,serif" font-size="14.00">&lt;userinfo&gt;</text>
</g>
<!-- 5&#45;&gt;6 -->
<g id="edge6" class="edge">
<title>5-&gt;6</title>
<path fill="none" stroke="black" d="M195.38,-201.01C169.62,-192.78 123.53,-178.06 93.23,-168.38"/>
<polygon fill="black" stroke="black" points="94.5,-165.11 83.91,-165.4 92.37,-171.77 94.5,-165.11"/>
</g>
<!-- 8 -->
<g id="node9" class="node">
<title>8</title>
<text text-anchor="middle" x="131.5" y="-151.7" font-family="Times,serif" font-size="14.00">@ (64)</text>
</g>
<!-- 5&#45;&gt;8 -->
<g id="edge8" class="edge">
<title>5-&gt;8</title>
<path fill="none" stroke="black" d="M203.99,-201.01C190.89,-193.4 168.23,-180.23 151.72,-170.63"/>
<polygon fill="black" stroke="black" points="153.64,-167.7 143.24,-165.7 150.12,-173.75 153.64,-167.7"/>
</g>
<!-- 9 -->
<g id="node10" class="node">
<title>9</title>
<text text-anchor="middle" x="188.5" y="-151.7" font-family="Times,serif" font-size="14.00">&lt;host&gt;</text>
</g>
<!-- 5&#45;&gt;9 -->
<g id="edge9" class="edge">
<title>5-&gt;9</title>
<path fill="none" stroke="black" d="M211.31,-201.21C207.8,-194.7 202.01,-183.96 197.15,-174.92"/>
<polygon fill="black" stroke="black" points="200.26,-173.32 192.43,-166.17 194.09,-176.64 200.26,-173.32"/>
</g>
<!-- 11 -->
<g id="node12" class="node">
<title>11</title>
<text text-anchor="middle" x="241.5" y="-151.7" font-family="Times,serif" font-size="14.00">: (58)</text>
</g>
<!-- 5&#45;&gt;11 -->
<g id="edge11" class="edge">
<title>5-&gt;11</title>
<path fill="none" stroke="black" d="M217.81,-201.21C221.49,-194.62 227.6,-183.72 232.69,-174.62"/>
<polygon fill="black" stroke="black" points="235.59,-176.6 237.42,-166.16 229.49,-173.18 235.59,-176.6"/>
</g>
<!-- 12 -->
<g id="node13" class="node">
<title>12</title>
<text text-anchor="middle" x="293.5" y="-151.7" font-family="Times,serif" font-size="14.00">&lt;port&gt;</text>
</g>
<!-- 5&#45;&gt;12 -->
<g id="edge12" class="edge">
<title>5-&gt;12</title>
<path fill="none" stroke="black" d="M224.51,-201.01C236.85,-193.47 258.13,-180.48 273.8,-170.91"/>
<polygon fill="black" stroke="black" points="275.57,-173.92 282.28,-165.73 271.93,-167.95 275.57,-173.92"/>
</g>
<!-- 7 -->
<g id="node8" class="node">
<title>7</title>
<text text-anchor="middle" x="63.5" y="-101.45" font-family="Times,serif" font-size="14.00">user:password</text>
</g>
<!-- 6&#45;&gt;7 -->
<g id="edge7" class="edge">
<title>6-&gt;7</title>
<path fill="none" stroke="black" d="M63.5,-150.96C63.5,-144.74 63.5,-134.65 63.5,-125.89"/>
<polygon fill="black" stroke="black" points="67,-126.1 63.5,-116.1 60,-126.1 67,-126.1"/>
</g>
<!-- 10 -->
<g id="node11" class="node">
<title>10</title>
<text text-anchor="middle" x="188.5" y="-101.45" font-family="Times,serif" font-size="14.00">www.google.com</text>
</g>
<!-- 9&#45;&gt;10 -->
<g id="edge10" class="edge">
<title>9-&gt;10</title>
<path fill="none" stroke="black" d="M188.5,-150.96C188.5,-144.74 188.5,-134.65 188.5,-125.89"/>
<polygon fill="black" stroke="black" points="192,-126.1 188.5,-116.1 185,-126.1 192,-126.1"/>
</g>
<!-- 13 -->
<g id="node14" class="node">
<title>13</title>
<text text-anchor="middle" x="293.5" y="-101.45" font-family="Times,serif" font-size="14.00">&lt;nat&gt;</text>
</g>
<!-- 12&#45;&gt;13 -->
<g id="edge13" class="edge">
<title>12-&gt;13</title>
<path fill="none" stroke="black" d="M293.5,-150.96C293.5,-144.74 293.5,-134.65 293.5,-125.89"/>
<polygon fill="black" stroke="black" points="297,-126.1 293.5,-116.1 290,-126.1 297,-126.1"/>
</g>
<!-- 14 -->
<g id="node15" class="node">
<title>14</title>
<text text-anchor="middle" x="263.5" y="-51.2" font-family="Times,serif" font-size="14.00">&lt;digit&gt;</text>
</g>
<!-- 13&#45;&gt;14 -->
<g id="edge14" class="edge">
<title>13-&gt;14</title>
<path fill="none" stroke="black" d="M289.82,-100.71C285.68,-94.05 278.8,-82.98 273.1,-73.82"/>
<polygon fill="black" stroke="black" points="276.26,-72.27 268.01,-65.63 270.32,-75.97 276.26,-72.27"/>
</g>
<!-- 16 -->
<g id="node17" class="node">
<title>16</title>
<text text-anchor="middle" x="322.5" y="-51.2" font-family="Times,serif" font-size="14.00">&lt;digit&gt;</text>
</g>
<!-- 13&#45;&gt;16 -->
<g id="edge16" class="edge">
<title>13-&gt;16</title>
<path fill="none" stroke="black" d="M297.06,-100.71C301.01,-94.12 307.57,-83.22 313.04,-74.12"/>
<polygon fill="black" stroke="black" points="315.98,-76.01 318.14,-65.64 309.98,-72.41 315.98,-76.01"/>
</g>
<!-- 15 -->
<g id="node16" class="node">
<title>15</title>
<text text-anchor="middle" x="263.5" y="-0.95" font-family="Times,serif" font-size="14.00">5 (53)</text>
</g>
<!-- 14&#45;&gt;15 -->
<g id="edge15" class="edge">
<title>14-&gt;15</title>
<path fill="none" stroke="black" d="M263.5,-50.46C263.5,-44.24 263.5,-34.15 263.5,-25.39"/>
<polygon fill="black" stroke="black" points="267,-25.6 263.5,-15.6 260,-25.6 267,-25.6"/>
</g>
<!-- 17 -->
<g id="node18" class="node">
<title>17</title>
<text text-anchor="middle" x="322.5" y="-0.95" font-family="Times,serif" font-size="14.00">3 (51)</text>
</g>
<!-- 16&#45;&gt;17 -->
<g id="edge17" class="edge">
<title>16-&gt;17</title>
<path fill="none" stroke="black" d="M322.5,-50.46C322.5,-44.24 322.5,-34.15 322.5,-25.39"/>
<polygon fill="black" stroke="black" points="326,-25.6 322.5,-15.6 319,-25.6 326,-25.6"/>
</g>
<!-- 19 -->
<g id="node20" class="node">
<title>19</title>
<text text-anchor="middle" x="345.5" y="-151.7" font-family="Times,serif" font-size="14.00">/ (47)</text>
</g>
<!-- 18&#45;&gt;19 -->
<g id="edge19" class="edge">
<title>18-&gt;19</title>
<path fill="none" stroke="black" d="M345.5,-201.21C345.5,-194.99 345.5,-184.9 345.5,-176.14"/>
<polygon fill="black" stroke="black" points="349,-176.35 345.5,-166.35 342,-176.35 349,-176.35"/>
</g>
<!-- 20 -->
<g id="node21" class="node">
<title>20</title>
<text text-anchor="middle" x="392.5" y="-151.7" font-family="Times,serif" font-size="14.00">&lt;id&gt;</text>
</g>
<!-- 18&#45;&gt;20 -->
<g id="edge20" class="edge">
<title>18-&gt;20</title>
<path fill="none" stroke="black" d="M351.26,-201.21C358.1,-194.19 369.72,-182.26 378.89,-172.85"/>
<polygon fill="black" stroke="black" points="381.16,-175.53 385.63,-165.92 376.15,-170.65 381.16,-175.53"/>
</g>
<!-- 21 -->
<g id="node22" class="node">
<title>21</title>
<text text-anchor="middle" x="392.5" y="-101.45" font-family="Times,serif" font-size="14.00">def</text>
</g>
<!-- 20&#45;&gt;21 -->
<g id="edge21" class="edge">
<title>20-&gt;21</title>
<path fill="none" stroke="black" d="M392.5,-150.96C392.5,-144.74 392.5,-134.65 392.5,-125.89"/>
<polygon fill="black" stroke="black" points="396,-126.1 392.5,-116.1 389,-126.1 396,-126.1"/>
</g>
<!-- 23 -->
<g id="node24" class="node">
<title>23</title>
<text text-anchor="middle" x="440.5" y="-151.7" font-family="Times,serif" font-size="14.00">? (63)</text>
</g>
<!-- 22&#45;&gt;23 -->
<g id="edge23" class="edge">
<title>22-&gt;23</title>
<path fill="none" stroke="black" d="M440.5,-201.21C440.5,-194.99 440.5,-184.9 440.5,-176.14"/>
<polygon fill="black" stroke="black" points="444,-176.35 440.5,-166.35 437,-176.35 444,-176.35"/>
</g>
<!-- 24 -->
<g id="node25" class="node">
<title>24</title>
<text text-anchor="middle" x="502.5" y="-151.7" font-family="Times,serif" font-size="14.00">&lt;params&gt;</text>
</g>
<!-- 22&#45;&gt;24 -->
<g id="edge24" class="edge">
<title>22-&gt;24</title>
<path fill="none" stroke="black" d="M448.35,-201.01C457.81,-193.65 473.96,-181.09 486.17,-171.59"/>
<polygon fill="black" stroke="black" points="487.97,-174.62 493.71,-165.71 483.67,-169.09 487.97,-174.62"/>
</g>
<!-- 25 -->
<g id="node26" class="node">
<title>25</title>
<text text-anchor="middle" x="502.5" y="-101.45" font-family="Times,serif" font-size="14.00">&lt;param&gt;</text>
</g>
<!-- 24&#45;&gt;25 -->
<g id="edge25" class="edge">
<title>24-&gt;25</title>
<path fill="none" stroke="black" d="M502.5,-150.96C502.5,-144.74 502.5,-134.65 502.5,-125.89"/>
<polygon fill="black" stroke="black" points="506,-126.1 502.5,-116.1 499,-126.1 506,-126.1"/>
</g>
<!-- 26 -->
<g id="node27" class="node">
<title>26</title>
<text text-anchor="middle" x="453.5" y="-51.2" font-family="Times,serif" font-size="14.00">&lt;id&gt;</text>
</g>
<!-- 25&#45;&gt;26 -->
<g id="edge26" class="edge">
<title>25-&gt;26</title>
<path fill="none" stroke="black" d="M496.49,-100.71C489.36,-93.69 477.25,-81.76 467.69,-72.35"/>
<polygon fill="black" stroke="black" points="470.22,-69.92 460.64,-65.4 465.31,-74.91 470.22,-69.92"/>
</g>
<!-- 28 -->
<g id="node29" class="node">
<title>28</title>
<text text-anchor="middle" x="502.5" y="-51.2" font-family="Times,serif" font-size="14.00">= (61)</text>
</g>
<!-- 25&#45;&gt;28 -->
<g id="edge28" class="edge">
<title>25-&gt;28</title>
<path fill="none" stroke="black" d="M502.5,-100.71C502.5,-94.49 502.5,-84.4 502.5,-75.64"/>
<polygon fill="black" stroke="black" points="506,-75.85 502.5,-65.85 499,-75.85 506,-75.85"/>
</g>
<!-- 29 -->
<g id="node30" class="node">
<title>29</title>
<text text-anchor="middle" x="551.5" y="-51.2" font-family="Times,serif" font-size="14.00">&lt;id&gt;</text>
</g>
<!-- 25&#45;&gt;29 -->
<g id="edge29" class="edge">
<title>25-&gt;29</title>
<path fill="none" stroke="black" d="M508.51,-100.71C515.64,-93.69 527.75,-81.76 537.31,-72.35"/>
<polygon fill="black" stroke="black" points="539.69,-74.91 544.36,-65.4 534.78,-69.92 539.69,-74.91"/>
</g>
<!-- 27 -->
<g id="node28" class="node">
<title>27</title>
<text text-anchor="middle" x="453.5" y="-0.95" font-family="Times,serif" font-size="14.00">abc</text>
</g>
<!-- 26&#45;&gt;27 -->
<g id="edge27" class="edge">
<title>26-&gt;27</title>
<path fill="none" stroke="black" d="M453.5,-50.46C453.5,-44.24 453.5,-34.15 453.5,-25.39"/>
<polygon fill="black" stroke="black" points="457,-25.6 453.5,-15.6 450,-25.6 457,-25.6"/>
</g>
<!-- 30 -->
<g id="node31" class="node">
<title>30</title>
<text text-anchor="middle" x="551.5" y="-0.95" font-family="Times,serif" font-size="14.00">def</text>
</g>
<!-- 29&#45;&gt;30 -->
<g id="edge30" class="edge">
<title>29-&gt;30</title>
<path fill="none" stroke="black" d="M551.5,-50.46C551.5,-44.24 551.5,-34.15 551.5,-25.39"/>
<polygon fill="black" stroke="black" points="555,-25.6 551.5,-15.6 548,-25.6 555,-25.6"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">f</span> <span class="o">=</span> <span class="n">GrammarFuzzer</span><span class="p">(</span><span class="n">CGI_GRAMMAR</span><span class="p">,</span> <span class="n">min_nonterminals</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">max_nonterminals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>'e+d+'
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">display_tree</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">derivation_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_svg output_subarea output_execute_result">


<!-- Generated by graphviz version 12.2.1 (20241206.2353)
 -->
<!-- Pages: 1 -->
<svg width="243pt" height="374pt" viewbox="0.00 0.00 242.75 374.00" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 370)">
<polygon fill="white" stroke="none" points="-4,4 -4,-370 238.75,-370 238.75,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="54.12" y="-352.7" font-family="Times,serif" font-size="14.00">&lt;start&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="54.12" y="-302.45" font-family="Times,serif" font-size="14.00">&lt;string&gt;</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0-&gt;1</title>
<path fill="none" stroke="black" d="M54.12,-351.96C54.12,-345.74 54.12,-335.65 54.12,-326.89"/>
<polygon fill="black" stroke="black" points="57.63,-327.1 54.13,-317.1 50.63,-327.1 57.63,-327.1"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="22.12" y="-252.2" font-family="Times,serif" font-size="14.00">&lt;letter&gt;</text>
</g>
<!-- 1&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>1-&gt;2</title>
<path fill="none" stroke="black" d="M50.2,-301.71C45.79,-295.05 38.44,-283.98 32.37,-274.82"/>
<polygon fill="black" stroke="black" points="35.36,-273 26.92,-266.6 29.53,-276.87 35.36,-273"/>
</g>
<!-- 5 -->
<g id="node6" class="node">
<title>5</title>
<text text-anchor="middle" x="86.12" y="-252.2" font-family="Times,serif" font-size="14.00">&lt;string&gt;</text>
</g>
<!-- 1&#45;&gt;5 -->
<g id="edge5" class="edge">
<title>1-&gt;5</title>
<path fill="none" stroke="black" d="M58.05,-301.71C62.46,-295.05 69.81,-283.98 75.88,-274.82"/>
<polygon fill="black" stroke="black" points="78.72,-276.87 81.33,-266.6 72.89,-273 78.72,-276.87"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="22.12" y="-201.95" font-family="Times,serif" font-size="14.00">&lt;other&gt;</text>
</g>
<!-- 2&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>2-&gt;3</title>
<path fill="none" stroke="black" d="M22.12,-251.46C22.12,-245.24 22.12,-235.15 22.12,-226.39"/>
<polygon fill="black" stroke="black" points="25.63,-226.6 22.13,-216.6 18.63,-226.6 25.63,-226.6"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="22.12" y="-151.7" font-family="Times,serif" font-size="14.00">e (101)</text>
</g>
<!-- 3&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>3-&gt;4</title>
<path fill="none" stroke="black" d="M22.12,-201.21C22.12,-194.99 22.12,-184.9 22.12,-176.14"/>
<polygon fill="black" stroke="black" points="25.63,-176.35 22.13,-166.35 18.63,-176.35 25.63,-176.35"/>
</g>
<!-- 6 -->
<g id="node7" class="node">
<title>6</title>
<text text-anchor="middle" x="85.12" y="-201.95" font-family="Times,serif" font-size="14.00">&lt;letter&gt;</text>
</g>
<!-- 5&#45;&gt;6 -->
<g id="edge6" class="edge">
<title>5-&gt;6</title>
<path fill="none" stroke="black" d="M86,-251.46C85.87,-245.24 85.66,-235.15 85.48,-226.39"/>
<polygon fill="black" stroke="black" points="88.99,-226.53 85.28,-216.6 81.99,-226.67 88.99,-226.53"/>
</g>
<!-- 9 -->
<g id="node10" class="node">
<title>9</title>
<text text-anchor="middle" x="149.12" y="-201.95" font-family="Times,serif" font-size="14.00">&lt;string&gt;</text>
</g>
<!-- 5&#45;&gt;9 -->
<g id="edge9" class="edge">
<title>5-&gt;9</title>
<path fill="none" stroke="black" d="M94.1,-251.26C103.72,-243.9 120.12,-231.34 132.53,-221.84"/>
<polygon fill="black" stroke="black" points="134.4,-224.81 140.21,-215.96 130.14,-219.26 134.4,-224.81"/>
</g>
<!-- 7 -->
<g id="node8" class="node">
<title>7</title>
<text text-anchor="middle" x="85.12" y="-151.7" font-family="Times,serif" font-size="14.00">&lt;plus&gt;</text>
</g>
<!-- 6&#45;&gt;7 -->
<g id="edge7" class="edge">
<title>6-&gt;7</title>
<path fill="none" stroke="black" d="M85.12,-201.21C85.12,-194.99 85.12,-184.9 85.12,-176.14"/>
<polygon fill="black" stroke="black" points="88.63,-176.35 85.13,-166.35 81.63,-176.35 88.63,-176.35"/>
</g>
<!-- 8 -->
<g id="node9" class="node">
<title>8</title>
<text text-anchor="middle" x="85.12" y="-101.45" font-family="Times,serif" font-size="14.00">+ (43)</text>
</g>
<!-- 7&#45;&gt;8 -->
<g id="edge8" class="edge">
<title>7-&gt;8</title>
<path fill="none" stroke="black" d="M85.12,-150.96C85.12,-144.74 85.12,-134.65 85.12,-125.89"/>
<polygon fill="black" stroke="black" points="88.63,-126.1 85.13,-116.1 81.63,-126.1 88.63,-126.1"/>
</g>
<!-- 10 -->
<g id="node11" class="node">
<title>10</title>
<text text-anchor="middle" x="147.12" y="-151.7" font-family="Times,serif" font-size="14.00">&lt;letter&gt;</text>
</g>
<!-- 9&#45;&gt;10 -->
<g id="edge10" class="edge">
<title>9-&gt;10</title>
<path fill="none" stroke="black" d="M148.88,-201.21C148.62,-194.99 148.2,-184.9 147.84,-176.14"/>
<polygon fill="black" stroke="black" points="151.35,-176.2 147.43,-166.35 144.35,-176.49 151.35,-176.2"/>
</g>
<!-- 13 -->
<g id="node14" class="node">
<title>13</title>
<text text-anchor="middle" x="211.12" y="-151.7" font-family="Times,serif" font-size="14.00">&lt;string&gt;</text>
</g>
<!-- 9&#45;&gt;13 -->
<g id="edge13" class="edge">
<title>9-&gt;13</title>
<path fill="none" stroke="black" d="M156.98,-201.01C166.44,-193.65 182.58,-181.09 194.79,-171.59"/>
<polygon fill="black" stroke="black" points="196.59,-174.62 202.34,-165.71 192.29,-169.09 196.59,-174.62"/>
</g>
<!-- 11 -->
<g id="node12" class="node">
<title>11</title>
<text text-anchor="middle" x="147.12" y="-101.45" font-family="Times,serif" font-size="14.00">&lt;other&gt;</text>
</g>
<!-- 10&#45;&gt;11 -->
<g id="edge11" class="edge">
<title>10-&gt;11</title>
<path fill="none" stroke="black" d="M147.12,-150.96C147.12,-144.74 147.12,-134.65 147.12,-125.89"/>
<polygon fill="black" stroke="black" points="150.63,-126.1 147.13,-116.1 143.63,-126.1 150.63,-126.1"/>
</g>
<!-- 12 -->
<g id="node13" class="node">
<title>12</title>
<text text-anchor="middle" x="147.12" y="-51.2" font-family="Times,serif" font-size="14.00">d (100)</text>
</g>
<!-- 11&#45;&gt;12 -->
<g id="edge12" class="edge">
<title>11-&gt;12</title>
<path fill="none" stroke="black" d="M147.12,-100.71C147.12,-94.49 147.12,-84.4 147.12,-75.64"/>
<polygon fill="black" stroke="black" points="150.63,-75.85 147.13,-65.85 143.63,-75.85 150.63,-75.85"/>
</g>
<!-- 14 -->
<g id="node15" class="node">
<title>14</title>
<text text-anchor="middle" x="211.12" y="-101.45" font-family="Times,serif" font-size="14.00">&lt;letter&gt;</text>
</g>
<!-- 13&#45;&gt;14 -->
<g id="edge14" class="edge">
<title>13-&gt;14</title>
<path fill="none" stroke="black" d="M211.12,-150.96C211.12,-144.74 211.12,-134.65 211.12,-125.89"/>
<polygon fill="black" stroke="black" points="214.63,-126.1 211.13,-116.1 207.63,-126.1 214.63,-126.1"/>
</g>
<!-- 15 -->
<g id="node16" class="node">
<title>15</title>
<text text-anchor="middle" x="211.12" y="-51.2" font-family="Times,serif" font-size="14.00">&lt;plus&gt;</text>
</g>
<!-- 14&#45;&gt;15 -->
<g id="edge15" class="edge">
<title>14-&gt;15</title>
<path fill="none" stroke="black" d="M211.12,-100.71C211.12,-94.49 211.12,-84.4 211.12,-75.64"/>
<polygon fill="black" stroke="black" points="214.63,-75.85 211.13,-65.85 207.63,-75.85 214.63,-75.85"/>
</g>
<!-- 16 -->
<g id="node17" class="node">
<title>16</title>
<text text-anchor="middle" x="211.12" y="-0.95" font-family="Times,serif" font-size="14.00">+ (43)</text>
</g>
<!-- 15&#45;&gt;16 -->
<g id="edge16" class="edge">
<title>15-&gt;16</title>
<path fill="none" stroke="black" d="M211.12,-50.46C211.12,-44.24 211.12,-34.15 211.12,-25.39"/>
<polygon fill="black" stroke="black" points="214.63,-25.6 211.13,-15.6 207.63,-25.6 214.63,-25.6"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>How do we stack up against <code>simple_grammar_fuzzer()</code>?</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">trials</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">xs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">ys</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">GrammarFuzzer</span><span class="p">(</span><span class="n">EXPR_GRAMMAR</span><span class="p">,</span> <span class="n">max_nonterminals</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">trials</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">Timer</span><span class="p">()</span> <span class="k">as</span> <span class="n">t</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span>
    <span class="n">xs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
    <span class="n">ys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">elapsed_time</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">" "</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">average_time</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ys</span><span class="p">)</span> <span class="o">/</span> <span class="n">trials</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Average time:"</span><span class="p">,</span> <span class="n">average_time</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Average time: 0.0263434316823259
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="o">%</span><span class="k">matplotlib</span> inline

<span class="kn">import</span> <span class="nn"><a href="https://matplotlib.org/" class="import" target="_blank">matplotlib.pyplot</a></span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Time required for generating an output'</span><span class="p">);</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_png output_subarea ">
<img src="../Images/7a67155bf919078dff92eb49265dfe42.png"/>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Our test generation is much faster, but also our inputs are much smaller.  We see that with derivation trees, we can get much better control over grammar production.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Finally, how does <code>GrammarFuzzer</code> work with <code>expr_grammar</code>, where <code>simple_grammar_fuzzer()</code> failed?  It works without any issue:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">f</span> <span class="o">=</span> <span class="n">GrammarFuzzer</span><span class="p">(</span><span class="n">expr_grammar</span><span class="p">,</span> <span class="n">max_nonterminals</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>'(9 + 7) * 7 * 2 * 5 + 7 * 2 / 6'
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>With <code>GrammarFuzzer</code>, we now have a solid foundation on which to build further fuzzers and illustrate more exciting concepts from the world of generating software tests.  Many of these do not even require writing a grammar – instead, they <em>infer</em> a grammar from the domain at hand, and thus allow using grammar-based fuzzing even without writing a grammar.  Stay tuned!</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Lessons-Learned">Lessons Learned</h2><ul>
<li><em>Derivation trees</em> are important for expressing input structure</li>
<li><em>Grammar fuzzing based on derivation trees</em> <ol>
<li>is much more efficient than string-based grammar fuzzing,</li>
<li>gives much better control over input generation, and</li>
<li>effectively avoids running into infinite expansions.</li>
</ol>
</li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Next-Steps">Next Steps</h2><p>Congratulations!  You have reached one of the central "hubs" of the book.  From here, there is a wide range of techniques that build on grammar fuzzing.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Extending-Grammars">Extending Grammars</h3><p>First, we have a number of techniques that all <em>extend</em> grammars in some form:</p>
<ul>
<li><a href="Parser.html">Parsing and recombining inputs</a> allows making use of existing inputs, again using derivation trees</li>
<li><a href="GrammarCoverageFuzzer.html">Covering grammar expansions</a> allows for <em>combinatorial</em> coverage</li>
<li><a href="ProbabilisticGrammarFuzzer.html">Assigning <em>probabilities</em> to individual expansions</a> gives additional control over expansions</li>
<li><a href="GeneratorGrammarFuzzer.html">Assigning <em>constraints</em> to individual expansions</a> allows expressing <em>semantic constraints</em> on individual rules.</li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Applying-Grammars">Applying Grammars</h3><p>Second, we can <em>apply</em> grammars in a variety of contexts that all involve some form of learning it automatically:</p>
<ul>
<li><a href="APIFuzzer.html">Fuzzing APIs</a>, learning a grammar from APIs</li>
<li><a href="WebFuzzer.html">Fuzzing graphical user interfaces</a>, learning a grammar from user interfaces for subsequent fuzzing</li>
<li><a href="GrammarMiner.html">Mining grammars</a>, learning a grammar for arbitrary input formats</li>
</ul>
<p>Keep on expanding!</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Background">Background</h2><p>Derivation trees (then frequently called <em>parse trees</em>) are a standard data structure into which <em>parsers</em> decompose inputs.  The <em>Dragon Book</em> (also known as <em>Compilers: Principles, Techniques, and Tools</em>) [<a href="https://www.pearson.com/us/higher-education/program/Aho-Compilers-Principles-Techniques-and-Tools-2nd-Edition/PGM167067.html">Aho <em>et al</em>, 2006</a>] discusses parsing into derivation trees as part of compiling programs.  We also use derivation trees <a href="Parser.html">when parsing and recombining inputs</a>.</p>
<p>The key idea in this chapter, namely expanding until a limit of symbols is reached, and then always choosing the shortest path, stems from Luke [<a href="https://doi.org/10.1109/4235.873237">Luke <em>et al</em>, 2000</a>].</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Exercises">Exercises</h2></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Exercise-1:-Caching-Method-Results">Exercise 1: Caching Method Results</h3><p>Tracking <code>GrammarFuzzer</code> reveals that some methods are called again and again, always with the same values.</p>
<p>Set up a class <code>FasterGrammarFuzzer</code> with a <em>cache</em> that checks whether the method has been called before, and if so, return the previously computed "memoized" value.  Do this for <code>expansion_to_children()</code>.  Compare the number of invocations before and after the optimization.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p><strong>Important</strong>: For <code>expansion_to_children()</code>, make sure that each list returned is an individual copy.  If you return the same (cached) list, this will interfere with the in-place modification of <code>GrammarFuzzer</code>.  Use the Python <code>copy.deepcopy()</code> function for this purpose.</p>

    
<p/><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/HEAD?labpath=docs%2Fnotebooks/GrammarFuzzer.ipynb#Exercises" target="_blank">Use the notebook</a> to work on the exercises and see solutions.</div>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Exercise-2:-Grammar-Pre-Compilation">Exercise 2: Grammar Pre-Compilation</h3><p>Some methods such as <code>symbol_cost()</code> or <code>expansion_cost()</code> return a value that is dependent on the grammar only.  Set up a class <code>EvenFasterGrammarFuzzer()</code> that pre-computes these values once upon initialization, such that later invocations of <code>symbol_cost()</code> or <code>expansion_cost()</code> need only look up these values.</p>

    
<p/><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/HEAD?labpath=docs%2Fnotebooks/GrammarFuzzer.ipynb#Exercises" target="_blank">Use the notebook</a> to work on the exercises and see solutions.</div>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Exercise-3:-Maintaining-Trees-to-be-Expanded">Exercise 3: Maintaining Trees to be Expanded</h3><p>In <code>expand_tree_once()</code>, the algorithm traverses the tree again and again to find nonterminals that still can be extended.  Speed up the process by keeping a list of nonterminal symbols in the tree that still can be expanded.</p>

    
<p/><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/HEAD?labpath=docs%2Fnotebooks/GrammarFuzzer.ipynb#Exercises" target="_blank">Use the notebook</a> to work on the exercises and see solutions.</div>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Exercise-4:-Alternate-Random-Expansions">Exercise 4: Alternate Random Expansions</h3></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We could define <code>expand_node_randomly()</code> such that it simply invokes <code>expand_node_by_cost(node, random.choice)</code>:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">ExerciseGrammarFuzzer</span><span class="p">(</span><span class="n">GrammarFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">expand_node_randomly</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">DerivationTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DerivationTree</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">"Expanding"</span><span class="p">,</span> <span class="n">all_terminals</span><span class="p">(</span><span class="n">node</span><span class="p">),</span> <span class="s2">"randomly by cost"</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_node_by_cost</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>What is the difference between the original implementation and this alternative?</p>

    
<p/><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/HEAD?labpath=docs%2Fnotebooks/GrammarFuzzer.ipynb#Exercises" target="_blank">Use the notebook</a> to work on the exercises and see solutions.</div>
</div>
</div>
</div>
</div>

        
<p class="imprint">
<img style="float:right" src="../Images/2f3faa36146c6fb38bbab67add09aa5f.png" alt="Creative Commons License" data-original-src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png"/>
The content of this project is licensed under the
<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.
The source code that is part of the content, as well as the source code used to format and display that content is licensed under the <a href="https://github.com/uds-se/fuzzingbook/blob/master/LICENSE.md#mit-license">MIT License</a>.
<a href="https://github.com/uds-se/fuzzingbook/commits/master/notebooks/GrammarFuzzer.ipynb" target="_blank)">Last change: 2023-11-11 18:18:06+01:00</a> • 
<a href="#citation" id="cite" onclick="revealCitation()">Cite</a> •
<a href="https://cispa.de/en/impressum" target="_blank">Imprint</a>
</p>



<div id="citation" class="citation" style="display: none;">
<a name="citation"/>
<h2>How to Cite this Work</h2>
<p>
Andreas Zeller, Rahul Gopinath, Marcel Böhme, Gordon Fraser, and Christian Holler: "<a href="https://www.fuzzingbook.org/html/GrammarFuzzer.html">Efficient Grammar Fuzzing</a>".  In Andreas Zeller, Rahul Gopinath, Marcel Böhme, Gordon Fraser, and Christian Holler, "<a href="https://www.fuzzingbook.org/">The Fuzzing Book</a>", <a href="https://www.fuzzingbook.org/html/GrammarFuzzer.html">https://www.fuzzingbook.org/html/GrammarFuzzer.html</a>.  Retrieved 2023-11-11 18:18:06+01:00.
</p>
<pre>
@incollection{fuzzingbook2023:GrammarFuzzer,
    author = {Andreas Zeller and Rahul Gopinath and Marcel B{\"o}hme and Gordon Fraser and Christian Holler},
    booktitle = {The Fuzzing Book},
    title = {Efficient Grammar Fuzzing},
    year = {2023},
    publisher = {CISPA Helmholtz Center for Information Security},
    howpublished = {\url{https://www.fuzzingbook.org/html/GrammarFuzzer.html}},
    note = {Retrieved 2023-11-11 18:18:06+01:00},
    url = {https://www.fuzzingbook.org/html/GrammarFuzzer.html},
    urldate = {2023-11-11 18:18:06+01:00}
}
</pre>
</div>

          
</body>
</html>