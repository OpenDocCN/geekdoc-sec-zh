<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Reducing Failure-Inducing Inputs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Reducing Failure-Inducing Inputs</h1>
<blockquote>原文：<a href="http://www.fuzzingbook.org/html/Reducer.html">http://www.fuzzingbook.org/html/Reducer.html</a></blockquote>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>By construction, fuzzers create inputs that may be hard to read.  This causes issues during <em>debugging</em>, when a human has to analyze the exact cause of the failure.  In this chapter, we present techniques that <em>automatically reduce and simplify failure-inducing inputs to a minimum</em> in order to ease debugging.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="kn">from</span> <span class="nn"><a href="https://github.com/uds-se/fuzzingbook//tree/master/notebooks/shared/bookutils" class="import" target="_blank">bookutils</a></span> <span class="kn">import</span> <span class="n">YouTubeVideo</span>
<span class="n">YouTubeVideo</span><span class="p">(</span><span class="s1">'JOv1xGVdXAU'</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_html rendered_html output_subarea output_execute_result">

        

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p><strong>Prerequisites</strong></p>
<ul>
<li>The simple "delta debugging" technique for reduction has no specific prerequisites.</li>
<li>As reduction is typically used together with fuzzing, reading the <a href="Fuzzer.html">chapter on basic fuzzing</a> is a good idea.</li>
<li>The later grammar-based techniques require knowledge on <a href="GrammarFuzzer.html">derivation trees</a> and <a href="Parser.html">parsing</a>.</li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><div class="synopsis"><h2 id="Synopsis">Synopsis</h2><!-- Automatically generated. Do not edit. -->

<p>To <a href="Importing.html">use the code provided in this chapter</a>, write</p>
<div class="highlight"><pre><span/><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn"><a href="Reducer.html" class="import" target="_blank">fuzzingbook.Reducer</a></span> <span class="kn">import</span> <span class="o">&lt;</span><span class="n">identifier</span><span class="o">&gt;</span>
</pre></div>
<p>and then make use of the following features.</p>
<p>A <em>reducer</em> takes a failure-inducing input and reduces it to the minimum that still reproduces the failure.  This chapter provides <code>Reducer</code> classes that implement such reducers.</p>
<p>Here is a simple example: An arithmetic expression causes an error in the Python interpreter:</p>
<div class="highlight"><pre><span/><span class="o">&gt;&gt;&gt;</span> <span class="err">!</span><span class="n">python</span> <span class="o">-</span><span class="n">c</span> <span class="s1">'x = 1 + 2 * 3 / 0'</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s2">"&lt;string&gt;"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">ZeroDivisionError</span><span class="p">:</span> <span class="n">division</span> <span class="n">by</span> <span class="n">zero</span>
</pre></div>
<p>Can we reduce this input to a minimum?  To use a <code>Reducer</code>, one first has to build a <code>Runner</code> whose outcome is <code>FAIL</code> if the precise error occurs.  We therefore build a <code>ZeroDivisionRunner</code> whose <code>run()</code> method will specifically return a <code>FAIL</code> outcome if a <code>ZeroDivisionError</code> occurs.</p>
<div class="highlight"><pre><span/><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn"><a href="Fuzzer.html" class="import" target="_blank">Fuzzer</a></span> <span class="kn">import</span> <span class="n">ProgramRunner</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/subprocess.html" class="import" target="_blank">subprocess</a></span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">class</span> <span class="nc">ZeroDivisionRunner</span><span class="p">(</span><span class="n">ProgramRunner</span><span class="p">):</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="s2">"""Make outcome 'FAIL' if ZeroDivisionError occurs"""</span>
<span class="o">&gt;&gt;&gt;</span> 
<span class="o">&gt;&gt;&gt;</span>     <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inp</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">""</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">subprocess</span><span class="o">.</span><span class="n">CompletedProcess</span><span class="p">,</span> <span class="n">Outcome</span><span class="p">]:</span>
<span class="o">&gt;&gt;&gt;</span>         <span class="n">process</span><span class="p">,</span> <span class="n">outcome</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span>         <span class="k">if</span> <span class="n">process</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">'ZeroDivisionError'</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
<span class="o">&gt;&gt;&gt;</span>             <span class="n">outcome</span> <span class="o">=</span> <span class="s1">'FAIL'</span>
<span class="o">&gt;&gt;&gt;</span>         <span class="k">return</span> <span class="n">process</span><span class="p">,</span> <span class="n">outcome</span>
</pre></div>
<p>If we feed this expression into a <code>ZeroDivisionRunner</code>, it will produce an outcome of <code>FAIL</code> as designed.</p>
<div class="highlight"><pre><span/><span class="o">&gt;&gt;&gt;</span> <span class="n">python_input</span> <span class="o">=</span> <span class="s2">"x = 1 + 2 * 3 / 0"</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">python_runner</span> <span class="o">=</span> <span class="n">ZeroDivisionRunner</span><span class="p">(</span><span class="s2">"python"</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">process</span><span class="p">,</span> <span class="n">outcome</span> <span class="o">=</span> <span class="n">python_runner</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">python_input</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">outcome</span>
<span class="s1">'FAIL'</span>
</pre></div>
<p>Delta Debugging is a simple and robust reduction algorithm.  We can tie a <code>DeltaDebuggingReducer</code> to this runner, and have it determine the substring that causes the <code>python</code> program to fail:</p>
<div class="highlight"><pre><span/><span class="o">&gt;&gt;&gt;</span> <span class="n">dd</span> <span class="o">=</span> <span class="n">DeltaDebuggingReducer</span><span class="p">(</span><span class="n">python_runner</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">dd</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">python_input</span><span class="p">)</span>
<span class="s1">'3/0'</span>
</pre></div>
<p>The input is reduced to the minimum: We get the essence of the division by zero.</p>
<p>

<!-- Generated by graphviz version 12.2.1 (20241206.2353)
 -->
<!-- Pages: 1 -->
<svg width="476pt" height="364pt" viewbox="0.00 0.00 475.50 363.50" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 359.5)">
<g id="a_graph0"><a xlink:title="DeltaDebuggingReducer class hierarchy">
<polygon fill="white" stroke="none" points="-4,4 -4,-359.5 471.5,-359.5 471.5,4 -4,4"/>
</a>
</g>
<!-- DeltaDebuggingReducer -->
<g id="node1" class="node">
<title>DeltaDebuggingReducer</title>
<g id="a_node1"><a xlink:href="#" xlink:title="class DeltaDebuggingReducer:&#10;Reduce inputs using delta debugging.">
<polygon fill="none" stroke="black" points="0,-45.12 0,-91.88 163.75,-91.88 163.75,-45.12 0,-45.12"/>
<text text-anchor="start" x="8" y="-75.58" font-family="Patua One, Helvetica, sans-serif" font-weight="bold" font-size="14.00" fill="#b03a2e">DeltaDebuggingReducer</text>
<polyline fill="none" stroke="black" points="0,-65.88 163.75,-65.88"/>
<g id="a_node1_0"><a xlink:href="#" xlink:title="DeltaDebuggingReducer">
<g id="a_node1_1"><a xlink:href="#" xlink:title="reduce(self, inp: str) -&gt; str:&#10;Reduce input `inp` using delta debugging. Return reduced input.">
<text text-anchor="start" x="57.88" y="-53.38" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-style="italic" font-size="10.00">reduce()</text>
</a>
</g>
</a>
</g>
</a>
</g>
</g>
<!-- CachingReducer -->
<g id="node2" class="node">
<title>CachingReducer</title>
<g id="a_node2"><a xlink:href="#" xlink:title="class CachingReducer:&#10;A reducer that also caches test outcomes">
<polygon fill="none" stroke="black" points="111.38,-173.5 111.38,-233 226.38,-233 226.38,-173.5 111.38,-173.5"/>
<text text-anchor="start" x="119.38" y="-216.7" font-family="Patua One, Helvetica, sans-serif" font-weight="bold" font-size="14.00" fill="#b03a2e">CachingReducer</text>
<polyline fill="none" stroke="black" points="111.38,-207 226.38,-207"/>
<g id="a_node2_2"><a xlink:href="#" xlink:title="CachingReducer">
<g id="a_node2_3"><a xlink:href="#" xlink:title="reset(self):&#10;Reset the test counter to zero. To be extended in subclasses.">
<text text-anchor="start" x="147.88" y="-194.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00">reset()</text>
</a>
</g>
<g id="a_node2_4"><a xlink:href="#" xlink:title="test(self, inp):&#10;Test with input `inp`. Return outcome.&#10;To be extended in subclasses.">
<text text-anchor="start" x="147.88" y="-181.75" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00">test()</text>
</a>
</g>
</a>
</g>
</a>
</g>
</g>
<!-- DeltaDebuggingReducer&#45;&gt;CachingReducer -->
<g id="edge1" class="edge">
<title>DeltaDebuggingReducer-&gt;CachingReducer</title>
<path fill="none" stroke="black" d="M96.83,-92.32C109.67,-111.91 128.45,-140.56 143.61,-163.7"/>
<polygon fill="none" stroke="black" points="140.62,-165.53 149.03,-171.97 146.48,-161.69 140.62,-165.53"/>
</g>
<!-- Reducer -->
<g id="node3" class="node">
<title>Reducer</title>
<g id="a_node3"><a xlink:href="#" xlink:title="class Reducer:&#10;Base class for reducers.">
<polygon fill="none" stroke="black" points="130.88,-270 130.88,-355 206.88,-355 206.88,-270 130.88,-270"/>
<text text-anchor="start" x="144.12" y="-338.7" font-family="Patua One, Helvetica, sans-serif" font-weight="bold" font-size="14.00" fill="#b03a2e">Reducer</text>
<polyline fill="none" stroke="black" points="130.88,-329 206.88,-329"/>
<g id="a_node3_5"><a xlink:href="#" xlink:title="Reducer">
<g id="a_node3_6"><a xlink:href="#" xlink:title="__init__(self, runner: Fuzzer.Runner, log_test: bool = False) -&gt; None:&#10;Attach reducer to the given `runner`">
<text text-anchor="start" x="138.88" y="-316.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00">__init__()</text>
</a>
</g>
<g id="a_node3_7"><a xlink:href="#" xlink:title="reduce(self, inp: str) -&gt; str:&#10;Reduce input `inp`. Return reduced input.&#10;To be defined in subclasses.">
<text text-anchor="start" x="138.88" y="-303.75" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-style="italic" font-size="10.00">reduce()</text>
</a>
</g>
<g id="a_node3_8"><a xlink:href="#" xlink:title="reset(self) -&gt; None:&#10;Reset the test counter to zero. To be extended in subclasses.">
<text text-anchor="start" x="138.88" y="-291" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-style="italic" font-size="10.00">reset()</text>
</a>
</g>
<g id="a_node3_9"><a xlink:href="#" xlink:title="test(self, inp: str) -&gt; str:&#10;Test with input `inp`. Return outcome.&#10;To be extended in subclasses.">
<text text-anchor="start" x="138.88" y="-278.25" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00">test()</text>
</a>
</g>
</a>
</g>
</a>
</g>
</g>
<!-- CachingReducer&#45;&gt;Reducer -->
<g id="edge2" class="edge">
<title>CachingReducer-&gt;Reducer</title>
<path fill="none" stroke="black" d="M168.88,-233.27C168.88,-241.04 168.88,-249.68 168.88,-258.31"/>
<polygon fill="none" stroke="black" points="165.38,-258.05 168.88,-268.05 172.38,-258.05 165.38,-258.05"/>
</g>
<!-- GrammarReducer -->
<g id="node4" class="node">
<title>GrammarReducer</title>
<g id="a_node4"><a xlink:href="#" xlink:title="class GrammarReducer:&#10;Reduce inputs using grammars">
<polygon fill="none" stroke="black" points="181.88,-0.5 181.88,-136.5 329.88,-136.5 329.88,-0.5 181.88,-0.5"/>
<text text-anchor="start" x="201.88" y="-120.2" font-family="Patua One, Helvetica, sans-serif" font-weight="bold" font-size="14.00" fill="#b03a2e">GrammarReducer</text>
<polyline fill="none" stroke="black" points="181.88,-110.5 329.88,-110.5"/>
<g id="a_node4_10"><a xlink:href="#" xlink:title="GrammarReducer">
<g id="a_node4_11"><a xlink:href="#" xlink:title="__init__(self, runner: Fuzzer.Runner, parser: Parser.Parser, *, log_test: bool = False, log_reduce: bool = False):&#10;Constructor.&#10;`runner` is the runner to be used.&#10;`parser` is the parser to be used.&#10;`log_test` - if set, show tests and results.&#10;`log_reduce` - if set, show reduction steps.">
<text text-anchor="start" x="189.88" y="-98" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-style="italic" font-size="10.00">__init__()</text>
</a>
</g>
<g id="a_node4_12"><a xlink:href="#" xlink:title="reduce(self, inp):&#10;Reduce input `inp`. Return reduced input.&#10;To be defined in subclasses.">
<text text-anchor="start" x="189.88" y="-85.25" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-style="italic" font-size="10.00">reduce()</text>
</a>
</g>
<g id="a_node4_13"><a xlink:href="#" xlink:title="alternate_reductions(self, tree: DerivationTree, symbol: str, depth: int = -1)">
<text text-anchor="start" x="189.88" y="-71.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00">alternate_reductions()</text>
</a>
</g>
<g id="a_node4_14"><a xlink:href="#" xlink:title="parse(self, inp)">
<text text-anchor="start" x="189.88" y="-58.75" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00">parse()</text>
</a>
</g>
<g id="a_node4_15"><a xlink:href="#" xlink:title="reduce_subtree(self, tree: DerivationTree, subtree: DerivationTree, depth: int = -1)">
<text text-anchor="start" x="189.88" y="-46" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00">reduce_subtree()</text>
</a>
</g>
<g id="a_node4_16"><a xlink:href="#" xlink:title="reduce_tree(self, tree)">
<text text-anchor="start" x="189.88" y="-33.25" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00">reduce_tree()</text>
</a>
</g>
<g id="a_node4_17"><a xlink:href="#" xlink:title="subtrees_with_symbol(self, tree: DerivationTree, symbol: str, depth: int = -1, ignore_root: bool = True) -&gt; List[DerivationTree]:&#10;Find all subtrees in `tree` whose root is `symbol`.&#10;If `ignore_root` is true, ignore the root note of `tree`.">
<text text-anchor="start" x="189.88" y="-20.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00">subtrees_with_symbol()</text>
</a>
</g>
<g id="a_node4_18"><a xlink:href="#" xlink:title="symbol_reductions(self, tree: DerivationTree, symbol: str, depth: int = -1):&#10;Find all expansion alternatives for the given symbol">
<text text-anchor="start" x="189.88" y="-7.75" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00">symbol_reductions()</text>
</a>
</g>
</a>
</g>
</a>
</g>
</g>
<!-- GrammarReducer&#45;&gt;CachingReducer -->
<g id="edge3" class="edge">
<title>GrammarReducer-&gt;CachingReducer</title>
<path fill="none" stroke="black" d="M211.87,-136.65C205.81,-145.9 199.76,-155.12 194.2,-163.61"/>
<polygon fill="none" stroke="black" points="191.3,-161.64 188.75,-171.92 197.16,-165.48 191.3,-161.64"/>
</g>
<!-- Legend -->
<g id="node5" class="node">
<title>Legend</title>
<text text-anchor="start" x="348.25" y="-84.5" font-family="Patua One, Helvetica, sans-serif" font-weight="bold" font-size="10.00" fill="#b03a2e">Legend</text>
<text text-anchor="start" x="348.25" y="-74.5" font-family="Patua One, Helvetica, sans-serif" font-size="10.00">• </text>
<text text-anchor="start" x="354.25" y="-74.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="8.00">public_method()</text>
<text text-anchor="start" x="348.25" y="-64.5" font-family="Patua One, Helvetica, sans-serif" font-size="10.00">• </text>
<text text-anchor="start" x="354.25" y="-64.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="8.00">private_method()</text>
<text text-anchor="start" x="348.25" y="-54.5" font-family="Patua One, Helvetica, sans-serif" font-size="10.00">• </text>
<text text-anchor="start" x="354.25" y="-54.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="8.00">overloaded_method()</text>
<text text-anchor="start" x="348.25" y="-45.45" font-family="Helvetica,sans-Serif" font-size="9.00">Hover over names to see doc</text>
</g>
</g>
</svg>
</p>
</div>
</div>
</div>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Why-Reducing?">Why Reducing?</h2><p>At this point, we have seen a number of test generation techniques that all in some form produce inputs in order to trigger failures.  If they are successful – that is, the program actually fails – we must find out why the failure occurred and how to fix it.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Here's an example of such a situation.  We have a class <code>MysteryRunner</code> with a <code>run()</code> method that – given its code – can occasionally fail.  But under which circumstances does this actually happen?  We have deliberately obscured the exact condition in order to make this non-obvious.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="kn">import</span> <span class="nn"><a href="https://github.com/uds-se/fuzzingbook//tree/master/notebooks/shared/bookutils" class="import" target="_blank">bookutils.setup</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="kn">from</span> <span class="nn"><a href="https://github.com/uds-se/fuzzingbook//tree/master/notebooks/shared/bookutils" class="import" target="_blank">bookutils</a></span> <span class="kn">import</span> <span class="n">quiz</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="kn">from</span> <span class="nn"><a href="https://docs.python.org/3/library/typing.html" class="import" target="_blank">typing</a></span> <span class="kn">import</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="kn">from</span> <span class="nn"><a href="ExpectError.html" class="import" target="_blank">ExpectError</a></span> <span class="kn">import</span> <span class="n">ExpectError</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="kn">from</span> <span class="nn"><a href="Fuzzer.html" class="import" target="_blank">Fuzzer</a></span> <span class="kn">import</span> <span class="n">RandomFuzzer</span><span class="p">,</span> <span class="n">Runner</span><span class="p">,</span> <span class="n">Outcome</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/re.html" class="import" target="_blank">re</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">MysteryRunner</span><span class="p">(</span><span class="n">Runner</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inp</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Outcome</span><span class="p">]:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">inp</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mo">0o17</span> <span class="o">+</span> <span class="mo">0o31</span><span class="p">))</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">inp</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mo">0o27</span> <span class="o">+</span> <span class="mo">0o22</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="n">Runner</span><span class="o">.</span><span class="n">FAIL</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="n">Runner</span><span class="o">.</span><span class="n">PASS</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let us fuzz the function until we find a failing input.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">mystery</span> <span class="o">=</span> <span class="n">MysteryRunner</span><span class="p">()</span>
<span class="n">random_fuzzer</span> <span class="o">=</span> <span class="n">RandomFuzzer</span><span class="p">()</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">inp</span> <span class="o">=</span> <span class="n">random_fuzzer</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span>
    <span class="n">result</span><span class="p">,</span> <span class="n">outcome</span> <span class="o">=</span> <span class="n">mystery</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">outcome</span> <span class="o">==</span> <span class="n">mystery</span><span class="o">.</span><span class="n">FAIL</span><span class="p">:</span>
        <span class="k">break</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">failing_input</span> <span class="o">=</span> <span class="n">result</span>
<span class="n">failing_input</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>' 7:,&gt;((/$$-/-&gt;.;.=;(.%!:50#7*8=$&amp;&amp;=$9!%6(4=&amp;69\':\'&lt;3+0-3.24#7=!&amp;60)2/+";+&lt;7+1&lt;2!4$&gt;92+$1&lt;(3%&amp;5\'\'&gt;#'
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Something in this input causes <code>MysteryRunner</code> to fail.  But what is it?</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Manual-Input-Reduction">Manual Input Reduction</h2><p>One important step in the debugging process is <em>reduction</em> – that is, to identify those circumstances of a failure that are relevant for the failure to occur, and to <em>omit</em> (if possible) those parts that are not.  As Kernighan and Pike [Kernighan <em>et al</em>, 1999] put it:</p>
<blockquote><p>For every circumstance of the problem, check whether it is relevant for the problem to occur.  If it is not, remove it from the problem report or the test case in question.</p>
</blockquote>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Specifically for inputs, they suggest a <em>divide and conquer</em> process:</p>
<blockquote><p>Proceed by binary search.  Throw away half the input and see if the output is still wrong; if not, go back to the previous state and discard the other half of the input.</p>
</blockquote>
<p>This is something we can easily try out, using our last generated input:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">failing_input</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>' 7:,&gt;((/$$-/-&gt;.;.=;(.%!:50#7*8=$&amp;&amp;=$9!%6(4=&amp;69\':\'&lt;3+0-3.24#7=!&amp;60)2/+";+&lt;7+1&lt;2!4$&gt;92+$1&lt;(3%&amp;5\'\'&gt;#'
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>For instance, we can see whether the error still occurs if we only feed in the first half:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">half_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">failing_input</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>   <span class="c1"># // is integer division</span>
<span class="n">first_half</span> <span class="o">=</span> <span class="n">failing_input</span><span class="p">[:</span><span class="n">half_length</span><span class="p">]</span>
<span class="n">mystery</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">first_half</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>(" 7:,&gt;((/$$-/-&gt;.;.=;(.%!:50#7*8=$&amp;&amp;=$9!%6(4=&amp;69':", 'PASS')
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Nope – the first half alone does not suffice.  Maybe the second half?</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">second_half</span> <span class="o">=</span> <span class="n">failing_input</span><span class="p">[</span><span class="n">half_length</span><span class="p">:]</span>
<span class="n">mystery</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">second_half</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>('\'&lt;3+0-3.24#7=!&amp;60)2/+";+&lt;7+1&lt;2!4$&gt;92+$1&lt;(3%&amp;5\'\'&gt;#', 'PASS')
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>This did not go so well either.  We may still proceed by cutting away <em>smaller chunks</em> – say, one character after another.  If our test is deterministic and easily repeated, it is clear that this process eventually will yield a reduced input.  But still, it is a rather inefficient process, especially for long inputs.  What we need is a <em>strategy</em> that effectively minimizes a failure-inducing input – a strategy that can be automated.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Delta-Debugging">Delta Debugging</h2></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>One strategy to effectively reduce failure-inducing inputs is <em>delta debugging</em> [<a href="https://doi.org/10.1109/32.988498">Zeller <em>et al</em>, 2002</a>].  Delta Debugging implements the "binary search" strategy, as listed above, but with a twist: If neither half fails (also as above), it keeps on cutting away smaller and smaller chunks from the input, until it eliminates individual characters.  Thus, after cutting away the first half, we cut away
the first quarter, the second quarter, and so on.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let us illustrate this on our example, and see what happens if we cut away the first quarter.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">quarter_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">failing_input</span><span class="p">)</span> <span class="o">//</span> <span class="mi">4</span>
<span class="n">input_without_first_quarter</span> <span class="o">=</span> <span class="n">failing_input</span><span class="p">[</span><span class="n">quarter_length</span><span class="p">:]</span>
<span class="n">mystery</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">input_without_first_quarter</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>('50#7*8=$&amp;&amp;=$9!%6(4=&amp;69\':\'&lt;3+0-3.24#7=!&amp;60)2/+";+&lt;7+1&lt;2!4$&gt;92+$1&lt;(3%&amp;5\'\'&gt;#',
 'FAIL')
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Ah! This has failed, and reduced our failing input by 25%.  Let's remove another quarter.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">input_without_first_and_second_quarter</span> <span class="o">=</span> <span class="n">failing_input</span><span class="p">[</span><span class="n">quarter_length</span> <span class="o">*</span> <span class="mi">2</span><span class="p">:]</span>
<span class="n">mystery</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">input_without_first_and_second_quarter</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>('\'&lt;3+0-3.24#7=!&amp;60)2/+";+&lt;7+1&lt;2!4$&gt;92+$1&lt;(3%&amp;5\'\'&gt;#', 'PASS')
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>This is not too surprising, as we had that one before:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">second_half</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>'\'&lt;3+0-3.24#7=!&amp;60)2/+";+&lt;7+1&lt;2!4$&gt;92+$1&lt;(3%&amp;5\'\'&gt;#'
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">input_without_first_and_second_quarter</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>'\'&lt;3+0-3.24#7=!&amp;60)2/+";+&lt;7+1&lt;2!4$&gt;92+$1&lt;(3%&amp;5\'\'&gt;#'
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>How about removing the third quarter, then?</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">input_without_first_and_third_quarter</span> <span class="o">=</span> <span class="n">failing_input</span><span class="p">[</span><span class="n">quarter_length</span><span class="p">:</span>
                                                      <span class="n">quarter_length</span> <span class="o">*</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">failing_input</span><span class="p">[</span><span class="n">quarter_length</span> <span class="o">*</span> <span class="mi">3</span><span class="p">:]</span>
<span class="n">mystery</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">input_without_first_and_third_quarter</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>("50#7*8=$&amp;&amp;=$9!%6(4=&amp;69':&lt;7+1&lt;2!4$&gt;92+$1&lt;(3%&amp;5''&gt;#", 'PASS')
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Ok.  Let us remove the fourth quarter.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">input_without_first_and_fourth_quarter</span> <span class="o">=</span> <span class="n">failing_input</span><span class="p">[</span><span class="n">quarter_length</span><span class="p">:</span><span class="n">quarter_length</span> <span class="o">*</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">mystery</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">input_without_first_and_fourth_quarter</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>('50#7*8=$&amp;&amp;=$9!%6(4=&amp;69\':\'&lt;3+0-3.24#7=!&amp;60)2/+";+', 'FAIL')
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Yes!  This has succeeded.  Our input is now 50% smaller.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We have now tried to remove pieces that make up $\frac{1}{2}$ and $\frac{1}{4}$ of the original failing string.  In the next iteration, we would go and remove even smaller pieces – $\frac{1}{8}$, $\frac{1}{16}$ and so on.  We continue until we are down to $\frac{1}{97}$ – that is, individual characters.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>However, this is something we happily let a computer do for us.  We first introduce a <code>Reducer</code> class as an abstract superclass for all kinds of reducers.  The <code>test()</code> method runs a single test (with logging, if wanted); the <code>reduce()</code> method will eventually reduce an input to the minimum.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">Reducer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Base class for reducers."""</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">runner</span><span class="p">:</span> <span class="n">Runner</span><span class="p">,</span> <span class="n">log_test</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Attach reducer to the given `runner`"""</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">runner</span> <span class="o">=</span> <span class="n">runner</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_test</span> <span class="o">=</span> <span class="n">log_test</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Reset the test counter to zero. To be extended in subclasses."""</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tests</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inp</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Outcome</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Test with input `inp`. Return outcome.</span>
<span class="sd">        To be extended in subclasses."""</span>

        <span class="n">result</span><span class="p">,</span> <span class="n">outcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">runner</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tests</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_test</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">"Test #</span><span class="si">%d</span><span class="s2">"</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">tests</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">inp</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">inp</span><span class="p">)),</span> <span class="n">outcome</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">outcome</span>

    <span class="k">def</span> <span class="nf">reduce</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inp</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Reduce input `inp`. Return reduced input.</span>
<span class="sd">        To be defined in subclasses."""</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="c1"># Default: Don't reduce</span>
        <span class="k">return</span> <span class="n">inp</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The <code>CachingReducer</code> variant saves test results, such that we don't have to run the same tests again and again:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">CachingReducer</span><span class="p">(</span><span class="n">Reducer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""A reducer that also caches test outcomes"""</span>

    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cache</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inp</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">inp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="n">inp</span><span class="p">]</span>

        <span class="n">outcome</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="n">inp</span><span class="p">]</span> <span class="o">=</span> <span class="n">outcome</span>
        <span class="k">return</span> <span class="n">outcome</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Here comes the <em>Delta Debugging</em> reducer.  Delta Debugging implements the strategy sketched above: It first removes larger chunks of size $\frac{1}{2}$; if this does not fail, then we proceed to chunks of size $\frac{1}{4}$, then $\frac{1}{8}$ and so on.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Our implementation uses almost the same Python code as Zeller in [<a href="https://doi.org/10.1109/32.988498">Zeller <em>et al</em>, 2002</a>]; the only difference is that it has been adapted to work on Python 3 and our <code>Runner</code> framework.  The variable <code>n</code> (initially 2) indicates the granularity – in each step, chunks of size $\frac{1}{n}$ are cut away.  If none of the test fails (<code>some_complement_is_failing</code> is False), then <code>n</code> is doubled – until it reaches the length of the input.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">DeltaDebuggingReducer</span><span class="p">(</span><span class="n">CachingReducer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Reduce inputs using delta debugging."""</span>

    <span class="k">def</span> <span class="nf">reduce</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inp</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Reduce input `inp` using delta debugging. Return reduced input."""</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span> <span class="o">!=</span> <span class="n">Runner</span><span class="o">.</span><span class="n">PASS</span>

        <span class="n">n</span> <span class="o">=</span> <span class="mi">2</span>     <span class="c1"># Initial granularity</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">subset_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span>
            <span class="n">some_complement_is_failing</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">while</span> <span class="n">start</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">inp</span><span class="p">):</span>
                <span class="n">complement</span> <span class="o">=</span> <span class="n">inp</span><span class="p">[:</span><span class="nb">int</span><span class="p">(</span><span class="n">start</span><span class="p">)]</span> <span class="o">+</span> \
                    <span class="n">inp</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">start</span> <span class="o">+</span> <span class="n">subset_length</span><span class="p">):]</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="n">complement</span><span class="p">)</span> <span class="o">==</span> <span class="n">Runner</span><span class="o">.</span><span class="n">FAIL</span><span class="p">:</span>
                    <span class="n">inp</span> <span class="o">=</span> <span class="n">complement</span>
                    <span class="n">n</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="n">some_complement_is_failing</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">break</span>

                <span class="n">start</span> <span class="o">+=</span> <span class="n">subset_length</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">some_complement_is_failing</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">inp</span><span class="p">):</span>
                    <span class="k">break</span>
                <span class="n">n</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">inp</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">inp</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>To see how the <code>DeltaDebuggingReducer</code> works, let us run it on our failing input.  With each step, we see how the remaining input gets smaller and smaller, until only two characters remain:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">dd_reducer</span> <span class="o">=</span> <span class="n">DeltaDebuggingReducer</span><span class="p">(</span><span class="n">mystery</span><span class="p">,</span> <span class="n">log_test</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">dd_reducer</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">failing_input</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Test #1 ' 7:,&gt;((/$$-/-&gt;.;.=;(.%!:50#7*8=$&amp;&amp;=$9!%6(4=&amp;69\':\'&lt;3+0-3.24#7=!&amp;60)2/+";+&lt;7+1&lt;2!4$&gt;92+$1&lt;(3%&amp;5\'\'&gt;#' 97 FAIL
Test #2 '\'&lt;3+0-3.24#7=!&amp;60)2/+";+&lt;7+1&lt;2!4$&gt;92+$1&lt;(3%&amp;5\'\'&gt;#' 49 PASS
Test #3 " 7:,&gt;((/$$-/-&gt;.;.=;(.%!:50#7*8=$&amp;&amp;=$9!%6(4=&amp;69':" 48 PASS
Test #4 '50#7*8=$&amp;&amp;=$9!%6(4=&amp;69\':\'&lt;3+0-3.24#7=!&amp;60)2/+";+&lt;7+1&lt;2!4$&gt;92+$1&lt;(3%&amp;5\'\'&gt;#' 73 FAIL
Test #5 "50#7*8=$&amp;&amp;=$9!%6(4=&amp;69':&lt;7+1&lt;2!4$&gt;92+$1&lt;(3%&amp;5''&gt;#" 49 PASS
Test #6 '50#7*8=$&amp;&amp;=$9!%6(4=&amp;69\':\'&lt;3+0-3.24#7=!&amp;60)2/+";+' 48 FAIL
Test #7 '\'&lt;3+0-3.24#7=!&amp;60)2/+";+' 24 PASS
Test #8 "50#7*8=$&amp;&amp;=$9!%6(4=&amp;69':" 24 PASS
Test #9 '9!%6(4=&amp;69\':\'&lt;3+0-3.24#7=!&amp;60)2/+";+' 36 FAIL
Test #10 '9!%6(4=&amp;69\':=!&amp;60)2/+";+' 24 FAIL
Test #11 '=!&amp;60)2/+";+' 12 PASS
Test #12 "9!%6(4=&amp;69':" 12 PASS
Test #13 '=&amp;69\':=!&amp;60)2/+";+' 18 PASS
Test #14 '9!%6(4=!&amp;60)2/+";+' 18 FAIL
Test #15 '9!%6(42/+";+' 12 PASS
Test #16 '9!%6(4=!&amp;60)' 12 FAIL
Test #17 '=!&amp;60)' 6 PASS
Test #18 '9!%6(4' 6 PASS
Test #19 '6(4=!&amp;60)' 9 FAIL
Test #20 '6(460)' 6 FAIL
Test #21 '60)' 3 PASS
Test #22 '6(4' 3 PASS
Test #23 '(460)' 5 FAIL
Test #24 '460)' 4 PASS
Test #25 '(0)' 3 FAIL
Test #26 '0)' 2 PASS
Test #27 '(' 1 PASS
Test #28 '()' 2 FAIL
Test #29 ')' 1 PASS
</pre>
</div>

</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>'()'
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Now we know why <code>MysteryRunner</code> fails – it suffices that the input contains two matching parentheses.  Delta Debugging determines this in 29 steps.  Its result is <em>1-minimal</em>, meaning that every character contained is required to produce the error; removing any (as seen in tests <code>#27</code> and <code>#29</code>, above) no longer makes the test fail.  This property is guaranteed by the delta debugging algorithm, which in its last stage always tries to delete characters one by one.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>A reduced test case such as the one above has many advantages:</p>
<ul>
<li><p>A reduced test case <strong>reduces the <em>cognitive load</em> of the programmer</strong>.  The test case is shorter and focused, and thus does not burden the programmer with irrelevant details.  A reduced input typically leads to shorter executions and smaller program states, both of which reduce the search space as it comes to understanding the bug.  In our case, we have eliminated lots of irrelevant input – only the two characters the reduced input contains are relevant.</p>
</li>
<li><p>A reduced test case <strong>is easier to communicate</strong>.  All one needs here is the summary: <code>MysteryRunner fails on "()"</code>, which is much better than <code>MysteryRunner fails on a 4100-character input (attached)</code>.</p>
</li>
<li><p>A reduced test case helps in <strong>identifying duplicates</strong>.  If similar bugs have been reported already, and all of them have been reduced to the same cause (namely that the input contains matching parentheses), then it becomes obvious that all these bugs are different symptoms of the same underlying cause – and would all be resolved at once with one code fix.</p>
</li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>How effective is delta debugging?  In the best case (when the left half or the right half fails), the number of tests is logarithmic proportional to the length $n$ of an input (i.e., $O(\log_2 n)$); this is the same complexity as binary search.  In the worst case, though, delta debugging can require a number of tests proportional to $n^2$ (i.e., $O(n^2)$) – this happens in the case when we are down to character granularity, and we have to repeatedly tried to delete all characters, only to find that deleting the last character results in a failure [<a href="https://doi.org/10.1109/32.988498">Zeller <em>et al</em>, 2002</a>].  (This is a pretty pathological situation, though.)</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>In general, delta debugging is a robust algorithm that is easy to implement, easy to deploy, and easy to use – provided that the underlying test case is deterministic and runs quickly enough to warrant a number of experiments.  As these are the same prerequisites that make fuzzing effective, delta debugging makes an excellent companion to fuzzing.</p>
</div>
</div>
</div>
</div>

<div class="output_area">

<div class="output_html rendered_html output_subarea output_execute_result">

    

    <div class="quiz">
    <h3 class="quiz_title">Quiz</h3>
    <p>
    </p><div class="quiz_question">What happens if the function under test does not fail?</div>
    
    <p>
    </p><div class="quiz_options" title="Pick a choice.">

        <input type="radio" name="f10c350e-d3ef-11ef-83cb-6298cf1a5790" id="f10c350e-d3ef-11ef-83cb-6298cf1a5790-1" onclick="clear_selection('f10c350e-d3ef-11ef-83cb-6298cf1a5790')"/>
        <label id="f10c350e-d3ef-11ef-83cb-6298cf1a5790-1-label" for="f10c350e-d3ef-11ef-83cb-6298cf1a5790-1">Delta debugging searches for the minimal input that produces the same result</label><br/>

        <input type="radio" name="f10c350e-d3ef-11ef-83cb-6298cf1a5790" id="f10c350e-d3ef-11ef-83cb-6298cf1a5790-2" onclick="clear_selection('f10c350e-d3ef-11ef-83cb-6298cf1a5790')"/>
        <label id="f10c350e-d3ef-11ef-83cb-6298cf1a5790-2-label" for="f10c350e-d3ef-11ef-83cb-6298cf1a5790-2">Delta debugging starts a fuzzer to find a failure</label><br/>

        <input type="radio" name="f10c350e-d3ef-11ef-83cb-6298cf1a5790" id="f10c350e-d3ef-11ef-83cb-6298cf1a5790-3" onclick="clear_selection('f10c350e-d3ef-11ef-83cb-6298cf1a5790')"/>
        <label id="f10c350e-d3ef-11ef-83cb-6298cf1a5790-3-label" for="f10c350e-d3ef-11ef-83cb-6298cf1a5790-3">Delta debugging raises an AssertionError</label><br/>

        <input type="radio" name="f10c350e-d3ef-11ef-83cb-6298cf1a5790" id="f10c350e-d3ef-11ef-83cb-6298cf1a5790-4" onclick="clear_selection('f10c350e-d3ef-11ef-83cb-6298cf1a5790')"/>
        <label id="f10c350e-d3ef-11ef-83cb-6298cf1a5790-4-label" for="f10c350e-d3ef-11ef-83cb-6298cf1a5790-4">Delta debugging runs forever in a loop</label><br/>

    </div>
    
    <input id="f10c350e-d3ef-11ef-83cb-6298cf1a5790-submit" type="submit" value="Submit" onclick="check_selection('f10c350e-d3ef-11ef-83cb-6298cf1a5790', 8, 0, '0 ** 0 + 1 ** 0 + 0 ** 1 + 1 ** 1')"/>
    <span class="quiz_hint" id="f10c350e-d3ef-11ef-83cb-6298cf1a5790-hint"/>
    </div>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Indeed, <code>DeltaDebugger</code> checks if its assumptions hold. If not, an assertion fails.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">with</span> <span class="n">ExpectError</span><span class="p">():</span>
    <span class="n">dd_reducer</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="s2">"I am a passing input"</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Test #1 'I am a passing input' 20 PASS
</pre>
</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>Traceback (most recent call last):
  File "/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_29923/3080932113.py", line 2, in &lt;module&gt;
    dd_reducer.reduce("I am a passing input")
  File "/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_29923/2870451724.py", line 8, in reduce
    assert self.test(inp) != Runner.PASS
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AssertionError (expected)
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Grammar-Based-Input-Reduction">Grammar-Based Input Reduction</h2><p>If the input language is syntactically complex, delta debugging may take several attempts at reduction, and may not be able to reduce inputs at all.  In the second half of this chapter, we thus introduce an algorithm named <em>Grammar-Based Reduction</em> (or GRABR for short) that makes use of <em>grammars</em> to reduce syntactically complex inputs.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Lexical-Reduction-vs.-Syntactic-Rules">Lexical Reduction vs. Syntactic Rules</h3><p>Despite its general robustness, there are situations in which delta debugging might be inefficient or outright fail.  As an example, consider some <em>expression input</em> such as <code>1 + (2 * 3)</code>.  Delta debugging requires a number of tests to simplify the failure-inducing input, but it eventually returns a minimal input</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">expr_input</span> <span class="o">=</span> <span class="s2">"1 + (2 * 3)"</span>
<span class="n">dd_reducer</span> <span class="o">=</span> <span class="n">DeltaDebuggingReducer</span><span class="p">(</span><span class="n">mystery</span><span class="p">,</span> <span class="n">log_test</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">dd_reducer</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">expr_input</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Test #1 '1 + (2 * 3)' 11 FAIL
Test #2 '2 * 3)' 6 PASS
Test #3 '1 + (' 5 PASS
Test #4 '+ (2 * 3)' 9 FAIL
Test #5 '+ ( 3)' 6 FAIL
Test #6 ' 3)' 3 PASS
Test #7 '+ (' 3 PASS
Test #8 ' ( 3)' 5 FAIL
Test #9 '( 3)' 4 FAIL
Test #10 '3)' 2 PASS
Test #11 '( ' 2 PASS
Test #12 '(3)' 3 FAIL
Test #13 '()' 2 FAIL
Test #14 ')' 1 PASS
Test #15 '(' 1 PASS
</pre>
</div>

</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>'()'
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Looking at the tests, above, though, only few of them actually represent syntactically valid arithmetic expressions.  In a practical setting, we may want to test a program which actually <em>parses</em> such expressions, and which would <em>reject</em> all invalid inputs.  We define a class <code>EvalMysteryRunner</code> which first <em>parses</em> the given input (according to the rules of our expression grammar), and <em>only</em> if it fits would it be passed to our original <code>MysteryRunner</code>.  This simulates a setting in which we test an expression interpreter, and in which only valid inputs can trigger the bug.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="kn">from</span> <span class="nn"><a href="Grammars.html" class="import" target="_blank">Grammars</a></span> <span class="kn">import</span> <span class="n">EXPR_GRAMMAR</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="kn">from</span> <span class="nn"><a href="Parser.html" class="import" target="_blank">Parser</a></span> <span class="kn">import</span> <span class="n">EarleyParser</span><span class="p">,</span> <span class="n">Parser</span>  <span class="c1"># minor dependency</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">EvalMysteryRunner</span><span class="p">(</span><span class="n">MysteryRunner</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span> <span class="o">=</span> <span class="n">EarleyParser</span><span class="p">(</span><span class="n">EXPR_GRAMMAR</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inp</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Outcome</span><span class="p">]:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tree</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">SyntaxError</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="n">Runner</span><span class="o">.</span><span class="n">UNRESOLVED</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">eval_mystery</span> <span class="o">=</span> <span class="n">EvalMysteryRunner</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Under these circumstances, it turns out that delta debugging utterly fails.  None of the reductions it applies yield a syntactically valid input, so the input as a whole remains as complex as it was before.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">dd_reducer</span> <span class="o">=</span> <span class="n">DeltaDebuggingReducer</span><span class="p">(</span><span class="n">eval_mystery</span><span class="p">,</span> <span class="n">log_test</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">dd_reducer</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">expr_input</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Test #1 '1 + (2 * 3)' 11 FAIL
Test #2 '2 * 3)' 6 UNRESOLVED
Test #3 '1 + (' 5 UNRESOLVED
Test #4 '+ (2 * 3)' 9 UNRESOLVED
Test #5 '1 2 * 3)' 8 UNRESOLVED
Test #6 '1 + ( 3)' 8 UNRESOLVED
Test #7 '1 + (2 *' 8 UNRESOLVED
Test #8 ' + (2 * 3)' 10 UNRESOLVED
Test #9 '1+ (2 * 3)' 10 UNRESOLVED
Test #10 '1 (2 * 3)' 9 UNRESOLVED
Test #11 '1 + 2 * 3)' 10 UNRESOLVED
Test #12 '1 + ( * 3)' 10 UNRESOLVED
Test #13 '1 + (2 3)' 9 UNRESOLVED
Test #14 '1 + (2 *3)' 10 UNRESOLVED
Test #15 '1 + (2 * ' 9 UNRESOLVED
Test #16 '1  (2 * 3)' 10 UNRESOLVED
Test #17 '1 +(2 * 3)' 10 UNRESOLVED
Test #18 '1 + (2* 3)' 10 UNRESOLVED
Test #19 '1 + (2  3)' 10 UNRESOLVED
Test #20 '1 + (2 * )' 10 UNRESOLVED
Test #21 '1 + (2 * 3' 10 UNRESOLVED
</pre>
</div>

</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>'1 + (2 * 3)'
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>This behavior is possible if the program under test has several constraints regarding input validity.  Delta debugging is not aware of these constraints (nor of the input structure in general), so it might violate these constraints again and again.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="A-Grammar-Based-Reduction-Approach">A Grammar-Based Reduction Approach</h3><p>To reduce inputs with high syntactical complexity, we use another approach: Rather than reducing the input string, we reduce the <em>tree</em> representing its structure.  The general idea is to start with a <em>derivation tree</em> coming from parsing the input, and then <em>substitute subtrees by smaller subtrees of the same type</em>.  These alternate subtrees can either come</p>
<ol>
<li>From the tree itself, or</li>
<li>By applying an alternate grammar expansion using elements from the tree.</li>
</ol>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let us show these two strategies using an example.  We start with a derivation tree from an arithmetic expression:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="kn">from</span> <span class="nn"><a href="Grammars.html" class="import" target="_blank">Grammars</a></span> <span class="kn">import</span> <span class="n">Grammar</span>
<span class="kn">from</span> <span class="nn"><a href="GrammarFuzzer.html" class="import" target="_blank">GrammarFuzzer</a></span> <span class="kn">import</span> <span class="n">all_terminals</span><span class="p">,</span> <span class="n">expansion_to_children</span><span class="p">,</span> <span class="n">display_tree</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">derivation_tree</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">EarleyParser</span><span class="p">(</span><span class="n">EXPR_GRAMMAR</span><span class="p">)</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">expr_input</span><span class="p">)</span>
<span class="n">display_tree</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_svg output_subarea output_execute_result">


<!-- Generated by graphviz version 12.2.1 (20241206.2353)
 -->
<!-- Pages: 1 -->
<svg width="210pt" height="575pt" viewbox="0.00 0.00 209.62 575.00" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 571)">
<polygon fill="white" stroke="none" points="-4,4 -4,-571 205.62,-571 205.62,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="81.62" y="-553.7" font-family="Times,serif" font-size="14.00">&lt;start&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="81.62" y="-503.45" font-family="Times,serif" font-size="14.00">&lt;expr&gt;</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0-&gt;1</title>
<path fill="none" stroke="black" d="M81.62,-552.96C81.62,-546.74 81.62,-536.65 81.62,-527.89"/>
<polygon fill="black" stroke="black" points="85.13,-528.1 81.63,-518.1 78.13,-528.1 85.13,-528.1"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="33.62" y="-453.2" font-family="Times,serif" font-size="14.00">&lt;term&gt;</text>
</g>
<!-- 1&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>1-&gt;2</title>
<path fill="none" stroke="black" d="M75.74,-502.71C68.76,-495.69 56.89,-483.76 47.53,-474.35"/>
<polygon fill="black" stroke="black" points="50.16,-472.03 40.63,-467.41 45.2,-476.97 50.16,-472.03"/>
</g>
<!-- 7 -->
<g id="node8" class="node">
<title>7</title>
<text text-anchor="middle" x="81.62" y="-453.2" font-family="Times,serif" font-size="14.00"> + </text>
</g>
<!-- 1&#45;&gt;7 -->
<g id="edge7" class="edge">
<title>1-&gt;7</title>
<path fill="none" stroke="black" d="M81.62,-502.71C81.62,-496.49 81.62,-486.4 81.62,-477.64"/>
<polygon fill="black" stroke="black" points="85.13,-477.85 81.63,-467.85 78.13,-477.85 85.13,-477.85"/>
</g>
<!-- 8 -->
<g id="node9" class="node">
<title>8</title>
<text text-anchor="middle" x="127.62" y="-453.2" font-family="Times,serif" font-size="14.00">&lt;expr&gt;</text>
</g>
<!-- 1&#45;&gt;8 -->
<g id="edge8" class="edge">
<title>1-&gt;8</title>
<path fill="none" stroke="black" d="M87.27,-502.71C93.89,-495.76 105.1,-484 114.03,-474.64"/>
<polygon fill="black" stroke="black" points="116.53,-477.09 120.89,-467.44 111.46,-472.26 116.53,-477.09"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="31.62" y="-402.95" font-family="Times,serif" font-size="14.00">&lt;factor&gt;</text>
</g>
<!-- 2&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>2-&gt;3</title>
<path fill="none" stroke="black" d="M33.38,-452.46C33.12,-446.24 32.7,-436.15 32.34,-427.39"/>
<polygon fill="black" stroke="black" points="35.85,-427.45 31.93,-417.6 28.85,-427.74 35.85,-427.45"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="27.62" y="-352.7" font-family="Times,serif" font-size="14.00">&lt;integer&gt;</text>
</g>
<!-- 3&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>3-&gt;4</title>
<path fill="none" stroke="black" d="M31.13,-402.21C30.62,-395.99 29.78,-385.9 29.06,-377.14"/>
<polygon fill="black" stroke="black" points="32.56,-377.02 28.24,-367.35 25.58,-377.6 32.56,-377.02"/>
</g>
<!-- 5 -->
<g id="node6" class="node">
<title>5</title>
<text text-anchor="middle" x="20.62" y="-302.45" font-family="Times,serif" font-size="14.00">&lt;digit&gt;</text>
</g>
<!-- 4&#45;&gt;5 -->
<g id="edge5" class="edge">
<title>4-&gt;5</title>
<path fill="none" stroke="black" d="M26.77,-351.96C25.86,-345.74 24.4,-335.65 23.13,-326.89"/>
<polygon fill="black" stroke="black" points="26.61,-326.48 21.71,-317.09 19.68,-327.49 26.61,-326.48"/>
</g>
<!-- 6 -->
<g id="node7" class="node">
<title>6</title>
<text text-anchor="middle" x="20.62" y="-252.2" font-family="Times,serif" font-size="14.00">1 (49)</text>
</g>
<!-- 5&#45;&gt;6 -->
<g id="edge6" class="edge">
<title>5-&gt;6</title>
<path fill="none" stroke="black" d="M20.62,-301.71C20.62,-295.49 20.62,-285.4 20.62,-276.64"/>
<polygon fill="black" stroke="black" points="24.13,-276.85 20.63,-266.85 17.13,-276.85 24.13,-276.85"/>
</g>
<!-- 9 -->
<g id="node10" class="node">
<title>9</title>
<text text-anchor="middle" x="127.62" y="-402.95" font-family="Times,serif" font-size="14.00">&lt;term&gt;</text>
</g>
<!-- 8&#45;&gt;9 -->
<g id="edge9" class="edge">
<title>8-&gt;9</title>
<path fill="none" stroke="black" d="M127.62,-452.46C127.62,-446.24 127.62,-436.15 127.62,-427.39"/>
<polygon fill="black" stroke="black" points="131.13,-427.6 127.63,-417.6 124.13,-427.6 131.13,-427.6"/>
</g>
<!-- 10 -->
<g id="node11" class="node">
<title>10</title>
<text text-anchor="middle" x="127.62" y="-352.7" font-family="Times,serif" font-size="14.00">&lt;factor&gt;</text>
</g>
<!-- 9&#45;&gt;10 -->
<g id="edge10" class="edge">
<title>9-&gt;10</title>
<path fill="none" stroke="black" d="M127.62,-402.21C127.62,-395.99 127.62,-385.9 127.62,-377.14"/>
<polygon fill="black" stroke="black" points="131.13,-377.35 127.63,-367.35 124.13,-377.35 131.13,-377.35"/>
</g>
<!-- 11 -->
<g id="node12" class="node">
<title>11</title>
<text text-anchor="middle" x="74.62" y="-302.45" font-family="Times,serif" font-size="14.00">( (40)</text>
</g>
<!-- 10&#45;&gt;11 -->
<g id="edge11" class="edge">
<title>10-&gt;11</title>
<path fill="none" stroke="black" d="M121.13,-351.96C113.34,-344.87 100.04,-332.76 89.65,-323.31"/>
<polygon fill="black" stroke="black" points="92.05,-320.75 82.3,-316.61 87.33,-325.93 92.05,-320.75"/>
</g>
<!-- 12 -->
<g id="node13" class="node">
<title>12</title>
<text text-anchor="middle" x="128.62" y="-302.45" font-family="Times,serif" font-size="14.00">&lt;expr&gt;</text>
</g>
<!-- 10&#45;&gt;12 -->
<g id="edge12" class="edge">
<title>10-&gt;12</title>
<path fill="none" stroke="black" d="M127.75,-351.96C127.88,-345.74 128.09,-335.65 128.27,-326.89"/>
<polygon fill="black" stroke="black" points="131.76,-327.17 128.47,-317.1 124.76,-327.03 131.76,-327.17"/>
</g>
<!-- 24 -->
<g id="node25" class="node">
<title>24</title>
<text text-anchor="middle" x="182.62" y="-302.45" font-family="Times,serif" font-size="14.00">) (41)</text>
</g>
<!-- 10&#45;&gt;24 -->
<g id="edge24" class="edge">
<title>10-&gt;24</title>
<path fill="none" stroke="black" d="M134.37,-351.96C142.53,-344.8 156.53,-332.51 167.36,-323.02"/>
<polygon fill="black" stroke="black" points="169.48,-325.81 174.69,-316.59 164.86,-320.55 169.48,-325.81"/>
</g>
<!-- 13 -->
<g id="node14" class="node">
<title>13</title>
<text text-anchor="middle" x="128.62" y="-252.2" font-family="Times,serif" font-size="14.00">&lt;term&gt;</text>
</g>
<!-- 12&#45;&gt;13 -->
<g id="edge13" class="edge">
<title>12-&gt;13</title>
<path fill="none" stroke="black" d="M128.62,-301.71C128.62,-295.49 128.62,-285.4 128.62,-276.64"/>
<polygon fill="black" stroke="black" points="132.13,-276.85 128.63,-266.85 125.13,-276.85 132.13,-276.85"/>
</g>
<!-- 14 -->
<g id="node15" class="node">
<title>14</title>
<text text-anchor="middle" x="79.62" y="-201.95" font-family="Times,serif" font-size="14.00">&lt;factor&gt;</text>
</g>
<!-- 13&#45;&gt;14 -->
<g id="edge14" class="edge">
<title>13-&gt;14</title>
<path fill="none" stroke="black" d="M122.62,-251.46C115.49,-244.44 103.37,-232.51 93.81,-223.1"/>
<polygon fill="black" stroke="black" points="96.34,-220.67 86.76,-216.15 91.43,-225.66 96.34,-220.67"/>
</g>
<!-- 18 -->
<g id="node19" class="node">
<title>18</title>
<text text-anchor="middle" x="128.62" y="-201.95" font-family="Times,serif" font-size="14.00"> * </text>
</g>
<!-- 13&#45;&gt;18 -->
<g id="edge18" class="edge">
<title>13-&gt;18</title>
<path fill="none" stroke="black" d="M128.62,-251.46C128.62,-245.24 128.62,-235.15 128.62,-226.39"/>
<polygon fill="black" stroke="black" points="132.13,-226.6 128.63,-216.6 125.13,-226.6 132.13,-226.6"/>
</g>
<!-- 19 -->
<g id="node20" class="node">
<title>19</title>
<text text-anchor="middle" x="174.62" y="-201.95" font-family="Times,serif" font-size="14.00">&lt;term&gt;</text>
</g>
<!-- 13&#45;&gt;19 -->
<g id="edge19" class="edge">
<title>13-&gt;19</title>
<path fill="none" stroke="black" d="M134.27,-251.46C140.89,-244.51 152.1,-232.75 161.03,-223.39"/>
<polygon fill="black" stroke="black" points="163.53,-225.84 167.89,-216.19 158.46,-221.01 163.53,-225.84"/>
</g>
<!-- 15 -->
<g id="node16" class="node">
<title>15</title>
<text text-anchor="middle" x="79.62" y="-151.7" font-family="Times,serif" font-size="14.00">&lt;integer&gt;</text>
</g>
<!-- 14&#45;&gt;15 -->
<g id="edge15" class="edge">
<title>14-&gt;15</title>
<path fill="none" stroke="black" d="M79.62,-201.21C79.62,-194.99 79.62,-184.9 79.62,-176.14"/>
<polygon fill="black" stroke="black" points="83.13,-176.35 79.63,-166.35 76.13,-176.35 83.13,-176.35"/>
</g>
<!-- 16 -->
<g id="node17" class="node">
<title>16</title>
<text text-anchor="middle" x="79.62" y="-101.45" font-family="Times,serif" font-size="14.00">&lt;digit&gt;</text>
</g>
<!-- 15&#45;&gt;16 -->
<g id="edge16" class="edge">
<title>15-&gt;16</title>
<path fill="none" stroke="black" d="M79.62,-150.96C79.62,-144.74 79.62,-134.65 79.62,-125.89"/>
<polygon fill="black" stroke="black" points="83.13,-126.1 79.63,-116.1 76.13,-126.1 83.13,-126.1"/>
</g>
<!-- 17 -->
<g id="node18" class="node">
<title>17</title>
<text text-anchor="middle" x="79.62" y="-51.2" font-family="Times,serif" font-size="14.00">2 (50)</text>
</g>
<!-- 16&#45;&gt;17 -->
<g id="edge17" class="edge">
<title>16-&gt;17</title>
<path fill="none" stroke="black" d="M79.62,-100.71C79.62,-94.49 79.62,-84.4 79.62,-75.64"/>
<polygon fill="black" stroke="black" points="83.13,-75.85 79.63,-65.85 76.13,-75.85 83.13,-75.85"/>
</g>
<!-- 20 -->
<g id="node21" class="node">
<title>20</title>
<text text-anchor="middle" x="174.62" y="-151.7" font-family="Times,serif" font-size="14.00">&lt;factor&gt;</text>
</g>
<!-- 19&#45;&gt;20 -->
<g id="edge20" class="edge">
<title>19-&gt;20</title>
<path fill="none" stroke="black" d="M174.62,-201.21C174.62,-194.99 174.62,-184.9 174.62,-176.14"/>
<polygon fill="black" stroke="black" points="178.13,-176.35 174.63,-166.35 171.13,-176.35 178.13,-176.35"/>
</g>
<!-- 21 -->
<g id="node22" class="node">
<title>21</title>
<text text-anchor="middle" x="174.62" y="-101.45" font-family="Times,serif" font-size="14.00">&lt;integer&gt;</text>
</g>
<!-- 20&#45;&gt;21 -->
<g id="edge21" class="edge">
<title>20-&gt;21</title>
<path fill="none" stroke="black" d="M174.62,-150.96C174.62,-144.74 174.62,-134.65 174.62,-125.89"/>
<polygon fill="black" stroke="black" points="178.13,-126.1 174.63,-116.1 171.13,-126.1 178.13,-126.1"/>
</g>
<!-- 22 -->
<g id="node23" class="node">
<title>22</title>
<text text-anchor="middle" x="174.62" y="-51.2" font-family="Times,serif" font-size="14.00">&lt;digit&gt;</text>
</g>
<!-- 21&#45;&gt;22 -->
<g id="edge22" class="edge">
<title>21-&gt;22</title>
<path fill="none" stroke="black" d="M174.62,-100.71C174.62,-94.49 174.62,-84.4 174.62,-75.64"/>
<polygon fill="black" stroke="black" points="178.13,-75.85 174.63,-65.85 171.13,-75.85 178.13,-75.85"/>
</g>
<!-- 23 -->
<g id="node24" class="node">
<title>23</title>
<text text-anchor="middle" x="174.62" y="-0.95" font-family="Times,serif" font-size="14.00">3 (51)</text>
</g>
<!-- 22&#45;&gt;23 -->
<g id="edge23" class="edge">
<title>22-&gt;23</title>
<path fill="none" stroke="black" d="M174.62,-50.46C174.62,-44.24 174.62,-34.15 174.62,-25.39"/>
<polygon fill="black" stroke="black" points="178.13,-25.6 174.63,-15.6 171.13,-25.6 178.13,-25.6"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Simplifying-by-Replacing-Subtrees">Simplifying by Replacing Subtrees</h3></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>To simplify this tree, we could replace any <code>&lt;expr&gt;</code> symbol up in the tree with some <code>&lt;expr&gt;</code> subtree down in the tree.  For instance, we could replace the uppermost <code>&lt;expr&gt;</code> with its right <code>&lt;expr&gt;</code> subtree, yielding the string <code>(2 + 3)</code>:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/copy.html" class="import" target="_blank">copy</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">new_derivation_tree</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
<span class="c1"># We really should have some query language</span>
<span class="n">sub_expr_tree</span> <span class="o">=</span> <span class="n">new_derivation_tree</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
<span class="n">display_tree</span><span class="p">(</span><span class="n">sub_expr_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_svg output_subarea output_execute_result">


<!-- Generated by graphviz version 12.2.1 (20241206.2353)
 -->
<!-- Pages: 1 -->
<svg width="157pt" height="475pt" viewbox="0.00 0.00 157.00 474.50" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 470.5)">
<polygon fill="white" stroke="none" points="-4,4 -4,-470.5 153,-470.5 153,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="76" y="-453.2" font-family="Times,serif" font-size="14.00">&lt;expr&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="76" y="-402.95" font-family="Times,serif" font-size="14.00">&lt;term&gt;</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0-&gt;1</title>
<path fill="none" stroke="black" d="M76,-452.46C76,-446.24 76,-436.15 76,-427.39"/>
<polygon fill="black" stroke="black" points="79.5,-427.6 76,-417.6 72.5,-427.6 79.5,-427.6"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="76" y="-352.7" font-family="Times,serif" font-size="14.00">&lt;factor&gt;</text>
</g>
<!-- 1&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>1-&gt;2</title>
<path fill="none" stroke="black" d="M76,-402.21C76,-395.99 76,-385.9 76,-377.14"/>
<polygon fill="black" stroke="black" points="79.5,-377.35 76,-367.35 72.5,-377.35 79.5,-377.35"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="22" y="-302.45" font-family="Times,serif" font-size="14.00">( (40)</text>
</g>
<!-- 2&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>2-&gt;3</title>
<path fill="none" stroke="black" d="M69.38,-351.96C61.36,-344.8 47.62,-332.51 36.99,-323.02"/>
<polygon fill="black" stroke="black" points="39.59,-320.65 29.8,-316.6 34.93,-325.87 39.59,-320.65"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="76" y="-302.45" font-family="Times,serif" font-size="14.00">&lt;expr&gt;</text>
</g>
<!-- 2&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>2-&gt;4</title>
<path fill="none" stroke="black" d="M76,-351.96C76,-345.74 76,-335.65 76,-326.89"/>
<polygon fill="black" stroke="black" points="79.5,-327.1 76,-317.1 72.5,-327.1 79.5,-327.1"/>
</g>
<!-- 16 -->
<g id="node17" class="node">
<title>16</title>
<text text-anchor="middle" x="130" y="-302.45" font-family="Times,serif" font-size="14.00">) (41)</text>
</g>
<!-- 2&#45;&gt;16 -->
<g id="edge16" class="edge">
<title>2-&gt;16</title>
<path fill="none" stroke="black" d="M82.62,-351.96C90.64,-344.8 104.38,-332.51 115.01,-323.02"/>
<polygon fill="black" stroke="black" points="117.07,-325.87 122.2,-316.6 112.41,-320.65 117.07,-325.87"/>
</g>
<!-- 5 -->
<g id="node6" class="node">
<title>5</title>
<text text-anchor="middle" x="76" y="-252.2" font-family="Times,serif" font-size="14.00">&lt;term&gt;</text>
</g>
<!-- 4&#45;&gt;5 -->
<g id="edge5" class="edge">
<title>4-&gt;5</title>
<path fill="none" stroke="black" d="M76,-301.71C76,-295.49 76,-285.4 76,-276.64"/>
<polygon fill="black" stroke="black" points="79.5,-276.85 76,-266.85 72.5,-276.85 79.5,-276.85"/>
</g>
<!-- 6 -->
<g id="node7" class="node">
<title>6</title>
<text text-anchor="middle" x="27" y="-201.95" font-family="Times,serif" font-size="14.00">&lt;factor&gt;</text>
</g>
<!-- 5&#45;&gt;6 -->
<g id="edge6" class="edge">
<title>5-&gt;6</title>
<path fill="none" stroke="black" d="M69.99,-251.46C62.86,-244.44 50.75,-232.51 41.19,-223.1"/>
<polygon fill="black" stroke="black" points="43.72,-220.67 34.14,-216.15 38.81,-225.66 43.72,-220.67"/>
</g>
<!-- 10 -->
<g id="node11" class="node">
<title>10</title>
<text text-anchor="middle" x="76" y="-201.95" font-family="Times,serif" font-size="14.00"> * </text>
</g>
<!-- 5&#45;&gt;10 -->
<g id="edge10" class="edge">
<title>5-&gt;10</title>
<path fill="none" stroke="black" d="M76,-251.46C76,-245.24 76,-235.15 76,-226.39"/>
<polygon fill="black" stroke="black" points="79.5,-226.6 76,-216.6 72.5,-226.6 79.5,-226.6"/>
</g>
<!-- 11 -->
<g id="node12" class="node">
<title>11</title>
<text text-anchor="middle" x="122" y="-201.95" font-family="Times,serif" font-size="14.00">&lt;term&gt;</text>
</g>
<!-- 5&#45;&gt;11 -->
<g id="edge11" class="edge">
<title>5-&gt;11</title>
<path fill="none" stroke="black" d="M81.64,-251.46C88.26,-244.51 99.47,-232.75 108.4,-223.39"/>
<polygon fill="black" stroke="black" points="110.9,-225.84 115.27,-216.19 105.84,-221.01 110.9,-225.84"/>
</g>
<!-- 7 -->
<g id="node8" class="node">
<title>7</title>
<text text-anchor="middle" x="27" y="-151.7" font-family="Times,serif" font-size="14.00">&lt;integer&gt;</text>
</g>
<!-- 6&#45;&gt;7 -->
<g id="edge7" class="edge">
<title>6-&gt;7</title>
<path fill="none" stroke="black" d="M27,-201.21C27,-194.99 27,-184.9 27,-176.14"/>
<polygon fill="black" stroke="black" points="30.5,-176.35 27,-166.35 23.5,-176.35 30.5,-176.35"/>
</g>
<!-- 8 -->
<g id="node9" class="node">
<title>8</title>
<text text-anchor="middle" x="27" y="-101.45" font-family="Times,serif" font-size="14.00">&lt;digit&gt;</text>
</g>
<!-- 7&#45;&gt;8 -->
<g id="edge8" class="edge">
<title>7-&gt;8</title>
<path fill="none" stroke="black" d="M27,-150.96C27,-144.74 27,-134.65 27,-125.89"/>
<polygon fill="black" stroke="black" points="30.5,-126.1 27,-116.1 23.5,-126.1 30.5,-126.1"/>
</g>
<!-- 9 -->
<g id="node10" class="node">
<title>9</title>
<text text-anchor="middle" x="27" y="-51.2" font-family="Times,serif" font-size="14.00">2 (50)</text>
</g>
<!-- 8&#45;&gt;9 -->
<g id="edge9" class="edge">
<title>8-&gt;9</title>
<path fill="none" stroke="black" d="M27,-100.71C27,-94.49 27,-84.4 27,-75.64"/>
<polygon fill="black" stroke="black" points="30.5,-75.85 27,-65.85 23.5,-75.85 30.5,-75.85"/>
</g>
<!-- 12 -->
<g id="node13" class="node">
<title>12</title>
<text text-anchor="middle" x="122" y="-151.7" font-family="Times,serif" font-size="14.00">&lt;factor&gt;</text>
</g>
<!-- 11&#45;&gt;12 -->
<g id="edge12" class="edge">
<title>11-&gt;12</title>
<path fill="none" stroke="black" d="M122,-201.21C122,-194.99 122,-184.9 122,-176.14"/>
<polygon fill="black" stroke="black" points="125.5,-176.35 122,-166.35 118.5,-176.35 125.5,-176.35"/>
</g>
<!-- 13 -->
<g id="node14" class="node">
<title>13</title>
<text text-anchor="middle" x="122" y="-101.45" font-family="Times,serif" font-size="14.00">&lt;integer&gt;</text>
</g>
<!-- 12&#45;&gt;13 -->
<g id="edge13" class="edge">
<title>12-&gt;13</title>
<path fill="none" stroke="black" d="M122,-150.96C122,-144.74 122,-134.65 122,-125.89"/>
<polygon fill="black" stroke="black" points="125.5,-126.1 122,-116.1 118.5,-126.1 125.5,-126.1"/>
</g>
<!-- 14 -->
<g id="node15" class="node">
<title>14</title>
<text text-anchor="middle" x="122" y="-51.2" font-family="Times,serif" font-size="14.00">&lt;digit&gt;</text>
</g>
<!-- 13&#45;&gt;14 -->
<g id="edge14" class="edge">
<title>13-&gt;14</title>
<path fill="none" stroke="black" d="M122,-100.71C122,-94.49 122,-84.4 122,-75.64"/>
<polygon fill="black" stroke="black" points="125.5,-75.85 122,-65.85 118.5,-75.85 125.5,-75.85"/>
</g>
<!-- 15 -->
<g id="node16" class="node">
<title>15</title>
<text text-anchor="middle" x="122" y="-0.95" font-family="Times,serif" font-size="14.00">3 (51)</text>
</g>
<!-- 14&#45;&gt;15 -->
<g id="edge15" class="edge">
<title>14-&gt;15</title>
<path fill="none" stroke="black" d="M122,-50.46C122,-44.24 122,-34.15 122,-25.39"/>
<polygon fill="black" stroke="black" points="125.5,-25.6 122,-15.6 118.5,-25.6 125.5,-25.6"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">new_derivation_tree</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">sub_expr_tree</span>
<span class="n">display_tree</span><span class="p">(</span><span class="n">new_derivation_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_svg output_subarea output_execute_result">


<!-- Generated by graphviz version 12.2.1 (20241206.2353)
 -->
<!-- Pages: 1 -->
<svg width="157pt" height="525pt" viewbox="0.00 0.00 157.00 524.75" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 520.75)">
<polygon fill="white" stroke="none" points="-4,4 -4,-520.75 153,-520.75 153,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="76" y="-503.45" font-family="Times,serif" font-size="14.00">&lt;start&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="76" y="-453.2" font-family="Times,serif" font-size="14.00">&lt;expr&gt;</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0-&gt;1</title>
<path fill="none" stroke="black" d="M76,-502.71C76,-496.49 76,-486.4 76,-477.64"/>
<polygon fill="black" stroke="black" points="79.5,-477.85 76,-467.85 72.5,-477.85 79.5,-477.85"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="76" y="-402.95" font-family="Times,serif" font-size="14.00">&lt;term&gt;</text>
</g>
<!-- 1&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>1-&gt;2</title>
<path fill="none" stroke="black" d="M76,-452.46C76,-446.24 76,-436.15 76,-427.39"/>
<polygon fill="black" stroke="black" points="79.5,-427.6 76,-417.6 72.5,-427.6 79.5,-427.6"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="76" y="-352.7" font-family="Times,serif" font-size="14.00">&lt;factor&gt;</text>
</g>
<!-- 2&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>2-&gt;3</title>
<path fill="none" stroke="black" d="M76,-402.21C76,-395.99 76,-385.9 76,-377.14"/>
<polygon fill="black" stroke="black" points="79.5,-377.35 76,-367.35 72.5,-377.35 79.5,-377.35"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="22" y="-302.45" font-family="Times,serif" font-size="14.00">( (40)</text>
</g>
<!-- 3&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>3-&gt;4</title>
<path fill="none" stroke="black" d="M69.38,-351.96C61.36,-344.8 47.62,-332.51 36.99,-323.02"/>
<polygon fill="black" stroke="black" points="39.59,-320.65 29.8,-316.6 34.93,-325.87 39.59,-320.65"/>
</g>
<!-- 5 -->
<g id="node6" class="node">
<title>5</title>
<text text-anchor="middle" x="76" y="-302.45" font-family="Times,serif" font-size="14.00">&lt;expr&gt;</text>
</g>
<!-- 3&#45;&gt;5 -->
<g id="edge5" class="edge">
<title>3-&gt;5</title>
<path fill="none" stroke="black" d="M76,-351.96C76,-345.74 76,-335.65 76,-326.89"/>
<polygon fill="black" stroke="black" points="79.5,-327.1 76,-317.1 72.5,-327.1 79.5,-327.1"/>
</g>
<!-- 17 -->
<g id="node18" class="node">
<title>17</title>
<text text-anchor="middle" x="130" y="-302.45" font-family="Times,serif" font-size="14.00">) (41)</text>
</g>
<!-- 3&#45;&gt;17 -->
<g id="edge17" class="edge">
<title>3-&gt;17</title>
<path fill="none" stroke="black" d="M82.62,-351.96C90.64,-344.8 104.38,-332.51 115.01,-323.02"/>
<polygon fill="black" stroke="black" points="117.07,-325.87 122.2,-316.6 112.41,-320.65 117.07,-325.87"/>
</g>
<!-- 6 -->
<g id="node7" class="node">
<title>6</title>
<text text-anchor="middle" x="76" y="-252.2" font-family="Times,serif" font-size="14.00">&lt;term&gt;</text>
</g>
<!-- 5&#45;&gt;6 -->
<g id="edge6" class="edge">
<title>5-&gt;6</title>
<path fill="none" stroke="black" d="M76,-301.71C76,-295.49 76,-285.4 76,-276.64"/>
<polygon fill="black" stroke="black" points="79.5,-276.85 76,-266.85 72.5,-276.85 79.5,-276.85"/>
</g>
<!-- 7 -->
<g id="node8" class="node">
<title>7</title>
<text text-anchor="middle" x="27" y="-201.95" font-family="Times,serif" font-size="14.00">&lt;factor&gt;</text>
</g>
<!-- 6&#45;&gt;7 -->
<g id="edge7" class="edge">
<title>6-&gt;7</title>
<path fill="none" stroke="black" d="M69.99,-251.46C62.86,-244.44 50.75,-232.51 41.19,-223.1"/>
<polygon fill="black" stroke="black" points="43.72,-220.67 34.14,-216.15 38.81,-225.66 43.72,-220.67"/>
</g>
<!-- 11 -->
<g id="node12" class="node">
<title>11</title>
<text text-anchor="middle" x="76" y="-201.95" font-family="Times,serif" font-size="14.00"> * </text>
</g>
<!-- 6&#45;&gt;11 -->
<g id="edge11" class="edge">
<title>6-&gt;11</title>
<path fill="none" stroke="black" d="M76,-251.46C76,-245.24 76,-235.15 76,-226.39"/>
<polygon fill="black" stroke="black" points="79.5,-226.6 76,-216.6 72.5,-226.6 79.5,-226.6"/>
</g>
<!-- 12 -->
<g id="node13" class="node">
<title>12</title>
<text text-anchor="middle" x="122" y="-201.95" font-family="Times,serif" font-size="14.00">&lt;term&gt;</text>
</g>
<!-- 6&#45;&gt;12 -->
<g id="edge12" class="edge">
<title>6-&gt;12</title>
<path fill="none" stroke="black" d="M81.64,-251.46C88.26,-244.51 99.47,-232.75 108.4,-223.39"/>
<polygon fill="black" stroke="black" points="110.9,-225.84 115.27,-216.19 105.84,-221.01 110.9,-225.84"/>
</g>
<!-- 8 -->
<g id="node9" class="node">
<title>8</title>
<text text-anchor="middle" x="27" y="-151.7" font-family="Times,serif" font-size="14.00">&lt;integer&gt;</text>
</g>
<!-- 7&#45;&gt;8 -->
<g id="edge8" class="edge">
<title>7-&gt;8</title>
<path fill="none" stroke="black" d="M27,-201.21C27,-194.99 27,-184.9 27,-176.14"/>
<polygon fill="black" stroke="black" points="30.5,-176.35 27,-166.35 23.5,-176.35 30.5,-176.35"/>
</g>
<!-- 9 -->
<g id="node10" class="node">
<title>9</title>
<text text-anchor="middle" x="27" y="-101.45" font-family="Times,serif" font-size="14.00">&lt;digit&gt;</text>
</g>
<!-- 8&#45;&gt;9 -->
<g id="edge9" class="edge">
<title>8-&gt;9</title>
<path fill="none" stroke="black" d="M27,-150.96C27,-144.74 27,-134.65 27,-125.89"/>
<polygon fill="black" stroke="black" points="30.5,-126.1 27,-116.1 23.5,-126.1 30.5,-126.1"/>
</g>
<!-- 10 -->
<g id="node11" class="node">
<title>10</title>
<text text-anchor="middle" x="27" y="-51.2" font-family="Times,serif" font-size="14.00">2 (50)</text>
</g>
<!-- 9&#45;&gt;10 -->
<g id="edge10" class="edge">
<title>9-&gt;10</title>
<path fill="none" stroke="black" d="M27,-100.71C27,-94.49 27,-84.4 27,-75.64"/>
<polygon fill="black" stroke="black" points="30.5,-75.85 27,-65.85 23.5,-75.85 30.5,-75.85"/>
</g>
<!-- 13 -->
<g id="node14" class="node">
<title>13</title>
<text text-anchor="middle" x="122" y="-151.7" font-family="Times,serif" font-size="14.00">&lt;factor&gt;</text>
</g>
<!-- 12&#45;&gt;13 -->
<g id="edge13" class="edge">
<title>12-&gt;13</title>
<path fill="none" stroke="black" d="M122,-201.21C122,-194.99 122,-184.9 122,-176.14"/>
<polygon fill="black" stroke="black" points="125.5,-176.35 122,-166.35 118.5,-176.35 125.5,-176.35"/>
</g>
<!-- 14 -->
<g id="node15" class="node">
<title>14</title>
<text text-anchor="middle" x="122" y="-101.45" font-family="Times,serif" font-size="14.00">&lt;integer&gt;</text>
</g>
<!-- 13&#45;&gt;14 -->
<g id="edge14" class="edge">
<title>13-&gt;14</title>
<path fill="none" stroke="black" d="M122,-150.96C122,-144.74 122,-134.65 122,-125.89"/>
<polygon fill="black" stroke="black" points="125.5,-126.1 122,-116.1 118.5,-126.1 125.5,-126.1"/>
</g>
<!-- 15 -->
<g id="node16" class="node">
<title>15</title>
<text text-anchor="middle" x="122" y="-51.2" font-family="Times,serif" font-size="14.00">&lt;digit&gt;</text>
</g>
<!-- 14&#45;&gt;15 -->
<g id="edge15" class="edge">
<title>14-&gt;15</title>
<path fill="none" stroke="black" d="M122,-100.71C122,-94.49 122,-84.4 122,-75.64"/>
<polygon fill="black" stroke="black" points="125.5,-75.85 122,-65.85 118.5,-75.85 125.5,-75.85"/>
</g>
<!-- 16 -->
<g id="node17" class="node">
<title>16</title>
<text text-anchor="middle" x="122" y="-0.95" font-family="Times,serif" font-size="14.00">3 (51)</text>
</g>
<!-- 15&#45;&gt;16 -->
<g id="edge16" class="edge">
<title>15-&gt;16</title>
<path fill="none" stroke="black" d="M122,-50.46C122,-44.24 122,-34.15 122,-25.39"/>
<polygon fill="black" stroke="black" points="125.5,-25.6 122,-15.6 118.5,-25.6 125.5,-25.6"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">all_terminals</span><span class="p">(</span><span class="n">new_derivation_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>'(2 * 3)'
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Replacing one subtree by another only works as long as individual elements such as <code>&lt;expr&gt;</code> occur multiple times in our tree.  In the reduced <code>new_derivation_tree</code>, above, we could replace further <code>&lt;expr&gt;</code> trees only once more.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Simplifying-by-Alternative-Expansions">Simplifying by Alternative Expansions</h3></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>A second means to simplify this tree is to apply <em>alternative expansions</em>.  That is, for a symbol, we check whether there is an alternative expansion with a smaller number of children.  Then, we replace the symbol with the alternative expansion, filling in needed symbols from the tree.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>As an example, consider the <code>new_derivation_tree</code> above.  The applied expansion for <code>&lt;term&gt;</code> has been</p>

<pre><code>&lt;term&gt; ::= &lt;term&gt; * &lt;factor&gt;

</code></pre>
<p>Let us replace this with the alternative expansion:</p>

<pre><code>&lt;term&gt; ::= &lt;factor&gt;</code></pre>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">term_tree</span> <span class="o">=</span> <span class="n">new_derivation_tree</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">display_tree</span><span class="p">(</span><span class="n">term_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_svg output_subarea output_execute_result">


<!-- Generated by graphviz version 12.2.1 (20241206.2353)
 -->
<!-- Pages: 1 -->
<svg width="157pt" height="274pt" viewbox="0.00 0.00 157.00 273.50" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 269.5)">
<polygon fill="white" stroke="none" points="-4,4 -4,-269.5 153,-269.5 153,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="76" y="-252.2" font-family="Times,serif" font-size="14.00">&lt;term&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="27" y="-201.95" font-family="Times,serif" font-size="14.00">&lt;factor&gt;</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0-&gt;1</title>
<path fill="none" stroke="black" d="M69.99,-251.46C62.86,-244.44 50.75,-232.51 41.19,-223.1"/>
<polygon fill="black" stroke="black" points="43.72,-220.67 34.14,-216.15 38.81,-225.66 43.72,-220.67"/>
</g>
<!-- 5 -->
<g id="node6" class="node">
<title>5</title>
<text text-anchor="middle" x="76" y="-201.95" font-family="Times,serif" font-size="14.00"> * </text>
</g>
<!-- 0&#45;&gt;5 -->
<g id="edge5" class="edge">
<title>0-&gt;5</title>
<path fill="none" stroke="black" d="M76,-251.46C76,-245.24 76,-235.15 76,-226.39"/>
<polygon fill="black" stroke="black" points="79.5,-226.6 76,-216.6 72.5,-226.6 79.5,-226.6"/>
</g>
<!-- 6 -->
<g id="node7" class="node">
<title>6</title>
<text text-anchor="middle" x="122" y="-201.95" font-family="Times,serif" font-size="14.00">&lt;term&gt;</text>
</g>
<!-- 0&#45;&gt;6 -->
<g id="edge6" class="edge">
<title>0-&gt;6</title>
<path fill="none" stroke="black" d="M81.64,-251.46C88.26,-244.51 99.47,-232.75 108.4,-223.39"/>
<polygon fill="black" stroke="black" points="110.9,-225.84 115.27,-216.19 105.84,-221.01 110.9,-225.84"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="27" y="-151.7" font-family="Times,serif" font-size="14.00">&lt;integer&gt;</text>
</g>
<!-- 1&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>1-&gt;2</title>
<path fill="none" stroke="black" d="M27,-201.21C27,-194.99 27,-184.9 27,-176.14"/>
<polygon fill="black" stroke="black" points="30.5,-176.35 27,-166.35 23.5,-176.35 30.5,-176.35"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="27" y="-101.45" font-family="Times,serif" font-size="14.00">&lt;digit&gt;</text>
</g>
<!-- 2&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>2-&gt;3</title>
<path fill="none" stroke="black" d="M27,-150.96C27,-144.74 27,-134.65 27,-125.89"/>
<polygon fill="black" stroke="black" points="30.5,-126.1 27,-116.1 23.5,-126.1 30.5,-126.1"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="27" y="-51.2" font-family="Times,serif" font-size="14.00">2 (50)</text>
</g>
<!-- 3&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>3-&gt;4</title>
<path fill="none" stroke="black" d="M27,-100.71C27,-94.49 27,-84.4 27,-75.64"/>
<polygon fill="black" stroke="black" points="30.5,-75.85 27,-65.85 23.5,-75.85 30.5,-75.85"/>
</g>
<!-- 7 -->
<g id="node8" class="node">
<title>7</title>
<text text-anchor="middle" x="122" y="-151.7" font-family="Times,serif" font-size="14.00">&lt;factor&gt;</text>
</g>
<!-- 6&#45;&gt;7 -->
<g id="edge7" class="edge">
<title>6-&gt;7</title>
<path fill="none" stroke="black" d="M122,-201.21C122,-194.99 122,-184.9 122,-176.14"/>
<polygon fill="black" stroke="black" points="125.5,-176.35 122,-166.35 118.5,-176.35 125.5,-176.35"/>
</g>
<!-- 8 -->
<g id="node9" class="node">
<title>8</title>
<text text-anchor="middle" x="122" y="-101.45" font-family="Times,serif" font-size="14.00">&lt;integer&gt;</text>
</g>
<!-- 7&#45;&gt;8 -->
<g id="edge8" class="edge">
<title>7-&gt;8</title>
<path fill="none" stroke="black" d="M122,-150.96C122,-144.74 122,-134.65 122,-125.89"/>
<polygon fill="black" stroke="black" points="125.5,-126.1 122,-116.1 118.5,-126.1 125.5,-126.1"/>
</g>
<!-- 9 -->
<g id="node10" class="node">
<title>9</title>
<text text-anchor="middle" x="122" y="-51.2" font-family="Times,serif" font-size="14.00">&lt;digit&gt;</text>
</g>
<!-- 8&#45;&gt;9 -->
<g id="edge9" class="edge">
<title>8-&gt;9</title>
<path fill="none" stroke="black" d="M122,-100.71C122,-94.49 122,-84.4 122,-75.64"/>
<polygon fill="black" stroke="black" points="125.5,-75.85 122,-65.85 118.5,-75.85 125.5,-75.85"/>
</g>
<!-- 10 -->
<g id="node11" class="node">
<title>10</title>
<text text-anchor="middle" x="122" y="-0.95" font-family="Times,serif" font-size="14.00">3 (51)</text>
</g>
<!-- 9&#45;&gt;10 -->
<g id="edge10" class="edge">
<title>9-&gt;10</title>
<path fill="none" stroke="black" d="M122,-50.46C122,-44.24 122,-34.15 122,-25.39"/>
<polygon fill="black" stroke="black" points="125.5,-25.6 122,-15.6 118.5,-25.6 125.5,-25.6"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">shorter_term_tree</span> <span class="o">=</span> <span class="n">term_tree</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
<span class="n">display_tree</span><span class="p">(</span><span class="n">shorter_term_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_svg output_subarea output_execute_result">


<!-- Generated by graphviz version 12.2.1 (20241206.2353)
 -->
<!-- Pages: 1 -->
<svg width="62pt" height="223pt" viewbox="0.00 0.00 62.00 223.25" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 219.25)">
<polygon fill="white" stroke="none" points="-4,4 -4,-219.25 58,-219.25 58,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="27" y="-201.95" font-family="Times,serif" font-size="14.00">&lt;term&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="27" y="-151.7" font-family="Times,serif" font-size="14.00">&lt;factor&gt;</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0-&gt;1</title>
<path fill="none" stroke="black" d="M27,-201.21C27,-194.99 27,-184.9 27,-176.14"/>
<polygon fill="black" stroke="black" points="30.5,-176.35 27,-166.35 23.5,-176.35 30.5,-176.35"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="27" y="-101.45" font-family="Times,serif" font-size="14.00">&lt;integer&gt;</text>
</g>
<!-- 1&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>1-&gt;2</title>
<path fill="none" stroke="black" d="M27,-150.96C27,-144.74 27,-134.65 27,-125.89"/>
<polygon fill="black" stroke="black" points="30.5,-126.1 27,-116.1 23.5,-126.1 30.5,-126.1"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="27" y="-51.2" font-family="Times,serif" font-size="14.00">&lt;digit&gt;</text>
</g>
<!-- 2&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>2-&gt;3</title>
<path fill="none" stroke="black" d="M27,-100.71C27,-94.49 27,-84.4 27,-75.64"/>
<polygon fill="black" stroke="black" points="30.5,-75.85 27,-65.85 23.5,-75.85 30.5,-75.85"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="27" y="-0.95" font-family="Times,serif" font-size="14.00">3 (51)</text>
</g>
<!-- 3&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>3-&gt;4</title>
<path fill="none" stroke="black" d="M27,-50.46C27,-44.24 27,-34.15 27,-25.39"/>
<polygon fill="black" stroke="black" points="30.5,-25.6 27,-15.6 23.5,-25.6 30.5,-25.6"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">new_derivation_tree</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">shorter_term_tree</span>
<span class="n">display_tree</span><span class="p">(</span><span class="n">new_derivation_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_svg output_subarea output_execute_result">


<!-- Generated by graphviz version 12.2.1 (20241206.2353)
 -->
<!-- Pages: 1 -->
<svg width="147pt" height="475pt" viewbox="0.00 0.00 146.75 474.50" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 470.5)">
<polygon fill="white" stroke="none" points="-4,4 -4,-470.5 142.75,-470.5 142.75,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="69.38" y="-453.2" font-family="Times,serif" font-size="14.00">&lt;start&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="69.38" y="-402.95" font-family="Times,serif" font-size="14.00">&lt;expr&gt;</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0-&gt;1</title>
<path fill="none" stroke="black" d="M69.38,-452.46C69.38,-446.24 69.38,-436.15 69.38,-427.39"/>
<polygon fill="black" stroke="black" points="72.88,-427.6 69.38,-417.6 65.88,-427.6 72.88,-427.6"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="69.38" y="-352.7" font-family="Times,serif" font-size="14.00">&lt;term&gt;</text>
</g>
<!-- 1&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>1-&gt;2</title>
<path fill="none" stroke="black" d="M69.38,-402.21C69.38,-395.99 69.38,-385.9 69.38,-377.14"/>
<polygon fill="black" stroke="black" points="72.88,-377.35 69.38,-367.35 65.88,-377.35 72.88,-377.35"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="69.38" y="-302.45" font-family="Times,serif" font-size="14.00">&lt;factor&gt;</text>
</g>
<!-- 2&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>2-&gt;3</title>
<path fill="none" stroke="black" d="M69.38,-351.96C69.38,-345.74 69.38,-335.65 69.38,-326.89"/>
<polygon fill="black" stroke="black" points="72.88,-327.1 69.38,-317.1 65.88,-327.1 72.88,-327.1"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="15.38" y="-252.2" font-family="Times,serif" font-size="14.00">( (40)</text>
</g>
<!-- 3&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>3-&gt;4</title>
<path fill="none" stroke="black" d="M62.75,-301.71C54.74,-294.55 40.99,-282.26 30.36,-272.77"/>
<polygon fill="black" stroke="black" points="32.97,-270.4 23.18,-266.35 28.3,-275.62 32.97,-270.4"/>
</g>
<!-- 5 -->
<g id="node6" class="node">
<title>5</title>
<text text-anchor="middle" x="69.38" y="-252.2" font-family="Times,serif" font-size="14.00">&lt;expr&gt;</text>
</g>
<!-- 3&#45;&gt;5 -->
<g id="edge5" class="edge">
<title>3-&gt;5</title>
<path fill="none" stroke="black" d="M69.38,-301.71C69.38,-295.49 69.38,-285.4 69.38,-276.64"/>
<polygon fill="black" stroke="black" points="72.88,-276.85 69.38,-266.85 65.88,-276.85 72.88,-276.85"/>
</g>
<!-- 11 -->
<g id="node12" class="node">
<title>11</title>
<text text-anchor="middle" x="123.38" y="-252.2" font-family="Times,serif" font-size="14.00">) (41)</text>
</g>
<!-- 3&#45;&gt;11 -->
<g id="edge11" class="edge">
<title>3-&gt;11</title>
<path fill="none" stroke="black" d="M76,-301.71C84.01,-294.55 97.76,-282.26 108.39,-272.77"/>
<polygon fill="black" stroke="black" points="110.45,-275.62 115.57,-266.35 105.78,-270.4 110.45,-275.62"/>
</g>
<!-- 6 -->
<g id="node7" class="node">
<title>6</title>
<text text-anchor="middle" x="69.38" y="-201.95" font-family="Times,serif" font-size="14.00">&lt;term&gt;</text>
</g>
<!-- 5&#45;&gt;6 -->
<g id="edge6" class="edge">
<title>5-&gt;6</title>
<path fill="none" stroke="black" d="M69.38,-251.46C69.38,-245.24 69.38,-235.15 69.38,-226.39"/>
<polygon fill="black" stroke="black" points="72.88,-226.6 69.38,-216.6 65.88,-226.6 72.88,-226.6"/>
</g>
<!-- 7 -->
<g id="node8" class="node">
<title>7</title>
<text text-anchor="middle" x="69.38" y="-151.7" font-family="Times,serif" font-size="14.00">&lt;factor&gt;</text>
</g>
<!-- 6&#45;&gt;7 -->
<g id="edge7" class="edge">
<title>6-&gt;7</title>
<path fill="none" stroke="black" d="M69.38,-201.21C69.38,-194.99 69.38,-184.9 69.38,-176.14"/>
<polygon fill="black" stroke="black" points="72.88,-176.35 69.38,-166.35 65.88,-176.35 72.88,-176.35"/>
</g>
<!-- 8 -->
<g id="node9" class="node">
<title>8</title>
<text text-anchor="middle" x="69.38" y="-101.45" font-family="Times,serif" font-size="14.00">&lt;integer&gt;</text>
</g>
<!-- 7&#45;&gt;8 -->
<g id="edge8" class="edge">
<title>7-&gt;8</title>
<path fill="none" stroke="black" d="M69.38,-150.96C69.38,-144.74 69.38,-134.65 69.38,-125.89"/>
<polygon fill="black" stroke="black" points="72.88,-126.1 69.38,-116.1 65.88,-126.1 72.88,-126.1"/>
</g>
<!-- 9 -->
<g id="node10" class="node">
<title>9</title>
<text text-anchor="middle" x="69.38" y="-51.2" font-family="Times,serif" font-size="14.00">&lt;digit&gt;</text>
</g>
<!-- 8&#45;&gt;9 -->
<g id="edge9" class="edge">
<title>8-&gt;9</title>
<path fill="none" stroke="black" d="M69.38,-100.71C69.38,-94.49 69.38,-84.4 69.38,-75.64"/>
<polygon fill="black" stroke="black" points="72.88,-75.85 69.38,-65.85 65.88,-75.85 72.88,-75.85"/>
</g>
<!-- 10 -->
<g id="node11" class="node">
<title>10</title>
<text text-anchor="middle" x="69.38" y="-0.95" font-family="Times,serif" font-size="14.00">3 (51)</text>
</g>
<!-- 9&#45;&gt;10 -->
<g id="edge10" class="edge">
<title>9-&gt;10</title>
<path fill="none" stroke="black" d="M69.38,-50.46C69.38,-44.24 69.38,-34.15 69.38,-25.39"/>
<polygon fill="black" stroke="black" points="72.88,-25.6 69.38,-15.6 65.88,-25.6 72.88,-25.6"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">all_terminals</span><span class="p">(</span><span class="n">new_derivation_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>'(3)'
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>If we replace derivation subtrees by (smaller) subtrees, and if we search for alternate expansions that again yield smaller subtrees, we can systematically simplify the input.  This could be much faster than delta debugging, as our inputs would always be syntactically valid.  However, we need a strategy for when to apply which simplification rule. This is what we develop in the remainder of this section.</p>
</div>
</div>
</div>
</div>

<details id="Excursion:-A-Class-for-Reducing-with-Grammars">
<summary>A Class for Reducing with Grammars</summary>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We introduce the <code>GrammarReducer</code> class, which is again a <code>Reducer</code>. Note that we derive from <code>CachingReducer</code>, as the strategy will produce several duplicates.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">GrammarReducer</span><span class="p">(</span><span class="n">CachingReducer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Reduce inputs using grammars"""</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">runner</span><span class="p">:</span> <span class="n">Runner</span><span class="p">,</span> <span class="n">parser</span><span class="p">:</span> <span class="n">Parser</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
                 <span class="n">log_test</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">log_reduce</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Constructor.</span>
<span class="sd">        `runner` is the runner to be used.</span>
<span class="sd">        `parser` is the parser to be used.</span>
<span class="sd">        `log_test` - if set, show tests and results.</span>
<span class="sd">        `log_reduce` - if set, show reduction steps.</span>
<span class="sd">        """</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">runner</span><span class="p">,</span> <span class="n">log_test</span><span class="o">=</span><span class="n">log_test</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span> <span class="o">=</span> <span class="n">parser</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">grammar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_symbol</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">start_symbol</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_reduce</span> <span class="o">=</span> <span class="n">log_reduce</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">try_all_combinations</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="A-Few-Helpers">A Few Helpers</h4><p>We define a number of helper functions, which we will need for our strategy.  <code>tree_list_to_string()</code> does what the name suggest, creating a string from a list of derivation trees:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="kn">from</span> <span class="nn"><a href="GrammarFuzzer.html" class="import" target="_blank">GrammarFuzzer</a></span> <span class="kn">import</span> <span class="n">DerivationTree</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">tree_list_to_string</span><span class="p">(</span><span class="n">q</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">DerivationTree</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="s2">"["</span> <span class="o">+</span> <span class="s2">", "</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">all_terminals</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span> <span class="k">for</span> <span class="n">tree</span> <span class="ow">in</span> <span class="n">q</span><span class="p">])</span> <span class="o">+</span> <span class="s2">"]"</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">tree_list_to_string</span><span class="p">([</span><span class="n">derivation_tree</span><span class="p">,</span> <span class="n">derivation_tree</span><span class="p">])</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>'[1 + (2 * 3), 1 + (2 * 3)]'
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The function <code>possible_combinations()</code> takes a list of lists $[[x_1, x_2], [y_1, y_2], \dots]$ and creates a list of combinations $[[x_1, y_1], [x_1, y_2], [x_2, y_1], [x_2, y_2], \dots]$.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">possible_combinations</span><span class="p">(</span><span class="n">list_of_lists</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]]:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_lists</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_lists</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_lists</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">e</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">possible_combinations</span><span class="p">(</span><span class="n">list_of_lists</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
                <span class="n">new_combo</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="o">+</span> <span class="n">c</span>
                <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_combo</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ret</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">possible_combinations</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="s1">'a'</span><span class="p">,</span> <span class="s1">'b'</span><span class="p">]])</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[[1, 'a'], [1, 'b'], [2, 'a'], [2, 'b']]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The functions <code>number_of_nodes()</code> and <code>max_height()</code> return the number of nodes and the maximum height of the given tree, respectively.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">number_of_nodes</span><span class="p">(</span><span class="n">tree</span><span class="p">:</span> <span class="n">DerivationTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">children</span><span class="p">)</span> <span class="o">=</span> <span class="n">tree</span>
    <span class="k">if</span> <span class="n">children</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="mi">1</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">([</span><span class="n">number_of_nodes</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">children</span><span class="p">])</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">number_of_nodes</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>25
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">def</span> <span class="nf">max_height</span><span class="p">(</span><span class="n">tree</span><span class="p">:</span> <span class="n">DerivationTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">children</span><span class="p">)</span> <span class="o">=</span> <span class="n">tree</span>
    <span class="k">if</span> <span class="n">children</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">children</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="mi">1</span> <span class="o">+</span> <span class="nb">max</span><span class="p">([</span><span class="n">max_height</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">children</span><span class="p">])</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">max_height</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>12
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="Simplification-Strategies">Simplification Strategies</h4><p>Let us now implement our two simplification strategies – replacing subtrees and alternate expansions.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h5 id="Finding-Subtrees">Finding Subtrees</h5><p>The method <code>subtrees_with_symbol()</code> returns all subtrees in the given tree which's root is equal to the given symbol.  If <code>ignore_root</code> is set (default), then the root node of <code>tree</code> is not compared against.  (The <code>depth</code> parameter will be discussed below.)</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">GrammarReducer</span><span class="p">(</span><span class="n">GrammarReducer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">subtrees_with_symbol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">:</span> <span class="n">DerivationTree</span><span class="p">,</span>
                             <span class="n">symbol</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                             <span class="n">ignore_root</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">DerivationTree</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""Find all subtrees in `tree` whose root is `symbol`.</span>
<span class="sd">        If `ignore_root` is true, ignore the root note of `tree`."""</span>

        <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="p">(</span><span class="n">child_symbol</span><span class="p">,</span> <span class="n">children</span><span class="p">)</span> <span class="o">=</span> <span class="n">tree</span>
        <span class="k">if</span> <span class="n">depth</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">ignore_root</span> <span class="ow">and</span> <span class="n">child_symbol</span> <span class="o">==</span> <span class="n">symbol</span><span class="p">:</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>

        <span class="c1"># Search across all children</span>
        <span class="k">if</span> <span class="n">depth</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">children</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">children</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subtrees_with_symbol</span><span class="p">(</span><span class="n">c</span><span class="p">,</span>
                                                 <span class="n">symbol</span><span class="p">,</span>
                                                 <span class="n">depth</span><span class="o">=</span><span class="n">depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                                                 <span class="n">ignore_root</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ret</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Here's an example: These are all subtrees with <code>&lt;term&gt;</code> in our derivation tree <code>derivation_tree</code>.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">grammar_reducer</span> <span class="o">=</span> <span class="n">GrammarReducer</span><span class="p">(</span>
    <span class="n">mystery</span><span class="p">,</span>
    <span class="n">EarleyParser</span><span class="p">(</span><span class="n">EXPR_GRAMMAR</span><span class="p">),</span>
    <span class="n">log_reduce</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">all_terminals</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>'1 + (2 * 3)'
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="p">[</span><span class="n">all_terminals</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">grammar_reducer</span><span class="o">.</span><span class="n">subtrees_with_symbol</span><span class="p">(</span>
    <span class="n">derivation_tree</span><span class="p">,</span> <span class="s2">"&lt;term&gt;"</span><span class="p">)]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>['1', '(2 * 3)', '2 * 3', '3']
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>If we want to replace <code>&lt;term&gt;</code> subtrees to simplify the tree, these are the subtrees we could replace them with.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h5 id="Alternate-Expansions">Alternate Expansions</h5></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Our second strategy, simplifying by alternate expansions, is a bit more complex.  We first fetch the possible expansions for the given symbol (starting with the ones with the fewest children).  For each expansion, we fill in values for the symbols from the subtree (using <code>subtrees_with_symbols()</code>, above).  We then pick the first possible combination (or <em>all</em> combinations, if the attribute <code>try_all_combinations</code> is set).</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">GrammarReducer</span><span class="p">(</span><span class="n">GrammarReducer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">alternate_reductions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">:</span> <span class="n">DerivationTree</span><span class="p">,</span> <span class="n">symbol</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
                             <span class="n">depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">reductions</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">expansions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">expansions</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span>
            <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">expansion</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span>
                <span class="n">expansion_to_children</span><span class="p">(</span><span class="n">expansion</span><span class="p">)))</span>

        <span class="k">for</span> <span class="n">expansion</span> <span class="ow">in</span> <span class="n">expansions</span><span class="p">:</span>
            <span class="n">expansion_children</span> <span class="o">=</span> <span class="n">expansion_to_children</span><span class="p">(</span><span class="n">expansion</span><span class="p">)</span>

            <span class="n">match</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">new_children_reductions</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">alt_symbol</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="n">expansion_children</span><span class="p">:</span>
                <span class="n">child_reductions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subtrees_with_symbol</span><span class="p">(</span>
                    <span class="n">tree</span><span class="p">,</span> <span class="n">alt_symbol</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="n">depth</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child_reductions</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">match</span> <span class="o">=</span> <span class="kc">False</span>   <span class="c1"># Child not found; cannot apply rule</span>
                    <span class="k">break</span>

                <span class="n">new_children_reductions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child_reductions</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">:</span>
                <span class="k">continue</span>  <span class="c1"># Try next alternative</span>

            <span class="c1"># Use the first suitable combination</span>
            <span class="k">for</span> <span class="n">new_children</span> <span class="ow">in</span> <span class="n">possible_combinations</span><span class="p">(</span><span class="n">new_children_reductions</span><span class="p">):</span>
                <span class="n">new_tree</span> <span class="o">=</span> <span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">new_children</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">number_of_nodes</span><span class="p">(</span><span class="n">new_tree</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">number_of_nodes</span><span class="p">(</span><span class="n">tree</span><span class="p">):</span>
                    <span class="n">reductions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_tree</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">try_all_combinations</span><span class="p">:</span>
                        <span class="k">break</span>

        <span class="c1"># Sort by number of nodes</span>
        <span class="n">reductions</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">number_of_nodes</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">reductions</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">grammar_reducer</span> <span class="o">=</span> <span class="n">GrammarReducer</span><span class="p">(</span>
    <span class="n">mystery</span><span class="p">,</span>
    <span class="n">EarleyParser</span><span class="p">(</span><span class="n">EXPR_GRAMMAR</span><span class="p">),</span>
    <span class="n">log_reduce</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">all_terminals</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>'1 + (2 * 3)'
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Here are <em>all</em> combinations for <code>&lt;term&gt;</code>:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">grammar_reducer</span><span class="o">.</span><span class="n">try_all_combinations</span> <span class="o">=</span> <span class="kc">True</span>
<span class="nb">print</span><span class="p">([</span><span class="n">all_terminals</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
       <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">grammar_reducer</span><span class="o">.</span><span class="n">alternate_reductions</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">,</span> <span class="s2">"&lt;term&gt;"</span><span class="p">)])</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>['1', '2', '3', '1 * 1', '1 * 3', '2 * 1', '2 * 3', '3 * 1', '3 * 3', '(2 * 3)', '1 * 2 * 3', '2 * 2 * 3', '3 * 2 * 3', '1 * (2 * 3)', '(2 * 3) * 1', '(2 * 3) * 3', '2 * (2 * 3)', '3 * (2 * 3)']
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The default, though, is simply to return the first of these:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">grammar_reducer</span><span class="o">.</span><span class="n">try_all_combinations</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">[</span><span class="n">all_terminals</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">grammar_reducer</span><span class="o">.</span><span class="n">alternate_reductions</span><span class="p">(</span>
    <span class="n">derivation_tree</span><span class="p">,</span> <span class="s2">"&lt;term&gt;"</span><span class="p">)]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>['1', '1 * 1']
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h5 id="Both-Strategies-Together">Both Strategies Together</h5></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let us now merge both strategies.  To replace a subtree with a given symbol, we first search for already existing subtrees (using <code>subtrees_with_symbol()</code>); then we go for alternate expansions (using <code>alternate_expansions()</code>).</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">GrammarReducer</span><span class="p">(</span><span class="n">GrammarReducer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">symbol_reductions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">:</span> <span class="n">DerivationTree</span><span class="p">,</span> <span class="n">symbol</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
                          <span class="n">depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Find all expansion alternatives for the given symbol"""</span>
        <span class="n">reductions</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subtrees_with_symbol</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">symbol</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="n">depth</span><span class="p">)</span>
                      <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">alternate_reductions</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">symbol</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="n">depth</span><span class="p">))</span>

        <span class="c1"># Filter duplicates</span>
        <span class="n">unique_reductions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">reductions</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">r</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unique_reductions</span><span class="p">:</span>
                <span class="n">unique_reductions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">unique_reductions</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">grammar_reducer</span> <span class="o">=</span> <span class="n">GrammarReducer</span><span class="p">(</span>
    <span class="n">mystery</span><span class="p">,</span>
    <span class="n">EarleyParser</span><span class="p">(</span><span class="n">EXPR_GRAMMAR</span><span class="p">),</span>
    <span class="n">log_reduce</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">all_terminals</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>'1 + (2 * 3)'
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>These are the possible reductions for <code>&lt;expr&gt;</code> nodes.  Note how we first return subtrees (<code>1 + (2 * 3)</code>, <code>(2 * 3)</code>, <code>2 * 3</code>) before going for alternate expansions of <code>&lt;expr&gt;</code> (<code>1</code>).</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">reductions</span> <span class="o">=</span> <span class="n">grammar_reducer</span><span class="o">.</span><span class="n">symbol_reductions</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">,</span> <span class="s2">"&lt;expr&gt;"</span><span class="p">)</span>
<span class="n">tree_list_to_string</span><span class="p">([</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">reductions</span><span class="p">])</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>'[1 + (2 * 3), (2 * 3), 2 * 3, 1]'
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>These are the possible reductions for <code>&lt;term&gt;</code> nodes.  Again, we first have subtrees of the derivation tree, followed by the alternate expansion <code>1 * 1</code>.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">reductions</span> <span class="o">=</span> <span class="n">grammar_reducer</span><span class="o">.</span><span class="n">symbol_reductions</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">,</span> <span class="s2">"&lt;term&gt;"</span><span class="p">)</span>
<span class="n">tree_list_to_string</span><span class="p">([</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">reductions</span><span class="p">])</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>'[1, (2 * 3), 2 * 3, 3, 1 * 1]'
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="The-Reduction-Strategy">The Reduction Strategy</h4><p>We are now able to return a number of alternatives for each symbol in the tree.  This is what we apply in the core function of our reduction strategy, <code>reduce_subtree()</code>.  Starting with <code>subtree</code>, for every child, we find possible reductions.  For every reduction, we replace the child with the reduction and test the resulting (full) tree.  If it fails, our reduction was successful; otherwise, we put the child back into place and try out the next reduction.  Eventually, we apply <code>reduce_subtree()</code> on all children, reducing these as well.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">GrammarReducer</span><span class="p">(</span><span class="n">GrammarReducer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">reduce_subtree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">:</span> <span class="n">DerivationTree</span><span class="p">,</span>
                       <span class="n">subtree</span><span class="p">:</span> <span class="n">DerivationTree</span><span class="p">,</span> <span class="n">depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">symbol</span><span class="p">,</span> <span class="n">children</span> <span class="o">=</span> <span class="n">subtree</span>
        <span class="k">if</span> <span class="n">children</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">children</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_reduce</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">"Reducing"</span><span class="p">,</span> <span class="n">all_terminals</span><span class="p">(</span><span class="n">subtree</span><span class="p">),</span> <span class="s2">"with depth"</span><span class="p">,</span> <span class="n">depth</span><span class="p">)</span>

        <span class="n">reduced</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">reduced_child</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">child</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">children</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">child</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="p">(</span><span class="n">child_symbol</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="o">=</span> <span class="n">child</span>
                <span class="k">for</span> <span class="n">reduction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbol_reductions</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">child_symbol</span><span class="p">,</span> <span class="n">depth</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">number_of_nodes</span><span class="p">(</span><span class="n">reduction</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">number_of_nodes</span><span class="p">(</span><span class="n">child</span><span class="p">):</span>
                        <span class="k">continue</span>

                    <span class="c1"># Try this reduction</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_reduce</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span>
                            <span class="s2">"Replacing"</span><span class="p">,</span>
                            <span class="n">all_terminals</span><span class="p">(</span>
                                <span class="n">children</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
                            <span class="s2">"by"</span><span class="p">,</span>
                            <span class="n">all_terminals</span><span class="p">(</span><span class="n">reduction</span><span class="p">))</span>
                    <span class="n">children</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">reduction</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="n">all_terminals</span><span class="p">(</span><span class="n">tree</span><span class="p">))</span> <span class="o">==</span> <span class="n">Runner</span><span class="o">.</span><span class="n">FAIL</span><span class="p">:</span>
                        <span class="c1"># Success</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_reduce</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s2">"New tree:"</span><span class="p">,</span> <span class="n">all_terminals</span><span class="p">(</span><span class="n">tree</span><span class="p">))</span>
                        <span class="n">reduced</span> <span class="o">=</span> <span class="n">reduced_child</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">break</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># Didn't work out - restore</span>
                        <span class="n">children</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">child</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">reduced_child</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_reduce</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">"Tried all alternatives for"</span><span class="p">,</span> <span class="n">all_terminals</span><span class="p">(</span><span class="n">subtree</span><span class="p">))</span>
                <span class="k">break</span>

        <span class="c1"># Run recursively</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">children</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reduce_subtree</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">depth</span><span class="p">):</span>
                <span class="n">reduced</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="n">reduced</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>All we now need is a few drivers.  The method <code>reduce_tree()</code> is the main entry point into <code>reduce_subtree()</code>:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">GrammarReducer</span><span class="p">(</span><span class="n">GrammarReducer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">reduce_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">reduce_subtree</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The custom method <code>parse()</code> turns a given input into a derivation tree:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">GrammarReducer</span><span class="p">(</span><span class="n">GrammarReducer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inp</span><span class="p">):</span>
        <span class="n">tree</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_reduce</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">all_terminals</span><span class="p">(</span><span class="n">tree</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">tree</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The method <code>reduce()</code> is the one single entry point, parsing the input and then reducing it.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">GrammarReducer</span><span class="p">(</span><span class="n">GrammarReducer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">reduce</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inp</span><span class="p">):</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reduce_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">all_terminals</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

</details>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let us try out our <code>GrammarReducer</code> class in practice on our input <code>expr_input</code> and the <code>mystery()</code> function.  How quickly can we reduce it?</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">expr_input</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>'1 + (2 * 3)'
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">grammar_reducer</span> <span class="o">=</span> <span class="n">GrammarReducer</span><span class="p">(</span>
    <span class="n">eval_mystery</span><span class="p">,</span>
    <span class="n">EarleyParser</span><span class="p">(</span><span class="n">EXPR_GRAMMAR</span><span class="p">),</span>
    <span class="n">log_test</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">grammar_reducer</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">expr_input</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Test #1 '(2 * 3)' 7 FAIL
Test #2 '2 * 3' 5 PASS
Test #3 '3' 1 PASS
Test #4 '2' 1 PASS
Test #5 '(3)' 3 FAIL
</pre>
</div>

</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>'(3)'
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Success!  In only five steps, our <code>GrammarReducer</code> reduces the input to the minimum that causes the failure.  Note how all tests are syntactically valid by construction, avoiding the <code>UNRESOLVED</code> outcomes that cause delta debugging to stall.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="A-Depth-Oriented-Strategy">A Depth-Oriented Strategy</h3></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Even if five steps are already good, we can still do better.  If we look at the log above, we see that after test <code>#2</code>, where the input (tree) is reduced to <code>2 * 3</code>, our <code>GrammarReducer</code> first tries to replace the tree with <code>2</code> and <code>3</code>, which are the alternate <code>&lt;term&gt;</code> subtrees.  This may work, of course; but if there are many possible subtrees, our strategy will spend quite some time trying one after the other.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Delta debugging, as introduced above, follows the idea of trying to cut inputs approximately in half, and thus quickly proceeds towards a minimal input.  By replacing a tree with much smaller subtrees, we <em>could</em> possibly reduce a tree significantly, but may need several attempts to do so.  A better strategy is to only consider <em>large</em> subtrees first – both for the subtree replacement and for alternate expansions.  To find such <em>large</em> subtrees, we limit the <em>depth</em> by which we search for possible replacements in the subtree – first, by looking at the direct descendants, later at lower descendants.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>This is the role of the <code>depth</code> parameter used in <code>subtrees_with_symbol()</code> and passed through the invoking functions.  If set, <em>only</em> symbols at the given depth are returned.  Here's an example, starting again with our derivation tree <code>derivation_tree</code>:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">grammar_reducer</span> <span class="o">=</span> <span class="n">GrammarReducer</span><span class="p">(</span>
    <span class="n">mystery</span><span class="p">,</span>
    <span class="n">EarleyParser</span><span class="p">(</span><span class="n">EXPR_GRAMMAR</span><span class="p">),</span>
    <span class="n">log_reduce</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">all_terminals</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>'1 + (2 * 3)'
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">display_tree</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_svg output_subarea output_execute_result">


<!-- Generated by graphviz version 12.2.1 (20241206.2353)
 -->
<!-- Pages: 1 -->
<svg width="210pt" height="575pt" viewbox="0.00 0.00 209.62 575.00" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 571)">
<polygon fill="white" stroke="none" points="-4,4 -4,-571 205.62,-571 205.62,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="81.62" y="-553.7" font-family="Times,serif" font-size="14.00">&lt;start&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="81.62" y="-503.45" font-family="Times,serif" font-size="14.00">&lt;expr&gt;</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0-&gt;1</title>
<path fill="none" stroke="black" d="M81.62,-552.96C81.62,-546.74 81.62,-536.65 81.62,-527.89"/>
<polygon fill="black" stroke="black" points="85.13,-528.1 81.63,-518.1 78.13,-528.1 85.13,-528.1"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="33.62" y="-453.2" font-family="Times,serif" font-size="14.00">&lt;term&gt;</text>
</g>
<!-- 1&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>1-&gt;2</title>
<path fill="none" stroke="black" d="M75.74,-502.71C68.76,-495.69 56.89,-483.76 47.53,-474.35"/>
<polygon fill="black" stroke="black" points="50.16,-472.03 40.63,-467.41 45.2,-476.97 50.16,-472.03"/>
</g>
<!-- 7 -->
<g id="node8" class="node">
<title>7</title>
<text text-anchor="middle" x="81.62" y="-453.2" font-family="Times,serif" font-size="14.00"> + </text>
</g>
<!-- 1&#45;&gt;7 -->
<g id="edge7" class="edge">
<title>1-&gt;7</title>
<path fill="none" stroke="black" d="M81.62,-502.71C81.62,-496.49 81.62,-486.4 81.62,-477.64"/>
<polygon fill="black" stroke="black" points="85.13,-477.85 81.63,-467.85 78.13,-477.85 85.13,-477.85"/>
</g>
<!-- 8 -->
<g id="node9" class="node">
<title>8</title>
<text text-anchor="middle" x="127.62" y="-453.2" font-family="Times,serif" font-size="14.00">&lt;expr&gt;</text>
</g>
<!-- 1&#45;&gt;8 -->
<g id="edge8" class="edge">
<title>1-&gt;8</title>
<path fill="none" stroke="black" d="M87.27,-502.71C93.89,-495.76 105.1,-484 114.03,-474.64"/>
<polygon fill="black" stroke="black" points="116.53,-477.09 120.89,-467.44 111.46,-472.26 116.53,-477.09"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="31.62" y="-402.95" font-family="Times,serif" font-size="14.00">&lt;factor&gt;</text>
</g>
<!-- 2&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>2-&gt;3</title>
<path fill="none" stroke="black" d="M33.38,-452.46C33.12,-446.24 32.7,-436.15 32.34,-427.39"/>
<polygon fill="black" stroke="black" points="35.85,-427.45 31.93,-417.6 28.85,-427.74 35.85,-427.45"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="27.62" y="-352.7" font-family="Times,serif" font-size="14.00">&lt;integer&gt;</text>
</g>
<!-- 3&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>3-&gt;4</title>
<path fill="none" stroke="black" d="M31.13,-402.21C30.62,-395.99 29.78,-385.9 29.06,-377.14"/>
<polygon fill="black" stroke="black" points="32.56,-377.02 28.24,-367.35 25.58,-377.6 32.56,-377.02"/>
</g>
<!-- 5 -->
<g id="node6" class="node">
<title>5</title>
<text text-anchor="middle" x="20.62" y="-302.45" font-family="Times,serif" font-size="14.00">&lt;digit&gt;</text>
</g>
<!-- 4&#45;&gt;5 -->
<g id="edge5" class="edge">
<title>4-&gt;5</title>
<path fill="none" stroke="black" d="M26.77,-351.96C25.86,-345.74 24.4,-335.65 23.13,-326.89"/>
<polygon fill="black" stroke="black" points="26.61,-326.48 21.71,-317.09 19.68,-327.49 26.61,-326.48"/>
</g>
<!-- 6 -->
<g id="node7" class="node">
<title>6</title>
<text text-anchor="middle" x="20.62" y="-252.2" font-family="Times,serif" font-size="14.00">1 (49)</text>
</g>
<!-- 5&#45;&gt;6 -->
<g id="edge6" class="edge">
<title>5-&gt;6</title>
<path fill="none" stroke="black" d="M20.62,-301.71C20.62,-295.49 20.62,-285.4 20.62,-276.64"/>
<polygon fill="black" stroke="black" points="24.13,-276.85 20.63,-266.85 17.13,-276.85 24.13,-276.85"/>
</g>
<!-- 9 -->
<g id="node10" class="node">
<title>9</title>
<text text-anchor="middle" x="127.62" y="-402.95" font-family="Times,serif" font-size="14.00">&lt;term&gt;</text>
</g>
<!-- 8&#45;&gt;9 -->
<g id="edge9" class="edge">
<title>8-&gt;9</title>
<path fill="none" stroke="black" d="M127.62,-452.46C127.62,-446.24 127.62,-436.15 127.62,-427.39"/>
<polygon fill="black" stroke="black" points="131.13,-427.6 127.63,-417.6 124.13,-427.6 131.13,-427.6"/>
</g>
<!-- 10 -->
<g id="node11" class="node">
<title>10</title>
<text text-anchor="middle" x="127.62" y="-352.7" font-family="Times,serif" font-size="14.00">&lt;factor&gt;</text>
</g>
<!-- 9&#45;&gt;10 -->
<g id="edge10" class="edge">
<title>9-&gt;10</title>
<path fill="none" stroke="black" d="M127.62,-402.21C127.62,-395.99 127.62,-385.9 127.62,-377.14"/>
<polygon fill="black" stroke="black" points="131.13,-377.35 127.63,-367.35 124.13,-377.35 131.13,-377.35"/>
</g>
<!-- 11 -->
<g id="node12" class="node">
<title>11</title>
<text text-anchor="middle" x="74.62" y="-302.45" font-family="Times,serif" font-size="14.00">( (40)</text>
</g>
<!-- 10&#45;&gt;11 -->
<g id="edge11" class="edge">
<title>10-&gt;11</title>
<path fill="none" stroke="black" d="M121.13,-351.96C113.34,-344.87 100.04,-332.76 89.65,-323.31"/>
<polygon fill="black" stroke="black" points="92.05,-320.75 82.3,-316.61 87.33,-325.93 92.05,-320.75"/>
</g>
<!-- 12 -->
<g id="node13" class="node">
<title>12</title>
<text text-anchor="middle" x="128.62" y="-302.45" font-family="Times,serif" font-size="14.00">&lt;expr&gt;</text>
</g>
<!-- 10&#45;&gt;12 -->
<g id="edge12" class="edge">
<title>10-&gt;12</title>
<path fill="none" stroke="black" d="M127.75,-351.96C127.88,-345.74 128.09,-335.65 128.27,-326.89"/>
<polygon fill="black" stroke="black" points="131.76,-327.17 128.47,-317.1 124.76,-327.03 131.76,-327.17"/>
</g>
<!-- 24 -->
<g id="node25" class="node">
<title>24</title>
<text text-anchor="middle" x="182.62" y="-302.45" font-family="Times,serif" font-size="14.00">) (41)</text>
</g>
<!-- 10&#45;&gt;24 -->
<g id="edge24" class="edge">
<title>10-&gt;24</title>
<path fill="none" stroke="black" d="M134.37,-351.96C142.53,-344.8 156.53,-332.51 167.36,-323.02"/>
<polygon fill="black" stroke="black" points="169.48,-325.81 174.69,-316.59 164.86,-320.55 169.48,-325.81"/>
</g>
<!-- 13 -->
<g id="node14" class="node">
<title>13</title>
<text text-anchor="middle" x="128.62" y="-252.2" font-family="Times,serif" font-size="14.00">&lt;term&gt;</text>
</g>
<!-- 12&#45;&gt;13 -->
<g id="edge13" class="edge">
<title>12-&gt;13</title>
<path fill="none" stroke="black" d="M128.62,-301.71C128.62,-295.49 128.62,-285.4 128.62,-276.64"/>
<polygon fill="black" stroke="black" points="132.13,-276.85 128.63,-266.85 125.13,-276.85 132.13,-276.85"/>
</g>
<!-- 14 -->
<g id="node15" class="node">
<title>14</title>
<text text-anchor="middle" x="79.62" y="-201.95" font-family="Times,serif" font-size="14.00">&lt;factor&gt;</text>
</g>
<!-- 13&#45;&gt;14 -->
<g id="edge14" class="edge">
<title>13-&gt;14</title>
<path fill="none" stroke="black" d="M122.62,-251.46C115.49,-244.44 103.37,-232.51 93.81,-223.1"/>
<polygon fill="black" stroke="black" points="96.34,-220.67 86.76,-216.15 91.43,-225.66 96.34,-220.67"/>
</g>
<!-- 18 -->
<g id="node19" class="node">
<title>18</title>
<text text-anchor="middle" x="128.62" y="-201.95" font-family="Times,serif" font-size="14.00"> * </text>
</g>
<!-- 13&#45;&gt;18 -->
<g id="edge18" class="edge">
<title>13-&gt;18</title>
<path fill="none" stroke="black" d="M128.62,-251.46C128.62,-245.24 128.62,-235.15 128.62,-226.39"/>
<polygon fill="black" stroke="black" points="132.13,-226.6 128.63,-216.6 125.13,-226.6 132.13,-226.6"/>
</g>
<!-- 19 -->
<g id="node20" class="node">
<title>19</title>
<text text-anchor="middle" x="174.62" y="-201.95" font-family="Times,serif" font-size="14.00">&lt;term&gt;</text>
</g>
<!-- 13&#45;&gt;19 -->
<g id="edge19" class="edge">
<title>13-&gt;19</title>
<path fill="none" stroke="black" d="M134.27,-251.46C140.89,-244.51 152.1,-232.75 161.03,-223.39"/>
<polygon fill="black" stroke="black" points="163.53,-225.84 167.89,-216.19 158.46,-221.01 163.53,-225.84"/>
</g>
<!-- 15 -->
<g id="node16" class="node">
<title>15</title>
<text text-anchor="middle" x="79.62" y="-151.7" font-family="Times,serif" font-size="14.00">&lt;integer&gt;</text>
</g>
<!-- 14&#45;&gt;15 -->
<g id="edge15" class="edge">
<title>14-&gt;15</title>
<path fill="none" stroke="black" d="M79.62,-201.21C79.62,-194.99 79.62,-184.9 79.62,-176.14"/>
<polygon fill="black" stroke="black" points="83.13,-176.35 79.63,-166.35 76.13,-176.35 83.13,-176.35"/>
</g>
<!-- 16 -->
<g id="node17" class="node">
<title>16</title>
<text text-anchor="middle" x="79.62" y="-101.45" font-family="Times,serif" font-size="14.00">&lt;digit&gt;</text>
</g>
<!-- 15&#45;&gt;16 -->
<g id="edge16" class="edge">
<title>15-&gt;16</title>
<path fill="none" stroke="black" d="M79.62,-150.96C79.62,-144.74 79.62,-134.65 79.62,-125.89"/>
<polygon fill="black" stroke="black" points="83.13,-126.1 79.63,-116.1 76.13,-126.1 83.13,-126.1"/>
</g>
<!-- 17 -->
<g id="node18" class="node">
<title>17</title>
<text text-anchor="middle" x="79.62" y="-51.2" font-family="Times,serif" font-size="14.00">2 (50)</text>
</g>
<!-- 16&#45;&gt;17 -->
<g id="edge17" class="edge">
<title>16-&gt;17</title>
<path fill="none" stroke="black" d="M79.62,-100.71C79.62,-94.49 79.62,-84.4 79.62,-75.64"/>
<polygon fill="black" stroke="black" points="83.13,-75.85 79.63,-65.85 76.13,-75.85 83.13,-75.85"/>
</g>
<!-- 20 -->
<g id="node21" class="node">
<title>20</title>
<text text-anchor="middle" x="174.62" y="-151.7" font-family="Times,serif" font-size="14.00">&lt;factor&gt;</text>
</g>
<!-- 19&#45;&gt;20 -->
<g id="edge20" class="edge">
<title>19-&gt;20</title>
<path fill="none" stroke="black" d="M174.62,-201.21C174.62,-194.99 174.62,-184.9 174.62,-176.14"/>
<polygon fill="black" stroke="black" points="178.13,-176.35 174.63,-166.35 171.13,-176.35 178.13,-176.35"/>
</g>
<!-- 21 -->
<g id="node22" class="node">
<title>21</title>
<text text-anchor="middle" x="174.62" y="-101.45" font-family="Times,serif" font-size="14.00">&lt;integer&gt;</text>
</g>
<!-- 20&#45;&gt;21 -->
<g id="edge21" class="edge">
<title>20-&gt;21</title>
<path fill="none" stroke="black" d="M174.62,-150.96C174.62,-144.74 174.62,-134.65 174.62,-125.89"/>
<polygon fill="black" stroke="black" points="178.13,-126.1 174.63,-116.1 171.13,-126.1 178.13,-126.1"/>
</g>
<!-- 22 -->
<g id="node23" class="node">
<title>22</title>
<text text-anchor="middle" x="174.62" y="-51.2" font-family="Times,serif" font-size="14.00">&lt;digit&gt;</text>
</g>
<!-- 21&#45;&gt;22 -->
<g id="edge22" class="edge">
<title>21-&gt;22</title>
<path fill="none" stroke="black" d="M174.62,-100.71C174.62,-94.49 174.62,-84.4 174.62,-75.64"/>
<polygon fill="black" stroke="black" points="178.13,-75.85 174.63,-65.85 171.13,-75.85 178.13,-75.85"/>
</g>
<!-- 23 -->
<g id="node24" class="node">
<title>23</title>
<text text-anchor="middle" x="174.62" y="-0.95" font-family="Times,serif" font-size="14.00">3 (51)</text>
</g>
<!-- 22&#45;&gt;23 -->
<g id="edge23" class="edge">
<title>22-&gt;23</title>
<path fill="none" stroke="black" d="M174.62,-50.46C174.62,-44.24 174.62,-34.15 174.62,-25.39"/>
<polygon fill="black" stroke="black" points="178.13,-25.6 174.63,-15.6 171.13,-25.6 178.13,-25.6"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>At a depth of 1, there is no <code>&lt;term&gt;</code> symbol:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="p">[</span><span class="n">all_terminals</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">grammar_reducer</span><span class="o">.</span><span class="n">subtrees_with_symbol</span><span class="p">(</span>
    <span class="n">derivation_tree</span><span class="p">,</span> <span class="s2">"&lt;term&gt;"</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>At a depth of 2, we have the <code>&lt;term&gt;</code> subtree on the left-hand side:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="p">[</span><span class="n">all_terminals</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">grammar_reducer</span><span class="o">.</span><span class="n">subtrees_with_symbol</span><span class="p">(</span>
    <span class="n">derivation_tree</span><span class="p">,</span> <span class="s2">"&lt;term&gt;"</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">2</span><span class="p">)]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>['1']
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>At a depth of 3, we have the <code>&lt;term&gt;</code> subtree on the right-hand side:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="p">[</span><span class="n">all_terminals</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">grammar_reducer</span><span class="o">.</span><span class="n">subtrees_with_symbol</span><span class="p">(</span>
    <span class="n">derivation_tree</span><span class="p">,</span> <span class="s2">"&lt;term&gt;"</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">3</span><span class="p">)]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>['(2 * 3)']
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The idea is now to start with a depth of 0, subsequently increasing it as we proceed:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="k">class</span> <span class="nc">GrammarReducer</span><span class="p">(</span><span class="n">GrammarReducer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">reduce_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">):</span>
        <span class="n">depth</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">depth</span> <span class="o">&lt;</span> <span class="n">max_height</span><span class="p">(</span><span class="n">tree</span><span class="p">):</span>
            <span class="n">reduced</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reduce_subtree</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">tree</span><span class="p">,</span> <span class="n">depth</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">reduced</span><span class="p">:</span>
                <span class="n">depth</span> <span class="o">=</span> <span class="mi">0</span>    <span class="c1"># Start with new tree</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">depth</span> <span class="o">+=</span> <span class="mi">1</span>   <span class="c1"># Extend search for subtrees</span>
        <span class="k">return</span> <span class="n">tree</span>        
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">grammar_reducer</span> <span class="o">=</span> <span class="n">GrammarReducer</span><span class="p">(</span>
    <span class="n">mystery</span><span class="p">,</span>
    <span class="n">EarleyParser</span><span class="p">(</span><span class="n">EXPR_GRAMMAR</span><span class="p">),</span>
    <span class="n">log_test</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">grammar_reducer</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">expr_input</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Test #1 '(2 * 3)' 7 FAIL
Test #2 '(3)' 3 FAIL
Test #3 '3' 1 PASS
</pre>
</div>

</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>'(3)'
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We see that a depth-oriented strategy needs even fewer steps in our setting.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Comparing-Strategies">Comparing Strategies</h3><p>We close by demonstrating the difference between text-based delta debugging and our grammar-based reduction.  We build a very long expression:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="kn">from</span> <span class="nn"><a href="GrammarFuzzer.html" class="import" target="_blank">GrammarFuzzer</a></span> <span class="kn">import</span> <span class="n">GrammarFuzzer</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">long_expr_input</span> <span class="o">=</span> <span class="n">GrammarFuzzer</span><span class="p">(</span><span class="n">EXPR_GRAMMAR</span><span class="p">,</span> <span class="n">min_nonterminals</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span>
<span class="n">long_expr_input</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>'++---((-2 / 3 / 3 - -+1 / 5 - 2) * ++6 / +8 * 4 / 9 / 2 * 8 + ++(5) * 3 / 8 * 0 + 3 * 3 + 4 / 0 / 6 + 9) * ++++(+--9 * -3 * 7 / 4 + --(4) / 3 - 0 / 3 + 5 + 0) * (1 * 6 - 1 / 9 * 5 - 9 / 0 + 7) * ++(8 - 1) * +1 * 7 * 0 + ((1 + 4) / 4 * 8 * 9 * 4 + 4 / (4) * 1 - (4) * 8 * 5 + 1 + 4) / (+(2 - 1 - 9) * 5 + 3 + 6 - 2) * +3 * (3 - 7 + 8) / 4 - -(9 * 4 - 1 * 0 + 5) / (5 / 9 * 5 + 2) * 7 + ((7 - 5 + 3) / 1 * 8 - 8 - 9) * --+1 * 4 / 4 - 4 / 7 * 4 - 3 / 6 * 1 - 2 - 7 - 8'
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>With grammars, we need only a handful of tests to find the failure-inducing input:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="kn">from</span> <span class="nn"><a href="Timer.html" class="import" target="_blank">Timer</a></span> <span class="kn">import</span> <span class="n">Timer</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">grammar_reducer</span> <span class="o">=</span> <span class="n">GrammarReducer</span><span class="p">(</span><span class="n">eval_mystery</span><span class="p">,</span> <span class="n">EarleyParser</span><span class="p">(</span><span class="n">EXPR_GRAMMAR</span><span class="p">))</span>
<span class="k">with</span> <span class="n">Timer</span><span class="p">()</span> <span class="k">as</span> <span class="n">grammar_time</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">grammar_reducer</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">long_expr_input</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(9)
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">grammar_reducer</span><span class="o">.</span><span class="n">tests</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>10
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">grammar_time</span><span class="o">.</span><span class="n">elapsed_time</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>0.0751019999734126
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Delta debugging, in contrast, requires orders of magnitude more tests (and consequently, time).  Again, the reduction is not closely as perfect as it is with the grammar-based reducer.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">dd_reducer</span> <span class="o">=</span> <span class="n">DeltaDebuggingReducer</span><span class="p">(</span><span class="n">eval_mystery</span><span class="p">)</span>
<span class="k">with</span> <span class="n">Timer</span><span class="p">()</span> <span class="k">as</span> <span class="n">dd_time</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">dd_reducer</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">long_expr_input</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>((2 - 1 - 2) * 8 + (5) - (4)) / ((2) * 3) * (9) / 3 / 1 - 8
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">dd_reducer</span><span class="o">.</span><span class="n">tests</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>900
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span/><span class="n">dd_time</span><span class="o">.</span><span class="n">elapsed_time</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>1.6051183340023272
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We see that if an input is syntactically complex, using a grammar to reduce inputs is the best way to go.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Lessons-Learned">Lessons Learned</h2><ul>
<li>Reducing failure-inducing inputs to a minimum is helpful for testing and debugging.</li>
<li><em>Delta debugging</em> is a simple and robust algorithm to easily reduce test cases.</li>
<li>For syntactically complex inputs, <em>grammar-based reduction</em> is much faster and yields better results.</li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Next-Steps">Next Steps</h2><p>Our next chapter focuses on <a href="WebFuzzer.html">Web GUI Fuzzing</a>, another domain where generating and reducing test cases is central.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Background">Background</h2><p>The "lexical" delta debugging algorithm discussed here stems from [<a href="https://doi.org/10.1109/32.988498">Zeller <em>et al</em>, 2002</a>]; actually, this is the exact Python implementation as used by Zeller in 2002.  The idea of systematically reducing inputs has been discovered a number of times, although not as automatic and generic as delta debugging. [<a href="https://www.microsoft.com/en-us/research/publication/massive-stochastic-testing-of-sql/">Slutz <em>et al</em>, 1998</a>], for instance, discusses systematic reduction of SQL statements for SQL databases; the general process as manual work is well described by [Kernighan <em>et al</em>, 1999].</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The deficits of delta debugging as it comes to syntactically complex inputs were first discussed in <em>compiler testing</em>, and <em>reducing tree inputs</em> rather than string inputs was quickly discovered as an alternative.  <em>Hierarchical Delta Debugging</em> (<em>HDD</em>) [<a href="https://doi.org/10.1145/1134285.1134307">Misherghi <em>et al</em>, 2006</a>] applies delta debugging on subtrees of a parse tree, systematically reducing a parse tree to a minimum.  <em>Generalized Tree Reduction</em> [<a href="http://dl.acm.org/citation.cfm?id=3155562.3155669">Herfert <em>et al</em>, 2017</a>] generalizes this idea to apply arbitrary <em>patterns</em> such as replacing a term by a compatible term in a subtree, as <code>subtrees_with_symbol()</code> does.  Using <em>grammars</em> to reduce inputs was first implemented in the <em>Perses</em> tool [<a href="https://doi.org/10.1145/3180155.3180236">Sun <em>et al</em>, 2018</a>]; our algorithm implements very similar strategies.  Searching for alternate expansions (as <code>alternate_reductions()</code>) is a contribution of the present chapter.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>While applying delta debugging to code lines does a decent job, <em>syntactic</em> and especially <em>language-specific</em> approaches can do a much better job for the programming language at hand:</p>
<ul>
<li><p><em>C-Reduce</em> [<a href="https://doi.org/10.1145/2254064.2254104">Regehr <em>et al</em>, 2012</a>] is a reducer specifically targeting the reduction of programming languages.  Besides reductions in the style of delta debugging or tree transformations, C-Reduce comes with more than 30 source-to-source transformations that replace aggregates by scalars, remove function parameters at a definition and all call sites, change functions to return <code>void</code> and deleting all <code>return</code> statements, and many more.  While specifically instantiated for the C language (and used for testing C compilers), these principles extend to arbitrary programming languages following an ALGOL-like syntax.</p>
</li>
<li><p>Kalhauge and Palsberg [<a href="https://doi.org/10.1145/3338906.3338956">Kalhauge <em>et al</em>, 2019</a>] introduce <em>binary reduction of dependency graphs</em>, a general solution for reducing arbitrary inputs with dependencies. Their <em>J-Reduce</em> tool specifically targets Java programs, and again is much faster than delta debugging and achieves a higher reduction rate.</p>
</li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Reducing inputs also works well in the context of <em>property-based testing</em>; that is, generating data structures for individual functions, which can then be reduced ("shrunk") upon failure. The <a href="https://hypothesis.works">Hypothesis</a> fuzzer has a number of type-specific shrinking strategies; this <a href="https://hypothesis.works/articles/integrated-shrinking/">blog article</a> discusses some of its features.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The chapter on <a href="https://www.debuggingbook.org/html/DeltaDebugger.html">"Reducing Failure-Inducing Inputs" in the Debugging Book</a> has an alternate implementation <code>DeltaDebugger</code> of delta debugging that is even easier to deploy; here, one simply writes</p>
<div class="highlight"><pre><span/><span class="k">with</span> <span class="n">DeltaDebugger</span><span class="p">()</span> <span class="k">as</span> <span class="n">dd</span><span class="p">:</span>
    <span class="n">fun</span><span class="p">(</span><span class="n">args</span><span class="o">...</span><span class="p">)</span>
<span class="n">dd</span>
</pre></div>
<p>to reduce the input in <code>args</code> for a failing (exception-throwing) function <code>fun()</code>. The chapter also  discusses further usage examples, including reducing <em>code</em> to a minimum.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>This <a href="https://www.drmaciver.com/2019/01/notes-on-test-case-reduction/">blog post</a> by David McIver contains lots of insights on how to apply reduction in practice, in particular multiple runs with different abstraction levels.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Exercises">Exercises</h2><p>How to best reduce inputs is still an underdeveloped field of research, with lots of opportunities.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Exercise-1:-Mutation-Based-Fuzzing-with-Reduction">Exercise 1: Mutation-Based Fuzzing with Reduction</h3><p>When fuzzing with a population, it can be useful to occasionally <em>reduce</em> the length of each element, such that future descendants are shorter, too, which typically speeds up their testing.</p>
<p>Consider the <code>MutationFuzzer</code> class from <a href="MutationFuzzer.html">the chapter on mutation-based fuzzing</a>. 
Extend it such that whenever a new input is added to the population, it is first reduced using delta debugging.</p>

    
<p/><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/HEAD?labpath=docs%2Fnotebooks/Reducer.ipynb#Exercises" target="_blank">Use the notebook</a> to work on the exercises and see solutions.</div>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Exercise-2:-Reduction-by-Production">Exercise 2: Reduction by Production</h3><p>Grammar-based input reduction, as sketched above, might be a good algorithm, but is by no means the only alternative.  One interesting question is whether "reduction" should only be limited to elements already present, or whether one would be allowed to also create <em>new</em> elements.  These would not be present in the original input, yet still allow producing a much smaller input that would still reproduce the original failure.</p>

    
<p/><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/HEAD?labpath=docs%2Fnotebooks/Reducer.ipynb#Exercises" target="_blank">Use the notebook</a> to work on the exercises and see solutions.</div>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>As an example, consider the following grammar:</p>

<pre><code>&lt;number&gt; ::= &lt;float&gt; | &lt;integer&gt; | &lt;not-a-number&gt;
&lt;float&gt; ::= &lt;digits&gt;.&lt;digits&gt;
&lt;integer&gt; ::= &lt;digits&gt;
&lt;not-a-number&gt; ::= NaN
&lt;digits&gt; ::= [0-9]+</code></pre>
<p>Assume the input <code>100.99</code> fails.  We might be able to reduce it to a minimum of, say, <code>1.9</code>.  However, we cannot reduce it to an <code>&lt;integer&gt;</code> or to <code>&lt;not-a-number&gt;</code>, as these symbols do not occur in the original input.  By allowing to <em>create</em> alternatives for these symbols, we could also test inputs such as <code>1</code> or <code>NaN</code> and further generalize the class of inputs for which the program fails.</p>

    
<p/><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/HEAD?labpath=docs%2Fnotebooks/Reducer.ipynb#Exercises" target="_blank">Use the notebook</a> to work on the exercises and see solutions.</div>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Create a class <code>GenerativeGrammarReducer</code> as subclass of <code>GrammarReducer</code>; extend the method <code>reduce_subtree()</code> accordingly.</p>

    
<p/><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/HEAD?labpath=docs%2Fnotebooks/Reducer.ipynb#Exercises" target="_blank">Use the notebook</a> to work on the exercises and see solutions.</div>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Exercise-3:-The-Big-Reduction-Shoot-Out">Exercise 3: The Big Reduction Shoot-Out</h3><p>Create a <em>benchmark</em> for the grammars already defined earlier, consisting of:</p>
<ol>
<li>A set of <em>inputs</em>, produced from these very grammars using <code>GrammarFuzzer</code> and derivatives;</li>
<li>A set of <em>tests</em> which check for the occurrence of individual symbols as well as pairs and triples of these symbols:<ul>
<li>Tests should be <em>unresolved</em> if the input is not syntactically valid;</li>
<li>Tests should <em>fail</em> if the symbols (or pairs or triples thereof) occur;</li>
<li>Tests should <em>pass</em> in all other cases.</li>
</ul>
</li>
</ol>
<p>Compare delta debugging and grammar-based debugging on the benchmark.  Implement HDD [<a href="https://doi.org/10.1145/1134285.1134307">Misherghi <em>et al</em>, 2006</a>] and <em>Generalized Tree Reduction</em> [<a href="http://dl.acm.org/citation.cfm?id=3155562.3155669">Herfert <em>et al</em>, 2017</a>] and add them to your comparison.  Which approach performs best, and under which circumstances?</p>

    
<p/><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/HEAD?labpath=docs%2Fnotebooks/Reducer.ipynb#Exercises" target="_blank">Use the notebook</a> to work on the exercises and see solutions.</div>
</div>
</div>
</div>
</div>

        
<p class="imprint">
<img style="float:right" src="../Images/2f3faa36146c6fb38bbab67add09aa5f.png" alt="Creative Commons License" data-original-src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png"/>
The content of this project is licensed under the
<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.
The source code that is part of the content, as well as the source code used to format and display that content is licensed under the <a href="https://github.com/uds-se/fuzzingbook/blob/master/LICENSE.md#mit-license">MIT License</a>.
<a href="https://github.com/uds-se/fuzzingbook/commits/master/notebooks/Reducer.ipynb" target="_blank)">Last change: 2023-11-11 18:18:06+01:00</a> • 
<a href="#citation" id="cite" onclick="revealCitation()">Cite</a> •
<a href="https://cispa.de/en/impressum" target="_blank">Imprint</a>
</p>



<div id="citation" class="citation" style="display: none;">
<a name="citation"/>
<h2>How to Cite this Work</h2>
<p>
Andreas Zeller, Rahul Gopinath, Marcel Böhme, Gordon Fraser, and Christian Holler: "<a href="https://www.fuzzingbook.org/html/Reducer.html">Reducing Failure-Inducing Inputs</a>".  In Andreas Zeller, Rahul Gopinath, Marcel Böhme, Gordon Fraser, and Christian Holler, "<a href="https://www.fuzzingbook.org/">The Fuzzing Book</a>", <a href="https://www.fuzzingbook.org/html/Reducer.html">https://www.fuzzingbook.org/html/Reducer.html</a>.  Retrieved 2023-11-11 18:18:06+01:00.
</p>
<pre>
@incollection{fuzzingbook2023:Reducer,
    author = {Andreas Zeller and Rahul Gopinath and Marcel B{\"o}hme and Gordon Fraser and Christian Holler},
    booktitle = {The Fuzzing Book},
    title = {Reducing Failure-Inducing Inputs},
    year = {2023},
    publisher = {CISPA Helmholtz Center for Information Security},
    howpublished = {\url{https://www.fuzzingbook.org/html/Reducer.html}},
    note = {Retrieved 2023-11-11 18:18:06+01:00},
    url = {https://www.fuzzingbook.org/html/Reducer.html},
    urldate = {2023-11-11 18:18:06+01:00}
}
</pre>
</div>

          
</body>
</html>