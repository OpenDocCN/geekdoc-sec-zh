["```py\nfrom [bookutils](https://github.com/uds-se/fuzzingbook//tree/master/notebooks/shared/bookutils) import YouTubeVideo\nYouTubeVideo('hSGzcjUj7Vs') \n```", "```py\n>>> from [fuzzingbook.GreyboxGrammarFuzzer](GreyboxGrammarFuzzer.html) import <identifier> \n```", "```py\n>>> dict_mutator = DictMutator([\"<a>\", \"</a>\", \"<a/>\", \"='a'\"])\n>>> seeds = [\"<html><head><title>Hello</title></head><body>World<br/></body></html>\"]\n>>> for i in range(10):\n>>>     print(dict_mutator.mutate(seeds[0]))\n<html><head><title>Hello</title></head><body>World<br/>>/body></html>\n<html><head><title>Hello</title></head><body>World<br/></body></ht7ml>\n<html><head><title>Hello</title></hgad><body>World<br/></body></html>\n<html><head><title>Hello</title></head><body>World<br/<a/>></body></html>\n<html><head><title>Hello</title></head><body>World<br+></body></html>\n<html><head><title>Hello</title></qhead><body>World<br/></body></html>\n<html><head><title>Hello</title></head><body>World<br='a'/></body></html>\n<html><head><title>Hello</title></head><body>Wormd<br/></body></html>\n<html><head><title>Hello</title></head><body>Wyorld<br/></body></html>\n<html><head><title>Hello<</a>/title></head><body>World<br/></body></html> \n```", "```py\n>>> runner = FunctionCoverageRunner(my_parser)\n>>> dict_fuzzer = GreyboxFuzzer(seeds, dict_mutator, PowerSchedule())\n>>> dict_fuzzer_outcome = dict_fuzzer.runs(runner, trials=5) \n```", "```py\n>>> parser = EarleyParser(XML_GRAMMAR, tokens=XML_TOKENS)\n>>> mutator = FragmentMutator(parser) \n```", "```py\n>>> seeds = [\"<html><head><title>Hello</title></head><body>World<br/></body></html>\"]\n>>> schedule = PowerSchedule()\n>>> lang_fuzzer = LangFuzzer(seeds, mutator, schedule)\n>>> for i in range(10):\n>>>     print(lang_fuzzer.fuzz())\n<html><head><title>Hello</title></head><body>World<br/></body></html>\n<html><head><title>Hello</title></head>World<br/></body></html>\n<html>World<body>World<br/></body></html>\n<html><title>Hello</title></head><title>World<br/></body></html>\n<html><head><title><head>World</head></title></head>World<br/></body></html>\n<html><body>World<br/></body><body>World<br/></body></html>\n\nException ignored in: <bound method IPythonKernel._clean_thread_parent_frames of <ipykernel.ipkernel.IPythonKernel object at 0x103912720>>\nTraceback (most recent call last):\n  File \"/Users/zeller/.local/lib/python3.12/site-packages/ipykernel/ipkernel.py\", line 775, in _clean_thread_parent_frames\n    def _clean_thread_parent_frames(\n\n  File \"Timeout.ipynb\", line 43, in timeout_handler\n    }\n\nTimeoutError: \n\n<html><body>WorldHello</body>\n\nException ignored in: <bound method IPythonKernel._clean_thread_parent_frames of <ipykernel.ipkernel.IPythonKernel object at 0x103912720>>\nTraceback (most recent call last):\n  File \"/Users/zeller/.local/lib/python3.12/site-packages/ipykernel/ipkernel.py\", line 775, in _clean_thread_parent_frames\n    def _clean_thread_parent_frames(\n\n  File \"Timeout.ipynb\", line 43, in timeout_handler\n    }\n\nTimeoutError: \n\n<html><head><title>Hello</title></head><body><head><head>World</head></title></head><body>World<br/></body><br/></body></html>\n<html><head><title></title></head><body>World<br/></body></html>\n<html><head><title>Hello</title></head><body><head><title><head>World</head></title></head><body>World<br/></body><br/><br/></body></html> \n```", "```py\n>>> tree_mutator = RegionMutator(parser)\n>>> byte_mutator = Mutator() \n```", "```py\n>>> schedule = AFLSmartSchedule(parser) \n```", "```py\n>>> aflsmart_fuzzer = GreyboxGrammarFuzzer(seeds, byte_mutator, tree_mutator, schedule) \n```", "```py\n>>> runner = FunctionCoverageRunner(my_parser)\n>>> aflsmart_outcome = aflsmart_fuzzer.runs(runner, trials=5) \n```", "```py\nimport [bookutils.setup](https://github.com/uds-se/fuzzingbook//tree/master/notebooks/shared/bookutils) \n```", "```py\nfrom [typing](https://docs.python.org/3/library/typing.html) import List, Set, Dict, Sequence, cast \n```", "```py\nfrom [Fuzzer](Fuzzer.html) import Fuzzer\nfrom [GreyboxFuzzer](GreyboxFuzzer.html) import Mutator, Seed, PowerSchedule\nfrom [GreyboxFuzzer](GreyboxFuzzer.html) import AdvancedMutationFuzzer, GreyboxFuzzer\nfrom [MutationFuzzer](MutationFuzzer.html) import FunctionCoverageRunner \n```", "```py\nMutator().mutate(\"Hello World\") \n```", "```py\n'Lello World'\n\n```", "```py\npopulation = [Seed(\"A\"), Seed(\"B\"), Seed(\"C\")]\nschedule = PowerSchedule()\nhits = {\n    \"A\": 0,\n    \"B\": 0,\n    \"C\": 0\n}\n\nfor i in range(10000):\n    seed = schedule.choose(population)\n    hits[seed.data] += 1\n\nhits \n```", "```py\n{'A': 3387, 'B': 3255, 'C': 3358}\n\n```", "```py\nfrom [html.parser](https://docs.python.org/3/library/html.parser.html) import HTMLParser \n```", "```py\ndef my_parser(inp: str) -> None:\n    parser = HTMLParser()\n    parser.feed(inp) \n```", "```py\nrunner = FunctionCoverageRunner(my_parser)\nrunner.run(\"Hello World\")\ncov = runner.coverage()\n\nlist(cov)[:5]  # Print 5 statements covered in HTMLParser \n```", "```py\n[('my_parser', 3),\n ('goahead', 163),\n ('updatepos', 47),\n ('goahead', 245),\n ('reset', 100)]\n\n```", "```py\nimport [time](https://docs.python.org/3/library/time.html)\nimport [random](https://docs.python.org/3/library/random.html) \n```", "```py\nn = 5000\nseed_input = \" \"  # empty seed\nrunner = FunctionCoverageRunner(my_parser)\nfuzzer = GreyboxFuzzer([seed_input], Mutator(), PowerSchedule()) \n```", "```py\nstart = time.time()\nfuzzer.runs(runner, trials=n)\nend = time.time() \n```", "```py\n\"It took the fuzzer %0.2f seconds to generate and execute %d inputs.\" % (end - start, n) \n```", "```py\n'It took the fuzzer 0.98 seconds to generate and execute 5000 inputs.'\n\n```", "```py\n\"During this fuzzing campaign, we covered %d statements.\" % len(runner.coverage()) \n```", "```py\n'During this fuzzing campaign, we covered 79 statements.'\n\n```", "```py\nclass DictMutator(Mutator):\n  \"\"\"Mutate strings using keywords from a dictionary\"\"\"\n\n    def __init__(self, dictionary: List[str]) -> None:\n  \"\"\"Constructor. `dictionary` is the list of keywords to use.\"\"\"\n        super().__init__()\n        self.dictionary = dictionary\n        self.mutators.append(self.insert_from_dictionary)\n\n    def insert_from_dictionary(self, s: str) -> str:\n  \"\"\"Returns s with a keyword from the dictionary inserted\"\"\"\n        pos = random.randint(0, len(s))\n        random_keyword = random.choice(self.dictionary)\n        return s[:pos] + random_keyword + s[pos:] \n```", "```py\nrunner = FunctionCoverageRunner(my_parser)\ndict_mutator = DictMutator([\"<a>\", \"</a>\", \"<a/>\", \"='a'\"])\ndict_fuzzer = GreyboxFuzzer([seed_input], dict_mutator, PowerSchedule())\n\nstart = time.time()\ndict_fuzzer.runs(runner, trials=n)\nend = time.time()\n\n\"It took the fuzzer %0.2f seconds to generate and execute %d inputs.\" % (end - start, n) \n```", "```py\n'It took the fuzzer 2.78 seconds to generate and execute 5000 inputs.'\n\n```", "```py\n\"During this fuzzing campaign, we covered %d statements.\" % len(runner.coverage()) \n```", "```py\n'During this fuzzing campaign, we covered 108 statements.'\n\n```", "```py\nfrom [Coverage](Coverage.html) import population_coverage \n```", "```py\nimport [matplotlib.pyplot](https://matplotlib.org/) as plt \n```", "```py\n_, dict_cov = population_coverage(dict_fuzzer.inputs, my_parser)\n_, fuzz_cov = population_coverage(fuzzer.inputs, my_parser)\nline_dict, = plt.plot(dict_cov, label=\"With Dictionary\")\nline_fuzz, = plt.plot(fuzz_cov, label=\"Without Dictionary\")\nplt.legend(handles=[line_dict, line_fuzz])\nplt.xlim(0, n)\nplt.title('Coverage over time')\nplt.xlabel('# of inputs')\nplt.ylabel('lines covered'); \n```", "```py\nvar  haystack  =  \"foo\";\nvar  re_text  =  \"^foo\";\nhaystack  +=  \"x\";\nre_text  +=  \"(x)\";\nvar  re  =  new  RegExp(re_text);\nre.test(haystack);\nRegExp.input  =  Number();\nprint(RegExp.$1); \n```", "```py\nimport [string](https://docs.python.org/3/library/string.html) \n```", "```py\nfrom [Grammars](Grammars.html) import is_valid_grammar, srange, Grammar \n```", "```py\nXML_TOKENS: Set[str] = {\"<id>\", \"<text>\"} \n```", "```py\nXML_GRAMMAR: Grammar = {\n    \"<start>\": [\"<xml-tree>\"],\n    \"<xml-tree>\": [\"<text>\",\n                   \"<xml-open-tag><xml-tree><xml-close-tag>\",\n                   \"<xml-openclose-tag>\",\n                   \"<xml-tree><xml-tree>\"],\n    \"<xml-open-tag>\":      [\"<<id>>\", \"<<id> <xml-attribute>>\"],\n    \"<xml-openclose-tag>\": [\"<<id>/>\", \"<<id> <xml-attribute>/>\"],\n    \"<xml-close-tag>\":     [\"</<id>>\"],\n    \"<xml-attribute>\":     [\"<id>=<id>\", \"<xml-attribute> <xml-attribute>\"],\n    \"<id>\":                [\"<letter>\", \"<id><letter>\"],\n    \"<text>\":              [\"<text><letter_space>\", \"<letter_space>\"],\n    \"<letter>\":            srange(string.ascii_letters + string.digits +\n                                  \"\\\"\" + \"'\" + \".\"),\n    \"<letter_space>\":      srange(string.ascii_letters + string.digits +\n                                  \"\\\"\" + \"'\" + \" \" + \"\\t\"),\n} \n```", "```py\nassert is_valid_grammar(XML_GRAMMAR) \n```", "```py\nfrom [Parser](Parser.html) import EarleyParser, Parser\nfrom [GrammarFuzzer](GrammarFuzzer.html) import display_tree, DerivationTree \n```", "```py\nfrom [IPython.display](https://ipython.readthedocs.io/en/stable/api/generated/IPython.display.html) import display \n```", "```py\nparser = EarleyParser(XML_GRAMMAR, tokens=XML_TOKENS)\n\nfor tree in parser.parse(\"<html>Text</html>\"):\n    display(display_tree(tree)) \n```", "```py\nclass FragmentMutator(Mutator):\n  \"\"\"Mutate inputs with input fragments from a pool\"\"\"\n\n    def __init__(self, parser: EarleyParser) -> None:\n  \"\"\"Initialize empty fragment pool and add parser\"\"\"\n        self.parser = parser\n        self.fragments: Dict[str, List[DerivationTree]] = \\\n            {k: [] for k in self.parser.cgrammar}\n        super().__init__() \n```", "```py\nfrom [Parser](Parser.html) import terminals \n```", "```py\nclass FragmentMutator(FragmentMutator):\n    def add_fragment(self, fragment: DerivationTree) -> None:\n  \"\"\"Recursively adds fragments to the fragment pool\"\"\"\n        (symbol, children) = fragment\n        if not self.is_excluded(symbol):\n            self.fragments[symbol].append(fragment)\n            assert children is not None\n            for subfragment in children:\n                self.add_fragment(subfragment)\n\n    def is_excluded(self, symbol: str) -> bool:\n  \"\"\"Returns true if a fragment starting with a specific\n symbol and all its decendents can be excluded\"\"\"\n        return (symbol not in self.parser.grammar() or\n                symbol in self.parser.tokens or\n                symbol in terminals(self.parser.grammar())) \n```", "```py\nfrom [Timeout](Timeout.html) import Timeout \n```", "```py\nclass SeedWithStructure(Seed):\n  \"\"\"Seeds augmented with structure info\"\"\"\n\n    def __init__(self, data: str) -> None:\n        super().__init__(data)\n        self.has_structure = False\n        self.structure: DerivationTree = (\"<empty>\", []) \n```", "```py\nclass FragmentMutator(FragmentMutator):\n    def add_to_fragment_pool(self, seed: SeedWithStructure) -> None:\n  \"\"\"Adds all fragments of a seed to the fragment pool\"\"\"\n        try:  # only allow quick parsing of 200ms max\n            with Timeout(0.2):\n                seed.structure = next(self.parser.parse(seed.data))\n                self.add_fragment(seed.structure)\n            seed.has_structure = True\n        except (SyntaxError, TimeoutError):\n            seed.has_structure = False \n```", "```py\nfrom [GrammarFuzzer](GrammarFuzzer.html) import tree_to_string \n```", "```py\nvalid_seed = SeedWithStructure(\n    \"<html><head><title>Hello</title></head><body>World<br/></body></html>\")\nfragment_mutator = FragmentMutator(EarleyParser(XML_GRAMMAR, tokens=XML_TOKENS))\nfragment_mutator.add_to_fragment_pool(valid_seed)\n\nfor key in fragment_mutator.fragments:\n    print(key)\n    for f in fragment_mutator.fragments[key]:\n        print(\"|-%s\" % tree_to_string(f)) \n```", "```py\n<start>\n|-<html><head><title>Hello</title></head><body>World<br/></body></html>\n<xml-tree>\n|-<html><head><title>Hello</title></head><body>World<br/></body></html>\n|-<head><title>Hello</title></head><body>World<br/></body>\n|-<head><title>Hello</title></head>\n|-<title>Hello</title>\n|-Hello\n|-<body>World<br/></body>\n|-World<br/>\n|-World\n|-<br/>\n<xml-open-tag>\n|-<html>\n|-<head>\n|-<title>\n|-<body>\n<xml-openclose-tag>\n|-<br/>\n<xml-close-tag>\n|-</title>\n|-</head>\n|-</body>\n|-</html>\n<xml-attribute>\n<id>\n<text>\n<letter>\n<letter_space>\n\n```", "```py\nclass FragmentMutator(FragmentMutator):\n    def __init__(self, parser: EarleyParser) -> None:\n  \"\"\"Initialize mutators\"\"\"\n        super().__init__(parser)\n        self.seen_seeds: List[SeedWithStructure] = []\n\n    def mutate(self, seed: SeedWithStructure) -> SeedWithStructure:\n  \"\"\"Implement structure-aware mutation. Memoize seeds.\"\"\"\n        if seed not in self.seen_seeds:\n            self.seen_seeds.append(seed)\n            self.add_to_fragment_pool(seed)\n\n        return super().mutate(seed) \n```", "```py\nclass FragmentMutator(FragmentMutator):\n    def count_nodes(self, fragment: DerivationTree) -> int:\n  \"\"\"Returns the number of nodes in the fragment\"\"\"\n        symbol, children = fragment\n        if self.is_excluded(symbol):\n            return 0\n\n        assert children is not None\n        return 1 + sum(map(self.count_nodes, children)) \n```", "```py\nclass FragmentMutator(FragmentMutator):\n    def recursive_swap(self, fragment: DerivationTree) -> DerivationTree:\n  \"\"\"Recursively finds the fragment to swap.\"\"\"\n        symbol, children = fragment\n        if self.is_excluded(symbol):\n            return symbol, children\n\n        self.to_swap -= 1\n        if self.to_swap == 0: \n            return random.choice(list(self.fragments[symbol]))\n\n        assert children is not None\n        return symbol, list(map(self.recursive_swap, children)) \n```", "```py\nclass FragmentMutator(FragmentMutator):\n    def __init__(self, parser: EarleyParser) -> None:\n        super().__init__(parser)\n        self.mutators = [self.swap_fragment]\n\n    def swap_fragment(self, seed: SeedWithStructure) -> SeedWithStructure:\n  \"\"\"Substitutes a random fragment with another with the same symbol\"\"\"\n        if seed.has_structure:\n            n_nodes = self.count_nodes(seed.structure)\n            self.to_swap = random.randint(2, n_nodes)\n            new_structure = self.recursive_swap(seed.structure)\n\n            new_seed = SeedWithStructure(tree_to_string(new_structure))\n            new_seed.has_structure = True\n            new_seed.structure = new_structure\n            return new_seed\n\n        return seed \n```", "```py\nvalid_seed = SeedWithStructure(\n    \"<html><head><title>Hello</title></head><body>World<br/></body></html>\")\nlf_mutator = FragmentMutator(parser)\nprint(valid_seed)\nlf_mutator.mutate(valid_seed) \n```", "```py\n<html><head><title>Hello</title></head><body>World<br/></body></html>\n\n```", "```py\n<title><head><title>Hello</title></head><body>World<br/></body></html>\n\n```", "```py\nclass FragmentMutator(FragmentMutator):\n    def recursive_delete(self, fragment: DerivationTree) -> DerivationTree:\n  \"\"\"Recursively finds the fragment to delete\"\"\"\n        symbol, children = fragment\n        if self.is_excluded(symbol):\n            return symbol, children\n\n        self.to_delete -= 1\n        if self.to_delete == 0:\n            return symbol, []\n\n        assert children is not None\n        return symbol, list(map(self.recursive_delete, children)) \n```", "```py\nclass FragmentMutator(FragmentMutator):\n    def __init__(self, parser):\n        super().__init__(parser)\n        self.mutators.append(self.delete_fragment)\n\n    def delete_fragment(self, seed: SeedWithStructure) -> SeedWithStructure:\n  \"\"\"Delete a random fragment\"\"\"\n        if seed.has_structure:\n            n_nodes = self.count_nodes(seed.structure)\n            self.to_delete = random.randint(2, n_nodes)\n            new_structure = self.recursive_delete(seed.structure)\n\n            new_seed = SeedWithStructure(tree_to_string(new_structure))\n            new_seed.has_structure = True\n            new_seed.structure = new_structure\n            # do not return an empty new_seed\n            if not new_seed.data:\n                return seed\n            else:\n                return new_seed\n\n        return seed \n```", "```py\nclass LangFuzzer(AdvancedMutationFuzzer):\n  \"\"\"Blackbox fuzzer mutating input fragments. Roughly based on `LangFuzz`.\"\"\"\n\n    def create_candidate(self) -> Seed:\n  \"\"\"Returns an input generated by fuzzing a seed in the population\"\"\"\n        candidate = self.schedule.choose(self.population)\n        trials = random.randint(1, 4)\n        for i in range(trials):\n            candidate = self.mutator.mutate(candidate)\n\n        return candidate \n```", "```py\nn = 300\nrunner = FunctionCoverageRunner(my_parser)\nmutator = FragmentMutator(EarleyParser(XML_GRAMMAR, tokens=XML_TOKENS))\nschedule = PowerSchedule()\n\nlang_fuzzer = LangFuzzer([valid_seed.data], mutator, schedule)\n\nstart = time.time()\nlang_fuzzer.runs(runner, trials=n)\nend = time.time()\n\n\"It took LangFuzzer %0.2f seconds to generate and execute %d inputs.\" % (end - start, n) \n```", "```py\nException ignored in: <bound method IPythonKernel._clean_thread_parent_frames of <ipykernel.ipkernel.IPythonKernel object at 0x103912720>>\nTraceback (most recent call last):\n  File \"/Users/zeller/.local/lib/python3.12/site-packages/ipykernel/ipkernel.py\", line 775, in _clean_thread_parent_frames\n    def _clean_thread_parent_frames(\n\n  File \"Timeout.ipynb\", line 43, in timeout_handler\n    }\n\nTimeoutError: \nException ignored in: <bound method IPythonKernel._clean_thread_parent_frames of <ipykernel.ipkernel.IPythonKernel object at 0x103912720>>\nTraceback (most recent call last):\n  File \"/Users/zeller/.local/lib/python3.12/site-packages/ipykernel/ipkernel.py\", line 775, in _clean_thread_parent_frames\n    def _clean_thread_parent_frames(\n\n  File \"Timeout.ipynb\", line 43, in timeout_handler\n    }\n\nTimeoutError: \nException ignored in: <bound method IPythonKernel._clean_thread_parent_frames of <ipykernel.ipkernel.IPythonKernel object at 0x103912720>>\nTraceback (most recent call last):\n  File \"/Users/zeller/.local/lib/python3.12/site-packages/ipykernel/ipkernel.py\", line 775, in _clean_thread_parent_frames\n    def _clean_thread_parent_frames(\n\n  File \"Timeout.ipynb\", line 43, in timeout_handler\n    }\n\nTimeoutError: \nException ignored in: <bound method IPythonKernel._clean_thread_parent_frames of <ipykernel.ipkernel.IPythonKernel object at 0x103912720>>\nTraceback (most recent call last):\n  File \"/Users/zeller/.local/lib/python3.12/site-packages/ipykernel/ipkernel.py\", line 775, in _clean_thread_parent_frames\n    def _clean_thread_parent_frames(\n\n  File \"Timeout.ipynb\", line 43, in timeout_handler\n    }\n\nTimeoutError: \nException ignored in: <bound method IPythonKernel._clean_thread_parent_frames of <ipykernel.ipkernel.IPythonKernel object at 0x103912720>>\nTraceback (most recent call last):\n  File \"/Users/zeller/.local/lib/python3.12/site-packages/ipykernel/ipkernel.py\", line 775, in _clean_thread_parent_frames\n    def _clean_thread_parent_frames(\n\n  File \"Timeout.ipynb\", line 43, in timeout_handler\n    }\n\nTimeoutError: \nException ignored in: <bound method IPythonKernel._clean_thread_parent_frames of <ipykernel.ipkernel.IPythonKernel object at 0x103912720>>\nTraceback (most recent call last):\n  File \"/Users/zeller/.local/lib/python3.12/site-packages/ipykernel/ipkernel.py\", line 775, in _clean_thread_parent_frames\n    def _clean_thread_parent_frames(\n\n  File \"Timeout.ipynb\", line 43, in timeout_handler\n    }\n\nTimeoutError: \nException ignored in: <bound method IPythonKernel._clean_thread_parent_frames of <ipykernel.ipkernel.IPythonKernel object at 0x103912720>>\nTraceback (most recent call last):\n  File \"/Users/zeller/.local/lib/python3.12/site-packages/ipykernel/ipkernel.py\", line 775, in _clean_thread_parent_frames\n    def _clean_thread_parent_frames(\n\n  File \"Timeout.ipynb\", line 43, in timeout_handler\n    }\n\nTimeoutError: \nException ignored in: <bound method IPythonKernel._clean_thread_parent_frames of <ipykernel.ipkernel.IPythonKernel object at 0x103912720>>\nTraceback (most recent call last):\n  File \"/Users/zeller/.local/lib/python3.12/site-packages/ipykernel/ipkernel.py\", line 775, in _clean_thread_parent_frames\n    def _clean_thread_parent_frames(\n\n  File \"Timeout.ipynb\", line 43, in timeout_handler\n    }\n\nTimeoutError: \n\n```", "```py\n'It took LangFuzzer 94.94 seconds to generate and execute 300 inputs.'\n\n```", "```py\nrunner = FunctionCoverageRunner(my_parser)\nmutator = Mutator()\nschedule = PowerSchedule()\n\nblackFuzzer = AdvancedMutationFuzzer([valid_seed.data], mutator, schedule)\n\nstart = time.time()\nblackFuzzer.runs(runner, trials=n)\nend = time.time()\n\n\"It took a blackbox fuzzer %0.2f seconds to generate and execute %d inputs.\" % (end - start, n) \n```", "```py\n'It took a blackbox fuzzer 0.10 seconds to generate and execute 300 inputs.'\n\n```", "```py\nblackbox_coverage = len(runner.coverage())\n\"During this fuzzing campaign, the blackbox fuzzer covered %d statements.\" % blackbox_coverage \n```", "```py\n'During this fuzzing campaign, the blackbox fuzzer covered 94 statements.'\n\n```", "```py\nfrom [Coverage](Coverage.html) import population_coverage \n```", "```py\ndef print_stats(fuzzer, parser: Parser) -> None:\n    coverage, _ = population_coverage(fuzzer.inputs, my_parser)\n\n    has_structure = 0\n    for seed in fuzzer.inputs:\n        # reuse memoized information\n        if hasattr(seed, \"has_structure\"):\n            if seed.has_structure: \n                has_structure += 1\n        else:\n            if isinstance(seed, str):\n                seed = Seed(seed)\n            try:\n                with Timeout(0.2):\n                    next(parser.parse(seed.data))\n                has_structure += 1\n            except (SyntaxError, TimeoutError):\n                pass\n\n    print(\"From the %d generated inputs, %d (%0.2f%%) can be parsed.\\n\"\n          \"In total, %d statements are covered.\" % (\n            len(fuzzer.inputs),\n            has_structure,\n            100 * has_structure / len(fuzzer.inputs),\n            len(coverage))) \n```", "```py\nprint_stats(lang_fuzzer, EarleyParser(XML_GRAMMAR, tokens=XML_TOKENS)) \n```", "```py\nFrom the 300 generated inputs, 172 (57.33%) can be parsed.\nIn total, 93 statements are covered.\n\n```", "```py\nprint_stats(blackFuzzer, EarleyParser(XML_GRAMMAR, tokens=XML_TOKENS)) \n```", "```py\nException ignored in: <bound method IPythonKernel._clean_thread_parent_frames of <ipykernel.ipkernel.IPythonKernel object at 0x103912720>>\nTraceback (most recent call last):\n  File \"/Users/zeller/.local/lib/python3.12/site-packages/ipykernel/ipkernel.py\", line 775, in _clean_thread_parent_frames\n    def _clean_thread_parent_frames(\n\n  File \"Timeout.ipynb\", line 43, in timeout_handler\n    }\n\nTimeoutError: \n\n```", "```py\nFrom the 300 generated inputs, 34 (11.33%) can be parsed.\nIn total, 167 statements are covered.\n\n```", "```py\nclass GreyboxGrammarFuzzer(GreyboxFuzzer):\n  \"\"\"Greybox fuzzer using grammars.\"\"\"\n\n    def __init__(self, seeds: List[str],\n                 byte_mutator: Mutator, tree_mutator: FragmentMutator,\n                 schedule: PowerSchedule) -> None:\n  \"\"\"Constructor.\n `seeds` - set of inputs to mutate.\n `byte_mutator` - a byte-level mutator.\n `tree_mutator` = a tree-level mutator.\n `schedule` - a power schedule.\n \"\"\"\n        super().__init__(seeds, byte_mutator, schedule)\n        self.tree_mutator = tree_mutator\n\n    def create_candidate(self) -> str:\n  \"\"\"Returns an input generated by structural mutation \n of a seed in the population\"\"\"\n        seed = cast(SeedWithStructure, self.schedule.choose(self.population))\n\n        # Structural mutation\n        trials = random.randint(0, 4)\n        for i in range(trials):\n            seed = self.tree_mutator.mutate(seed)\n\n        # Byte-level mutation\n        candidate = seed.data\n        if trials == 0 or not seed.has_structure or random.randint(0, 1) == 1:\n            dumb_trials = min(len(seed.data), 1 << random.randint(1, 5))\n            for i in range(dumb_trials):\n                candidate = self.mutator.mutate(candidate)\n\n        return candidate \n```", "```py\nrunner = FunctionCoverageRunner(my_parser)\nbyte_mutator = Mutator()\ntree_mutator = FragmentMutator(EarleyParser(XML_GRAMMAR, tokens=XML_TOKENS))\nschedule = PowerSchedule()\n\ngg_fuzzer = GreyboxGrammarFuzzer([valid_seed.data], byte_mutator, tree_mutator, schedule)\n\nstart = time.time()\ngg_fuzzer.runs(runner, trials=n)\nend = time.time()\n\n\"It took the greybox grammar fuzzer %0.2f seconds to generate and execute %d inputs.\" % (end - start, n) \n```", "```py\n'It took the greybox grammar fuzzer 0.69 seconds to generate and execute 300 inputs.'\n\n```", "```py\nprint_stats(gg_fuzzer, EarleyParser(XML_GRAMMAR, tokens=XML_TOKENS)) \n```", "```py\nFrom the 300 generated inputs, 2 (0.67%) can be parsed.\nIn total, 171 statements are covered.\n\n```", "```py\ninvalid_seed = Seed(\"<html><body><i>World</i><br/>>/body></html>\")\nparser = EarleyParser(XML_GRAMMAR, tokens=XML_TOKENS)\ntable = parser.chart_parse(invalid_seed.data, parser.start_symbol())\nfor column in table:\n    print(column)\n    print(\"---\") \n```", "```py\nNone chart[0]\n\n---\n< chart[1]\n\n---\nh chart[2]\n<letter>:= h |(1,2)\n<id>:= <letter> |(1,2)\n---\nt chart[3]\n<letter>:= t |(2,3)\n<id>:= <id> <letter> |(1,3)\n---\nm chart[4]\n<letter>:= m |(3,4)\n<id>:= <id> <letter> |(1,4)\n---\nl chart[5]\n<letter>:= l |(4,5)\n<id>:= <id> <letter> |(1,5)\n---\n> chart[6]\n<xml-open-tag>:= < <id> > |(0,6)\n---\n< chart[7]\n\n---\nb chart[8]\n<letter>:= b |(7,8)\n<id>:= <letter> |(7,8)\n---\no chart[9]\n<letter>:= o |(8,9)\n<id>:= <id> <letter> |(7,9)\n---\nd chart[10]\n<letter>:= d |(9,10)\n<id>:= <id> <letter> |(7,10)\n---\ny chart[11]\n<letter>:= y |(10,11)\n<id>:= <id> <letter> |(7,11)\n---\n> chart[12]\n<xml-open-tag>:= < <id> > |(6,12)\n---\n< chart[13]\n\n---\ni chart[14]\n<letter>:= i |(13,14)\n<id>:= <letter> |(13,14)\n---\n> chart[15]\n<xml-open-tag>:= < <id> > |(12,15)\n---\nW chart[16]\n<letter_space>:= W |(15,16)\n<text>:= <letter_space> |(15,16)\n<xml-tree>:= <text> |(15,16)\n---\no chart[17]\n<letter_space>:= o |(16,17)\n<text>:= <text> <letter_space> |(15,17)\n<text>:= <letter_space> |(16,17)\n<xml-tree>:= <text> |(15,17)\n<xml-tree>:= <text> |(16,17)\n<xml-tree>:= <xml-tree> <xml-tree> |(15,17)\n---\nr chart[18]\n<letter_space>:= r |(17,18)\n<text>:= <text> <letter_space> |(15,18)\n<text>:= <text> <letter_space> |(16,18)\n<text>:= <letter_space> |(17,18)\n<xml-tree>:= <text> |(15,18)\n<xml-tree>:= <text> |(16,18)\n<xml-tree>:= <text> |(17,18)\n<xml-tree>:= <xml-tree> <xml-tree> |(15,18)\n<xml-tree>:= <xml-tree> <xml-tree> |(16,18)\n---\nl chart[19]\n<letter_space>:= l |(18,19)\n<text>:= <text> <letter_space> |(15,19)\n<text>:= <text> <letter_space> |(16,19)\n<text>:= <text> <letter_space> |(17,19)\n<text>:= <letter_space> |(18,19)\n<xml-tree>:= <text> |(15,19)\n<xml-tree>:= <text> |(16,19)\n<xml-tree>:= <text> |(17,19)\n<xml-tree>:= <text> |(18,19)\n<xml-tree>:= <xml-tree> <xml-tree> |(15,19)\n<xml-tree>:= <xml-tree> <xml-tree> |(16,19)\n<xml-tree>:= <xml-tree> <xml-tree> |(17,19)\n---\nd chart[20]\n<letter_space>:= d |(19,20)\n<text>:= <text> <letter_space> |(15,20)\n<text>:= <text> <letter_space> |(16,20)\n<text>:= <text> <letter_space> |(17,20)\n<text>:= <text> <letter_space> |(18,20)\n<text>:= <letter_space> |(19,20)\n<xml-tree>:= <text> |(15,20)\n<xml-tree>:= <text> |(16,20)\n<xml-tree>:= <text> |(17,20)\n<xml-tree>:= <text> |(18,20)\n<xml-tree>:= <text> |(19,20)\n<xml-tree>:= <xml-tree> <xml-tree> |(15,20)\n<xml-tree>:= <xml-tree> <xml-tree> |(16,20)\n<xml-tree>:= <xml-tree> <xml-tree> |(17,20)\n<xml-tree>:= <xml-tree> <xml-tree> |(18,20)\n---\n< chart[21]\n\n---\n/ chart[22]\n\n---\ni chart[23]\n<letter>:= i |(22,23)\n<id>:= <letter> |(22,23)\n---\n> chart[24]\n<xml-close-tag>:= < / <id> > |(20,24)\n<xml-tree>:= <xml-open-tag> <xml-tree> <xml-close-tag> |(12,24)\n---\n< chart[25]\n\n---\nb chart[26]\n<letter>:= b |(25,26)\n<id>:= <letter> |(25,26)\n---\nr chart[27]\n<letter>:= r |(26,27)\n<id>:= <id> <letter> |(25,27)\n---\n/ chart[28]\n\n---\n> chart[29]\n<xml-openclose-tag>:= < <id> / > |(24,29)\n<xml-tree>:= <xml-openclose-tag> |(24,29)\n<xml-tree>:= <xml-tree> <xml-tree> |(12,29)\n---\n> chart[30]\n\n---\n/ chart[31]\n\n---\nb chart[32]\n\n---\no chart[33]\n\n---\nd chart[34]\n\n---\ny chart[35]\n\n---\n> chart[36]\n\n---\n< chart[37]\n\n---\n/ chart[38]\n\n---\nh chart[39]\n\n---\nt chart[40]\n\n---\nm chart[41]\n\n---\nl chart[42]\n\n---\n> chart[43]\n\n---\n\n```", "```py\ncols = [col for col in table if col.states]\nparsable = invalid_seed.data[:len(cols)-1]\n\nprint(\"'%s'\" % invalid_seed)\nparsable \n```", "```py\n'<html><body><i>World</i><br/>>/body></html>'\n\n```", "```py\n'<html><body><i>World</i><br/>'\n\n```", "```py\nvalidity = 100 * len(parsable) / len(invalid_seed.data)\n\n\"%0.1f%% of the string can be parsed successfully.\" % validity \n```", "```py\n'67.4% of the string can be parsed successfully.'\n\n```", "```py\nclass SeedWithRegions(SeedWithStructure):\n  \"\"\"Seeds augmented with structure info\"\"\"\n\n    def __init__(self, data: str) -> None:\n        super().__init__(data)\n        self.has_regions = False\n        self.regions: Dict[str, Set] = {} \n```", "```py\nclass RegionMutator(FragmentMutator):\n    def add_to_fragment_pool(self, seed: SeedWithRegions) -> None:\n  \"\"\"Mark fragments and regions in a seed file\"\"\"\n        super().add_to_fragment_pool(seed)\n        if not seed.has_structure:\n            try:\n                with Timeout(0.2):\n                    seed.regions = {k: set() for k in self.parser.cgrammar}\n                    for column in self.parser.chart_parse(seed.data,\n                                                          self.parser.start_symbol()):\n                        for state in column.states:\n                            if (not self.is_excluded(state.name) and\n                                    state.e_col.index - state.s_col.index > 1 and\n                                    state.finished()):\n                                seed.regions[state.name].add((state.s_col.index,\n                                                              state.e_col.index))\n                seed.has_regions = True\n            except TimeoutError:\n                seed.has_regions = False\n        else:\n            seed.has_regions = False \n```", "```py\ninvalid_seed = SeedWithRegions(\"<html><body><i>World</i><br/>>/body></html>\")\nmutator = RegionMutator(parser)\nmutator.add_to_fragment_pool(invalid_seed)\nfor symbol in invalid_seed.regions:\n    print(symbol)\n    for (s, e) in invalid_seed.regions[symbol]:\n        print(\"|-(%d,%d) : %s\" % (s, e, invalid_seed.data[s:e])) \n```", "```py\n<start>\n<xml-tree>\n|-(16,20) : orld\n|-(12,24) : <i>World</i>\n|-(17,20) : rld\n|-(18,20) : ld\n|-(16,19) : orl\n|-(15,17) : Wo\n|-(12,29) : <i>World</i><br/>\n|-(17,19) : rl\n|-(15,20) : World\n|-(24,29) : <br/>\n|-(15,19) : Worl\n|-(16,18) : or\n|-(15,18) : Wor\n<xml-open-tag>\n|-(6,12) : <body>\n|-(12,15) : <i>\n|-(0,6) : <html>\n<xml-openclose-tag>\n|-(24,29) : <br/>\n<xml-close-tag>\n|-(20,24) : </i>\n<xml-attribute>\n<id>\n<text>\n<letter>\n<letter_space>\n\n```", "```py\nclass RegionMutator(RegionMutator):\n    def swap_fragment(self, seed: SeedWithRegions) -> SeedWithRegions:\n  \"\"\"Chooses a random region and swaps it with a fragment\n that starts with the same symbol\"\"\"\n        if not seed.has_structure and seed.has_regions:\n            regions = [r for r in seed.regions\n                       if (len(seed.regions[r]) > 0 and\n                           len(self.fragments[r]) > 0)]\n            if len(regions) == 0:\n                return seed\n\n            key = random.choice(list(regions))\n            s, e = random.choice(list(seed.regions[key]))\n            swap_structure = random.choice(self.fragments[key])\n            swap_string = tree_to_string(swap_structure)\n            new_seed = SeedWithRegions(seed.data[:s] + swap_string + seed.data[e:])\n            new_seed.has_structure = False\n            new_seed.has_regions = False\n            return new_seed\n        else:\n            return super().swap_fragment(seed) \n```", "```py\nclass RegionMutator(RegionMutator):\n    def delete_fragment(self, seed: SeedWithRegions) -> SeedWithRegions:\n  \"\"\"Deletes a random region\"\"\"\n        if not seed.has_structure and seed.has_regions:\n            regions = [r for r in seed.regions\n                       if len(seed.regions[r]) > 0]\n            if len(regions) == 0:\n                return seed\n\n            key = random.choice(list(regions))\n            s, e = (0, 0)\n            while (e - s < 2):\n                s, e = random.choice(list(seed.regions[key]))\n\n            new_seed = SeedWithRegions(seed.data[:s] + seed.data[e:])\n            new_seed.has_structure = False\n            new_seed.has_regions = False\n            return new_seed\n        else:\n            return super().delete_fragment(seed) \n```", "```py\nsimple_seed = SeedWithRegions(\"<b>Text</b>\")\nmutator = RegionMutator(parser)\nmutator.add_to_fragment_pool(simple_seed)\n\nprint(invalid_seed)\nmutator.mutate(invalid_seed) \n```", "```py\n<html><body><i>World</i><br/>>/body></html>\n\n```", "```py\n<html><body>>/body></html>\n\n```", "```py\nrunner = FunctionCoverageRunner(my_parser)\nbyte_mutator = Mutator()\ntree_mutator = RegionMutator(EarleyParser(XML_GRAMMAR, tokens=XML_TOKENS))\nschedule = PowerSchedule()\n\nregionFuzzer = GreyboxGrammarFuzzer([valid_seed.data], byte_mutator, tree_mutator, schedule)\n\nstart = time.time()\nregionFuzzer.runs(runner, trials = n)\nend = time.time()\n\n\"\"\"\nIt took the structural greybox fuzzer with region mutator\n%0.2f seconds to generate and execute %d inputs.\n\"\"\" % (end - start, n) \n```", "```py\n'\\nIt took the structural greybox fuzzer with region mutator\\n6.83 seconds to generate and execute 300 inputs.\\n'\n\n```", "```py\ndef print_more_stats(fuzzer: GreyboxGrammarFuzzer, parser: EarleyParser):\n    print_stats(fuzzer, parser)\n    validity = 0.0\n    total = 0\n    for seed in fuzzer.population:\n        if not seed.data: continue\n        table = parser.chart_parse(seed.data, parser.start_symbol())\n        cols = [col for col in table if col.states]\n        parsable = invalid_seed.data[:len(cols)-1]\n        validity += len(parsable) / len(seed.data)\n        total += 1\n\n    print(\"On average, %0.1f%% of a seed in the population can be successfully parsed.\" % (100 * validity / total)) \n```", "```py\nprint_more_stats(regionFuzzer, parser) \n```", "```py\nFrom the 300 generated inputs, 11 (3.67%) can be parsed.\nIn total, 168 statements are covered.\nOn average, 18.2% of a seed in the population can be successfully parsed.\n\n```", "```py\nimport [math](https://docs.python.org/3/library/math.html) \n```", "```py\nclass AFLSmartSchedule(PowerSchedule):\n    def __init__(self, parser: EarleyParser, exponent: float = 1.0):\n        self.parser = parser\n        self.exponent = exponent\n\n    def parsable(self, seed: Seed) -> str:\n  \"\"\"Returns the substring that is parsable\"\"\"\n        table = self.parser.chart_parse(seed.data, self.parser.start_symbol())\n        cols = [col for col in table if col.states]\n        return seed.data[:len(cols)-1]\n\n    def degree_of_validity(self, seed: Seed) -> float:\n  \"\"\"Returns the proportion of a seed that is parsable\"\"\"\n        if not hasattr(seed, 'validity'):\n            seed.validity = (len(self.parsable(seed)) / len(seed.data)\n                             if len(seed.data) > 0 else 0)\n        return seed.validity\n\n    def assignEnergy(self, population: Sequence[Seed]):\n  \"\"\"Assign exponential energy proportional to degree of validity\"\"\"\n        for seed in population:\n            seed.energy = ((self.degree_of_validity(seed) / math.log(len(seed.data))) ** self.exponent\n                           if len(seed.data) > 1 else 0) \n```", "```py\nsmart_schedule = AFLSmartSchedule(parser)\nprint(\"%11s: %s\" % (\"Entire seed\", simple_seed))\nprint(\"%11s: %s\" % (\"Parsable\", smart_schedule.parsable(simple_seed)))\n\n\"Degree of validity: %0.2f%%\" % (100 * smart_schedule.degree_of_validity(simple_seed)) \n```", "```py\nEntire seed: <b>Text</b>\n   Parsable: <b>Text</b>\n\n```", "```py\n'Degree of validity: 100.00%'\n\n```", "```py\nprint(\"%11s: %s\" % (\"Entire seed\", invalid_seed))\nprint(\"%11s: %s\" % (\"Parsable\", smart_schedule.parsable(invalid_seed)))\n\n\"Degree of validity: %0.2f%%\" % (100 * smart_schedule.degree_of_validity(invalid_seed)) \n```", "```py\nEntire seed: <html><body><i>World</i><br/>>/body></html>\n   Parsable: <html><body><i>World</i><br/>\n\n```", "```py\n'Degree of validity: 67.44%'\n\n```", "```py\nrunner = FunctionCoverageRunner(my_parser)\nbyte_mutator = Mutator()\ntree_mutator = RegionMutator(EarleyParser(XML_GRAMMAR, tokens=XML_TOKENS))\nschedule = AFLSmartSchedule(parser)\n\naflsmart_fuzzer = GreyboxGrammarFuzzer([valid_seed.data], byte_mutator, \n                                       tree_mutator, schedule)\n\nstart = time.time()\naflsmart_fuzzer.runs(runner, trials=n)\nend = time.time()\n\n\"It took AFLSmart %0.2f seconds to generate and execute %d inputs.\" % (end - start, n) \n```", "```py\nException ignored in: <bound method IPythonKernel._clean_thread_parent_frames of <ipykernel.ipkernel.IPythonKernel object at 0x103912720>>\nTraceback (most recent call last):\n  File \"/Users/zeller/.local/lib/python3.12/site-packages/ipykernel/ipkernel.py\", line 775, in _clean_thread_parent_frames\n    def _clean_thread_parent_frames(\n\n  File \"Timeout.ipynb\", line 43, in timeout_handler\n    }\n\nTimeoutError: \nException ignored in: <bound method IPythonKernel._clean_thread_parent_frames of <ipykernel.ipkernel.IPythonKernel object at 0x103912720>>\nTraceback (most recent call last):\n  File \"/Users/zeller/.local/lib/python3.12/site-packages/ipykernel/ipkernel.py\", line 775, in _clean_thread_parent_frames\n    def _clean_thread_parent_frames(\n\n  File \"Timeout.ipynb\", line 43, in timeout_handler\n    }\n\nTimeoutError: \nException ignored in: <bound method IPythonKernel._clean_thread_parent_frames of <ipykernel.ipkernel.IPythonKernel object at 0x103912720>>\nTraceback (most recent call last):\n  File \"/Users/zeller/.local/lib/python3.12/site-packages/ipykernel/ipkernel.py\", line 775, in _clean_thread_parent_frames\n    def _clean_thread_parent_frames(\n\n  File \"Timeout.ipynb\", line 43, in timeout_handler\n    }\n\nTimeoutError: \n\n```", "```py\n'It took AFLSmart 26.16 seconds to generate and execute 300 inputs.'\n\n```", "```py\nprint_more_stats(aflsmart_fuzzer, parser) \n```", "```py\nFrom the 300 generated inputs, 9 (3.00%) can be parsed.\nIn total, 159 statements are covered.\nOn average, 22.6% of a seed in the population can be successfully parsed.\n\n```", "```py\n@incollection{fuzzingbook2024:GreyboxGrammarFuzzer,\n    author = {Andreas Zeller and Rahul Gopinath and Marcel B{\\\"o}hme and Gordon Fraser and Christian Holler},\n    booktitle = {The Fuzzing Book},\n    title = {Greybox Fuzzing with Grammars},\n    year = {2024},\n    publisher = {CISPA Helmholtz Center for Information Security},\n    howpublished = {\\url{https://www.fuzzingbook.org/html/GreyboxGrammarFuzzer.html}},\n    note = {Retrieved 2024-01-21 13:07:50+01:00},\n    url = {https://www.fuzzingbook.org/html/GreyboxGrammarFuzzer.html},\n    urldate = {2024-01-21 13:07:50+01:00}\n}\n\n```"]