# 4 供应链攻击

当攻击者有意干扰软件开发或分发过程以影响该软件的用户时，就会发生软件 *供应链攻击*。

供应链攻击及其可能的缓解措施并不仅限于编译器。然而，编译器因其广泛部署给开发者、在持续集成系统和作为即时编译器（JITs）中使用而成为攻击的诱人目标。此外，如果一个受感染的编译器能够静默地将感染传播到使用或运行它的其他软件中，它可能会产生更大的影响。

本章探讨了涉及编译器的供应链攻击的历史以及可以采取哪些措施来预防它们。

## 4.1 供应链攻击的历史

早在 1974 年，Karger 和 Schell 就提出了通过 PL/I 编译器攻击 Multics 操作系统的理论 [@Karger1974]。在这场攻击中，向编译器中插入了一个陷阱门，然后它将恶意代码注入到生成的目标代码中。此外，陷阱门可以设计成重新插入编译器二进制文件中，这样未来的编译器在无需更改其源代码的情况下也会被静默感染。这种方法随后在 Ken Thompson 1984 年的 ACM 图灵奖获奖感言 *信任的反思* 中被普及化 [@Thompson1984]。

如果这些案例看起来有些牵强，那么考虑一下，已经有一些针对开发工具的供应链攻击的真实例子。

Induc 是一种病毒家族，它感染了 Delphi 工具链中的预编译库并注入恶意代码 [@Gostev2009]。当 Delphi 编译项目时，恶意库被包含在生成的可执行文件中，从而使得病毒能够传播。该病毒首次于 2009 年被发现，在此之前至少已经传播了一年。已知一些流行的应用程序已被感染，包括一个聊天客户端和一个媒体播放器。总的来说，全球检测到的受感染计算机超过十万台。

XcodeGhost 是 2015 年首次发现的恶意软件的名称，它感染了数千个 iOS 应用程序 [@Cox2015]。感染的源头被追踪到一个被木马化的 Xcode 工具版本。恶意软件存在于 Xcode 工具中的一个额外目标文件中，并在构建过程中静默地链接到每个应用程序中。文件共享网站被用来向不知情的开发者传播被木马化的 Xcode 工具。

在 2017 年发现的一项名为 ShadowPad 的供应链攻击中，发现了一个被木马化的链接器参与了攻击 [@Greenberg2019]。一些攻击实例使用了被木马化的 Visual Studio 链接器，它在构建应用程序时静默地将恶意库包含到应用程序中。名为 CCleaner 和 ShadowHammer 的相关攻击使用了相同的被木马化的链接器方法来感染构建的应用程序。这些攻击的受感染应用程序被分发到全球数百万用户。

这些案例突显出攻击编译器，尤其是链接器和库，是悄无声息地感染许多其他应用的可行途径，而且毫无疑问，未来将会有更多此类攻击。现在让我们探讨我们能做些什么来应对这些问题。

解释这些漏洞是如何产生的以及如何减轻它们。[#180](https://github.com/llsoftsec/llsoftsecbook/issues/180)
