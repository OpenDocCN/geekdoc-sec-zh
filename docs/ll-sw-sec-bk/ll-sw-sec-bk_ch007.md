# 7 物理攻击

这章可能应该移动到更高一级的“物理访问侧信道攻击”部分下 [#181](https://github.com/llsoftsec/llsoftsecbook/issues/181)

## 7.1 概述

存在许多类型的物理攻击 - 这些攻击方法侧重于系统（例如 CPU、GPU、加密硬件）的一个或多个物理属性，并且可以是

+   被动型 - 只监测物理量（例如侧信道信息泄露），或者

+   主动型 - 物理量的修改，例如，

    +   改变系统的操作条件，使电路超出其规范运行（例如通过改变温度，或通过施加故障到电源电压/时钟源）

    +   向系统注入故障（例如使用电磁脉冲注入或激光束改变系统的电气状态）

    +   物理修改系统/芯片

在本节的其余部分，我们将专注于物理攻击的一个子集：

+   侧信道信息泄露

+   使用故障的物理攻击

这两种攻击形式可以使用低成本硬件实施，并且研究人员已经在为物联网（IoT）应用开发的 SoC 或微控制器上广泛演示了这些攻击。

## 7.2 物理访问侧信道攻击

如果攻击者能够物理访问设备，即使没有调试访问权限，攻击者也可以收集处理器上程序执行的相关侧信道信息。如果处理器用于处理加密操作，这些侧信道信息可以用来推断加密密钥（或正在处理的数据）。请注意，某些形式的物理攻击（例如行 hammer 和 voltjockey 错误注入攻击）不需要物理访问，但这些攻击在本节中不予覆盖。

### 7.2.1 信息是如何泄露的？

最常见的物理访问侧信道攻击方法是捕获设备在运行期间的电压或电流消耗。每当触发器翻转时，开关活动会导致微小的电流尖峰。尽管芯片内部电源分配连接上存在电容，但寄存器（由触发器组成）的翻转仍然会导致电源电流的变化，这很容易观察到。因为供电（在电源、印刷电路板、芯片封装以及硅晶圆上）的连接也包含电阻，芯片电源中的电流变化也会导致电源电压的变化。同样，如果攻击者能够物理访问设备，这也可以很容易地观察到。如果攻击者能够访问能够记录电流/电压/功率模式的采集设备，他/她可以记录不同加密操作的“功率特征”，包括使用不同数据输入的功率特征。通过应用差分功率分析等分析技术，攻击者可以提取正在处理的信息。一种额外的侧信道泄露形式是电磁辐射。因为处理器的时钟频率通常在射频（RF）范围内，晶圆上的线和 PCB 上的轨迹成为小型天线，处理器电压/电流的波动产生射频信号。尽管辐射的射频功率可能很小，但这仍然意味着如果攻击者与设备近距离接触并拥有放大和记录射频功率特征的正确设备，他/她可以观察到侧信道泄露。然而，可以通过以下方式降低这种攻击的风险：使用以下方法减少辐射能量水平：

+   设备周围的屏蔽，包括电路板上的接地板。

+   印刷电路板上的电源轨迹上的耦合电容。

通常，这种攻击需要了解无线电电路技术，并且结果可能受其他因素影响。例如，在正常环境中，有许多其他射频噪声源会影响信号测量的准确性。在“嘈杂”环境中，附近各种无线通信设备的射频信号可能会淹没被监控设备的信号。

### 7.2.2 指令级别的侧信道泄露

指令执行可能导致各种形式的侧信道泄露：

由条件分支引起的循环定时 – 包含条件分支的代码序列可能导致可观察到的侧信道泄露。例如，如果几个代码段的功率特征容易识别（以下图中 A、B 和 C 过程），则可以检测到是否执行了条件分支。

![条件分支泄露](img/file8.svg)

条件分支泄露

由特定数据值引起的周期时间 – 一些指令的执行周期可能取决于输入数据的值，从而导致时间侧通道泄漏。例如，Arm Cortex-M 处理器中的整数除法指令。

![执行周期泄漏](img/file9.svg)

执行周期泄漏

由于值变化引起的功率变化 – 功率特征中的功率尖峰通常取决于设置了多少位以及寄存器（s）中翻转了多少位——所谓的汉明重量和汉明距离，因此尖峰的幅度可以用来猜测该时钟周期中的寄存器值。功率尖峰可能由以下组合引起

+   由于指令操作引起的逻辑切换（例如，单周期乘法器消耗的功率可能远高于布尔逻辑函数使用的功率），以及

+   由于寄存器银行和数据路径中数据值的变化引起的逻辑切换。

切换活动取决于前一个和下一个操作。如果特定指令周围的代码功率特征可识别，那么正在处理的数据值可能被猜测。

![翻转位数的泄漏](img/file10.svg)

翻转位数的泄漏

在某些 SoC 或微控制器实现中，操作的功率尖峰效应可能远高于寄存器银行中数据值变化的效应。在这种情况下，程序执行流程可以被观察到，因此也可能间接泄露关于其处理的数据的信息。

### 7.2.3 对策

对于没有物理保护功能的普通嵌入式设备，功率/电压/辐射侧通道导致信息泄漏的可能性要高得多。然而，一些时间特征泄漏方面可以减少：

+   使用数据独立定时（DIT）的数据处理指令进行加密操作。在最近的 Arm 架构（包括 Armv8-A 和 Armv8-M）中，一些指令在架构上定义为 DIT（数据独立定时）。

+   对于条件分支，其中条件取决于秘密数据，使用表分支可能有助于减少基于时间的泄漏（两条路径都会导致分支）。没有必要替换所有条件分支。例如，加密操作中的许多循环计数器可以独立于加密密钥或输入数据值，因此没有必要更改这些循环。

与“时间侧通道”部分有重叠。如何最好地整合？ [#182](https://github.com/llsoftsec/llsoftsecbook/issues/182)

有一些额外的软件技术可以减轻功耗泄漏。最著名的技巧之一是掩码（例如，布尔、乘法、仿射）。在应用软件缓解措施时，软件开发者需要检查编译器（C/C++）执行的优化是否会影响缓解措施，因为编译器可能非常智能，为了执行更快的操作（或减少代码大小）可能会取消掩码。

## 7.3 故障注入攻击

### 7.3.1 常见的故障注入攻击形式

如果攻击者可以物理访问设备，他们也可以选择使用物理攻击来修改软件的行为，例如，在设备的初始化序列中阻止软件设置某些安全功能。这类攻击中最常见的两种形式是电压毛刺和时钟毛刺。

![常见的故障注入攻击](img/file11.svg)

常见的故障注入攻击

+   电压毛刺攻击

    +   使用能够快速切换电压级别的可编程电源，可以在软件执行的特定时钟周期内减小/增加芯片的电源电压。在某些情况下，精确的电压下降可能导致处理器“跳过”一条指令，例如，写入内存或硬件寄存器可能不会被处理。或者，如果已经发生了写入，实际使用的写入值可能会因电压毛刺而改变。

+   时钟毛刺攻击

    +   使用时钟切换电路，可以减小时钟脉冲的宽度，或者两个时钟脉冲之间的间隔，这样在某些时钟边缘时，一些硬件寄存器可能无法正确更新。类似于电压毛刺，这会使硬件看起来跳过了某条指令。

这种电压/时钟毛刺攻击可能会影响处理器中的多个部分，但有时影响可能不会导致任何明显的操作错误，只会留下处理器跳过内存/寄存器写入或写入错误值的唯一效果。潜在地，毛刺攻击可能导致其他可观察的效果（例如，寄存器复位，位翻转）。程序或指令执行级别的故障注入方法（及其物理效应）和可观察效果通常被称为故障模型，其中可以说特定的故障注入表现为指令跳过等。关于故障模型概念的更多详细信息，请参阅论文[“Fault Attacks on Secure Embedded Software: Threats, Design and Evaluation”](https://arxiv.org/pdf/2003.10513.pdf)，其中该论文的第 1 图很好地展示了这一概念。

将上述参考内容使用 bibtex 格式。[#159](https://github.com/llsoftsec/llsoftsecbook/issues/159)

使用毛刺方法，有几种常见的攻击系统的方式。例如：

+   在安全特性设置序列中跳过指令——例如，跳过写入 MPU（内存保护单元）/安全属性单元（SAU）的操作，以便 MPU/SAU 不被启用。

+   在安全认证后跳过指令，该指令跳转到错误处理代码。由于分支没有被采取，即使安全认证失败，代码也可以继续运行。

+   在内存或硬件中写入不正确的值。例如，当将加密密钥写入加密加速器时，强制写入的密钥值为零（导致总线硬件电压降低）。

示例：[针对 Armv8-M TrustZone 的攻击](https://www.youtube.com/watch?v=4u6BAH8mEDw)

还有其他形式的物理攻击，但大多数都需要大量的努力或成本（例如，割开芯片封装可以执行故障注入或读取芯片上的秘密数据）。

### 7.3.2 反制措施

理想情况下，系统设计师可以使用支持故障注入防护的硬件（如 SoC 或微控制器）。例如，硬件电路可以包括冗余逻辑（空间和时间）。此外，软件开发者可以通过在写操作后添加检查来使这种攻击更困难。当应用软件缓解措施时，软件开发者需要检查编译器（C/C++）执行的优化不会影响缓解措施。
