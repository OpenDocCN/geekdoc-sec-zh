# 第三章? 函数开始和结束

函数开始的指令,是像下面这样的代码片段:

```cpp
#!bash
push    ebp
mov     ebp, esp
sub     esp, X 
```

这些指令做了什么:将寄存器 EBP 的值入栈,将 ESP 赋值给 EBP,在栈中分配空间, 用来保存局部变量。

在函数执行过程中,EBP 是固定的,可以用来访问局部变量和函数参数。也可以使用 ESP,但在函数运行过程中,ESP 会变化,使用起来不方便。

```cpp
#!bash
mov    esp, ebp
pop    ebp
ret    0 
```

函数在运行结束时,会释放在栈中所申请的内存,EBP 的值出栈,将代码控制权还原 给调用者。

## 3.1 递归

函数调用开始和结束使递归变得难以理解。

举个例子,有一次我写了一个函数遍历二叉树右侧节点。使用了看起来很高?上的递归函数,但由于每次函数调用开始和结束都需要花费很长时间,它运行速度比迭代方 式要慢好多倍。

顺便提一下,这就是尾部调用存在的原因。